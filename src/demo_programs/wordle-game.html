<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <style>body {
            background-color: rgb(68, 114, 196);
            height: 100vh;
            width: 100%;
            overflow: hidden;
            margin: 0;
            padding: 0;
          }
          
          #display {
            background-color: white;
            overflow: hidden;
            aspect-ratio: 4/3;
            height: 100vh;
            position: relative;
          }
          
          #block-graphics,
          #vector-graphics,
          #printed-text {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
          }
          
          #printed-text,
          #printed-text input {
            color: black;
            border-color: white;
            font-style: normal;
            font-family: consolas, monospace;
            font-size: 11pt;
          }
          
          #printed-text {
            white-space: pre;
            z-index: 20;
            padding: 2px;
            overflow-y: auto;
          }
          
          #printed-text input:focus {
            background-color: var(--selection);
            width: 100%;
          }
          
          #vector-graphics {
            z-index: 10;
          }
          
          #block-graphics {
            width: 100%;
            height: 100%;
            display: grid;
            grid-template-columns: repeat(40, 1fr);
            grid-template-rows: repeat(30, 1fr);
          }
          
          #block-graphics div {
            container: block / size;
            font-size: 0.7cqw;
            text-align: center;
          }</style>
        <title>Elan program</title>
    </head>
    <body>
        <div id="display" tabindex="1">
            <div id="printed-text"></div>
            <div id="block-graphics"></div>
            <div id="vector-graphics"></div>
        </div>
        <script type="text/javascript">"use strict";
(() => {
  // src/ide/web/ui-helpers.ts
  function checkIsChrome() {
    const isChromium = window.chrome;
    const winNav = window.navigator;
    const vendorName = winNav.vendor;
    const isOpera = typeof window.opr !== "undefined";
    const _isFirefox = winNav.userAgent.indexOf("Firefox") > -1;
    const isIEedge = winNav.userAgent.indexOf("Edg") > -1;
    const isIOSChrome = winNav.userAgent.match("CriOS");
    const isGoogleChrome = typeof winNav.userAgentData !== "undefined" ? winNav.userAgentData.brands.some((b) => b.brand === "Google Chrome") : vendorName === "Google Inc.";
    const isChrome2 = isChromium !== null && typeof isChromium !== "undefined" && vendorName === "Google Inc." && isOpera === false && isIEedge === false && isGoogleChrome;
    if (isIOSChrome) {
      return true;
    } else if (isChrome2 || isIEedge) {
      return true;
    } else {
      return false;
    }
  }
  function confirmContinueOnNonChromeBrowser() {
    return confirm(
      `Elan is compatible with the Chrome or Edge browser. It does not work correctly in Firefox or Safari.`
    );
  }
  function readMsg(value) {
    return { type: "read", value };
  }
  function errorMsg(value) {
    return { type: "status", status: "error", error: value };
  }

  // src/compiler/standard-library/elan-runtime-error.ts
  var ElanRuntimeError = class extends Error {
    constructor(err) {
      super(err instanceof Error ? err.message : err);
      this.err = err;
    }
    useLine(token) {
      return !(token.startsWith("data") || token.startsWith("http") || token.startsWith("async") || token.startsWith("Array") || token.startsWith("System") || token.startsWith("onmessage"));
    }
    updateLine0(l0) {
      if (l0.startsWith("RangeError")) {
        return "Error: Stack Overflow";
      }
      return l0;
    }
    get elanStack() {
      const jsStack = this.err instanceof Error ? this.err.stack : this.stack;
      const elanStack = [];
      if (jsStack) {
        let lines = jsStack.split("\n").map((l) => l.trim());
        if (lines.length > 0) {
          elanStack.push(this.updateLine0(lines[0]));
          lines = lines.slice(1);
          for (const l of lines) {
            const line = l.split(" ");
            if (line.length > 1) {
              let fn = line[1];
              fn = fn === "runTests" ? "test" : fn;
              fn = fn === "System.printLine" ? "print" : fn;
              if (this.useLine(fn)) {
                elanStack.push(`at ${fn}`);
              }
            }
          }
        }
      }
      if (elanStack.length > 0) {
        return elanStack.join("\n");
      }
      return "";
    }
  };

  // src/compiler/keywords.ts
  var abstractKeyword = "abstract";
  var classKeyword = "class";
  var copyKeyword = "copy";
  var emptyKeyword = "empty";
  var functionKeyword = "function";
  var ifKeyword = "if";
  var lambdaKeyword = "lambda";
  var newKeyword = "new";
  var privateKeyword = "private";
  var procedureKeyword = "procedure";
  var propertyKeyword = "property";
  var abstractPropertyKeywords = abstractKeyword + " " + propertyKeyword;
  var abstractProcedureKeywords = abstractKeyword + " " + procedureKeyword;
  var abstractFunctionKeywords = abstractKeyword + " " + functionKeyword;
  var privatePropertyKeywords = privateKeyword + " " + propertyKeyword;
  var privateProcedureKeywords = privateKeyword + " " + procedureKeyword;
  var privateFunctionKeywords = privateKeyword + " " + functionKeyword;
  var abstractClassKeywords = abstractKeyword + " " + classKeyword;

  // src/compiler/symbols/elan-type-names.ts
  var BooleanName = "Boolean";
  var IntName = "Int";
  var FloatName = "Float";
  var StringName = "String";
  var RegExpName = "RegExp";
  var FuncName = "Func";
  var TupleName = "Tuple";

  // src/compiler/compiler-interfaces/type-options.ts
  var noTypeOptions = {
    isImmutable: false,
    isAbstract: false,
    isIndexable: false,
    isDoubleIndexable: false,
    isIterable: false
  };
  var immutableTypeOptions = {
    isImmutable: true,
    isAbstract: false,
    isIndexable: false,
    isDoubleIndexable: false,
    isIterable: false
  };

  // src/compiler/symbols/int-type.ts
  var IntType = class _IntType {
    constructor() {
    }
    initialValue = "0";
    typeOptions = immutableTypeOptions;
    static Instance = new _IntType();
    name = IntName;
    toString() {
      return this.name;
    }
    isAssignableFrom(otherType) {
      return otherType instanceof _IntType;
    }
  };

  // src/compiler/symbols/float-type.ts
  var FloatType = class _FloatType {
    constructor() {
    }
    initialValue = "0";
    typeOptions = immutableTypeOptions;
    static Instance = new _FloatType();
    name = FloatName;
    toString() {
      return this.name;
    }
    isNumber(st) {
      return st instanceof IntType || st instanceof _FloatType;
    }
    isAssignableFrom(otherType) {
      return this.isNumber(otherType);
    }
  };

  // src/compiler/symbols/unknown-type.ts
  var UnknownType = class _UnknownType {
    constructor() {
    }
    initialValue = "";
    typeOptions = immutableTypeOptions;
    static Instance = new _UnknownType();
    name = "Unknown";
    toString() {
      return this.name;
    }
    isAssignableFrom(_otherType) {
      return true;
    }
  };

  // src/compiler/syntax-nodes/empty-asn.ts
  var EmptyAsn = class _EmptyAsn {
    constructor(fieldId) {
      this.fieldId = fieldId;
    }
    indent() {
      return "";
    }
    items = [];
    id = "";
    symbolScope = 9 /* unknown */;
    compileErrors = [];
    compile() {
      return ``;
    }
    symbolType() {
      return UnknownType.Instance;
    }
    get value() {
      return _EmptyAsn.Instance;
    }
    toString() {
      return "";
    }
    static Instance = new _EmptyAsn("");
  };

  // src/compiler/compiler-interfaces/elan-type-interfaces.ts
  var elanMetadataKey = Symbol("elan-metadata");

  // src/compiler/symbols/boolean-type.ts
  var BooleanType = class _BooleanType {
    constructor() {
    }
    typeOptions = immutableTypeOptions;
    initialValue = "false";
    static Instance = new _BooleanType();
    name = BooleanName;
    toString() {
      return this.name;
    }
    isAssignableFrom(otherType) {
      return otherType instanceof _BooleanType;
    }
  };

  // src/compiler/symbols/tuple-type.ts
  var TupleType = class _TupleType {
    constructor(ofTypes) {
      this.ofTypes = ofTypes;
    }
    typeOptions = immutableTypeOptions;
    get initialValue() {
      const init = this.ofTypes.map((t) => t.initialValue).join(", ");
      return `system.emptyTuple([${init}])`;
    }
    get name() {
      return `tuple(${this.ofTypes.map((t) => t.name).join(", ")})`;
    }
    toString() {
      return `tuple(${this.ofTypes.map((t) => t.name).join(", ")})`;
    }
    isAssignableFrom(otherType) {
      if (otherType instanceof _TupleType) {
        if (this.ofTypes.length !== otherType.ofTypes.length) {
          return false;
        }
        return this.ofTypes.map((t, i) => t.isAssignableFrom(otherType.ofTypes[i])).every((b) => b);
      }
      return false;
    }
  };

  // src/compiler/symbols/function-type.ts
  var FunctionType = class _FunctionType {
    constructor(parameterNames2, parameterTypes, returnType, isExtension, isPure, isAsync, deprecated) {
      this.parameterNames = parameterNames2;
      this.parameterTypes = parameterTypes;
      this.returnType = returnType;
      this.isExtension = isExtension;
      this.isPure = isPure;
      this.isAsync = isAsync;
      this.deprecated = deprecated;
    }
    get initialValue() {
      return `system.emptyFunc(${this.returnType.initialValue})`;
    }
    // so can have mutable type parameters
    typeOptions = noTypeOptions;
    get name() {
      return `Func<of ${this.parameterTypes.map((p) => p.name).join(", ")} => ${this.returnType.name}>`;
    }
    toString() {
      return FuncName;
    }
    isAssignableFrom(otherType) {
      if (otherType instanceof _FunctionType) {
        if (this.parameterTypes.length !== otherType.parameterTypes.length) {
          return false;
        }
        const rt = this.returnType.isAssignableFrom(otherType.returnType);
        return rt && this.parameterTypes.map((t, i) => t.isAssignableFrom(otherType.parameterTypes[i])).every((b) => b);
      }
      return false;
    }
  };

  // src/compiler/symbols/unknown-symbol.ts
  var UnknownSymbol = class {
    constructor(id) {
      this.symbolId = id ?? "";
    }
    symbolId = "";
    symbolType = () => UnknownType.Instance;
    symbolScope = 9 /* unknown */;
    name = "Unknown Symbol";
  };

  // src/compiler/symbols/generic-parameter-type.ts
  var GenericParameterType = class _GenericParameterType {
    constructor(id, constraint) {
      this.id = id;
      this.constraint = constraint;
    }
    typeOptions = noTypeOptions;
    initialValue = "";
    get name() {
      return this.constraint ? `${this.constraint.name}` : `Generic Parameter ${this.id}`;
    }
    toString() {
      return this.name;
    }
    isAssignableFrom(otherType) {
      if (otherType instanceof _GenericParameterType) {
        return this.name === otherType.name;
      }
      return false;
    }
  };

  // src/compiler/symbols/null-scope.ts
  var NullScope = class _NullScope {
    resolveSymbol(_id, _scope) {
      return new UnknownSymbol();
    }
    resolveOwnSymbol(_id) {
      return new UnknownSymbol();
    }
    getParentScope() {
      return _NullScope.Instance;
    }
    symbolMatches(_id, _all, _initialScope) {
      return [];
    }
    getChildren() {
      return [];
    }
    symbolId = "";
    symbolType = () => UnknownType.Instance;
    symbolScope = 9 /* unknown */;
    static Instance = new _NullScope();
  };

  // src/compiler/symbols/regexp-type.ts
  var RegExpType = class _RegExpType {
    constructor() {
    }
    initialValue = "system.emptyRegExp()";
    typeOptions = immutableTypeOptions;
    static Instance = new _RegExpType();
    name = RegExpName;
    toString() {
      return this.name;
    }
    isAssignableFrom(otherType) {
      return otherType instanceof _RegExpType;
    }
  };

  // src/compiler/symbols/string-type.ts
  var StringType = class _StringType {
    constructor() {
    }
    get ofTypes() {
      return [_StringType.Instance];
    }
    initialValue = '""';
    get typeOptions() {
      return {
        isImmutable: true,
        isAbstract: false,
        isIndexable: true,
        isDoubleIndexable: false,
        isIterable: true
      };
    }
    static Instance = new _StringType();
    name = StringName;
    toString() {
      return this.name;
    }
    isAssignableFrom(otherType) {
      return otherType instanceof _StringType;
    }
  };

  // src/compiler/symbols/elan-symbols.ts
  var intSymbol = {
    symbolId: IntType.Instance.name,
    symbolType: function() {
      return IntType.Instance;
    },
    symbolScope: 3 /* program */
  };
  var floatSymbol = {
    symbolId: FloatType.Instance.name,
    symbolType: function() {
      return FloatType.Instance;
    },
    symbolScope: 3 /* program */
  };
  var stringSymbol = {
    symbolId: StringType.Instance.name,
    symbolType: function() {
      return StringType.Instance;
    },
    symbolScope: 3 /* program */
  };
  var booleanSymbol = {
    symbolId: BooleanType.Instance.name,
    symbolType: function() {
      return BooleanType.Instance;
    },
    symbolScope: 3 /* program */
  };
  var regExpSymbol = {
    symbolId: RegExpType.Instance.name,
    symbolType: function() {
      return RegExpType.Instance;
    },
    symbolScope: 3 /* program */
  };
  var tupleSymbol = {
    symbolId: TupleName,
    symbolType: function() {
      return new TupleType([new GenericParameterType("T1"), new GenericParameterType("T2")]);
    },
    symbolScope: 3 /* program */,
    isClass: true,
    isAbstract: true,
    isNotInheritable: true,
    ofTypes: [new GenericParameterType("T1"), new GenericParameterType("T2")]
  };
  var funcSymbol = {
    symbolId: FuncName,
    symbolType: function() {
      return new FunctionType(
        ["T"],
        [new GenericParameterType("T")],
        new GenericParameterType("T1"),
        false,
        true,
        false
      );
    },
    symbolScope: 3 /* program */,
    isClass: true,
    isAbstract: true,
    isNotInheritable: true,
    ofTypes: [new GenericParameterType("T")]
  };

  // src/compiler/syntax-nodes/ast-helpers.ts
  var opMap = /* @__PURE__ */ new Map([
    [0 /* Add */, "+"],
    [1 /* Minus */, "-"],
    [2 /* Not */, "not"],
    [3 /* Multiply */, "*"],
    [4 /* And */, "and"],
    [5 /* Equals */, "is"],
    [6 /* LT */, "<"],
    [7 /* GT */, ">"],
    [8 /* GTE */, ">="],
    [9 /* LTE */, "<="],
    [10 /* Div */, "div"],
    [11 /* Mod */, "mod"],
    [12 /* Divide */, "/"],
    [13 /* NotEquals */, "isnt"],
    [14 /* Pow */, "^"],
    [15 /* Or */, "or"]
  ]);

  // src/ide/frames/symbol-completion-helpers.ts
  var KeywordCompletion = class _KeywordCompletion {
    constructor(keyword, spaceAfter, dotAfter, openBracketAfter) {
      this.keyword = keyword;
      this.spaceAfter = spaceAfter;
      this.dotAfter = dotAfter;
      this.openBracketAfter = openBracketAfter;
    }
    static map = /* @__PURE__ */ new Map();
    static create(keyword, spaceAfter = true, dotAfter = false, openBracketAfter = false) {
      if (!this.map.has(keyword)) {
        this.map.set(keyword, new _KeywordCompletion(keyword, spaceAfter, dotAfter, openBracketAfter));
      }
      return this.map.get(keyword);
    }
    static reset() {
      this.map.clear();
    }
  };

  // src/ide/frames/parse-nodes/parse-node-helpers.ts
  var allIds = [
    5 /* id_constant */,
    0 /* id_let */,
    4 /* id_parameter_out */,
    3 /* id_parameter_regular */,
    2 /* id_property */,
    1 /* id_variable */,
    6 /* id_enumValue */
  ];
  var allMethods = [
    12 /* method_function */,
    12 /* method_function */,
    13 /* method_system */
  ];
  var allIdsAndMethods = [
    5 /* id_constant */,
    0 /* id_let */,
    4 /* id_parameter_out */,
    3 /* id_parameter_regular */,
    2 /* id_property */,
    1 /* id_variable */,
    6 /* id_enumValue */,
    12 /* method_function */,
    12 /* method_function */,
    13 /* method_system */
  ];
  var assignableIds = [
    4 /* id_parameter_out */,
    1 /* id_variable */,
    2 /* id_property */
  ];
  var concreteAndAbstractTypes = [
    8 /* type_abstract */,
    10 /* type_notInheritable */,
    7 /* type_concrete */,
    9 /* type_enum */
  ];
  var allKeywordsThatCanStartAnExpression = new Set(
    [newKeyword, copyKeyword, ifKeyword, lambdaKeyword, emptyKeyword].map(
      (kw) => KeywordCompletion.create(kw)
    )
  );

  // src/compiler/elan-type-annotations.ts
  var ElanValueTypeDescriptor = class {
    constructor(name, ofType, valueType) {
      this.name = name;
      this.ofType = ofType;
      this.valueType = valueType;
    }
    isConstant = true;
    mapType(_scope) {
      switch (this.name) {
        case FloatName:
          return FloatType.Instance;
        case StringName:
          return StringType.Instance;
        case IntName:
          return IntType.Instance;
        case BooleanName:
          return BooleanType.Instance;
        case RegExpName:
          return RegExpType.Instance;
      }
      throw new Error("NotImplemented: " + this.name);
    }
  };
  var ElanGenericTypeDescriptor = class {
    constructor(name, constraint) {
      this.name = name;
      this.constraint = constraint;
    }
    isConstant = true;
    mapType(scope) {
      return new GenericParameterType(this.name, this.constraint?.mapType(scope));
    }
  };
  var ElanInt = new ElanValueTypeDescriptor(IntName);
  var ElanFloat = new ElanValueTypeDescriptor(FloatName);
  var ElanString = new ElanValueTypeDescriptor(StringName);
  var ElanBoolean = new ElanValueTypeDescriptor(BooleanName);
  var ElanRegExp = new ElanValueTypeDescriptor(RegExpName);
  var ElanT1 = new ElanGenericTypeDescriptor("T1");
  var ElanT2 = new ElanGenericTypeDescriptor("T2");

  // src/ide/frames/file-impl.ts
  var fileErrorPrefix = `Cannot load file:`;
  var cannotLoadFile = `${fileErrorPrefix} it has been created or modified outside Elan IDE`;

  // src/ide/web/web-helpers.ts
  function checkForUnclosedHtmlTag(text) {
    if (/<[A-Za-z!\/?][^>]*$/.test(text)) {
      throw new ElanRuntimeError(
        "Unclosed HTML tag in printed text '" + text.replace(/</g, "&lt;") + "'"
      );
    }
  }
  function sanitiseHtml(text) {
    return text.replaceAll("&", "&amp;").replaceAll("<", "&lt;").replaceAll(">", "&gt;");
  }

  // src/ide/web/web-input-output.ts
  var WebInputOutput = class {
    keyBuffer = [];
    display;
    lastDirId = "elan-data";
    constructor() {
      this.display = document.getElementById("display");
      this.display.addEventListener("keydown", (k) => {
        if (k.key === "Shift" || k.key === "Control" || k.key === "Alt") {
          return;
        }
        this.keyBuffer.push(k);
      });
      this.display.focus();
    }
    breakPoint(_allScopedSymbols, _id, _singlestep) {
      throw new Error("Method not implemented.");
    }
    useChromeFileAPI() {
      return "showOpenFilePicker" in self;
    }
    chooser() {
      const f = document.createElement("input");
      const g = this.display;
      f.style.display = "none";
      f.type = "file";
      f.name = "file";
      g.appendChild(f);
      return f;
    }
    chromeChooser() {
      const f = document.createElement("input");
      const g = this.display;
      f.style.display = "none";
      g.appendChild(f);
      return f;
    }
    readFileChrome() {
      let fileHandle;
      const chooser = this.chromeChooser();
      return new Promise((rs, rj) => {
        chooser.addEventListener("click", async () => {
          try {
            [fileHandle] = await window.showOpenFilePicker({
              startIn: "documents",
              id: this.lastDirId
            });
            const file = await fileHandle.getFile();
            if (file.type !== "text/plain") {
              rj(`cannot load non text file ${file.name} of type ${file.type}`);
            } else {
              const contents = await file.text();
              rs(contents);
            }
          } catch (_e) {
            rj("read cancelled");
          }
        });
        chooser.click();
        this.display?.removeChild(chooser);
      });
    }
    readFile() {
      if (this.useChromeFileAPI()) {
        return this.readFileChrome();
      }
      const inp = this.chooser();
      return new Promise((rs, rj) => {
        inp.addEventListener("change", (event) => {
          const elanFile = event.target.files?.[0];
          if (elanFile) {
            if (elanFile.type !== "text/plain") {
              rj(`cannot load non text file ${elanFile.name} of type ${elanFile.type}`);
            } else {
              const reader = new FileReader();
              reader.addEventListener("load", (event2) => {
                const content = event2.target.result;
                rs(content);
              });
              reader.readAsText(elanFile);
            }
          }
          event.preventDefault();
        });
        inp.addEventListener("cancel", (event) => {
          rj("read cancelled");
          event.preventDefault();
        });
        inp.click();
      });
    }
    async writeFileChrome(fileName, data) {
      try {
        const fh = await self.showSaveFilePicker({
          suggestedName: fileName,
          startIn: "documents",
          id: this.lastDirId
        });
        const writeable = await fh.createWritable();
        await writeable.write(data);
        return await writeable.close();
      } catch (_e) {
        throw new Error("write cancelled");
      }
    }
    writeFile(fileName, data) {
      if (!fileName) {
        fileName = "untitled.txt";
      }
      if (!fileName.endsWith(".txt")) {
        fileName = `${fileName}.txt`;
      }
      if (this.useChromeFileAPI()) {
        return this.writeFileChrome(fileName, data);
      }
      return new Promise((rs, rj) => {
        try {
          const blob = new Blob([data], { type: "text/plain" });
          const aElement = document.createElement("a");
          aElement.setAttribute("download", fileName);
          const href = URL.createObjectURL(blob);
          aElement.href = href;
          aElement.setAttribute("target", "_blank");
          aElement.click();
          URL.revokeObjectURL(href);
          rs();
        } catch (_e) {
          rj("write cancelled");
        }
      });
    }
    drawBlockGraphics(html) {
      document.getElementById("block-graphics").innerHTML = html;
      this.display.focus();
      return Promise.resolve();
    }
    clearBlockGraphics() {
      this.clearKeyBuffer();
      return this.drawBlockGraphics("");
    }
    drawVectorGraphics(html) {
      document.getElementById("vector-graphics").innerHTML = html;
      this.display.focus();
      return Promise.resolve();
    }
    clearVectorGraphics() {
      this.clearKeyBuffer();
      return this.drawVectorGraphics("");
    }
    async clearDisplay() {
      this.clearKeyBuffer();
      await this.clearPrintedText();
      await this.clearHtml();
      await this.clearBlockGraphics();
      return this.clearVectorGraphics();
    }
    finished() {
      this.cancelWaits = true;
    }
    cancelWaits = false;
    printedText = "";
    currentInterval;
    async printLine(text) {
      await this.print(`${text}
`);
      const element = document.getElementById("printed-text");
      element.scrollTop = element.scrollHeight;
      return Promise.resolve();
    }
    async print(text) {
      this.printedText = `${this.printedText}${sanitiseHtml(text)}`;
      await this.renderPrintedText();
      return Promise.resolve();
    }
    async printTab(position, text) {
      const lastNl = this.printedText.lastIndexOf("\n");
      const spaces = "                                                                                ";
      const charsSinceNl = this.printedText.length - lastNl;
      const tab = spaces.substring(0, position - charsSinceNl + 1);
      this.printedText = `${this.printedText}${tab}${sanitiseHtml(text)}`;
      await this.renderPrintedText();
      return Promise.resolve();
    }
    stopReading() {
      clearInterval(this.currentInterval);
      this.display.focus();
      return Promise.resolve();
    }
    async readLine() {
      await this.renderPrintedText();
      const div = document.getElementById("printed-text");
      const inp = document.createElement("input");
      inp.id = "inp";
      inp.type = "text";
      inp.autofocus = true;
      inp.tabIndex = 2;
      div.appendChild(inp);
      inp.focus();
      this.cancelWaits = false;
      return new Promise((rs) => {
        let entered = false;
        inp.addEventListener("keydown", (k) => {
          entered = k.key === "Enter";
        });
        this.currentInterval = setInterval(async () => {
          if (this.cancelWaits) {
            clearInterval(this.currentInterval);
            rs("");
          } else if (entered) {
            rs(inp.value);
            this.stopReading();
            const v = inp.value.replace(/</g, "&lt;");
            div.removeChild(inp);
            await this.printLine(v);
          }
        }, 250);
      });
    }
    waitForAnyKey() {
      this.cancelWaits = false;
      return new Promise((rs) => {
        const timeOut = setInterval(async () => {
          if (this.cancelWaits || await this.getKey() !== "") {
            clearInterval(timeOut);
            rs();
          }
        }, 250);
      });
    }
    waitForKey() {
      this.cancelWaits = false;
      return new Promise((rs) => {
        const timeOut = setInterval(async () => {
          const key = await this.getKey();
          if (this.cancelWaits || key !== "") {
            clearInterval(timeOut);
            rs(key);
          }
        }, 250);
      });
    }
    getKey() {
      this.display.focus();
      const evt = this.keyBuffer[0];
      this.keyBuffer = this.keyBuffer.slice(1);
      const ks = evt ? evt.key : "";
      return Promise.resolve(ks);
    }
    getModKey(e) {
      return e.ctrlKey ? "Control" : e.shiftKey ? "Shift" : e.altKey ? "Alt" : "";
    }
    getKeyWithModifier() {
      this.display.focus();
      const evt = this.keyBuffer.pop();
      const ks = evt ? [evt.key, this.getModKey(evt)] : ["", ""];
      return Promise.resolve(ks);
    }
    clearKeyBuffer() {
      this.keyBuffer = [];
      return Promise.resolve();
    }
    clearSystemInfo() {
      document.getElementById("system-info").innerHTML = "";
      return Promise.resolve();
    }
    async renderPrintedText() {
      const div = document.getElementById("printed-text");
      div.innerHTML = this.printedText;
      return Promise.resolve();
    }
    async clearPrintedText() {
      this.printedText = "";
      await this.renderPrintedText();
      return Promise.resolve();
    }
    wrapHtmlInSrcdoc(s) {
      return `<head><link href='styles/ide.css' rel='stylesheet'/></head><body><div id='display-html'>${s}</div></body>`;
    }
    wrapHtmlInIframe(s) {
      return `<iframe id="display-html-sandbox" sandbox seamless srcdoc="${this.wrapHtmlInSrcdoc(s)}"</iframe>`;
    }
    drawHtml(html) {
      checkForUnclosedHtmlTag(html);
      const div = document.getElementById("display-html");
      const iframe = document.getElementById("display-html-sandbox");
      if (!iframe) {
        div.innerHTML = this.wrapHtmlInIframe(html);
      } else {
        iframe.srcdoc = this.wrapHtmlInSrcdoc(html);
      }
      return new Promise((rs) => setTimeout(() => rs(), 50));
    }
    clearHtml() {
      document.getElementById("display-html").innerHTML = "";
      return Promise.resolve();
    }
    _audioCtx;
    get audioCtx() {
      if (!this._audioCtx) {
        this._audioCtx = new AudioContext();
      }
      return this._audioCtx;
    }
    tone(duration, frequency, volume) {
      return new Promise((rs) => {
        const ac = this.audioCtx;
        const oscillator = ac.createOscillator();
        const gainNode = ac.createGain();
        oscillator.connect(gainNode);
        gainNode.connect(ac.destination);
        gainNode.gain.value = volume;
        oscillator.frequency.value = frequency;
        oscillator.type = "sine";
        oscillator.onended = (_e) => rs();
        oscillator.start(ac.currentTime);
        oscillator.stop(ac.currentTime + duration / 1e3);
      });
    }
  };

  // src/ide/web/standalone.ts
  var displayDiv = document.getElementById("display");
  var elanInputOutput = new WebInputOutput();
  var runWorker;
  var jsCode = `data:text/javascript;base64,dmFyIF9fY3JlYXRlID0gT2JqZWN0LmNyZWF0ZTsKdmFyIF9fZGVmUHJvcCA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eTsKdmFyIF9fZ2V0T3duUHJvcERlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yOwp2YXIgX19nZXRPd25Qcm9wTmFtZXMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lczsKdmFyIF9fZ2V0UHJvdG9PZiA9IE9iamVjdC5nZXRQcm90b3R5cGVPZjsKdmFyIF9faGFzT3duUHJvcCA9IE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHk7CnZhciBfX2NvbW1vbkpTID0gKGNiLCBtb2QpID0+IGZ1bmN0aW9uIF9fcmVxdWlyZSgpIHsKICByZXR1cm4gbW9kIHx8ICgwLCBjYltfX2dldE93blByb3BOYW1lcyhjYilbMF1dKSgobW9kID0geyBleHBvcnRzOiB7fSB9KS5leHBvcnRzLCBtb2QpLCBtb2QuZXhwb3J0czsKfTsKdmFyIF9fY29weVByb3BzID0gKHRvLCBmcm9tLCBleGNlcHQsIGRlc2MpID0+IHsKICBpZiAoZnJvbSAmJiB0eXBlb2YgZnJvbSA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIGZyb20gPT09ICJmdW5jdGlvbiIpIHsKICAgIGZvciAobGV0IGtleSBvZiBfX2dldE93blByb3BOYW1lcyhmcm9tKSkKICAgICAgaWYgKCFfX2hhc093blByb3AuY2FsbCh0bywga2V5KSAmJiBrZXkgIT09IGV4Y2VwdCkKICAgICAgICBfX2RlZlByb3AodG8sIGtleSwgeyBnZXQ6ICgpID0+IGZyb21ba2V5XSwgZW51bWVyYWJsZTogIShkZXNjID0gX19nZXRPd25Qcm9wRGVzYyhmcm9tLCBrZXkpKSB8fCBkZXNjLmVudW1lcmFibGUgfSk7CiAgfQogIHJldHVybiB0bzsKfTsKdmFyIF9fdG9FU00gPSAobW9kLCBpc05vZGVNb2RlLCB0YXJnZXQpID0+ICh0YXJnZXQgPSBtb2QgIT0gbnVsbCA/IF9fY3JlYXRlKF9fZ2V0UHJvdG9PZihtb2QpKSA6IHt9LCBfX2NvcHlQcm9wcygKICAvLyBJZiB0aGUgaW1wb3J0ZXIgaXMgaW4gbm9kZSBjb21wYXRpYmlsaXR5IG1vZGUgb3IgdGhpcyBpcyBub3QgYW4gRVNNCiAgLy8gZmlsZSB0aGF0IGhhcyBiZWVuIGNvbnZlcnRlZCB0byBhIENvbW1vbkpTIGZpbGUgdXNpbmcgYSBCYWJlbC0KICAvLyBjb21wYXRpYmxlIHRyYW5zZm9ybSAoaS5lLiAiX19lc01vZHVsZSIgaGFzIG5vdCBiZWVuIHNldCksIHRoZW4gc2V0CiAgLy8gImRlZmF1bHQiIHRvIHRoZSBDb21tb25KUyAibW9kdWxlLmV4cG9ydHMiIGZvciBub2RlIGNvbXBhdGliaWxpdHkuCiAgaXNOb2RlTW9kZSB8fCAhbW9kIHx8ICFtb2QuX19lc01vZHVsZSA/IF9fZGVmUHJvcCh0YXJnZXQsICJkZWZhdWx0IiwgeyB2YWx1ZTogbW9kLCBlbnVtZXJhYmxlOiB0cnVlIH0pIDogdGFyZ2V0LAogIG1vZAopKTsKdmFyIF9fZGVjb3JhdGVDbGFzcyA9IChkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwga2luZCkgPT4gewogIHZhciByZXN1bHQgPSBraW5kID4gMSA/IHZvaWQgMCA6IGtpbmQgPyBfX2dldE93blByb3BEZXNjKHRhcmdldCwga2V5KSA6IHRhcmdldDsKICBmb3IgKHZhciBpID0gZGVjb3JhdG9ycy5sZW5ndGggLSAxLCBkZWNvcmF0b3I7IGkgPj0gMDsgaS0tKQogICAgaWYgKGRlY29yYXRvciA9IGRlY29yYXRvcnNbaV0pCiAgICAgIHJlc3VsdCA9IChraW5kID8gZGVjb3JhdG9yKHRhcmdldCwga2V5LCByZXN1bHQpIDogZGVjb3JhdG9yKHJlc3VsdCkpIHx8IHJlc3VsdDsKICBpZiAoa2luZCAmJiByZXN1bHQpIF9fZGVmUHJvcCh0YXJnZXQsIGtleSwgcmVzdWx0KTsKICByZXR1cm4gcmVzdWx0Owp9Owp2YXIgX19kZWNvcmF0ZVBhcmFtID0gKGluZGV4LCBkZWNvcmF0b3IpID0+ICh0YXJnZXQsIGtleSkgPT4gZGVjb3JhdG9yKHRhcmdldCwga2V5LCBpbmRleCk7CgovLyBub2RlX21vZHVsZXMvcmVmbGVjdC1tZXRhZGF0YS9SZWZsZWN0LmpzCnZhciByZXF1aXJlX1JlZmxlY3QgPSBfX2NvbW1vbkpTKHsKICAibm9kZV9tb2R1bGVzL3JlZmxlY3QtbWV0YWRhdGEvUmVmbGVjdC5qcyIoKSB7CiAgICB2YXIgUmVmbGVjdDI7CiAgICAoZnVuY3Rpb24oUmVmbGVjdDMpIHsKICAgICAgKGZ1bmN0aW9uKGZhY3RvcnkpIHsKICAgICAgICB2YXIgcm9vdCA9IHR5cGVvZiBnbG9iYWxUaGlzID09PSAib2JqZWN0IiA/IGdsb2JhbFRoaXMgOiB0eXBlb2YgZ2xvYmFsID09PSAib2JqZWN0IiA/IGdsb2JhbCA6IHR5cGVvZiBzZWxmID09PSAib2JqZWN0IiA/IHNlbGYgOiB0eXBlb2YgdGhpcyA9PT0gIm9iamVjdCIgPyB0aGlzIDogc2xvcHB5TW9kZVRoaXMoKTsKICAgICAgICB2YXIgZXhwb3J0ZXIgPSBtYWtlRXhwb3J0ZXIoUmVmbGVjdDMpOwogICAgICAgIGlmICh0eXBlb2Ygcm9vdC5SZWZsZWN0ICE9PSAidW5kZWZpbmVkIikgewogICAgICAgICAgZXhwb3J0ZXIgPSBtYWtlRXhwb3J0ZXIocm9vdC5SZWZsZWN0LCBleHBvcnRlcik7CiAgICAgICAgfQogICAgICAgIGZhY3RvcnkoZXhwb3J0ZXIsIHJvb3QpOwogICAgICAgIGlmICh0eXBlb2Ygcm9vdC5SZWZsZWN0ID09PSAidW5kZWZpbmVkIikgewogICAgICAgICAgcm9vdC5SZWZsZWN0ID0gUmVmbGVjdDM7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIG1ha2VFeHBvcnRlcih0YXJnZXQsIHByZXZpb3VzKSB7CiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oa2V5LCB2YWx1ZSkgewogICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHsgY29uZmlndXJhYmxlOiB0cnVlLCB3cml0YWJsZTogdHJ1ZSwgdmFsdWUgfSk7CiAgICAgICAgICAgIGlmIChwcmV2aW91cykKICAgICAgICAgICAgICBwcmV2aW91cyhrZXksIHZhbHVlKTsKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIGZ1bmN0aW9uVGhpcygpIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiBGdW5jdGlvbigicmV0dXJuIHRoaXM7IikoKTsKICAgICAgICAgIH0gY2F0Y2ggKF8pIHsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gaW5kaXJlY3RFdmFsVGhpcygpIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHJldHVybiAodm9pZCAwLCBldmFsKSgiKGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpczsgfSkoKSIpOwogICAgICAgICAgfSBjYXRjaCAoXykgewogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBzbG9wcHlNb2RlVGhpcygpIHsKICAgICAgICAgIHJldHVybiBmdW5jdGlvblRoaXMoKSB8fCBpbmRpcmVjdEV2YWxUaGlzKCk7CiAgICAgICAgfQogICAgICB9KShmdW5jdGlvbihleHBvcnRlciwgcm9vdCkgewogICAgICAgIHZhciBoYXNPd24gPSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5OwogICAgICAgIHZhciBzdXBwb3J0c1N5bWJvbCA9IHR5cGVvZiBTeW1ib2wgPT09ICJmdW5jdGlvbiI7CiAgICAgICAgdmFyIHRvUHJpbWl0aXZlU3ltYm9sID0gc3VwcG9ydHNTeW1ib2wgJiYgdHlwZW9mIFN5bWJvbC50b1ByaW1pdGl2ZSAhPT0gInVuZGVmaW5lZCIgPyBTeW1ib2wudG9QcmltaXRpdmUgOiAiQEB0b1ByaW1pdGl2ZSI7CiAgICAgICAgdmFyIGl0ZXJhdG9yU3ltYm9sID0gc3VwcG9ydHNTeW1ib2wgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciAhPT0gInVuZGVmaW5lZCIgPyBTeW1ib2wuaXRlcmF0b3IgOiAiQEBpdGVyYXRvciI7CiAgICAgICAgdmFyIHN1cHBvcnRzQ3JlYXRlID0gdHlwZW9mIE9iamVjdC5jcmVhdGUgPT09ICJmdW5jdGlvbiI7CiAgICAgICAgdmFyIHN1cHBvcnRzUHJvdG8gPSB7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5OwogICAgICAgIHZhciBkb3duTGV2ZWwgPSAhc3VwcG9ydHNDcmVhdGUgJiYgIXN1cHBvcnRzUHJvdG87CiAgICAgICAgdmFyIEhhc2hNYXAgPSB7CiAgICAgICAgICAvLyBjcmVhdGUgYW4gb2JqZWN0IGluIGRpY3Rpb25hcnkgbW9kZSAoYS5rLmEuICJzbG93IiBtb2RlIGluIHY4KQogICAgICAgICAgY3JlYXRlOiBzdXBwb3J0c0NyZWF0ZSA/IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gTWFrZURpY3Rpb25hcnkoLyogQF9fUFVSRV9fICovIE9iamVjdC5jcmVhdGUobnVsbCkpOwogICAgICAgICAgfSA6IHN1cHBvcnRzUHJvdG8gPyBmdW5jdGlvbigpIHsKICAgICAgICAgICAgcmV0dXJuIE1ha2VEaWN0aW9uYXJ5KHsgX19wcm90b19fOiBudWxsIH0pOwogICAgICAgICAgfSA6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICByZXR1cm4gTWFrZURpY3Rpb25hcnkoe30pOwogICAgICAgICAgfSwKICAgICAgICAgIGhhczogZG93bkxldmVsID8gZnVuY3Rpb24obWFwLCBrZXkpIHsKICAgICAgICAgICAgcmV0dXJuIGhhc093bi5jYWxsKG1hcCwga2V5KTsKICAgICAgICAgIH0gOiBmdW5jdGlvbihtYXAsIGtleSkgewogICAgICAgICAgICByZXR1cm4ga2V5IGluIG1hcDsKICAgICAgICAgIH0sCiAgICAgICAgICBnZXQ6IGRvd25MZXZlbCA/IGZ1bmN0aW9uKG1hcCwga2V5KSB7CiAgICAgICAgICAgIHJldHVybiBoYXNPd24uY2FsbChtYXAsIGtleSkgPyBtYXBba2V5XSA6IHZvaWQgMDsKICAgICAgICAgIH0gOiBmdW5jdGlvbihtYXAsIGtleSkgewogICAgICAgICAgICByZXR1cm4gbWFwW2tleV07CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgICB2YXIgZnVuY3Rpb25Qcm90b3R5cGUgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YoRnVuY3Rpb24pOwogICAgICAgIHZhciBfTWFwID0gdHlwZW9mIE1hcCA9PT0gImZ1bmN0aW9uIiAmJiB0eXBlb2YgTWFwLnByb3RvdHlwZS5lbnRyaWVzID09PSAiZnVuY3Rpb24iID8gTWFwIDogQ3JlYXRlTWFwUG9seWZpbGwoKTsKICAgICAgICB2YXIgX1NldCA9IHR5cGVvZiBTZXQgPT09ICJmdW5jdGlvbiIgJiYgdHlwZW9mIFNldC5wcm90b3R5cGUuZW50cmllcyA9PT0gImZ1bmN0aW9uIiA/IFNldCA6IENyZWF0ZVNldFBvbHlmaWxsKCk7CiAgICAgICAgdmFyIF9XZWFrTWFwID0gdHlwZW9mIFdlYWtNYXAgPT09ICJmdW5jdGlvbiIgPyBXZWFrTWFwIDogQ3JlYXRlV2Vha01hcFBvbHlmaWxsKCk7CiAgICAgICAgdmFyIHJlZ2lzdHJ5U3ltYm9sID0gc3VwcG9ydHNTeW1ib2wgPyBTeW1ib2wuZm9yKCJAcmVmbGVjdC1tZXRhZGF0YTpyZWdpc3RyeSIpIDogdm9pZCAwOwogICAgICAgIHZhciBtZXRhZGF0YVJlZ2lzdHJ5ID0gR2V0T3JDcmVhdGVNZXRhZGF0YVJlZ2lzdHJ5KCk7CiAgICAgICAgdmFyIG1ldGFkYXRhUHJvdmlkZXIgPSBDcmVhdGVNZXRhZGF0YVByb3ZpZGVyKG1ldGFkYXRhUmVnaXN0cnkpOwogICAgICAgIGZ1bmN0aW9uIGRlY29yYXRlKGRlY29yYXRvcnMsIHRhcmdldCwgcHJvcGVydHlLZXksIGF0dHJpYnV0ZXMpIHsKICAgICAgICAgIGlmICghSXNVbmRlZmluZWQocHJvcGVydHlLZXkpKSB7CiAgICAgICAgICAgIGlmICghSXNBcnJheShkZWNvcmF0b3JzKSkKICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCk7CiAgICAgICAgICAgIGlmICghSXNPYmplY3QodGFyZ2V0KSkKICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCk7CiAgICAgICAgICAgIGlmICghSXNPYmplY3QoYXR0cmlidXRlcykgJiYgIUlzVW5kZWZpbmVkKGF0dHJpYnV0ZXMpICYmICFJc051bGwoYXR0cmlidXRlcykpCiAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigpOwogICAgICAgICAgICBpZiAoSXNOdWxsKGF0dHJpYnV0ZXMpKQogICAgICAgICAgICAgIGF0dHJpYnV0ZXMgPSB2b2lkIDA7CiAgICAgICAgICAgIHByb3BlcnR5S2V5ID0gVG9Qcm9wZXJ0eUtleShwcm9wZXJ0eUtleSk7CiAgICAgICAgICAgIHJldHVybiBEZWNvcmF0ZVByb3BlcnR5KGRlY29yYXRvcnMsIHRhcmdldCwgcHJvcGVydHlLZXksIGF0dHJpYnV0ZXMpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYgKCFJc0FycmF5KGRlY29yYXRvcnMpKQogICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoKTsKICAgICAgICAgICAgaWYgKCFJc0NvbnN0cnVjdG9yKHRhcmdldCkpCiAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigpOwogICAgICAgICAgICByZXR1cm4gRGVjb3JhdGVDb25zdHJ1Y3RvcihkZWNvcmF0b3JzLCB0YXJnZXQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBleHBvcnRlcigiZGVjb3JhdGUiLCBkZWNvcmF0ZSk7CiAgICAgICAgZnVuY3Rpb24gbWV0YWRhdGEobWV0YWRhdGFLZXksIG1ldGFkYXRhVmFsdWUpIHsKICAgICAgICAgIGZ1bmN0aW9uIGRlY29yYXRvcih0YXJnZXQsIHByb3BlcnR5S2V5KSB7CiAgICAgICAgICAgIGlmICghSXNPYmplY3QodGFyZ2V0KSkKICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCk7CiAgICAgICAgICAgIGlmICghSXNVbmRlZmluZWQocHJvcGVydHlLZXkpICYmICFJc1Byb3BlcnR5S2V5KHByb3BlcnR5S2V5KSkKICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCk7CiAgICAgICAgICAgIE9yZGluYXJ5RGVmaW5lT3duTWV0YWRhdGEobWV0YWRhdGFLZXksIG1ldGFkYXRhVmFsdWUsIHRhcmdldCwgcHJvcGVydHlLZXkpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGRlY29yYXRvcjsKICAgICAgICB9CiAgICAgICAgZXhwb3J0ZXIoIm1ldGFkYXRhIiwgbWV0YWRhdGEpOwogICAgICAgIGZ1bmN0aW9uIGRlZmluZU1ldGFkYXRhKG1ldGFkYXRhS2V5LCBtZXRhZGF0YVZhbHVlLCB0YXJnZXQsIHByb3BlcnR5S2V5KSB7CiAgICAgICAgICBpZiAoIUlzT2JqZWN0KHRhcmdldCkpCiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoKTsKICAgICAgICAgIGlmICghSXNVbmRlZmluZWQocHJvcGVydHlLZXkpKQogICAgICAgICAgICBwcm9wZXJ0eUtleSA9IFRvUHJvcGVydHlLZXkocHJvcGVydHlLZXkpOwogICAgICAgICAgcmV0dXJuIE9yZGluYXJ5RGVmaW5lT3duTWV0YWRhdGEobWV0YWRhdGFLZXksIG1ldGFkYXRhVmFsdWUsIHRhcmdldCwgcHJvcGVydHlLZXkpOwogICAgICAgIH0KICAgICAgICBleHBvcnRlcigiZGVmaW5lTWV0YWRhdGEiLCBkZWZpbmVNZXRhZGF0YSk7CiAgICAgICAgZnVuY3Rpb24gaGFzTWV0YWRhdGEobWV0YWRhdGFLZXksIHRhcmdldCwgcHJvcGVydHlLZXkpIHsKICAgICAgICAgIGlmICghSXNPYmplY3QodGFyZ2V0KSkKICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigpOwogICAgICAgICAgaWYgKCFJc1VuZGVmaW5lZChwcm9wZXJ0eUtleSkpCiAgICAgICAgICAgIHByb3BlcnR5S2V5ID0gVG9Qcm9wZXJ0eUtleShwcm9wZXJ0eUtleSk7CiAgICAgICAgICByZXR1cm4gT3JkaW5hcnlIYXNNZXRhZGF0YShtZXRhZGF0YUtleSwgdGFyZ2V0LCBwcm9wZXJ0eUtleSk7CiAgICAgICAgfQogICAgICAgIGV4cG9ydGVyKCJoYXNNZXRhZGF0YSIsIGhhc01ldGFkYXRhKTsKICAgICAgICBmdW5jdGlvbiBoYXNPd25NZXRhZGF0YShtZXRhZGF0YUtleSwgdGFyZ2V0LCBwcm9wZXJ0eUtleSkgewogICAgICAgICAgaWYgKCFJc09iamVjdCh0YXJnZXQpKQogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCk7CiAgICAgICAgICBpZiAoIUlzVW5kZWZpbmVkKHByb3BlcnR5S2V5KSkKICAgICAgICAgICAgcHJvcGVydHlLZXkgPSBUb1Byb3BlcnR5S2V5KHByb3BlcnR5S2V5KTsKICAgICAgICAgIHJldHVybiBPcmRpbmFyeUhhc093bk1ldGFkYXRhKG1ldGFkYXRhS2V5LCB0YXJnZXQsIHByb3BlcnR5S2V5KTsKICAgICAgICB9CiAgICAgICAgZXhwb3J0ZXIoImhhc093bk1ldGFkYXRhIiwgaGFzT3duTWV0YWRhdGEpOwogICAgICAgIGZ1bmN0aW9uIGdldE1ldGFkYXRhKG1ldGFkYXRhS2V5LCB0YXJnZXQsIHByb3BlcnR5S2V5KSB7CiAgICAgICAgICBpZiAoIUlzT2JqZWN0KHRhcmdldCkpCiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoKTsKICAgICAgICAgIGlmICghSXNVbmRlZmluZWQocHJvcGVydHlLZXkpKQogICAgICAgICAgICBwcm9wZXJ0eUtleSA9IFRvUHJvcGVydHlLZXkocHJvcGVydHlLZXkpOwogICAgICAgICAgcmV0dXJuIE9yZGluYXJ5R2V0TWV0YWRhdGEobWV0YWRhdGFLZXksIHRhcmdldCwgcHJvcGVydHlLZXkpOwogICAgICAgIH0KICAgICAgICBleHBvcnRlcigiZ2V0TWV0YWRhdGEiLCBnZXRNZXRhZGF0YSk7CiAgICAgICAgZnVuY3Rpb24gZ2V0T3duTWV0YWRhdGEobWV0YWRhdGFLZXksIHRhcmdldCwgcHJvcGVydHlLZXkpIHsKICAgICAgICAgIGlmICghSXNPYmplY3QodGFyZ2V0KSkKICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigpOwogICAgICAgICAgaWYgKCFJc1VuZGVmaW5lZChwcm9wZXJ0eUtleSkpCiAgICAgICAgICAgIHByb3BlcnR5S2V5ID0gVG9Qcm9wZXJ0eUtleShwcm9wZXJ0eUtleSk7CiAgICAgICAgICByZXR1cm4gT3JkaW5hcnlHZXRPd25NZXRhZGF0YShtZXRhZGF0YUtleSwgdGFyZ2V0LCBwcm9wZXJ0eUtleSk7CiAgICAgICAgfQogICAgICAgIGV4cG9ydGVyKCJnZXRPd25NZXRhZGF0YSIsIGdldE93bk1ldGFkYXRhKTsKICAgICAgICBmdW5jdGlvbiBnZXRNZXRhZGF0YUtleXModGFyZ2V0LCBwcm9wZXJ0eUtleSkgewogICAgICAgICAgaWYgKCFJc09iamVjdCh0YXJnZXQpKQogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCk7CiAgICAgICAgICBpZiAoIUlzVW5kZWZpbmVkKHByb3BlcnR5S2V5KSkKICAgICAgICAgICAgcHJvcGVydHlLZXkgPSBUb1Byb3BlcnR5S2V5KHByb3BlcnR5S2V5KTsKICAgICAgICAgIHJldHVybiBPcmRpbmFyeU1ldGFkYXRhS2V5cyh0YXJnZXQsIHByb3BlcnR5S2V5KTsKICAgICAgICB9CiAgICAgICAgZXhwb3J0ZXIoImdldE1ldGFkYXRhS2V5cyIsIGdldE1ldGFkYXRhS2V5cyk7CiAgICAgICAgZnVuY3Rpb24gZ2V0T3duTWV0YWRhdGFLZXlzKHRhcmdldCwgcHJvcGVydHlLZXkpIHsKICAgICAgICAgIGlmICghSXNPYmplY3QodGFyZ2V0KSkKICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigpOwogICAgICAgICAgaWYgKCFJc1VuZGVmaW5lZChwcm9wZXJ0eUtleSkpCiAgICAgICAgICAgIHByb3BlcnR5S2V5ID0gVG9Qcm9wZXJ0eUtleShwcm9wZXJ0eUtleSk7CiAgICAgICAgICByZXR1cm4gT3JkaW5hcnlPd25NZXRhZGF0YUtleXModGFyZ2V0LCBwcm9wZXJ0eUtleSk7CiAgICAgICAgfQogICAgICAgIGV4cG9ydGVyKCJnZXRPd25NZXRhZGF0YUtleXMiLCBnZXRPd25NZXRhZGF0YUtleXMpOwogICAgICAgIGZ1bmN0aW9uIGRlbGV0ZU1ldGFkYXRhKG1ldGFkYXRhS2V5LCB0YXJnZXQsIHByb3BlcnR5S2V5KSB7CiAgICAgICAgICBpZiAoIUlzT2JqZWN0KHRhcmdldCkpCiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoKTsKICAgICAgICAgIGlmICghSXNVbmRlZmluZWQocHJvcGVydHlLZXkpKQogICAgICAgICAgICBwcm9wZXJ0eUtleSA9IFRvUHJvcGVydHlLZXkocHJvcGVydHlLZXkpOwogICAgICAgICAgaWYgKCFJc09iamVjdCh0YXJnZXQpKQogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCk7CiAgICAgICAgICBpZiAoIUlzVW5kZWZpbmVkKHByb3BlcnR5S2V5KSkKICAgICAgICAgICAgcHJvcGVydHlLZXkgPSBUb1Byb3BlcnR5S2V5KHByb3BlcnR5S2V5KTsKICAgICAgICAgIHZhciBwcm92aWRlciA9IEdldE1ldGFkYXRhUHJvdmlkZXIoCiAgICAgICAgICAgIHRhcmdldCwKICAgICAgICAgICAgcHJvcGVydHlLZXksCiAgICAgICAgICAgIC8qQ3JlYXRlKi8KICAgICAgICAgICAgZmFsc2UKICAgICAgICAgICk7CiAgICAgICAgICBpZiAoSXNVbmRlZmluZWQocHJvdmlkZXIpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICByZXR1cm4gcHJvdmlkZXIuT3JkaW5hcnlEZWxldGVNZXRhZGF0YShtZXRhZGF0YUtleSwgdGFyZ2V0LCBwcm9wZXJ0eUtleSk7CiAgICAgICAgfQogICAgICAgIGV4cG9ydGVyKCJkZWxldGVNZXRhZGF0YSIsIGRlbGV0ZU1ldGFkYXRhKTsKICAgICAgICBmdW5jdGlvbiBEZWNvcmF0ZUNvbnN0cnVjdG9yKGRlY29yYXRvcnMsIHRhcmdldCkgewogICAgICAgICAgZm9yICh2YXIgaSA9IGRlY29yYXRvcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyAtLWkpIHsKICAgICAgICAgICAgdmFyIGRlY29yYXRvciA9IGRlY29yYXRvcnNbaV07CiAgICAgICAgICAgIHZhciBkZWNvcmF0ZWQgPSBkZWNvcmF0b3IodGFyZ2V0KTsKICAgICAgICAgICAgaWYgKCFJc1VuZGVmaW5lZChkZWNvcmF0ZWQpICYmICFJc051bGwoZGVjb3JhdGVkKSkgewogICAgICAgICAgICAgIGlmICghSXNDb25zdHJ1Y3RvcihkZWNvcmF0ZWQpKQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigpOwogICAgICAgICAgICAgIHRhcmdldCA9IGRlY29yYXRlZDsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHRhcmdldDsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gRGVjb3JhdGVQcm9wZXJ0eShkZWNvcmF0b3JzLCB0YXJnZXQsIHByb3BlcnR5S2V5LCBkZXNjcmlwdG9yKSB7CiAgICAgICAgICBmb3IgKHZhciBpID0gZGVjb3JhdG9ycy5sZW5ndGggLSAxOyBpID49IDA7IC0taSkgewogICAgICAgICAgICB2YXIgZGVjb3JhdG9yID0gZGVjb3JhdG9yc1tpXTsKICAgICAgICAgICAgdmFyIGRlY29yYXRlZCA9IGRlY29yYXRvcih0YXJnZXQsIHByb3BlcnR5S2V5LCBkZXNjcmlwdG9yKTsKICAgICAgICAgICAgaWYgKCFJc1VuZGVmaW5lZChkZWNvcmF0ZWQpICYmICFJc051bGwoZGVjb3JhdGVkKSkgewogICAgICAgICAgICAgIGlmICghSXNPYmplY3QoZGVjb3JhdGVkKSkKICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoKTsKICAgICAgICAgICAgICBkZXNjcmlwdG9yID0gZGVjb3JhdGVkOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gZGVzY3JpcHRvcjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gT3JkaW5hcnlIYXNNZXRhZGF0YShNZXRhZGF0YUtleSwgTywgUCkgewogICAgICAgICAgdmFyIGhhc093bjIgPSBPcmRpbmFyeUhhc093bk1ldGFkYXRhKE1ldGFkYXRhS2V5LCBPLCBQKTsKICAgICAgICAgIGlmIChoYXNPd24yKQogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIHZhciBwYXJlbnQgPSBPcmRpbmFyeUdldFByb3RvdHlwZU9mKE8pOwogICAgICAgICAgaWYgKCFJc051bGwocGFyZW50KSkKICAgICAgICAgICAgcmV0dXJuIE9yZGluYXJ5SGFzTWV0YWRhdGEoTWV0YWRhdGFLZXksIHBhcmVudCwgUCk7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIE9yZGluYXJ5SGFzT3duTWV0YWRhdGEoTWV0YWRhdGFLZXksIE8sIFApIHsKICAgICAgICAgIHZhciBwcm92aWRlciA9IEdldE1ldGFkYXRhUHJvdmlkZXIoCiAgICAgICAgICAgIE8sCiAgICAgICAgICAgIFAsCiAgICAgICAgICAgIC8qQ3JlYXRlKi8KICAgICAgICAgICAgZmFsc2UKICAgICAgICAgICk7CiAgICAgICAgICBpZiAoSXNVbmRlZmluZWQocHJvdmlkZXIpKQogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICByZXR1cm4gVG9Cb29sZWFuKHByb3ZpZGVyLk9yZGluYXJ5SGFzT3duTWV0YWRhdGEoTWV0YWRhdGFLZXksIE8sIFApKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gT3JkaW5hcnlHZXRNZXRhZGF0YShNZXRhZGF0YUtleSwgTywgUCkgewogICAgICAgICAgdmFyIGhhc093bjIgPSBPcmRpbmFyeUhhc093bk1ldGFkYXRhKE1ldGFkYXRhS2V5LCBPLCBQKTsKICAgICAgICAgIGlmIChoYXNPd24yKQogICAgICAgICAgICByZXR1cm4gT3JkaW5hcnlHZXRPd25NZXRhZGF0YShNZXRhZGF0YUtleSwgTywgUCk7CiAgICAgICAgICB2YXIgcGFyZW50ID0gT3JkaW5hcnlHZXRQcm90b3R5cGVPZihPKTsKICAgICAgICAgIGlmICghSXNOdWxsKHBhcmVudCkpCiAgICAgICAgICAgIHJldHVybiBPcmRpbmFyeUdldE1ldGFkYXRhKE1ldGFkYXRhS2V5LCBwYXJlbnQsIFApOwogICAgICAgICAgcmV0dXJuIHZvaWQgMDsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gT3JkaW5hcnlHZXRPd25NZXRhZGF0YShNZXRhZGF0YUtleSwgTywgUCkgewogICAgICAgICAgdmFyIHByb3ZpZGVyID0gR2V0TWV0YWRhdGFQcm92aWRlcigKICAgICAgICAgICAgTywKICAgICAgICAgICAgUCwKICAgICAgICAgICAgLypDcmVhdGUqLwogICAgICAgICAgICBmYWxzZQogICAgICAgICAgKTsKICAgICAgICAgIGlmIChJc1VuZGVmaW5lZChwcm92aWRlcikpCiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIHJldHVybiBwcm92aWRlci5PcmRpbmFyeUdldE93bk1ldGFkYXRhKE1ldGFkYXRhS2V5LCBPLCBQKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gT3JkaW5hcnlEZWZpbmVPd25NZXRhZGF0YShNZXRhZGF0YUtleSwgTWV0YWRhdGFWYWx1ZSwgTywgUCkgewogICAgICAgICAgdmFyIHByb3ZpZGVyID0gR2V0TWV0YWRhdGFQcm92aWRlcigKICAgICAgICAgICAgTywKICAgICAgICAgICAgUCwKICAgICAgICAgICAgLypDcmVhdGUqLwogICAgICAgICAgICB0cnVlCiAgICAgICAgICApOwogICAgICAgICAgcHJvdmlkZXIuT3JkaW5hcnlEZWZpbmVPd25NZXRhZGF0YShNZXRhZGF0YUtleSwgTWV0YWRhdGFWYWx1ZSwgTywgUCk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIE9yZGluYXJ5TWV0YWRhdGFLZXlzKE8sIFApIHsKICAgICAgICAgIHZhciBvd25LZXlzID0gT3JkaW5hcnlPd25NZXRhZGF0YUtleXMoTywgUCk7CiAgICAgICAgICB2YXIgcGFyZW50ID0gT3JkaW5hcnlHZXRQcm90b3R5cGVPZihPKTsKICAgICAgICAgIGlmIChwYXJlbnQgPT09IG51bGwpCiAgICAgICAgICAgIHJldHVybiBvd25LZXlzOwogICAgICAgICAgdmFyIHBhcmVudEtleXMgPSBPcmRpbmFyeU1ldGFkYXRhS2V5cyhwYXJlbnQsIFApOwogICAgICAgICAgaWYgKHBhcmVudEtleXMubGVuZ3RoIDw9IDApCiAgICAgICAgICAgIHJldHVybiBvd25LZXlzOwogICAgICAgICAgaWYgKG93bktleXMubGVuZ3RoIDw9IDApCiAgICAgICAgICAgIHJldHVybiBwYXJlbnRLZXlzOwogICAgICAgICAgdmFyIHNldCA9IG5ldyBfU2V0KCk7CiAgICAgICAgICB2YXIga2V5cyA9IFtdOwogICAgICAgICAgZm9yICh2YXIgX2kgPSAwLCBvd25LZXlzXzEgPSBvd25LZXlzOyBfaSA8IG93bktleXNfMS5sZW5ndGg7IF9pKyspIHsKICAgICAgICAgICAgdmFyIGtleSA9IG93bktleXNfMVtfaV07CiAgICAgICAgICAgIHZhciBoYXNLZXkgPSBzZXQuaGFzKGtleSk7CiAgICAgICAgICAgIGlmICghaGFzS2V5KSB7CiAgICAgICAgICAgICAgc2V0LmFkZChrZXkpOwogICAgICAgICAgICAgIGtleXMucHVzaChrZXkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBmb3IgKHZhciBfYSA9IDAsIHBhcmVudEtleXNfMSA9IHBhcmVudEtleXM7IF9hIDwgcGFyZW50S2V5c18xLmxlbmd0aDsgX2ErKykgewogICAgICAgICAgICB2YXIga2V5ID0gcGFyZW50S2V5c18xW19hXTsKICAgICAgICAgICAgdmFyIGhhc0tleSA9IHNldC5oYXMoa2V5KTsKICAgICAgICAgICAgaWYgKCFoYXNLZXkpIHsKICAgICAgICAgICAgICBzZXQuYWRkKGtleSk7CiAgICAgICAgICAgICAga2V5cy5wdXNoKGtleSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBrZXlzOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBPcmRpbmFyeU93bk1ldGFkYXRhS2V5cyhPLCBQKSB7CiAgICAgICAgICB2YXIgcHJvdmlkZXIgPSBHZXRNZXRhZGF0YVByb3ZpZGVyKAogICAgICAgICAgICBPLAogICAgICAgICAgICBQLAogICAgICAgICAgICAvKmNyZWF0ZSovCiAgICAgICAgICAgIGZhbHNlCiAgICAgICAgICApOwogICAgICAgICAgaWYgKCFwcm92aWRlcikgewogICAgICAgICAgICByZXR1cm4gW107CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gcHJvdmlkZXIuT3JkaW5hcnlPd25NZXRhZGF0YUtleXMoTywgUCk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIFR5cGUoeCkgewogICAgICAgICAgaWYgKHggPT09IG51bGwpCiAgICAgICAgICAgIHJldHVybiAxOwogICAgICAgICAgc3dpdGNoICh0eXBlb2YgeCkgewogICAgICAgICAgICBjYXNlICJ1bmRlZmluZWQiOgogICAgICAgICAgICAgIHJldHVybiAwOwogICAgICAgICAgICBjYXNlICJib29sZWFuIjoKICAgICAgICAgICAgICByZXR1cm4gMjsKICAgICAgICAgICAgY2FzZSAic3RyaW5nIjoKICAgICAgICAgICAgICByZXR1cm4gMzsKICAgICAgICAgICAgY2FzZSAic3ltYm9sIjoKICAgICAgICAgICAgICByZXR1cm4gNDsKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjoKICAgICAgICAgICAgICByZXR1cm4gNTsKICAgICAgICAgICAgY2FzZSAib2JqZWN0IjoKICAgICAgICAgICAgICByZXR1cm4geCA9PT0gbnVsbCA/IDEgOiA2OwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIHJldHVybiA2OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBJc1VuZGVmaW5lZCh4KSB7CiAgICAgICAgICByZXR1cm4geCA9PT0gdm9pZCAwOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBJc051bGwoeCkgewogICAgICAgICAgcmV0dXJuIHggPT09IG51bGw7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIElzU3ltYm9sKHgpIHsKICAgICAgICAgIHJldHVybiB0eXBlb2YgeCA9PT0gInN5bWJvbCI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIElzT2JqZWN0KHgpIHsKICAgICAgICAgIHJldHVybiB0eXBlb2YgeCA9PT0gIm9iamVjdCIgPyB4ICE9PSBudWxsIDogdHlwZW9mIHggPT09ICJmdW5jdGlvbiI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIFRvUHJpbWl0aXZlKGlucHV0LCBQcmVmZXJyZWRUeXBlKSB7CiAgICAgICAgICBzd2l0Y2ggKFR5cGUoaW5wdXQpKSB7CiAgICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgICByZXR1cm4gaW5wdXQ7CiAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICByZXR1cm4gaW5wdXQ7CiAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICByZXR1cm4gaW5wdXQ7CiAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICByZXR1cm4gaW5wdXQ7CiAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICByZXR1cm4gaW5wdXQ7CiAgICAgICAgICAgIGNhc2UgNToKICAgICAgICAgICAgICByZXR1cm4gaW5wdXQ7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgaGludCA9IFByZWZlcnJlZFR5cGUgPT09IDMgPyAic3RyaW5nIiA6IFByZWZlcnJlZFR5cGUgPT09IDUgPyAibnVtYmVyIiA6ICJkZWZhdWx0IjsKICAgICAgICAgIHZhciBleG90aWNUb1ByaW0gPSBHZXRNZXRob2QoaW5wdXQsIHRvUHJpbWl0aXZlU3ltYm9sKTsKICAgICAgICAgIGlmIChleG90aWNUb1ByaW0gIT09IHZvaWQgMCkgewogICAgICAgICAgICB2YXIgcmVzdWx0ID0gZXhvdGljVG9QcmltLmNhbGwoaW5wdXQsIGhpbnQpOwogICAgICAgICAgICBpZiAoSXNPYmplY3QocmVzdWx0KSkKICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCk7CiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gT3JkaW5hcnlUb1ByaW1pdGl2ZShpbnB1dCwgaGludCA9PT0gImRlZmF1bHQiID8gIm51bWJlciIgOiBoaW50KTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gT3JkaW5hcnlUb1ByaW1pdGl2ZShPLCBoaW50KSB7CiAgICAgICAgICBpZiAoaGludCA9PT0gInN0cmluZyIpIHsKICAgICAgICAgICAgdmFyIHRvU3RyaW5nXzEgPSBPLnRvU3RyaW5nOwogICAgICAgICAgICBpZiAoSXNDYWxsYWJsZSh0b1N0cmluZ18xKSkgewogICAgICAgICAgICAgIHZhciByZXN1bHQgPSB0b1N0cmluZ18xLmNhbGwoTyk7CiAgICAgICAgICAgICAgaWYgKCFJc09iamVjdChyZXN1bHQpKQogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgdmFsdWVPZiA9IE8udmFsdWVPZjsKICAgICAgICAgICAgaWYgKElzQ2FsbGFibGUodmFsdWVPZikpIHsKICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gdmFsdWVPZi5jYWxsKE8pOwogICAgICAgICAgICAgIGlmICghSXNPYmplY3QocmVzdWx0KSkKICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZhciB2YWx1ZU9mID0gTy52YWx1ZU9mOwogICAgICAgICAgICBpZiAoSXNDYWxsYWJsZSh2YWx1ZU9mKSkgewogICAgICAgICAgICAgIHZhciByZXN1bHQgPSB2YWx1ZU9mLmNhbGwoTyk7CiAgICAgICAgICAgICAgaWYgKCFJc09iamVjdChyZXN1bHQpKQogICAgICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgdG9TdHJpbmdfMiA9IE8udG9TdHJpbmc7CiAgICAgICAgICAgIGlmIChJc0NhbGxhYmxlKHRvU3RyaW5nXzIpKSB7CiAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHRvU3RyaW5nXzIuY2FsbChPKTsKICAgICAgICAgICAgICBpZiAoIUlzT2JqZWN0KHJlc3VsdCkpCiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCk7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIFRvQm9vbGVhbihhcmd1bWVudCkgewogICAgICAgICAgcmV0dXJuICEhYXJndW1lbnQ7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIFRvU3RyaW5nKGFyZ3VtZW50KSB7CiAgICAgICAgICByZXR1cm4gIiIgKyBhcmd1bWVudDsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gVG9Qcm9wZXJ0eUtleShhcmd1bWVudCkgewogICAgICAgICAgdmFyIGtleSA9IFRvUHJpbWl0aXZlKAogICAgICAgICAgICBhcmd1bWVudCwKICAgICAgICAgICAgMwogICAgICAgICAgICAvKiBTdHJpbmcgKi8KICAgICAgICAgICk7CiAgICAgICAgICBpZiAoSXNTeW1ib2woa2V5KSkKICAgICAgICAgICAgcmV0dXJuIGtleTsKICAgICAgICAgIHJldHVybiBUb1N0cmluZyhrZXkpOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBJc0FycmF5KGFyZ3VtZW50KSB7CiAgICAgICAgICByZXR1cm4gQXJyYXkuaXNBcnJheSA/IEFycmF5LmlzQXJyYXkoYXJndW1lbnQpIDogYXJndW1lbnQgaW5zdGFuY2VvZiBPYmplY3QgPyBhcmd1bWVudCBpbnN0YW5jZW9mIEFycmF5IDogT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGFyZ3VtZW50KSA9PT0gIltvYmplY3QgQXJyYXldIjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gSXNDYWxsYWJsZShhcmd1bWVudCkgewogICAgICAgICAgcmV0dXJuIHR5cGVvZiBhcmd1bWVudCA9PT0gImZ1bmN0aW9uIjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gSXNDb25zdHJ1Y3Rvcihhcmd1bWVudCkgewogICAgICAgICAgcmV0dXJuIHR5cGVvZiBhcmd1bWVudCA9PT0gImZ1bmN0aW9uIjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gSXNQcm9wZXJ0eUtleShhcmd1bWVudCkgewogICAgICAgICAgc3dpdGNoIChUeXBlKGFyZ3VtZW50KSkgewogICAgICAgICAgICBjYXNlIDM6CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIFNhbWVWYWx1ZVplcm8oeCwgeSkgewogICAgICAgICAgcmV0dXJuIHggPT09IHkgfHwgeCAhPT0geCAmJiB5ICE9PSB5OwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBHZXRNZXRob2QoViwgUCkgewogICAgICAgICAgdmFyIGZ1bmMgPSBWW1BdOwogICAgICAgICAgaWYgKGZ1bmMgPT09IHZvaWQgMCB8fCBmdW5jID09PSBudWxsKQogICAgICAgICAgICByZXR1cm4gdm9pZCAwOwogICAgICAgICAgaWYgKCFJc0NhbGxhYmxlKGZ1bmMpKQogICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCk7CiAgICAgICAgICByZXR1cm4gZnVuYzsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gR2V0SXRlcmF0b3Iob2JqKSB7CiAgICAgICAgICB2YXIgbWV0aG9kID0gR2V0TWV0aG9kKG9iaiwgaXRlcmF0b3JTeW1ib2wpOwogICAgICAgICAgaWYgKCFJc0NhbGxhYmxlKG1ldGhvZCkpCiAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoKTsKICAgICAgICAgIHZhciBpdGVyYXRvciA9IG1ldGhvZC5jYWxsKG9iaik7CiAgICAgICAgICBpZiAoIUlzT2JqZWN0KGl0ZXJhdG9yKSkKICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcigpOwogICAgICAgICAgcmV0dXJuIGl0ZXJhdG9yOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBJdGVyYXRvclZhbHVlKGl0ZXJSZXN1bHQpIHsKICAgICAgICAgIHJldHVybiBpdGVyUmVzdWx0LnZhbHVlOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBJdGVyYXRvclN0ZXAoaXRlcmF0b3IpIHsKICAgICAgICAgIHZhciByZXN1bHQgPSBpdGVyYXRvci5uZXh0KCk7CiAgICAgICAgICByZXR1cm4gcmVzdWx0LmRvbmUgPyBmYWxzZSA6IHJlc3VsdDsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gSXRlcmF0b3JDbG9zZShpdGVyYXRvcikgewogICAgICAgICAgdmFyIGYgPSBpdGVyYXRvclsicmV0dXJuIl07CiAgICAgICAgICBpZiAoZikKICAgICAgICAgICAgZi5jYWxsKGl0ZXJhdG9yKTsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gT3JkaW5hcnlHZXRQcm90b3R5cGVPZihPKSB7CiAgICAgICAgICB2YXIgcHJvdG8gPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YoTyk7CiAgICAgICAgICBpZiAodHlwZW9mIE8gIT09ICJmdW5jdGlvbiIgfHwgTyA9PT0gZnVuY3Rpb25Qcm90b3R5cGUpCiAgICAgICAgICAgIHJldHVybiBwcm90bzsKICAgICAgICAgIGlmIChwcm90byAhPT0gZnVuY3Rpb25Qcm90b3R5cGUpCiAgICAgICAgICAgIHJldHVybiBwcm90bzsKICAgICAgICAgIHZhciBwcm90b3R5cGUgPSBPLnByb3RvdHlwZTsKICAgICAgICAgIHZhciBwcm90b3R5cGVQcm90byA9IHByb3RvdHlwZSAmJiBPYmplY3QuZ2V0UHJvdG90eXBlT2YocHJvdG90eXBlKTsKICAgICAgICAgIGlmIChwcm90b3R5cGVQcm90byA9PSBudWxsIHx8IHByb3RvdHlwZVByb3RvID09PSBPYmplY3QucHJvdG90eXBlKQogICAgICAgICAgICByZXR1cm4gcHJvdG87CiAgICAgICAgICB2YXIgY29uc3RydWN0b3IgPSBwcm90b3R5cGVQcm90by5jb25zdHJ1Y3RvcjsKICAgICAgICAgIGlmICh0eXBlb2YgY29uc3RydWN0b3IgIT09ICJmdW5jdGlvbiIpCiAgICAgICAgICAgIHJldHVybiBwcm90bzsKICAgICAgICAgIGlmIChjb25zdHJ1Y3RvciA9PT0gTykKICAgICAgICAgICAgcmV0dXJuIHByb3RvOwogICAgICAgICAgcmV0dXJuIGNvbnN0cnVjdG9yOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBDcmVhdGVNZXRhZGF0YVJlZ2lzdHJ5KCkgewogICAgICAgICAgdmFyIGZhbGxiYWNrOwogICAgICAgICAgaWYgKCFJc1VuZGVmaW5lZChyZWdpc3RyeVN5bWJvbCkgJiYgdHlwZW9mIHJvb3QuUmVmbGVjdCAhPT0gInVuZGVmaW5lZCIgJiYgIShyZWdpc3RyeVN5bWJvbCBpbiByb290LlJlZmxlY3QpICYmIHR5cGVvZiByb290LlJlZmxlY3QuZGVmaW5lTWV0YWRhdGEgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgZmFsbGJhY2sgPSBDcmVhdGVGYWxsYmFja1Byb3ZpZGVyKHJvb3QuUmVmbGVjdCk7CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgZmlyc3Q7CiAgICAgICAgICB2YXIgc2Vjb25kOwogICAgICAgICAgdmFyIHJlc3Q7CiAgICAgICAgICB2YXIgdGFyZ2V0UHJvdmlkZXJNYXAgPSBuZXcgX1dlYWtNYXAoKTsKICAgICAgICAgIHZhciByZWdpc3RyeSA9IHsKICAgICAgICAgICAgcmVnaXN0ZXJQcm92aWRlciwKICAgICAgICAgICAgZ2V0UHJvdmlkZXIsCiAgICAgICAgICAgIHNldFByb3ZpZGVyCiAgICAgICAgICB9OwogICAgICAgICAgcmV0dXJuIHJlZ2lzdHJ5OwogICAgICAgICAgZnVuY3Rpb24gcmVnaXN0ZXJQcm92aWRlcihwcm92aWRlcikgewogICAgICAgICAgICBpZiAoIU9iamVjdC5pc0V4dGVuc2libGUocmVnaXN0cnkpKSB7CiAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJDYW5ub3QgYWRkIHByb3ZpZGVyIHRvIGEgZnJvemVuIHJlZ2lzdHJ5LiIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN3aXRjaCAodHJ1ZSkgewogICAgICAgICAgICAgIGNhc2UgZmFsbGJhY2sgPT09IHByb3ZpZGVyOgogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSBJc1VuZGVmaW5lZChmaXJzdCk6CiAgICAgICAgICAgICAgICBmaXJzdCA9IHByb3ZpZGVyOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSBmaXJzdCA9PT0gcHJvdmlkZXI6CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlIElzVW5kZWZpbmVkKHNlY29uZCk6CiAgICAgICAgICAgICAgICBzZWNvbmQgPSBwcm92aWRlcjsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGNhc2Ugc2Vjb25kID09PSBwcm92aWRlcjoKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICBpZiAocmVzdCA9PT0gdm9pZCAwKQogICAgICAgICAgICAgICAgICByZXN0ID0gbmV3IF9TZXQoKTsKICAgICAgICAgICAgICAgIHJlc3QuYWRkKHByb3ZpZGVyKTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBnZXRQcm92aWRlck5vQ2FjaGUoTywgUCkgewogICAgICAgICAgICBpZiAoIUlzVW5kZWZpbmVkKGZpcnN0KSkgewogICAgICAgICAgICAgIGlmIChmaXJzdC5pc1Byb3ZpZGVyRm9yKE8sIFApKQogICAgICAgICAgICAgICAgcmV0dXJuIGZpcnN0OwogICAgICAgICAgICAgIGlmICghSXNVbmRlZmluZWQoc2Vjb25kKSkgewogICAgICAgICAgICAgICAgaWYgKHNlY29uZC5pc1Byb3ZpZGVyRm9yKE8sIFApKQogICAgICAgICAgICAgICAgICByZXR1cm4gZmlyc3Q7CiAgICAgICAgICAgICAgICBpZiAoIUlzVW5kZWZpbmVkKHJlc3QpKSB7CiAgICAgICAgICAgICAgICAgIHZhciBpdGVyYXRvciA9IEdldEl0ZXJhdG9yKHJlc3QpOwogICAgICAgICAgICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAgICAgICAgICAgIHZhciBuZXh0ID0gSXRlcmF0b3JTdGVwKGl0ZXJhdG9yKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIW5leHQpIHsKICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2b2lkIDA7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHZhciBwcm92aWRlciA9IEl0ZXJhdG9yVmFsdWUobmV4dCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHByb3ZpZGVyLmlzUHJvdmlkZXJGb3IoTywgUCkpIHsKICAgICAgICAgICAgICAgICAgICAgIEl0ZXJhdG9yQ2xvc2UoaXRlcmF0b3IpOwogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHByb3ZpZGVyOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIUlzVW5kZWZpbmVkKGZhbGxiYWNrKSAmJiBmYWxsYmFjay5pc1Byb3ZpZGVyRm9yKE8sIFApKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGZhbGxiYWNrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB2b2lkIDA7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBnZXRQcm92aWRlcihPLCBQKSB7CiAgICAgICAgICAgIHZhciBwcm92aWRlck1hcCA9IHRhcmdldFByb3ZpZGVyTWFwLmdldChPKTsKICAgICAgICAgICAgdmFyIHByb3ZpZGVyOwogICAgICAgICAgICBpZiAoIUlzVW5kZWZpbmVkKHByb3ZpZGVyTWFwKSkgewogICAgICAgICAgICAgIHByb3ZpZGVyID0gcHJvdmlkZXJNYXAuZ2V0KFApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghSXNVbmRlZmluZWQocHJvdmlkZXIpKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHByb3ZpZGVyOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHByb3ZpZGVyID0gZ2V0UHJvdmlkZXJOb0NhY2hlKE8sIFApOwogICAgICAgICAgICBpZiAoIUlzVW5kZWZpbmVkKHByb3ZpZGVyKSkgewogICAgICAgICAgICAgIGlmIChJc1VuZGVmaW5lZChwcm92aWRlck1hcCkpIHsKICAgICAgICAgICAgICAgIHByb3ZpZGVyTWFwID0gbmV3IF9NYXAoKTsKICAgICAgICAgICAgICAgIHRhcmdldFByb3ZpZGVyTWFwLnNldChPLCBwcm92aWRlck1hcCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHByb3ZpZGVyTWFwLnNldChQLCBwcm92aWRlcik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHByb3ZpZGVyOwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gaGFzUHJvdmlkZXIocHJvdmlkZXIpIHsKICAgICAgICAgICAgaWYgKElzVW5kZWZpbmVkKHByb3ZpZGVyKSkKICAgICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCk7CiAgICAgICAgICAgIHJldHVybiBmaXJzdCA9PT0gcHJvdmlkZXIgfHwgc2Vjb25kID09PSBwcm92aWRlciB8fCAhSXNVbmRlZmluZWQocmVzdCkgJiYgcmVzdC5oYXMocHJvdmlkZXIpOwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gc2V0UHJvdmlkZXIoTywgUCwgcHJvdmlkZXIpIHsKICAgICAgICAgICAgaWYgKCFoYXNQcm92aWRlcihwcm92aWRlcikpIHsKICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIk1ldGFkYXRhIHByb3ZpZGVyIG5vdCByZWdpc3RlcmVkLiIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBleGlzdGluZ1Byb3ZpZGVyID0gZ2V0UHJvdmlkZXIoTywgUCk7CiAgICAgICAgICAgIGlmIChleGlzdGluZ1Byb3ZpZGVyICE9PSBwcm92aWRlcikgewogICAgICAgICAgICAgIGlmICghSXNVbmRlZmluZWQoZXhpc3RpbmdQcm92aWRlcikpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdmFyIHByb3ZpZGVyTWFwID0gdGFyZ2V0UHJvdmlkZXJNYXAuZ2V0KE8pOwogICAgICAgICAgICAgIGlmIChJc1VuZGVmaW5lZChwcm92aWRlck1hcCkpIHsKICAgICAgICAgICAgICAgIHByb3ZpZGVyTWFwID0gbmV3IF9NYXAoKTsKICAgICAgICAgICAgICAgIHRhcmdldFByb3ZpZGVyTWFwLnNldChPLCBwcm92aWRlck1hcCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHByb3ZpZGVyTWFwLnNldChQLCBwcm92aWRlcik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIEdldE9yQ3JlYXRlTWV0YWRhdGFSZWdpc3RyeSgpIHsKICAgICAgICAgIHZhciBtZXRhZGF0YVJlZ2lzdHJ5MjsKICAgICAgICAgIGlmICghSXNVbmRlZmluZWQocmVnaXN0cnlTeW1ib2wpICYmIElzT2JqZWN0KHJvb3QuUmVmbGVjdCkgJiYgT2JqZWN0LmlzRXh0ZW5zaWJsZShyb290LlJlZmxlY3QpKSB7CiAgICAgICAgICAgIG1ldGFkYXRhUmVnaXN0cnkyID0gcm9vdC5SZWZsZWN0W3JlZ2lzdHJ5U3ltYm9sXTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChJc1VuZGVmaW5lZChtZXRhZGF0YVJlZ2lzdHJ5MikpIHsKICAgICAgICAgICAgbWV0YWRhdGFSZWdpc3RyeTIgPSBDcmVhdGVNZXRhZGF0YVJlZ2lzdHJ5KCk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoIUlzVW5kZWZpbmVkKHJlZ2lzdHJ5U3ltYm9sKSAmJiBJc09iamVjdChyb290LlJlZmxlY3QpICYmIE9iamVjdC5pc0V4dGVuc2libGUocm9vdC5SZWZsZWN0KSkgewogICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkocm9vdC5SZWZsZWN0LCByZWdpc3RyeVN5bWJvbCwgewogICAgICAgICAgICAgIGVudW1lcmFibGU6IGZhbHNlLAogICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogZmFsc2UsCiAgICAgICAgICAgICAgd3JpdGFibGU6IGZhbHNlLAogICAgICAgICAgICAgIHZhbHVlOiBtZXRhZGF0YVJlZ2lzdHJ5MgogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBtZXRhZGF0YVJlZ2lzdHJ5MjsKICAgICAgICB9CiAgICAgICAgZnVuY3Rpb24gQ3JlYXRlTWV0YWRhdGFQcm92aWRlcihyZWdpc3RyeSkgewogICAgICAgICAgdmFyIG1ldGFkYXRhMiA9IG5ldyBfV2Vha01hcCgpOwogICAgICAgICAgdmFyIHByb3ZpZGVyID0gewogICAgICAgICAgICBpc1Byb3ZpZGVyRm9yOiBmdW5jdGlvbihPLCBQKSB7CiAgICAgICAgICAgICAgdmFyIHRhcmdldE1ldGFkYXRhID0gbWV0YWRhdGEyLmdldChPKTsKICAgICAgICAgICAgICBpZiAoSXNVbmRlZmluZWQodGFyZ2V0TWV0YWRhdGEpKQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgIHJldHVybiB0YXJnZXRNZXRhZGF0YS5oYXMoUCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIE9yZGluYXJ5RGVmaW5lT3duTWV0YWRhdGE6IE9yZGluYXJ5RGVmaW5lT3duTWV0YWRhdGEyLAogICAgICAgICAgICBPcmRpbmFyeUhhc093bk1ldGFkYXRhOiBPcmRpbmFyeUhhc093bk1ldGFkYXRhMiwKICAgICAgICAgICAgT3JkaW5hcnlHZXRPd25NZXRhZGF0YTogT3JkaW5hcnlHZXRPd25NZXRhZGF0YTIsCiAgICAgICAgICAgIE9yZGluYXJ5T3duTWV0YWRhdGFLZXlzOiBPcmRpbmFyeU93bk1ldGFkYXRhS2V5czIsCiAgICAgICAgICAgIE9yZGluYXJ5RGVsZXRlTWV0YWRhdGEKICAgICAgICAgIH07CiAgICAgICAgICBtZXRhZGF0YVJlZ2lzdHJ5LnJlZ2lzdGVyUHJvdmlkZXIocHJvdmlkZXIpOwogICAgICAgICAgcmV0dXJuIHByb3ZpZGVyOwogICAgICAgICAgZnVuY3Rpb24gR2V0T3JDcmVhdGVNZXRhZGF0YU1hcChPLCBQLCBDcmVhdGUpIHsKICAgICAgICAgICAgdmFyIHRhcmdldE1ldGFkYXRhID0gbWV0YWRhdGEyLmdldChPKTsKICAgICAgICAgICAgdmFyIGNyZWF0ZWRUYXJnZXRNZXRhZGF0YSA9IGZhbHNlOwogICAgICAgICAgICBpZiAoSXNVbmRlZmluZWQodGFyZ2V0TWV0YWRhdGEpKSB7CiAgICAgICAgICAgICAgaWYgKCFDcmVhdGUpCiAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCAwOwogICAgICAgICAgICAgIHRhcmdldE1ldGFkYXRhID0gbmV3IF9NYXAoKTsKICAgICAgICAgICAgICBtZXRhZGF0YTIuc2V0KE8sIHRhcmdldE1ldGFkYXRhKTsKICAgICAgICAgICAgICBjcmVhdGVkVGFyZ2V0TWV0YWRhdGEgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBtZXRhZGF0YU1hcCA9IHRhcmdldE1ldGFkYXRhLmdldChQKTsKICAgICAgICAgICAgaWYgKElzVW5kZWZpbmVkKG1ldGFkYXRhTWFwKSkgewogICAgICAgICAgICAgIGlmICghQ3JlYXRlKQogICAgICAgICAgICAgICAgcmV0dXJuIHZvaWQgMDsKICAgICAgICAgICAgICBtZXRhZGF0YU1hcCA9IG5ldyBfTWFwKCk7CiAgICAgICAgICAgICAgdGFyZ2V0TWV0YWRhdGEuc2V0KFAsIG1ldGFkYXRhTWFwKTsKICAgICAgICAgICAgICBpZiAoIXJlZ2lzdHJ5LnNldFByb3ZpZGVyKE8sIFAsIHByb3ZpZGVyKSkgewogICAgICAgICAgICAgICAgdGFyZ2V0TWV0YWRhdGEuZGVsZXRlKFApOwogICAgICAgICAgICAgICAgaWYgKGNyZWF0ZWRUYXJnZXRNZXRhZGF0YSkgewogICAgICAgICAgICAgICAgICBtZXRhZGF0YTIuZGVsZXRlKE8pOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJXcm9uZyBwcm92aWRlciBmb3IgdGFyZ2V0LiIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbWV0YWRhdGFNYXA7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBPcmRpbmFyeUhhc093bk1ldGFkYXRhMihNZXRhZGF0YUtleSwgTywgUCkgewogICAgICAgICAgICB2YXIgbWV0YWRhdGFNYXAgPSBHZXRPckNyZWF0ZU1ldGFkYXRhTWFwKAogICAgICAgICAgICAgIE8sCiAgICAgICAgICAgICAgUCwKICAgICAgICAgICAgICAvKkNyZWF0ZSovCiAgICAgICAgICAgICAgZmFsc2UKICAgICAgICAgICAgKTsKICAgICAgICAgICAgaWYgKElzVW5kZWZpbmVkKG1ldGFkYXRhTWFwKSkKICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIHJldHVybiBUb0Jvb2xlYW4obWV0YWRhdGFNYXAuaGFzKE1ldGFkYXRhS2V5KSk7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBPcmRpbmFyeUdldE93bk1ldGFkYXRhMihNZXRhZGF0YUtleSwgTywgUCkgewogICAgICAgICAgICB2YXIgbWV0YWRhdGFNYXAgPSBHZXRPckNyZWF0ZU1ldGFkYXRhTWFwKAogICAgICAgICAgICAgIE8sCiAgICAgICAgICAgICAgUCwKICAgICAgICAgICAgICAvKkNyZWF0ZSovCiAgICAgICAgICAgICAgZmFsc2UKICAgICAgICAgICAgKTsKICAgICAgICAgICAgaWYgKElzVW5kZWZpbmVkKG1ldGFkYXRhTWFwKSkKICAgICAgICAgICAgICByZXR1cm4gdm9pZCAwOwogICAgICAgICAgICByZXR1cm4gbWV0YWRhdGFNYXAuZ2V0KE1ldGFkYXRhS2V5KTsKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIE9yZGluYXJ5RGVmaW5lT3duTWV0YWRhdGEyKE1ldGFkYXRhS2V5LCBNZXRhZGF0YVZhbHVlLCBPLCBQKSB7CiAgICAgICAgICAgIHZhciBtZXRhZGF0YU1hcCA9IEdldE9yQ3JlYXRlTWV0YWRhdGFNYXAoCiAgICAgICAgICAgICAgTywKICAgICAgICAgICAgICBQLAogICAgICAgICAgICAgIC8qQ3JlYXRlKi8KICAgICAgICAgICAgICB0cnVlCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIG1ldGFkYXRhTWFwLnNldChNZXRhZGF0YUtleSwgTWV0YWRhdGFWYWx1ZSk7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBPcmRpbmFyeU93bk1ldGFkYXRhS2V5czIoTywgUCkgewogICAgICAgICAgICB2YXIga2V5cyA9IFtdOwogICAgICAgICAgICB2YXIgbWV0YWRhdGFNYXAgPSBHZXRPckNyZWF0ZU1ldGFkYXRhTWFwKAogICAgICAgICAgICAgIE8sCiAgICAgICAgICAgICAgUCwKICAgICAgICAgICAgICAvKkNyZWF0ZSovCiAgICAgICAgICAgICAgZmFsc2UKICAgICAgICAgICAgKTsKICAgICAgICAgICAgaWYgKElzVW5kZWZpbmVkKG1ldGFkYXRhTWFwKSkKICAgICAgICAgICAgICByZXR1cm4ga2V5czsKICAgICAgICAgICAgdmFyIGtleXNPYmogPSBtZXRhZGF0YU1hcC5rZXlzKCk7CiAgICAgICAgICAgIHZhciBpdGVyYXRvciA9IEdldEl0ZXJhdG9yKGtleXNPYmopOwogICAgICAgICAgICB2YXIgayA9IDA7CiAgICAgICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICAgICAgdmFyIG5leHQgPSBJdGVyYXRvclN0ZXAoaXRlcmF0b3IpOwogICAgICAgICAgICAgIGlmICghbmV4dCkgewogICAgICAgICAgICAgICAga2V5cy5sZW5ndGggPSBrOwogICAgICAgICAgICAgICAgcmV0dXJuIGtleXM7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHZhciBuZXh0VmFsdWUgPSBJdGVyYXRvclZhbHVlKG5leHQpOwogICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBrZXlzW2tdID0gbmV4dFZhbHVlOwogICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICAgIEl0ZXJhdG9yQ2xvc2UoaXRlcmF0b3IpOwogICAgICAgICAgICAgICAgfSBmaW5hbGx5IHsKICAgICAgICAgICAgICAgICAgdGhyb3cgZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaysrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBPcmRpbmFyeURlbGV0ZU1ldGFkYXRhKE1ldGFkYXRhS2V5LCBPLCBQKSB7CiAgICAgICAgICAgIHZhciBtZXRhZGF0YU1hcCA9IEdldE9yQ3JlYXRlTWV0YWRhdGFNYXAoCiAgICAgICAgICAgICAgTywKICAgICAgICAgICAgICBQLAogICAgICAgICAgICAgIC8qQ3JlYXRlKi8KICAgICAgICAgICAgICBmYWxzZQogICAgICAgICAgICApOwogICAgICAgICAgICBpZiAoSXNVbmRlZmluZWQobWV0YWRhdGFNYXApKQogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgaWYgKCFtZXRhZGF0YU1hcC5kZWxldGUoTWV0YWRhdGFLZXkpKQogICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgaWYgKG1ldGFkYXRhTWFwLnNpemUgPT09IDApIHsKICAgICAgICAgICAgICB2YXIgdGFyZ2V0TWV0YWRhdGEgPSBtZXRhZGF0YTIuZ2V0KE8pOwogICAgICAgICAgICAgIGlmICghSXNVbmRlZmluZWQodGFyZ2V0TWV0YWRhdGEpKSB7CiAgICAgICAgICAgICAgICB0YXJnZXRNZXRhZGF0YS5kZWxldGUoUCk7CiAgICAgICAgICAgICAgICBpZiAodGFyZ2V0TWV0YWRhdGEuc2l6ZSA9PT0gMCkgewogICAgICAgICAgICAgICAgICBtZXRhZGF0YTIuZGVsZXRlKHRhcmdldE1ldGFkYXRhKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIENyZWF0ZUZhbGxiYWNrUHJvdmlkZXIocmVmbGVjdCkgewogICAgICAgICAgdmFyIGRlZmluZU1ldGFkYXRhMiA9IHJlZmxlY3QuZGVmaW5lTWV0YWRhdGEsIGhhc093bk1ldGFkYXRhMiA9IHJlZmxlY3QuaGFzT3duTWV0YWRhdGEsIGdldE93bk1ldGFkYXRhMiA9IHJlZmxlY3QuZ2V0T3duTWV0YWRhdGEsIGdldE93bk1ldGFkYXRhS2V5czIgPSByZWZsZWN0LmdldE93bk1ldGFkYXRhS2V5cywgZGVsZXRlTWV0YWRhdGEyID0gcmVmbGVjdC5kZWxldGVNZXRhZGF0YTsKICAgICAgICAgIHZhciBtZXRhZGF0YU93bmVyID0gbmV3IF9XZWFrTWFwKCk7CiAgICAgICAgICB2YXIgcHJvdmlkZXIgPSB7CiAgICAgICAgICAgIGlzUHJvdmlkZXJGb3I6IGZ1bmN0aW9uKE8sIFApIHsKICAgICAgICAgICAgICB2YXIgbWV0YWRhdGFQcm9wZXJ0eVNldCA9IG1ldGFkYXRhT3duZXIuZ2V0KE8pOwogICAgICAgICAgICAgIGlmICghSXNVbmRlZmluZWQobWV0YWRhdGFQcm9wZXJ0eVNldCkgJiYgbWV0YWRhdGFQcm9wZXJ0eVNldC5oYXMoUCkpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoZ2V0T3duTWV0YWRhdGFLZXlzMihPLCBQKS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIGlmIChJc1VuZGVmaW5lZChtZXRhZGF0YVByb3BlcnR5U2V0KSkgewogICAgICAgICAgICAgICAgICBtZXRhZGF0YVByb3BlcnR5U2V0ID0gbmV3IF9TZXQoKTsKICAgICAgICAgICAgICAgICAgbWV0YWRhdGFPd25lci5zZXQoTywgbWV0YWRhdGFQcm9wZXJ0eVNldCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBtZXRhZGF0YVByb3BlcnR5U2V0LmFkZChQKTsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIE9yZGluYXJ5RGVmaW5lT3duTWV0YWRhdGE6IGRlZmluZU1ldGFkYXRhMiwKICAgICAgICAgICAgT3JkaW5hcnlIYXNPd25NZXRhZGF0YTogaGFzT3duTWV0YWRhdGEyLAogICAgICAgICAgICBPcmRpbmFyeUdldE93bk1ldGFkYXRhOiBnZXRPd25NZXRhZGF0YTIsCiAgICAgICAgICAgIE9yZGluYXJ5T3duTWV0YWRhdGFLZXlzOiBnZXRPd25NZXRhZGF0YUtleXMyLAogICAgICAgICAgICBPcmRpbmFyeURlbGV0ZU1ldGFkYXRhOiBkZWxldGVNZXRhZGF0YTIKICAgICAgICAgIH07CiAgICAgICAgICByZXR1cm4gcHJvdmlkZXI7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIEdldE1ldGFkYXRhUHJvdmlkZXIoTywgUCwgQ3JlYXRlKSB7CiAgICAgICAgICB2YXIgcmVnaXN0ZXJlZFByb3ZpZGVyID0gbWV0YWRhdGFSZWdpc3RyeS5nZXRQcm92aWRlcihPLCBQKTsKICAgICAgICAgIGlmICghSXNVbmRlZmluZWQocmVnaXN0ZXJlZFByb3ZpZGVyKSkgewogICAgICAgICAgICByZXR1cm4gcmVnaXN0ZXJlZFByb3ZpZGVyOwogICAgICAgICAgfQogICAgICAgICAgaWYgKENyZWF0ZSkgewogICAgICAgICAgICBpZiAobWV0YWRhdGFSZWdpc3RyeS5zZXRQcm92aWRlcihPLCBQLCBtZXRhZGF0YVByb3ZpZGVyKSkgewogICAgICAgICAgICAgIHJldHVybiBtZXRhZGF0YVByb3ZpZGVyOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiSWxsZWdhbCBzdGF0ZS4iKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB2b2lkIDA7CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIENyZWF0ZU1hcFBvbHlmaWxsKCkgewogICAgICAgICAgdmFyIGNhY2hlU2VudGluZWwgPSB7fTsKICAgICAgICAgIHZhciBhcnJheVNlbnRpbmVsID0gW107CiAgICAgICAgICB2YXIgTWFwSXRlcmF0b3IgPSAoCiAgICAgICAgICAgIC8qKiBAY2xhc3MgKi8KICAgICAgICAgICAgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgZnVuY3Rpb24gTWFwSXRlcmF0b3IyKGtleXMsIHZhbHVlcywgc2VsZWN0b3IpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2luZGV4ID0gMDsKICAgICAgICAgICAgICAgIHRoaXMuX2tleXMgPSBrZXlzOwogICAgICAgICAgICAgICAgdGhpcy5fdmFsdWVzID0gdmFsdWVzOwogICAgICAgICAgICAgICAgdGhpcy5fc2VsZWN0b3IgPSBzZWxlY3RvcjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgTWFwSXRlcmF0b3IyLnByb3RvdHlwZVsiQEBpdGVyYXRvciJdID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIE1hcEl0ZXJhdG9yMi5wcm90b3R5cGVbaXRlcmF0b3JTeW1ib2xdID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIE1hcEl0ZXJhdG9yMi5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gdGhpcy5faW5kZXg7CiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPj0gMCAmJiBpbmRleCA8IHRoaXMuX2tleXMubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSB0aGlzLl9zZWxlY3Rvcih0aGlzLl9rZXlzW2luZGV4XSwgdGhpcy5fdmFsdWVzW2luZGV4XSk7CiAgICAgICAgICAgICAgICAgIGlmIChpbmRleCArIDEgPj0gdGhpcy5fa2V5cy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9pbmRleCA9IC0xOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2tleXMgPSBhcnJheVNlbnRpbmVsOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3ZhbHVlcyA9IGFycmF5U2VudGluZWw7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5faW5kZXgrKzsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICByZXR1cm4geyB2YWx1ZTogcmVzdWx0LCBkb25lOiBmYWxzZSB9OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHsgdmFsdWU6IHZvaWQgMCwgZG9uZTogdHJ1ZSB9OwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgTWFwSXRlcmF0b3IyLnByb3RvdHlwZS50aHJvdyA9IGZ1bmN0aW9uKGVycm9yKSB7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5faW5kZXggPj0gMCkgewogICAgICAgICAgICAgICAgICB0aGlzLl9pbmRleCA9IC0xOwogICAgICAgICAgICAgICAgICB0aGlzLl9rZXlzID0gYXJyYXlTZW50aW5lbDsKICAgICAgICAgICAgICAgICAgdGhpcy5fdmFsdWVzID0gYXJyYXlTZW50aW5lbDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRocm93IGVycm9yOwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgTWFwSXRlcmF0b3IyLnByb3RvdHlwZS5yZXR1cm4gPSBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2luZGV4ID49IDApIHsKICAgICAgICAgICAgICAgICAgdGhpcy5faW5kZXggPSAtMTsKICAgICAgICAgICAgICAgICAgdGhpcy5fa2V5cyA9IGFycmF5U2VudGluZWw7CiAgICAgICAgICAgICAgICAgIHRoaXMuX3ZhbHVlcyA9IGFycmF5U2VudGluZWw7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4geyB2YWx1ZSwgZG9uZTogdHJ1ZSB9OwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgcmV0dXJuIE1hcEl0ZXJhdG9yMjsKICAgICAgICAgICAgfSgpCiAgICAgICAgICApOwogICAgICAgICAgdmFyIE1hcDIgPSAoCiAgICAgICAgICAgIC8qKiBAY2xhc3MgKi8KICAgICAgICAgICAgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgZnVuY3Rpb24gTWFwMygpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2tleXMgPSBbXTsKICAgICAgICAgICAgICAgIHRoaXMuX3ZhbHVlcyA9IFtdOwogICAgICAgICAgICAgICAgdGhpcy5fY2FjaGVLZXkgPSBjYWNoZVNlbnRpbmVsOwogICAgICAgICAgICAgICAgdGhpcy5fY2FjaGVJbmRleCA9IC0yOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoTWFwMy5wcm90b3R5cGUsICJzaXplIiwgewogICAgICAgICAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2tleXMubGVuZ3RoOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGVudW1lcmFibGU6IHRydWUsCiAgICAgICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBNYXAzLnByb3RvdHlwZS5oYXMgPSBmdW5jdGlvbihrZXkpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9maW5kKAogICAgICAgICAgICAgICAgICBrZXksCiAgICAgICAgICAgICAgICAgIC8qaW5zZXJ0Ki8KICAgICAgICAgICAgICAgICAgZmFsc2UKICAgICAgICAgICAgICAgICkgPj0gMDsKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIE1hcDMucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uKGtleSkgewogICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gdGhpcy5fZmluZCgKICAgICAgICAgICAgICAgICAga2V5LAogICAgICAgICAgICAgICAgICAvKmluc2VydCovCiAgICAgICAgICAgICAgICAgIGZhbHNlCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgcmV0dXJuIGluZGV4ID49IDAgPyB0aGlzLl92YWx1ZXNbaW5kZXhdIDogdm9pZCAwOwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgTWFwMy5wcm90b3R5cGUuc2V0ID0gZnVuY3Rpb24oa2V5LCB2YWx1ZSkgewogICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gdGhpcy5fZmluZCgKICAgICAgICAgICAgICAgICAga2V5LAogICAgICAgICAgICAgICAgICAvKmluc2VydCovCiAgICAgICAgICAgICAgICAgIHRydWUKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICB0aGlzLl92YWx1ZXNbaW5kZXhdID0gdmFsdWU7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpczsKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIE1hcDMucHJvdG90eXBlLmRlbGV0ZSA9IGZ1bmN0aW9uKGtleSkgewogICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gdGhpcy5fZmluZCgKICAgICAgICAgICAgICAgICAga2V5LAogICAgICAgICAgICAgICAgICAvKmluc2VydCovCiAgICAgICAgICAgICAgICAgIGZhbHNlCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgaWYgKGluZGV4ID49IDApIHsKICAgICAgICAgICAgICAgICAgdmFyIHNpemUgPSB0aGlzLl9rZXlzLmxlbmd0aDsKICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IGluZGV4ICsgMTsgaSA8IHNpemU7IGkrKykgewogICAgICAgICAgICAgICAgICAgIHRoaXMuX2tleXNbaSAtIDFdID0gdGhpcy5fa2V5c1tpXTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl92YWx1ZXNbaSAtIDFdID0gdGhpcy5fdmFsdWVzW2ldOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHRoaXMuX2tleXMubGVuZ3RoLS07CiAgICAgICAgICAgICAgICAgIHRoaXMuX3ZhbHVlcy5sZW5ndGgtLTsKICAgICAgICAgICAgICAgICAgaWYgKFNhbWVWYWx1ZVplcm8oa2V5LCB0aGlzLl9jYWNoZUtleSkpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9jYWNoZUtleSA9IGNhY2hlU2VudGluZWw7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fY2FjaGVJbmRleCA9IC0yOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgTWFwMy5wcm90b3R5cGUuY2xlYXIgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2tleXMubGVuZ3RoID0gMDsKICAgICAgICAgICAgICAgIHRoaXMuX3ZhbHVlcy5sZW5ndGggPSAwOwogICAgICAgICAgICAgICAgdGhpcy5fY2FjaGVLZXkgPSBjYWNoZVNlbnRpbmVsOwogICAgICAgICAgICAgICAgdGhpcy5fY2FjaGVJbmRleCA9IC0yOwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgTWFwMy5wcm90b3R5cGUua2V5cyA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBNYXBJdGVyYXRvcih0aGlzLl9rZXlzLCB0aGlzLl92YWx1ZXMsIGdldEtleSk7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICBNYXAzLnByb3RvdHlwZS52YWx1ZXMgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiBuZXcgTWFwSXRlcmF0b3IodGhpcy5fa2V5cywgdGhpcy5fdmFsdWVzLCBnZXRWYWx1ZSk7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICBNYXAzLnByb3RvdHlwZS5lbnRyaWVzID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IE1hcEl0ZXJhdG9yKHRoaXMuX2tleXMsIHRoaXMuX3ZhbHVlcywgZ2V0RW50cnkpOwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgTWFwMy5wcm90b3R5cGVbIkBAaXRlcmF0b3IiXSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZW50cmllcygpOwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgTWFwMy5wcm90b3R5cGVbaXRlcmF0b3JTeW1ib2xdID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5lbnRyaWVzKCk7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICBNYXAzLnByb3RvdHlwZS5fZmluZCA9IGZ1bmN0aW9uKGtleSwgaW5zZXJ0KSB7CiAgICAgICAgICAgICAgICBpZiAoIVNhbWVWYWx1ZVplcm8odGhpcy5fY2FjaGVLZXksIGtleSkpIHsKICAgICAgICAgICAgICAgICAgdGhpcy5fY2FjaGVJbmRleCA9IC0xOwogICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuX2tleXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICBpZiAoU2FtZVZhbHVlWmVybyh0aGlzLl9rZXlzW2ldLCBrZXkpKSB7CiAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9jYWNoZUluZGV4ID0gaTsKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHRoaXMuX2NhY2hlSW5kZXggPCAwICYmIGluc2VydCkgewogICAgICAgICAgICAgICAgICB0aGlzLl9jYWNoZUluZGV4ID0gdGhpcy5fa2V5cy5sZW5ndGg7CiAgICAgICAgICAgICAgICAgIHRoaXMuX2tleXMucHVzaChrZXkpOwogICAgICAgICAgICAgICAgICB0aGlzLl92YWx1ZXMucHVzaCh2b2lkIDApOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NhY2hlSW5kZXg7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICByZXR1cm4gTWFwMzsKICAgICAgICAgICAgfSgpCiAgICAgICAgICApOwogICAgICAgICAgcmV0dXJuIE1hcDI7CiAgICAgICAgICBmdW5jdGlvbiBnZXRLZXkoa2V5LCBfKSB7CiAgICAgICAgICAgIHJldHVybiBrZXk7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBnZXRWYWx1ZShfLCB2YWx1ZSkgewogICAgICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBnZXRFbnRyeShrZXksIHZhbHVlKSB7CiAgICAgICAgICAgIHJldHVybiBba2V5LCB2YWx1ZV07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZ1bmN0aW9uIENyZWF0ZVNldFBvbHlmaWxsKCkgewogICAgICAgICAgdmFyIFNldDIgPSAoCiAgICAgICAgICAgIC8qKiBAY2xhc3MgKi8KICAgICAgICAgICAgZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgZnVuY3Rpb24gU2V0MygpIHsKICAgICAgICAgICAgICAgIHRoaXMuX21hcCA9IG5ldyBfTWFwKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShTZXQzLnByb3RvdHlwZSwgInNpemUiLCB7CiAgICAgICAgICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fbWFwLnNpemU7CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSwKICAgICAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIFNldDMucHJvdG90eXBlLmhhcyA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fbWFwLmhhcyh2YWx1ZSk7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICBTZXQzLnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbih2YWx1ZSkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX21hcC5zZXQodmFsdWUsIHZhbHVlKSwgdGhpczsKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIFNldDMucHJvdG90eXBlLmRlbGV0ZSA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fbWFwLmRlbGV0ZSh2YWx1ZSk7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICBTZXQzLnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgdGhpcy5fbWFwLmNsZWFyKCk7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICBTZXQzLnByb3RvdHlwZS5rZXlzID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fbWFwLmtleXMoKTsKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIFNldDMucHJvdG90eXBlLnZhbHVlcyA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX21hcC5rZXlzKCk7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICBTZXQzLnByb3RvdHlwZS5lbnRyaWVzID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fbWFwLmVudHJpZXMoKTsKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIFNldDMucHJvdG90eXBlWyJAQGl0ZXJhdG9yIl0gPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmtleXMoKTsKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIFNldDMucHJvdG90eXBlW2l0ZXJhdG9yU3ltYm9sXSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMua2V5cygpOwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgcmV0dXJuIFNldDM7CiAgICAgICAgICAgIH0oKQogICAgICAgICAgKTsKICAgICAgICAgIHJldHVybiBTZXQyOwogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBDcmVhdGVXZWFrTWFwUG9seWZpbGwoKSB7CiAgICAgICAgICB2YXIgVVVJRF9TSVpFID0gMTY7CiAgICAgICAgICB2YXIga2V5cyA9IEhhc2hNYXAuY3JlYXRlKCk7CiAgICAgICAgICB2YXIgcm9vdEtleSA9IENyZWF0ZVVuaXF1ZUtleSgpOwogICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgLyoqIEBjbGFzcyAqLwogICAgICAgICAgICBmdW5jdGlvbigpIHsKICAgICAgICAgICAgICBmdW5jdGlvbiBXZWFrTWFwMigpIHsKICAgICAgICAgICAgICAgIHRoaXMuX2tleSA9IENyZWF0ZVVuaXF1ZUtleSgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBXZWFrTWFwMi5wcm90b3R5cGUuaGFzID0gZnVuY3Rpb24odGFyZ2V0KSB7CiAgICAgICAgICAgICAgICB2YXIgdGFibGUgPSBHZXRPckNyZWF0ZVdlYWtNYXBUYWJsZSgKICAgICAgICAgICAgICAgICAgdGFyZ2V0LAogICAgICAgICAgICAgICAgICAvKmNyZWF0ZSovCiAgICAgICAgICAgICAgICAgIGZhbHNlCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgcmV0dXJuIHRhYmxlICE9PSB2b2lkIDAgPyBIYXNoTWFwLmhhcyh0YWJsZSwgdGhpcy5fa2V5KSA6IGZhbHNlOwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgV2Vha01hcDIucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uKHRhcmdldCkgewogICAgICAgICAgICAgICAgdmFyIHRhYmxlID0gR2V0T3JDcmVhdGVXZWFrTWFwVGFibGUoCiAgICAgICAgICAgICAgICAgIHRhcmdldCwKICAgICAgICAgICAgICAgICAgLypjcmVhdGUqLwogICAgICAgICAgICAgICAgICBmYWxzZQogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIHJldHVybiB0YWJsZSAhPT0gdm9pZCAwID8gSGFzaE1hcC5nZXQodGFibGUsIHRoaXMuX2tleSkgOiB2b2lkIDA7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICBXZWFrTWFwMi5wcm90b3R5cGUuc2V0ID0gZnVuY3Rpb24odGFyZ2V0LCB2YWx1ZSkgewogICAgICAgICAgICAgICAgdmFyIHRhYmxlID0gR2V0T3JDcmVhdGVXZWFrTWFwVGFibGUoCiAgICAgICAgICAgICAgICAgIHRhcmdldCwKICAgICAgICAgICAgICAgICAgLypjcmVhdGUqLwogICAgICAgICAgICAgICAgICB0cnVlCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgdGFibGVbdGhpcy5fa2V5XSA9IHZhbHVlOwogICAgICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICBXZWFrTWFwMi5wcm90b3R5cGUuZGVsZXRlID0gZnVuY3Rpb24odGFyZ2V0KSB7CiAgICAgICAgICAgICAgICB2YXIgdGFibGUgPSBHZXRPckNyZWF0ZVdlYWtNYXBUYWJsZSgKICAgICAgICAgICAgICAgICAgdGFyZ2V0LAogICAgICAgICAgICAgICAgICAvKmNyZWF0ZSovCiAgICAgICAgICAgICAgICAgIGZhbHNlCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgcmV0dXJuIHRhYmxlICE9PSB2b2lkIDAgPyBkZWxldGUgdGFibGVbdGhpcy5fa2V5XSA6IGZhbHNlOwogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgV2Vha01hcDIucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9rZXkgPSBDcmVhdGVVbmlxdWVLZXkoKTsKICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIHJldHVybiBXZWFrTWFwMjsKICAgICAgICAgICAgfSgpCiAgICAgICAgICApOwogICAgICAgICAgZnVuY3Rpb24gQ3JlYXRlVW5pcXVlS2V5KCkgewogICAgICAgICAgICB2YXIga2V5OwogICAgICAgICAgICBkbwogICAgICAgICAgICAgIGtleSA9ICJAQFdlYWtNYXBAQCIgKyBDcmVhdGVVVUlEKCk7CiAgICAgICAgICAgIHdoaWxlIChIYXNoTWFwLmhhcyhrZXlzLCBrZXkpKTsKICAgICAgICAgICAga2V5c1trZXldID0gdHJ1ZTsKICAgICAgICAgICAgcmV0dXJuIGtleTsKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIEdldE9yQ3JlYXRlV2Vha01hcFRhYmxlKHRhcmdldCwgY3JlYXRlKSB7CiAgICAgICAgICAgIGlmICghaGFzT3duLmNhbGwodGFyZ2V0LCByb290S2V5KSkgewogICAgICAgICAgICAgIGlmICghY3JlYXRlKQogICAgICAgICAgICAgICAgcmV0dXJuIHZvaWQgMDsKICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCByb290S2V5LCB7IHZhbHVlOiBIYXNoTWFwLmNyZWF0ZSgpIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0YXJnZXRbcm9vdEtleV07CiAgICAgICAgICB9CiAgICAgICAgICBmdW5jdGlvbiBGaWxsUmFuZG9tQnl0ZXMoYnVmZmVyLCBzaXplKSB7CiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2l6ZTsgKytpKQogICAgICAgICAgICAgIGJ1ZmZlcltpXSA9IE1hdGgucmFuZG9tKCkgKiAyNTUgfCAwOwogICAgICAgICAgICByZXR1cm4gYnVmZmVyOwogICAgICAgICAgfQogICAgICAgICAgZnVuY3Rpb24gR2VuUmFuZG9tQnl0ZXMoc2l6ZSkgewogICAgICAgICAgICBpZiAodHlwZW9mIFVpbnQ4QXJyYXkgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICAgICAgICB2YXIgYXJyYXkgPSBuZXcgVWludDhBcnJheShzaXplKTsKICAgICAgICAgICAgICBpZiAodHlwZW9mIGNyeXB0byAhPT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgICAgIGNyeXB0by5nZXRSYW5kb21WYWx1ZXMoYXJyYXkpOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIG1zQ3J5cHRvICE9PSAidW5kZWZpbmVkIikgewogICAgICAgICAgICAgICAgbXNDcnlwdG8uZ2V0UmFuZG9tVmFsdWVzKGFycmF5KTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgRmlsbFJhbmRvbUJ5dGVzKGFycmF5LCBzaXplKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIGFycmF5OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBGaWxsUmFuZG9tQnl0ZXMobmV3IEFycmF5KHNpemUpLCBzaXplKTsKICAgICAgICAgIH0KICAgICAgICAgIGZ1bmN0aW9uIENyZWF0ZVVVSUQoKSB7CiAgICAgICAgICAgIHZhciBkYXRhID0gR2VuUmFuZG9tQnl0ZXMoVVVJRF9TSVpFKTsKICAgICAgICAgICAgZGF0YVs2XSA9IGRhdGFbNl0gJiA3OSB8IDY0OwogICAgICAgICAgICBkYXRhWzhdID0gZGF0YVs4XSAmIDE5MSB8IDEyODsKICAgICAgICAgICAgdmFyIHJlc3VsdCA9ICIiOwogICAgICAgICAgICBmb3IgKHZhciBvZmZzZXQgPSAwOyBvZmZzZXQgPCBVVUlEX1NJWkU7ICsrb2Zmc2V0KSB7CiAgICAgICAgICAgICAgdmFyIGJ5dGUgPSBkYXRhW29mZnNldF07CiAgICAgICAgICAgICAgaWYgKG9mZnNldCA9PT0gNCB8fCBvZmZzZXQgPT09IDYgfHwgb2Zmc2V0ID09PSA4KQogICAgICAgICAgICAgICAgcmVzdWx0ICs9ICItIjsKICAgICAgICAgICAgICBpZiAoYnl0ZSA8IDE2KQogICAgICAgICAgICAgICAgcmVzdWx0ICs9ICIwIjsKICAgICAgICAgICAgICByZXN1bHQgKz0gYnl0ZS50b1N0cmluZygxNikudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBmdW5jdGlvbiBNYWtlRGljdGlvbmFyeShvYmopIHsKICAgICAgICAgIG9iai5fXyA9IHZvaWQgMDsKICAgICAgICAgIGRlbGV0ZSBvYmouX187CiAgICAgICAgICByZXR1cm4gb2JqOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9KShSZWZsZWN0MiB8fCAoUmVmbGVjdDIgPSB7fSkpOwogIH0KfSk7CgovLyBzcmMvY29tcGlsZXIvc3RhbmRhcmQtbGlicmFyeS9zdGQtbGliLnRzCnZhciBpbXBvcnRfcmVmbGVjdF9tZXRhZGF0YSA9IF9fdG9FU00ocmVxdWlyZV9SZWZsZWN0KCkpOwoKLy8gc3JjL2NvbXBpbGVyL2NvbXBpbGVyLWludGVyZmFjZXMvZWxhbi10eXBlLWludGVyZmFjZXMudHMKdmFyIGVsYW5NZXRhZGF0YUtleSA9IFN5bWJvbCgiZWxhbi1tZXRhZGF0YSIpOwpmdW5jdGlvbiBpc0Z1bmN0aW9uRGVzY3JpcHRvcihkKSB7CiAgcmV0dXJuICEhZCAmJiAiaXNGdW5jdGlvbiIgaW4gZDsKfQpmdW5jdGlvbiBpc1Byb2NlZHVyZURlc2NyaXB0b3IoZCkgewogIHJldHVybiAhIWQgJiYgImlzUHJvY2VkdXJlIiBpbiBkOwp9CmZ1bmN0aW9uIGlzQ29uc3RhbnREZXNjcmlwdG9yKGQpIHsKICByZXR1cm4gISFkICYmICJpc0NvbnN0YW50IiBpbiBkOwp9CgovLyBzcmMvY29tcGlsZXIvZWxhbi1jb21waWxlci1lcnJvci50cwp2YXIgRWxhbkNvbXBpbGVyRXJyb3IgPSBjbGFzcyBleHRlbmRzIEVycm9yIHsKICBjb25zdHJ1Y3RvcihlcnIpIHsKICAgIHN1cGVyKGVyciBpbnN0YW5jZW9mIEVycm9yID8gZXJyLm1lc3NhZ2UgOiBlcnIpOwogICAgdGhpcy5lcnIgPSBlcnI7CiAgfQp9OwoKLy8gc3JjL2NvbXBpbGVyL2NvbXBpbGVyLWludGVyZmFjZXMvdHlwZS1vcHRpb25zLnRzCnZhciBub1R5cGVPcHRpb25zID0gewogIGlzSW1tdXRhYmxlOiBmYWxzZSwKICBpc0Fic3RyYWN0OiBmYWxzZSwKICBpc0luZGV4YWJsZTogZmFsc2UsCiAgaXNEb3VibGVJbmRleGFibGU6IGZhbHNlLAogIGlzSXRlcmFibGU6IGZhbHNlCn07CnZhciBpbW11dGFibGVUeXBlT3B0aW9ucyA9IHsKICBpc0ltbXV0YWJsZTogdHJ1ZSwKICBpc0Fic3RyYWN0OiBmYWxzZSwKICBpc0luZGV4YWJsZTogZmFsc2UsCiAgaXNEb3VibGVJbmRleGFibGU6IGZhbHNlLAogIGlzSXRlcmFibGU6IGZhbHNlCn07CmZ1bmN0aW9uIGdldFR5cGVPcHRpb25zKCkgewogIHJldHVybiB7CiAgICBpc0ltbXV0YWJsZTogZmFsc2UsCiAgICBpc0Fic3RyYWN0OiBmYWxzZSwKICAgIGlzSW5kZXhhYmxlOiBmYWxzZSwKICAgIGlzRG91YmxlSW5kZXhhYmxlOiBmYWxzZSwKICAgIGlzSXRlcmFibGU6IGZhbHNlCiAgfTsKfQoKLy8gc3JjL2NvbXBpbGVyL2tleXdvcmRzLnRzCnZhciBhYnN0cmFjdEtleXdvcmQgPSAiYWJzdHJhY3QiOwp2YXIgY2xhc3NLZXl3b3JkID0gImNsYXNzIjsKdmFyIGNvbnN0cnVjdG9yS2V5d29yZCA9ICJjb25zdHJ1Y3RvciI7CnZhciBmdW5jdGlvbktleXdvcmQgPSAiZnVuY3Rpb24iOwp2YXIgcHJpdmF0ZUtleXdvcmQgPSAicHJpdmF0ZSI7CnZhciBwcm9jZWR1cmVLZXl3b3JkID0gInByb2NlZHVyZSI7CnZhciBwcm9wZXJ0eUtleXdvcmQgPSAicHJvcGVydHkiOwp2YXIgdGhpc0tleXdvcmQgPSAidGhpcyI7CnZhciBhYnN0cmFjdFByb3BlcnR5S2V5d29yZHMgPSBhYnN0cmFjdEtleXdvcmQgKyAiICIgKyBwcm9wZXJ0eUtleXdvcmQ7CnZhciBhYnN0cmFjdFByb2NlZHVyZUtleXdvcmRzID0gYWJzdHJhY3RLZXl3b3JkICsgIiAiICsgcHJvY2VkdXJlS2V5d29yZDsKdmFyIGFic3RyYWN0RnVuY3Rpb25LZXl3b3JkcyA9IGFic3RyYWN0S2V5d29yZCArICIgIiArIGZ1bmN0aW9uS2V5d29yZDsKdmFyIHByaXZhdGVQcm9wZXJ0eUtleXdvcmRzID0gcHJpdmF0ZUtleXdvcmQgKyAiICIgKyBwcm9wZXJ0eUtleXdvcmQ7CnZhciBwcml2YXRlUHJvY2VkdXJlS2V5d29yZHMgPSBwcml2YXRlS2V5d29yZCArICIgIiArIHByb2NlZHVyZUtleXdvcmQ7CnZhciBwcml2YXRlRnVuY3Rpb25LZXl3b3JkcyA9IHByaXZhdGVLZXl3b3JkICsgIiAiICsgZnVuY3Rpb25LZXl3b3JkOwp2YXIgYWJzdHJhY3RDbGFzc0tleXdvcmRzID0gYWJzdHJhY3RLZXl3b3JkICsgIiAiICsgY2xhc3NLZXl3b3JkOwoKLy8gc3JjL2NvbXBpbGVyL3N5bWJvbHMvZWxhbi10eXBlLW5hbWVzLnRzCnZhciBCb29sZWFuTmFtZSA9ICJCb29sZWFuIjsKdmFyIEludE5hbWUgPSAiSW50IjsKdmFyIEZsb2F0TmFtZSA9ICJGbG9hdCI7CnZhciBTdHJpbmdOYW1lID0gIlN0cmluZyI7CnZhciBSZWdFeHBOYW1lID0gIlJlZ0V4cCI7CnZhciBGdW5jTmFtZSA9ICJGdW5jIjsKdmFyIFR1cGxlTmFtZSA9ICJUdXBsZSI7CnZhciBDbGFzc05hbWUgPSAiQ2xhc3MiOwoKLy8gc3JjL2NvbXBpbGVyL3N5bWJvbHMvYm9vbGVhbi10eXBlLnRzCnZhciBCb29sZWFuVHlwZSA9IGNsYXNzIF9Cb29sZWFuVHlwZSB7CiAgY29uc3RydWN0b3IoKSB7CiAgfQogIHR5cGVPcHRpb25zID0gaW1tdXRhYmxlVHlwZU9wdGlvbnM7CiAgaW5pdGlhbFZhbHVlID0gImZhbHNlIjsKICBzdGF0aWMgSW5zdGFuY2UgPSBuZXcgX0Jvb2xlYW5UeXBlKCk7CiAgbmFtZSA9IEJvb2xlYW5OYW1lOwogIHRvU3RyaW5nKCkgewogICAgcmV0dXJuIHRoaXMubmFtZTsKICB9CiAgaXNBc3NpZ25hYmxlRnJvbShvdGhlclR5cGUpIHsKICAgIHJldHVybiBvdGhlclR5cGUgaW5zdGFuY2VvZiBfQm9vbGVhblR5cGU7CiAgfQp9OwoKLy8gc3JjL2NvbXBpbGVyL3N5bWJvbHMvaW50LXR5cGUudHMKdmFyIEludFR5cGUgPSBjbGFzcyBfSW50VHlwZSB7CiAgY29uc3RydWN0b3IoKSB7CiAgfQogIGluaXRpYWxWYWx1ZSA9ICIwIjsKICB0eXBlT3B0aW9ucyA9IGltbXV0YWJsZVR5cGVPcHRpb25zOwogIHN0YXRpYyBJbnN0YW5jZSA9IG5ldyBfSW50VHlwZSgpOwogIG5hbWUgPSBJbnROYW1lOwogIHRvU3RyaW5nKCkgewogICAgcmV0dXJuIHRoaXMubmFtZTsKICB9CiAgaXNBc3NpZ25hYmxlRnJvbShvdGhlclR5cGUpIHsKICAgIHJldHVybiBvdGhlclR5cGUgaW5zdGFuY2VvZiBfSW50VHlwZTsKICB9Cn07CgovLyBzcmMvY29tcGlsZXIvc3ltYm9scy9mbG9hdC10eXBlLnRzCnZhciBGbG9hdFR5cGUgPSBjbGFzcyBfRmxvYXRUeXBlIHsKICBjb25zdHJ1Y3RvcigpIHsKICB9CiAgaW5pdGlhbFZhbHVlID0gIjAiOwogIHR5cGVPcHRpb25zID0gaW1tdXRhYmxlVHlwZU9wdGlvbnM7CiAgc3RhdGljIEluc3RhbmNlID0gbmV3IF9GbG9hdFR5cGUoKTsKICBuYW1lID0gRmxvYXROYW1lOwogIHRvU3RyaW5nKCkgewogICAgcmV0dXJuIHRoaXMubmFtZTsKICB9CiAgaXNOdW1iZXIoc3QpIHsKICAgIHJldHVybiBzdCBpbnN0YW5jZW9mIEludFR5cGUgfHwgc3QgaW5zdGFuY2VvZiBfRmxvYXRUeXBlOwogIH0KICBpc0Fzc2lnbmFibGVGcm9tKG90aGVyVHlwZSkgewogICAgcmV0dXJuIHRoaXMuaXNOdW1iZXIob3RoZXJUeXBlKTsKICB9Cn07CgovLyBzcmMvY29tcGlsZXIvc3ltYm9scy9mdW5jdGlvbi10eXBlLnRzCnZhciBGdW5jdGlvblR5cGUgPSBjbGFzcyBfRnVuY3Rpb25UeXBlIHsKICBjb25zdHJ1Y3RvcihwYXJhbWV0ZXJOYW1lcywgcGFyYW1ldGVyVHlwZXMsIHJldHVyblR5cGUsIGlzRXh0ZW5zaW9uLCBpc1B1cmUsIGlzQXN5bmMsIGRlcHJlY2F0ZWQpIHsKICAgIHRoaXMucGFyYW1ldGVyTmFtZXMgPSBwYXJhbWV0ZXJOYW1lczsKICAgIHRoaXMucGFyYW1ldGVyVHlwZXMgPSBwYXJhbWV0ZXJUeXBlczsKICAgIHRoaXMucmV0dXJuVHlwZSA9IHJldHVyblR5cGU7CiAgICB0aGlzLmlzRXh0ZW5zaW9uID0gaXNFeHRlbnNpb247CiAgICB0aGlzLmlzUHVyZSA9IGlzUHVyZTsKICAgIHRoaXMuaXNBc3luYyA9IGlzQXN5bmM7CiAgICB0aGlzLmRlcHJlY2F0ZWQgPSBkZXByZWNhdGVkOwogIH0KICBnZXQgaW5pdGlhbFZhbHVlKCkgewogICAgcmV0dXJuIGBzeXN0ZW0uZW1wdHlGdW5jKCR7dGhpcy5yZXR1cm5UeXBlLmluaXRpYWxWYWx1ZX0pYDsKICB9CiAgLy8gc28gY2FuIGhhdmUgbXV0YWJsZSB0eXBlIHBhcmFtZXRlcnMKICB0eXBlT3B0aW9ucyA9IG5vVHlwZU9wdGlvbnM7CiAgZ2V0IG5hbWUoKSB7CiAgICByZXR1cm4gYEZ1bmM8b2YgJHt0aGlzLnBhcmFtZXRlclR5cGVzLm1hcCgocCkgPT4gcC5uYW1lKS5qb2luKCIsICIpfSA9PiAke3RoaXMucmV0dXJuVHlwZS5uYW1lfT5gOwogIH0KICB0b1N0cmluZygpIHsKICAgIHJldHVybiBGdW5jTmFtZTsKICB9CiAgaXNBc3NpZ25hYmxlRnJvbShvdGhlclR5cGUpIHsKICAgIGlmIChvdGhlclR5cGUgaW5zdGFuY2VvZiBfRnVuY3Rpb25UeXBlKSB7CiAgICAgIGlmICh0aGlzLnBhcmFtZXRlclR5cGVzLmxlbmd0aCAhPT0gb3RoZXJUeXBlLnBhcmFtZXRlclR5cGVzLmxlbmd0aCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBjb25zdCBydCA9IHRoaXMucmV0dXJuVHlwZS5pc0Fzc2lnbmFibGVGcm9tKG90aGVyVHlwZS5yZXR1cm5UeXBlKTsKICAgICAgcmV0dXJuIHJ0ICYmIHRoaXMucGFyYW1ldGVyVHlwZXMubWFwKCh0LCBpKSA9PiB0LmlzQXNzaWduYWJsZUZyb20ob3RoZXJUeXBlLnBhcmFtZXRlclR5cGVzW2ldKSkuZXZlcnkoKGIpID0+IGIpOwogICAgfQogICAgcmV0dXJuIGZhbHNlOwogIH0KfTsKCi8vIHNyYy9jb21waWxlci9zeW1ib2xzL2dlbmVyaWMtcGFyYW1ldGVyLXR5cGUudHMKdmFyIEdlbmVyaWNQYXJhbWV0ZXJUeXBlID0gY2xhc3MgX0dlbmVyaWNQYXJhbWV0ZXJUeXBlIHsKICBjb25zdHJ1Y3RvcihpZCwgY29uc3RyYWludCkgewogICAgdGhpcy5pZCA9IGlkOwogICAgdGhpcy5jb25zdHJhaW50ID0gY29uc3RyYWludDsKICB9CiAgdHlwZU9wdGlvbnMgPSBub1R5cGVPcHRpb25zOwogIGluaXRpYWxWYWx1ZSA9ICIiOwogIGdldCBuYW1lKCkgewogICAgcmV0dXJuIHRoaXMuY29uc3RyYWludCA/IGAke3RoaXMuY29uc3RyYWludC5uYW1lfWAgOiBgR2VuZXJpYyBQYXJhbWV0ZXIgJHt0aGlzLmlkfWA7CiAgfQogIHRvU3RyaW5nKCkgewogICAgcmV0dXJuIHRoaXMubmFtZTsKICB9CiAgaXNBc3NpZ25hYmxlRnJvbShvdGhlclR5cGUpIHsKICAgIGlmIChvdGhlclR5cGUgaW5zdGFuY2VvZiBfR2VuZXJpY1BhcmFtZXRlclR5cGUpIHsKICAgICAgcmV0dXJuIHRoaXMubmFtZSA9PT0gb3RoZXJUeXBlLm5hbWU7CiAgICB9CiAgICByZXR1cm4gZmFsc2U7CiAgfQp9OwoKLy8gc3JjL2NvbXBpbGVyL3N5bWJvbHMvcHJvY2VkdXJlLXR5cGUudHMKdmFyIFByb2NlZHVyZVR5cGUgPSBjbGFzcyB7CiAgY29uc3RydWN0b3IocGFyYW1ldGVyTmFtZXMsIHBhcmFtZXRlclR5cGVzLCBpc0V4dGVuc2lvbiwgaXNBc3luYywgZGVwcmVjYXRlZCkgewogICAgdGhpcy5wYXJhbWV0ZXJOYW1lcyA9IHBhcmFtZXRlck5hbWVzOwogICAgdGhpcy5wYXJhbWV0ZXJUeXBlcyA9IHBhcmFtZXRlclR5cGVzOwogICAgdGhpcy5pc0V4dGVuc2lvbiA9IGlzRXh0ZW5zaW9uOwogICAgdGhpcy5pc0FzeW5jID0gaXNBc3luYzsKICAgIHRoaXMuZGVwcmVjYXRlZCA9IGRlcHJlY2F0ZWQ7CiAgfQogIHR5cGVPcHRpb25zID0gaW1tdXRhYmxlVHlwZU9wdGlvbnM7CiAgaW5pdGlhbFZhbHVlID0gIiI7CiAgZ2V0IG5hbWUoKSB7CiAgICByZXR1cm4gYFByb2NlZHVyZSAoJHt0aGlzLnBhcmFtZXRlclR5cGVzLm1hcCgocCkgPT4gcC5uYW1lKS5qb2luKCIsICIpfSlgOwogIH0KICB0b1N0cmluZygpIHsKICAgIHJldHVybiBgUHJvY2VkdXJlYDsKICB9CiAgaXNBc3NpZ25hYmxlRnJvbShfb3RoZXJUeXBlKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cn07CgovLyBzcmMvY29tcGlsZXIvc3ltYm9scy9zdHJpbmctdHlwZS50cwp2YXIgU3RyaW5nVHlwZSA9IGNsYXNzIF9TdHJpbmdUeXBlIHsKICBjb25zdHJ1Y3RvcigpIHsKICB9CiAgZ2V0IG9mVHlwZXMoKSB7CiAgICByZXR1cm4gW19TdHJpbmdUeXBlLkluc3RhbmNlXTsKICB9CiAgaW5pdGlhbFZhbHVlID0gJyIiJzsKICBnZXQgdHlwZU9wdGlvbnMoKSB7CiAgICByZXR1cm4gewogICAgICBpc0ltbXV0YWJsZTogdHJ1ZSwKICAgICAgaXNBYnN0cmFjdDogZmFsc2UsCiAgICAgIGlzSW5kZXhhYmxlOiB0cnVlLAogICAgICBpc0RvdWJsZUluZGV4YWJsZTogZmFsc2UsCiAgICAgIGlzSXRlcmFibGU6IHRydWUKICAgIH07CiAgfQogIHN0YXRpYyBJbnN0YW5jZSA9IG5ldyBfU3RyaW5nVHlwZSgpOwogIG5hbWUgPSBTdHJpbmdOYW1lOwogIHRvU3RyaW5nKCkgewogICAgcmV0dXJuIHRoaXMubmFtZTsKICB9CiAgaXNBc3NpZ25hYmxlRnJvbShvdGhlclR5cGUpIHsKICAgIHJldHVybiBvdGhlclR5cGUgaW5zdGFuY2VvZiBfU3RyaW5nVHlwZTsKICB9Cn07CgovLyBzcmMvY29tcGlsZXIvc3ltYm9scy90dXBsZS10eXBlLnRzCnZhciBUdXBsZVR5cGUgPSBjbGFzcyBfVHVwbGVUeXBlIHsKICBjb25zdHJ1Y3RvcihvZlR5cGVzKSB7CiAgICB0aGlzLm9mVHlwZXMgPSBvZlR5cGVzOwogIH0KICB0eXBlT3B0aW9ucyA9IGltbXV0YWJsZVR5cGVPcHRpb25zOwogIGdldCBpbml0aWFsVmFsdWUoKSB7CiAgICBjb25zdCBpbml0ID0gdGhpcy5vZlR5cGVzLm1hcCgodCkgPT4gdC5pbml0aWFsVmFsdWUpLmpvaW4oIiwgIik7CiAgICByZXR1cm4gYHN5c3RlbS5lbXB0eVR1cGxlKFske2luaXR9XSlgOwogIH0KICBnZXQgbmFtZSgpIHsKICAgIHJldHVybiBgdHVwbGUoJHt0aGlzLm9mVHlwZXMubWFwKCh0KSA9PiB0Lm5hbWUpLmpvaW4oIiwgIil9KWA7CiAgfQogIHRvU3RyaW5nKCkgewogICAgcmV0dXJuIGB0dXBsZSgke3RoaXMub2ZUeXBlcy5tYXAoKHQpID0+IHQubmFtZSkuam9pbigiLCAiKX0pYDsKICB9CiAgaXNBc3NpZ25hYmxlRnJvbShvdGhlclR5cGUpIHsKICAgIGlmIChvdGhlclR5cGUgaW5zdGFuY2VvZiBfVHVwbGVUeXBlKSB7CiAgICAgIGlmICh0aGlzLm9mVHlwZXMubGVuZ3RoICE9PSBvdGhlclR5cGUub2ZUeXBlcy5sZW5ndGgpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMub2ZUeXBlcy5tYXAoKHQsIGkpID0+IHQuaXNBc3NpZ25hYmxlRnJvbShvdGhlclR5cGUub2ZUeXBlc1tpXSkpLmV2ZXJ5KChiKSA9PiBiKTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9Cn07CgovLyBzcmMvY29tcGlsZXIvc3ltYm9scy91bmtub3duLXR5cGUudHMKdmFyIFVua25vd25UeXBlID0gY2xhc3MgX1Vua25vd25UeXBlIHsKICBjb25zdHJ1Y3RvcigpIHsKICB9CiAgaW5pdGlhbFZhbHVlID0gIiI7CiAgdHlwZU9wdGlvbnMgPSBpbW11dGFibGVUeXBlT3B0aW9uczsKICBzdGF0aWMgSW5zdGFuY2UgPSBuZXcgX1Vua25vd25UeXBlKCk7CiAgbmFtZSA9ICJVbmtub3duIjsKICB0b1N0cmluZygpIHsKICAgIHJldHVybiB0aGlzLm5hbWU7CiAgfQogIGlzQXNzaWduYWJsZUZyb20oX290aGVyVHlwZSkgewogICAgcmV0dXJuIHRydWU7CiAgfQp9OwoKLy8gc3JjL2NvbXBpbGVyL3N5bWJvbHMvZHVwbGljYXRlLXN5bWJvbC50cwp2YXIgRHVwbGljYXRlU3ltYm9sID0gY2xhc3MgewogIGNvbnN0cnVjdG9yKGR1cGxpY2F0ZXMpIHsKICAgIHRoaXMuZHVwbGljYXRlcyA9IGR1cGxpY2F0ZXM7CiAgfQogIGdldCBzeW1ib2xJZCgpIHsKICAgIHJldHVybiB0aGlzLmR1cGxpY2F0ZXNbMF0uc3ltYm9sSWQ7CiAgfQogIHN5bWJvbFR5cGUoKSB7CiAgICByZXR1cm4gdGhpcy5kdXBsaWNhdGVzWzBdLnN5bWJvbFR5cGUoKTsKICB9CiAgZ2V0IHN5bWJvbFNjb3BlKCkgewogICAgcmV0dXJuIHRoaXMuZHVwbGljYXRlc1swXS5zeW1ib2xTY29wZTsKICB9CiAgbmFtZSA9ICJEdXBsaWNhdGUgU3ltYm9sIjsKfTsKCi8vIHNyYy9jb21waWxlci9zeW1ib2xzL3Vua25vd24tc3ltYm9sLnRzCnZhciBVbmtub3duU3ltYm9sID0gY2xhc3MgewogIGNvbnN0cnVjdG9yKGlkKSB7CiAgICB0aGlzLnN5bWJvbElkID0gaWQgPz8gIiI7CiAgfQogIHN5bWJvbElkID0gIiI7CiAgc3ltYm9sVHlwZSA9ICgpID0+IFVua25vd25UeXBlLkluc3RhbmNlOwogIHN5bWJvbFNjb3BlID0gOSAvKiB1bmtub3duICovOwogIG5hbWUgPSAiVW5rbm93biBTeW1ib2wiOwp9OwoKLy8gc3JjL2NvbXBpbGVyL3N5bnRheC1ub2Rlcy9lbXB0eS1hc24udHMKdmFyIEVtcHR5QXNuID0gY2xhc3MgX0VtcHR5QXNuIHsKICBjb25zdHJ1Y3RvcihmaWVsZElkKSB7CiAgICB0aGlzLmZpZWxkSWQgPSBmaWVsZElkOwogIH0KICBpbmRlbnQoKSB7CiAgICByZXR1cm4gIiI7CiAgfQogIGl0ZW1zID0gW107CiAgaWQgPSAiIjsKICBzeW1ib2xTY29wZSA9IDkgLyogdW5rbm93biAqLzsKICBjb21waWxlRXJyb3JzID0gW107CiAgY29tcGlsZSgpIHsKICAgIHJldHVybiBgYDsKICB9CiAgc3ltYm9sVHlwZSgpIHsKICAgIHJldHVybiBVbmtub3duVHlwZS5JbnN0YW5jZTsKICB9CiAgZ2V0IHZhbHVlKCkgewogICAgcmV0dXJuIF9FbXB0eUFzbi5JbnN0YW5jZTsKICB9CiAgdG9TdHJpbmcoKSB7CiAgICByZXR1cm4gIiI7CiAgfQogIHN0YXRpYyBJbnN0YW5jZSA9IG5ldyBfRW1wdHlBc24oIiIpOwp9OwoKLy8gc3JjL2NvbXBpbGVyL3N5bWJvbHMvcmVnZXhwLXR5cGUudHMKdmFyIFJlZ0V4cFR5cGUgPSBjbGFzcyBfUmVnRXhwVHlwZSB7CiAgY29uc3RydWN0b3IoKSB7CiAgfQogIGluaXRpYWxWYWx1ZSA9ICJzeXN0ZW0uZW1wdHlSZWdFeHAoKSI7CiAgdHlwZU9wdGlvbnMgPSBpbW11dGFibGVUeXBlT3B0aW9uczsKICBzdGF0aWMgSW5zdGFuY2UgPSBuZXcgX1JlZ0V4cFR5cGUoKTsKICBuYW1lID0gUmVnRXhwTmFtZTsKICB0b1N0cmluZygpIHsKICAgIHJldHVybiB0aGlzLm5hbWU7CiAgfQogIGlzQXNzaWduYWJsZUZyb20ob3RoZXJUeXBlKSB7CiAgICByZXR1cm4gb3RoZXJUeXBlIGluc3RhbmNlb2YgX1JlZ0V4cFR5cGU7CiAgfQp9OwoKLy8gc3JjL2NvbXBpbGVyL3N5bWJvbHMvZWxhbi1zeW1ib2xzLnRzCnZhciBpbnRTeW1ib2wgPSB7CiAgc3ltYm9sSWQ6IEludFR5cGUuSW5zdGFuY2UubmFtZSwKICBzeW1ib2xUeXBlOiBmdW5jdGlvbigpIHsKICAgIHJldHVybiBJbnRUeXBlLkluc3RhbmNlOwogIH0sCiAgc3ltYm9sU2NvcGU6IDMgLyogcHJvZ3JhbSAqLwp9Owp2YXIgZmxvYXRTeW1ib2wgPSB7CiAgc3ltYm9sSWQ6IEZsb2F0VHlwZS5JbnN0YW5jZS5uYW1lLAogIHN5bWJvbFR5cGU6IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIEZsb2F0VHlwZS5JbnN0YW5jZTsKICB9LAogIHN5bWJvbFNjb3BlOiAzIC8qIHByb2dyYW0gKi8KfTsKdmFyIHN0cmluZ1N5bWJvbCA9IHsKICBzeW1ib2xJZDogU3RyaW5nVHlwZS5JbnN0YW5jZS5uYW1lLAogIHN5bWJvbFR5cGU6IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIFN0cmluZ1R5cGUuSW5zdGFuY2U7CiAgfSwKICBzeW1ib2xTY29wZTogMyAvKiBwcm9ncmFtICovCn07CnZhciBib29sZWFuU3ltYm9sID0gewogIHN5bWJvbElkOiBCb29sZWFuVHlwZS5JbnN0YW5jZS5uYW1lLAogIHN5bWJvbFR5cGU6IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIEJvb2xlYW5UeXBlLkluc3RhbmNlOwogIH0sCiAgc3ltYm9sU2NvcGU6IDMgLyogcHJvZ3JhbSAqLwp9Owp2YXIgcmVnRXhwU3ltYm9sID0gewogIHN5bWJvbElkOiBSZWdFeHBUeXBlLkluc3RhbmNlLm5hbWUsCiAgc3ltYm9sVHlwZTogZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gUmVnRXhwVHlwZS5JbnN0YW5jZTsKICB9LAogIHN5bWJvbFNjb3BlOiAzIC8qIHByb2dyYW0gKi8KfTsKdmFyIHR1cGxlU3ltYm9sID0gewogIHN5bWJvbElkOiBUdXBsZU5hbWUsCiAgc3ltYm9sVHlwZTogZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gbmV3IFR1cGxlVHlwZShbbmV3IEdlbmVyaWNQYXJhbWV0ZXJUeXBlKCJUMSIpLCBuZXcgR2VuZXJpY1BhcmFtZXRlclR5cGUoIlQyIildKTsKICB9LAogIHN5bWJvbFNjb3BlOiAzIC8qIHByb2dyYW0gKi8sCiAgaXNDbGFzczogdHJ1ZSwKICBpc0Fic3RyYWN0OiB0cnVlLAogIGlzTm90SW5oZXJpdGFibGU6IHRydWUsCiAgb2ZUeXBlczogW25ldyBHZW5lcmljUGFyYW1ldGVyVHlwZSgiVDEiKSwgbmV3IEdlbmVyaWNQYXJhbWV0ZXJUeXBlKCJUMiIpXQp9Owp2YXIgZnVuY1N5bWJvbCA9IHsKICBzeW1ib2xJZDogRnVuY05hbWUsCiAgc3ltYm9sVHlwZTogZnVuY3Rpb24oKSB7CiAgICByZXR1cm4gbmV3IEZ1bmN0aW9uVHlwZSgKICAgICAgWyJUIl0sCiAgICAgIFtuZXcgR2VuZXJpY1BhcmFtZXRlclR5cGUoIlQiKV0sCiAgICAgIG5ldyBHZW5lcmljUGFyYW1ldGVyVHlwZSgiVDEiKSwKICAgICAgZmFsc2UsCiAgICAgIHRydWUsCiAgICAgIGZhbHNlCiAgICApOwogIH0sCiAgc3ltYm9sU2NvcGU6IDMgLyogcHJvZ3JhbSAqLywKICBpc0NsYXNzOiB0cnVlLAogIGlzQWJzdHJhY3Q6IHRydWUsCiAgaXNOb3RJbmhlcml0YWJsZTogdHJ1ZSwKICBvZlR5cGVzOiBbbmV3IEdlbmVyaWNQYXJhbWV0ZXJUeXBlKCJUIildCn07CgovLyBzcmMvY29tcGlsZXIvc3ltYm9scy9udWxsLXNjb3BlLnRzCnZhciBOdWxsU2NvcGUgPSBjbGFzcyBfTnVsbFNjb3BlIHsKICByZXNvbHZlU3ltYm9sKF9pZCwgX3Njb3BlKSB7CiAgICByZXR1cm4gbmV3IFVua25vd25TeW1ib2woKTsKICB9CiAgcmVzb2x2ZU93blN5bWJvbChfaWQpIHsKICAgIHJldHVybiBuZXcgVW5rbm93blN5bWJvbCgpOwogIH0KICBnZXRQYXJlbnRTY29wZSgpIHsKICAgIHJldHVybiBfTnVsbFNjb3BlLkluc3RhbmNlOwogIH0KICBzeW1ib2xNYXRjaGVzKF9pZCwgX2FsbCwgX2luaXRpYWxTY29wZSkgewogICAgcmV0dXJuIFtdOwogIH0KICBnZXRDaGlsZHJlbigpIHsKICAgIHJldHVybiBbXTsKICB9CiAgc3ltYm9sSWQgPSAiIjsKICBzeW1ib2xUeXBlID0gKCkgPT4gVW5rbm93blR5cGUuSW5zdGFuY2U7CiAgc3ltYm9sU2NvcGUgPSA5IC8qIHVua25vd24gKi87CiAgc3RhdGljIEluc3RhbmNlID0gbmV3IF9OdWxsU2NvcGUoKTsKfTsKCi8vIHNyYy9jb21waWxlci9zeW50YXgtbm9kZXMvYXN0LWhlbHBlcnMudHMKdmFyIFR5cGVIb2xkZXIgPSBjbGFzcyB7CiAgY29uc3RydWN0b3Ioc3ltYm9sVHlwZSwgb2ZUeXBlcykgewogICAgdGhpcy5zeW1ib2xUeXBlID0gc3ltYm9sVHlwZTsKICAgIHRoaXMub2ZUeXBlcyA9IG9mVHlwZXM7CiAgfQogIGlzQXNzaWduYWJsZUZyb20ob3RoZXJUeXBlKSB7CiAgICByZXR1cm4gdGhpcy5zeW1ib2xUeXBlLmlzQXNzaWduYWJsZUZyb20ob3RoZXJUeXBlKTsKICB9CiAgdHlwZU9wdGlvbnMgPSBub1R5cGVPcHRpb25zOwogIG5hbWUgPSAiVHlwZUhvbGRlciI7CiAgaW5pdGlhbFZhbHVlID0gIiI7CiAgdG9TdHJpbmcoKSB7CiAgICByZXR1cm4gdGhpcy5uYW1lOwogIH0KfTsKZnVuY3Rpb24gZ2VuZXJhdGVUeXBlKHR5cGUsIG1hdGNoZXMsIGRlcHRoID0gMCkgewogIGRlcHRoKys7CiAgaWYgKGRlcHRoID4gMjApIHsKICAgIHJldHVybiB0eXBlOwogIH0KICBpZiAoaXNSZWlmeWFibGVTeW1ib2xUeXBlKHR5cGUpKSB7CiAgICByZXR1cm4gdHlwZS5yZWlmeSh0eXBlLm9mVHlwZXMubWFwKCh0KSA9PiBnZW5lcmF0ZVR5cGUodCwgbWF0Y2hlcywgZGVwdGgpKSk7CiAgfQogIGlmICh0eXBlIGluc3RhbmNlb2YgR2VuZXJpY1BhcmFtZXRlclR5cGUpIHsKICAgIGxldCBtYXRjaCA9IG1hdGNoZXMuZ2V0KHR5cGUuaWQpOwogICAgaWYgKG1hdGNoIGluc3RhbmNlb2YgVHlwZUhvbGRlcikgewogICAgICBtYXRjaCA9IGdlbmVyYXRlVHlwZShtYXRjaC5zeW1ib2xUeXBlLCBtYXRjaGVzLCBkZXB0aCk7CiAgICB9CiAgICBtYXRjaCA9IG1hdGNoID8/IHR5cGU7CiAgICBpZiAobWF0Y2ggaW5zdGFuY2VvZiBHZW5lcmljUGFyYW1ldGVyVHlwZSkgewogICAgICBsZXQgbmV3Q29uc3RyYWludCA9IHZvaWQgMDsKICAgICAgaWYgKG1hdGNoLmNvbnN0cmFpbnQpIHsKICAgICAgICBuZXdDb25zdHJhaW50ID0gZ2VuZXJhdGVUeXBlKG1hdGNoLmNvbnN0cmFpbnQsIG1hdGNoZXMsIGRlcHRoKTsKICAgICAgfQogICAgICBpZiAobmV3Q29uc3RyYWludCkgewogICAgICAgIG1hdGNoID0gbmV3IEdlbmVyaWNQYXJhbWV0ZXJUeXBlKG1hdGNoLmlkLCBuZXdDb25zdHJhaW50KTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIG1hdGNoOwogIH0KICBpZiAodHlwZSBpbnN0YW5jZW9mIFR1cGxlVHlwZSkgewogICAgcmV0dXJuIG5ldyBUdXBsZVR5cGUodHlwZS5vZlR5cGVzLm1hcCgodCkgPT4gZ2VuZXJhdGVUeXBlKHQsIG1hdGNoZXMsIGRlcHRoKSkpOwogIH0KICBpZiAodHlwZSBpbnN0YW5jZW9mIEZ1bmN0aW9uVHlwZSkgewogICAgcmV0dXJuIG5ldyBGdW5jdGlvblR5cGUoCiAgICAgIHR5cGUucGFyYW1ldGVyTmFtZXMsCiAgICAgIHR5cGUucGFyYW1ldGVyVHlwZXMubWFwKCh0KSA9PiBnZW5lcmF0ZVR5cGUodCwgbWF0Y2hlcywgZGVwdGgpKSwKICAgICAgZ2VuZXJhdGVUeXBlKHR5cGUucmV0dXJuVHlwZSwgbWF0Y2hlcyksCiAgICAgIHR5cGUuaXNFeHRlbnNpb24sCiAgICAgIHR5cGUuaXNQdXJlLAogICAgICB0eXBlLmlzQXN5bmMsCiAgICAgIHR5cGUuZGVwcmVjYXRlZAogICAgKTsKICB9CiAgaWYgKHR5cGUgaW5zdGFuY2VvZiBQcm9jZWR1cmVUeXBlKSB7CiAgICByZXR1cm4gbmV3IFByb2NlZHVyZVR5cGUoCiAgICAgIHR5cGUucGFyYW1ldGVyTmFtZXMsCiAgICAgIHR5cGUucGFyYW1ldGVyVHlwZXMubWFwKCh0KSA9PiBnZW5lcmF0ZVR5cGUodCwgbWF0Y2hlcywgZGVwdGgpKSwKICAgICAgdHlwZS5pc0V4dGVuc2lvbiwKICAgICAgdHlwZS5pc0FzeW5jCiAgICApOwogIH0KICByZXR1cm4gdHlwZTsKfQp2YXIgb3BNYXAgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcChbCiAgWzAgLyogQWRkICovLCAiKyJdLAogIFsxIC8qIE1pbnVzICovLCAiLSJdLAogIFsyIC8qIE5vdCAqLywgIm5vdCJdLAogIFszIC8qIE11bHRpcGx5ICovLCAiKiJdLAogIFs0IC8qIEFuZCAqLywgImFuZCJdLAogIFs1IC8qIEVxdWFscyAqLywgImlzIl0sCiAgWzYgLyogTFQgKi8sICI8Il0sCiAgWzcgLyogR1QgKi8sICI+Il0sCiAgWzggLyogR1RFICovLCAiPj0iXSwKICBbOSAvKiBMVEUgKi8sICI8PSJdLAogIFsxMCAvKiBEaXYgKi8sICJkaXYiXSwKICBbMTEgLyogTW9kICovLCAibW9kIl0sCiAgWzEyIC8qIERpdmlkZSAqLywgIi8iXSwKICBbMTMgLyogTm90RXF1YWxzICovLCAiaXNudCJdLAogIFsxNCAvKiBQb3cgKi8sICJeIl0sCiAgWzE1IC8qIE9yICovLCAib3IiXQpdKTsKCi8vIHNyYy9jb21waWxlci9zeW1ib2xzL3N5bWJvbC1oZWxwZXJzLnRzCmZ1bmN0aW9uIGlzQ2xhc3MocykgewogIHJldHVybiAhIXMgJiYgImlzQ2xhc3MiIGluIHM7Cn0KZnVuY3Rpb24gaXNTeW1ib2wocykgewogIHJldHVybiAhIXMgJiYgInN5bWJvbElkIiBpbiBzICYmICJzeW1ib2xUeXBlIiBpbiBzOwp9CmZ1bmN0aW9uIGlzUmVpZnlhYmxlU3ltYm9sVHlwZShzKSB7CiAgcmV0dXJuICEhcyAmJiAicmVpZnkiIGluIHM7Cn0KZnVuY3Rpb24gaXNQcm9wZXJ0eShzKSB7CiAgcmV0dXJuICEhcyAmJiAiaXNQcm9wZXJ0eSIgaW4gczsKfQpmdW5jdGlvbiBpc01lbWJlcihzKSB7CiAgcmV0dXJuICEhcyAmJiAiaXNNZW1iZXIiIGluIHM7Cn0KZnVuY3Rpb24gZml4Q2FzZShpZCwgcykgewogIGxldCBzaWQgPSBzLnN5bWJvbElkOwogIGlmICghaGFzQW55VXBwZXJDYXNlKGlkKSkgewogICAgaWQgPSBpZC50b1VwcGVyQ2FzZSgpOwogICAgc2lkID0gc2lkLnRvVXBwZXJDYXNlKCk7CiAgfQogIHJldHVybiBbaWQsIHNpZF07Cn0KZnVuY3Rpb24gbWF0Y2hTdGFydChpLCBzKSB7CiAgY29uc3QgW2lkLCBzaWRdID0gZml4Q2FzZShpLCBzKTsKICByZXR1cm4gc2lkLnN0YXJ0c1dpdGgoaWQpOwp9CmZ1bmN0aW9uIGhhc0FueVVwcGVyQ2FzZShpZCkgewogIHJldHVybiBBcnJheS5mcm9tKGlkKS5maWx0ZXIoKGMpID0+IGMudG9VcHBlckNhc2UoKSA9PT0gYykubGVuZ3RoID4gMDsKfQpmdW5jdGlvbiBtYXRjaEluY2x1ZGVzKGksIHMpIHsKICBjb25zdCBbaWQsIHNpZF0gPSBmaXhDYXNlKGksIHMpOwogIHJldHVybiBzaWQuaW5jbHVkZXMoaWQpOwp9CmZ1bmN0aW9uIHN5bWJvbE1hdGNoZXMoaWQsIGFsbCwgc3ltYm9scykgewogIGlmIChhbGwpIHsKICAgIHJldHVybiBzeW1ib2xzOwogIH0KICBjb25zdCBzdyA9IHN5bWJvbHMuZmlsdGVyKChzKSA9PiBtYXRjaFN0YXJ0KGlkLCBzKSk7CiAgbGV0IGluYyA9IFtdOwogIGNvbnN0IGxpbWl0ID0gMTsKICBpZiAoaWQubGVuZ3RoID49IGxpbWl0KSB7CiAgICBpbmMgPSBzeW1ib2xzLmZpbHRlcigocykgPT4gIXN3LmluY2x1ZGVzKHMpKS5maWx0ZXIoKHMpID0+IG1hdGNoSW5jbHVkZXMoaWQsIHMpKTsKICB9CiAgcmV0dXJuIHN3LmNvbmNhdChpbmMpOwp9CgovLyBzcmMvY29tcGlsZXIvc3ltYm9scy9jbGFzcy10eXBlLnRzCnZhciBDbGFzc1R5cGUgPSBjbGFzcyBfQ2xhc3NUeXBlIHsKICBjb25zdHJ1Y3RvcihjbGFzc05hbWUsIHN1YlR5cGUsIGlzTm90SW5oZXJpdGFibGUsIHR5cGVPcHRpb25zLCBpbmhlcml0c0Zyb20sIHNjb3BlKSB7CiAgICB0aGlzLmNsYXNzTmFtZSA9IGNsYXNzTmFtZTsKICAgIHRoaXMuc3ViVHlwZSA9IHN1YlR5cGU7CiAgICB0aGlzLmlzTm90SW5oZXJpdGFibGUgPSBpc05vdEluaGVyaXRhYmxlOwogICAgdGhpcy50eXBlT3B0aW9ucyA9IHR5cGVPcHRpb25zOwogICAgdGhpcy5pbmhlcml0c0Zyb20gPSBpbmhlcml0c0Zyb207CiAgICB0aGlzLnNjb3BlID0gc2NvcGU7CiAgfQogIGdldCBvZlR5cGVzKCkgewogICAgcmV0dXJuIGlzQ2xhc3ModGhpcy5zY29wZSkgPyB0aGlzLnNjb3BlLm9mVHlwZXMgOiBbXTsKICB9CiAgZ2V0IGRlcHJlY2F0ZWQoKSB7CiAgICByZXR1cm4gaXNDbGFzcyh0aGlzLnNjb3BlKSA/IHRoaXMuc2NvcGUuZGVwcmVjYXRlZCA6IHZvaWQgMDsKICB9CiAgcmVpZnkoZ3RzKSB7CiAgICBpZiAoaXNDbGFzcyh0aGlzLnNjb3BlKSkgewogICAgICBjb25zdCBjbHMgPSB0aGlzLnNjb3BlLnVwZGF0ZU9mVHlwZXMoZ3RzKTsKICAgICAgcmV0dXJuIG5ldyBfQ2xhc3NUeXBlKAogICAgICAgIHRoaXMuY2xhc3NOYW1lLAogICAgICAgIHRoaXMuc3ViVHlwZSwKICAgICAgICB0aGlzLmlzTm90SW5oZXJpdGFibGUsCiAgICAgICAgdGhpcy50eXBlT3B0aW9ucywKICAgICAgICB0aGlzLmluaGVyaXRzRnJvbSwKICAgICAgICBjbHMKICAgICAgKTsKICAgIH0KICAgIHJldHVybiB0aGlzOwogIH0KICB1cGRhdGVGcm9tKG90aGVyKSB7CiAgICB0aGlzLmNsYXNzTmFtZSA9IG90aGVyLmNsYXNzTmFtZTsKICAgIHRoaXMuaXNOb3RJbmhlcml0YWJsZSA9IG90aGVyLmlzTm90SW5oZXJpdGFibGU7CiAgICB0aGlzLnR5cGVPcHRpb25zID0gb3RoZXIudHlwZU9wdGlvbnM7CiAgICB0aGlzLmluaGVyaXRzRnJvbSA9IG90aGVyLmluaGVyaXRzRnJvbTsKICAgIHRoaXMuc2NvcGUgPSBvdGhlci5zY29wZTsKICAgIHJldHVybiB0aGlzOwogIH0KICBzeW1ib2xNYXRjaGVzKGlkLCBhbGwpIHsKICAgIGNvbnN0IHN5bWJvbHMgPSB0aGlzLnNjb3BlLmdldENoaWxkcmVuKCkuZmlsdGVyKChmKSA9PiBpc1N5bWJvbChmKSk7CiAgICByZXR1cm4gc3ltYm9sTWF0Y2hlcyhpZCwgYWxsLCBzeW1ib2xzKTsKICB9CiAgdHlwZU1hdGNoKHQxLCB0MikgewogICAgaWYgKHQxIGluc3RhbmNlb2YgRmxvYXRUeXBlICYmIHQyIGluc3RhbmNlb2YgSW50VHlwZSkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHJldHVybiB0MS5uYW1lID09PSB0Mi5uYW1lOwogIH0KICBpc0Fzc2lnbmFibGVGcm9tKG90aGVyVHlwZSkgewogICAgaWYgKG90aGVyVHlwZSBpbnN0YW5jZW9mIF9DbGFzc1R5cGUpIHsKICAgICAgaWYgKG90aGVyVHlwZS5jbGFzc05hbWUgPT09IHRoaXMuY2xhc3NOYW1lKSB7CiAgICAgICAgaWYgKHRoaXMub2ZUeXBlcy5sZW5ndGggPT09IG90aGVyVHlwZS5vZlR5cGVzLmxlbmd0aCkgewogICAgICAgICAgcmV0dXJuIHRoaXMub2ZUeXBlcy5sZW5ndGggPT09IDAgPyB0cnVlIDogdGhpcy5vZlR5cGVzLmV2ZXJ5KCh0LCBpKSA9PiB0aGlzLnR5cGVNYXRjaCh0LCBvdGhlclR5cGUub2ZUeXBlc1tpXSkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgcmV0dXJuIG90aGVyVHlwZS5pbmhlcml0c0Zyb20uc29tZSgoYykgPT4gdGhpcy5pc0Fzc2lnbmFibGVGcm9tKGMpKTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9CiAgZ2V0UGFyZW50U2NvcGUoKSB7CiAgICByZXR1cm4gdGhpcy5zY29wZTsKICB9CiAgY2hpbGRTeW1ib2xzKCkgewogICAgcmV0dXJuIHRoaXMuc2NvcGUuZ2V0Q2hpbGRyZW4oKS5maWx0ZXIoKGMpID0+IGlzU3ltYm9sKGMpKTsKICB9CiAgcmVzb2x2ZVN5bWJvbChpZCwgc2NvcGUpIHsKICAgIHJldHVybiB0aGlzLnNjb3BlLnJlc29sdmVTeW1ib2woaWQsIHNjb3BlKTsKICB9CiAgZ2V0IG5hbWUoKSB7CiAgICBpZiAodGhpcy5vZlR5cGVzLmxlbmd0aCA9PT0gMSkgewogICAgICByZXR1cm4gYCR7dGhpcy5jbGFzc05hbWUudHJpbSgpfTxvZiAke3RoaXMub2ZUeXBlc1swXS5uYW1lfT5gOwogICAgfQogICAgaWYgKHRoaXMub2ZUeXBlcy5sZW5ndGggPT09IDIpIHsKICAgICAgcmV0dXJuIGAke3RoaXMuY2xhc3NOYW1lLnRyaW0oKX08b2YgJHt0aGlzLm9mVHlwZXNbMF0ubmFtZX0sICR7dGhpcy5vZlR5cGVzWzFdLm5hbWV9PmA7CiAgICB9CiAgICByZXR1cm4gYCR7dGhpcy5jbGFzc05hbWUudHJpbSgpfWA7CiAgfQogIHRvU3RyaW5nKCkgewogICAgcmV0dXJuIGAke3RoaXMuY2xhc3NOYW1lLnRyaW0oKX1gOwogIH0KICBnZXQgaW5pdGlhbFZhbHVlKCkgewogICAgY29uc3QgaXNTdGRMaWIgPSB0aGlzLnNjb3BlLnN5bWJvbFNjb3BlID09PSAyIC8qIHN0ZGxpYiAqLzsKICAgIGNvbnN0IHByZWZpeCA9IGlzU3RkTGliID8gInN5c3RlbS5pbml0aWFsaXNlKF9zdGRsaWIuIiA6ICIiOwogICAgY29uc3QgcG9zdGZpeCA9IGlzU3RkTGliID8gIikiIDogIiI7CiAgICByZXR1cm4gYCR7cHJlZml4fSR7dGhpcy5jbGFzc05hbWV9LmVtcHR5SW5zdGFuY2UoKSR7cG9zdGZpeH1gOwogIH0KfTsKCi8vIHNyYy9jb21waWxlci9zeW1ib2xzL3N0ZGxpYi1jbGFzcy50cwp2YXIgU3RkTGliQ2xhc3MgPSBjbGFzcyBfU3RkTGliQ2xhc3MgewogIGNvbnN0cnVjdG9yKG5hbWUsIGlzTm90SW5oZXJpdGFibGUsIHR5cGVPcHRpb25zLCBjaGlsZHJlbiwgb2ZUeXBlcywgaW5oZXJpdFR5cGVzLCBzY29wZSwgZGVwcmVjYXRlZCkgewogICAgdGhpcy5uYW1lID0gbmFtZTsKICAgIHRoaXMuaXNOb3RJbmhlcml0YWJsZSA9IGlzTm90SW5oZXJpdGFibGU7CiAgICB0aGlzLnR5cGVPcHRpb25zID0gdHlwZU9wdGlvbnM7CiAgICB0aGlzLmNoaWxkcmVuID0gY2hpbGRyZW47CiAgICB0aGlzLm9mVHlwZXMgPSBvZlR5cGVzOwogICAgdGhpcy5pbmhlcml0VHlwZXMgPSBpbmhlcml0VHlwZXM7CiAgICB0aGlzLnNjb3BlID0gc2NvcGU7CiAgICB0aGlzLmRlcHJlY2F0ZWQgPSBkZXByZWNhdGVkOwogICAgdGhpcy5zeW1ib2xJZCA9IHRoaXMubmFtZTsKICB9CiAgZ2V0IGlzQWJzdHJhY3QoKSB7CiAgICByZXR1cm4gdGhpcy50eXBlT3B0aW9ucy5pc0Fic3RyYWN0OwogIH0KICB1cGRhdGVPZlR5cGVzKG9mVHlwZXMpIHsKICAgIGNvbnN0IG5ld09mVHlwZXMgPSBbLi4udGhpcy5vZlR5cGVzXTsKICAgIGNvbnN0IGxlc3NPZiA9IG5ld09mVHlwZXMubGVuZ3RoID4gb2ZUeXBlcy5sZW5ndGggPyBvZlR5cGVzLmxlbmd0aCA6IG5ld09mVHlwZXMubGVuZ3RoOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZXNzT2Y7IGkrKykgewogICAgICBuZXdPZlR5cGVzW2ldID0gb2ZUeXBlc1tpXTsKICAgIH0KICAgIHJldHVybiBuZXcgX1N0ZExpYkNsYXNzKAogICAgICB0aGlzLm5hbWUsCiAgICAgIHRoaXMuaXNOb3RJbmhlcml0YWJsZSwKICAgICAgdGhpcy50eXBlT3B0aW9ucywKICAgICAgdGhpcy5jaGlsZHJlbiwKICAgICAgbmV3T2ZUeXBlcywKICAgICAgdGhpcy5pbmhlcml0VHlwZXMsCiAgICAgIHRoaXMuc2NvcGUsCiAgICAgIHRoaXMuZGVwcmVjYXRlZAogICAgKTsKICB9CiAgZ2V0RGlyZWN0U3VwZXJDbGFzc2VzVHlwZUFuZE5hbWUoKSB7CiAgICBpZiAodGhpcy5pbmhlcml0VHlwZXMubGVuZ3RoID4gMCkgewogICAgICBjb25zdCB0eXBlQW5kTmFtZSA9IHRoaXMuaW5oZXJpdFR5cGVzLmZpbHRlcigoYykgPT4gYyBpbnN0YW5jZW9mIENsYXNzVHlwZSkubWFwKChjKSA9PiBbYywgYy5jbGFzc05hbWVdKTsKICAgICAgcmV0dXJuIHR5cGVBbmROYW1lOwogICAgfQogICAgcmV0dXJuIFtdOwogIH0KICBpc0NsYXNzID0gdHJ1ZTsKICBzeW1ib2xJZDsKICBzeW1ib2xUeXBlKCkgewogICAgcmV0dXJuIG5ldyBDbGFzc1R5cGUoCiAgICAgIHRoaXMubmFtZSwKICAgICAgdGhpcy50eXBlT3B0aW9ucy5pc0Fic3RyYWN0ID8gMSAvKiBhYnN0cmFjdCAqLyA6IDAgLyogY29uY3JldGUgKi8sCiAgICAgIHRoaXMuaXNOb3RJbmhlcml0YWJsZSwKICAgICAgdGhpcy50eXBlT3B0aW9ucywKICAgICAgdGhpcy5pbmhlcml0VHlwZXMsCiAgICAgIHRoaXMKICAgICk7CiAgfQogIHN5bWJvbFNjb3BlID0gMiAvKiBzdGRsaWIgKi87CiAgZ2V0Q2hpbGRyZW4oKSB7CiAgICByZXR1cm4gdGhpcy5jaGlsZHJlbjsKICB9CiAgcmVzb2x2ZU93blN5bWJvbChpZCkgewogICAgaWYgKGlkID09PSB0aGlzS2V5d29yZCkgewogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIGNvbnN0IG1hdGNoZXMgPSB0aGlzLmdldENoaWxkcmVuKCkuZmlsdGVyKChmKSA9PiBpc1N5bWJvbChmKSAmJiBmLnN5bWJvbElkID09PSBpZCk7CiAgICBpZiAobWF0Y2hlcy5sZW5ndGggPT09IDEpIHsKICAgICAgcmV0dXJuIG1hdGNoZXNbMF07CiAgICB9CiAgICBpZiAobWF0Y2hlcy5sZW5ndGggPiAxKSB7CiAgICAgIHJldHVybiBuZXcgRHVwbGljYXRlU3ltYm9sKG1hdGNoZXMpOwogICAgfQogICAgY29uc3QgdHlwZXMgPSB0aGlzLmluaGVyaXRUeXBlcy5maWx0ZXIoKHQpID0+IHQgaW5zdGFuY2VvZiBDbGFzc1R5cGUpOwogICAgZm9yIChjb25zdCBjdCBvZiB0eXBlcykgewogICAgICBjb25zdCBzID0gY3Quc2NvcGUucmVzb2x2ZU93blN5bWJvbChpZCk7CiAgICAgIGlmIChpc01lbWJlcihzKSkgewogICAgICAgIG1hdGNoZXMucHVzaChzKTsKICAgICAgfQogICAgfQogICAgaWYgKG1hdGNoZXMubGVuZ3RoID09PSAxKSB7CiAgICAgIHJldHVybiBtYXRjaGVzWzBdOwogICAgfQogICAgaWYgKG1hdGNoZXMubGVuZ3RoID4gMSkgewogICAgICByZXR1cm4gbmV3IER1cGxpY2F0ZVN5bWJvbChtYXRjaGVzKTsKICAgIH0KICAgIHJldHVybiBuZXcgVW5rbm93blN5bWJvbChpZCk7CiAgfQogIHJlc29sdmVTeW1ib2woaWQsIF9zY29wZSkgewogICAgY29uc3Qgc3ltYm9sID0gdGhpcy5yZXNvbHZlT3duU3ltYm9sKGlkKTsKICAgIGlmIChzeW1ib2wgaW5zdGFuY2VvZiBVbmtub3duU3ltYm9sKSB7CiAgICAgIHJldHVybiB0aGlzLmdldFBhcmVudFNjb3BlKCkucmVzb2x2ZVN5bWJvbChpZCwgdGhpcyk7CiAgICB9CiAgICBpZiAoIWlzUHJvcGVydHkoc3ltYm9sKSkgewogICAgICBjb25zdCBzdCA9IHN5bWJvbC5zeW1ib2xUeXBlKCk7CiAgICAgIGNvbnN0IG1hdGNoZXMgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpOwogICAgICB0aGlzLm9mVHlwZXMuZm9yRWFjaCgodCwgaSkgPT4gbWF0Y2hlcy5zZXQoYFQke2kgKyAxfWAsIHQpKTsKICAgICAgY29uc3Qgc3QxID0gZ2VuZXJhdGVUeXBlKHN0LCBtYXRjaGVzKTsKICAgICAgbGV0IHJlaWZpZWRTeW1ib2w7CiAgICAgIGlmIChpc01lbWJlcihzeW1ib2wpKSB7CiAgICAgICAgcmVpZmllZFN5bWJvbCA9IHsKICAgICAgICAgIHN5bWJvbElkOiBzeW1ib2wuc3ltYm9sSWQsCiAgICAgICAgICBzeW1ib2xUeXBlOiAoKSA9PiBzdDEsCiAgICAgICAgICBzeW1ib2xTY29wZTogc3ltYm9sLnN5bWJvbFNjb3BlLAogICAgICAgICAgaXNNZW1iZXI6IHN5bWJvbC5pc01lbWJlciwKICAgICAgICAgIHByaXZhdGU6IHN5bWJvbC5wcml2YXRlLAogICAgICAgICAgaXNBYnN0cmFjdDogc3ltYm9sLmlzQWJzdHJhY3QsCiAgICAgICAgICBnZXRDbGFzczogc3ltYm9sLmdldENsYXNzCiAgICAgICAgfTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZWlmaWVkU3ltYm9sID0gewogICAgICAgICAgc3ltYm9sSWQ6IHN5bWJvbC5zeW1ib2xJZCwKICAgICAgICAgIHN5bWJvbFR5cGU6ICgpID0+IHN0MSwKICAgICAgICAgIHN5bWJvbFNjb3BlOiBzeW1ib2wuc3ltYm9sU2NvcGUKICAgICAgICB9OwogICAgICB9CiAgICAgIHJldHVybiByZWlmaWVkU3ltYm9sOwogICAgfQogICAgcmV0dXJuIHN5bWJvbDsKICB9CiAgZ2V0UGFyZW50U2NvcGUoKSB7CiAgICByZXR1cm4gdGhpcy5zY29wZTsKICB9CiAgc3ltYm9sTWF0Y2hlcyhpZCwgYWxsLCBfaW5pdGlhbFNjb3BlKSB7CiAgICBsZXQgb3RoZXJNYXRjaGVzID0gdGhpcy5nZXRQYXJlbnRTY29wZSgpLnN5bWJvbE1hdGNoZXMoaWQsIGFsbCwgdGhpcyk7CiAgICBmb3IgKGNvbnN0IGluaGVyaXRlZCBvZiB0aGlzLmluaGVyaXRUeXBlcykgewogICAgICBpZiAoaW5oZXJpdGVkIGluc3RhbmNlb2YgQ2xhc3NUeXBlKSB7CiAgICAgICAgY29uc3QgbSA9IGluaGVyaXRlZC5zeW1ib2xNYXRjaGVzKGlkLCBhbGwpOwogICAgICAgIG90aGVyTWF0Y2hlcyA9IG90aGVyTWF0Y2hlcy5jb25jYXQobSk7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IHN5bWJvbHMgPSB0aGlzLmdldENoaWxkcmVuKCkuZmlsdGVyKChmKSA9PiBpc1N5bWJvbChmKSk7CiAgICBjb25zdCBtYXRjaGVzID0gc3ltYm9sTWF0Y2hlcyhpZCwgYWxsLCBzeW1ib2xzKTsKICAgIHJldHVybiBtYXRjaGVzLmNvbmNhdChvdGhlck1hdGNoZXMpOwogIH0KfTsKCi8vIHNyYy9jb21waWxlci9lbGFuLXR5cGUtYW5ub3RhdGlvbnMudHMKdmFyIG5hbWVUb1R5cGVNYXAgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpOwp2YXIgU3RkTGliQ2xhc3NDYWNoZSA9IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7CmZ1bmN0aW9uIHN0ZGxpYkNsYXNzVW5pcXVlSWQobmFtZSwgb2ZUeXBlcykgewogIGNvbnN0IGZ1bGxOYW1lID0gW25hbWVdOwogIGZvciAoY29uc3Qgc3Qgb2Ygb2ZUeXBlcyA/PyBbXSkgewogICAgZnVsbE5hbWUucHVzaChzdC5uYW1lKTsKICB9CiAgcmV0dXJuIGZ1bGxOYW1lLmpvaW4oIl8iKTsKfQp2YXIgRWxhblByb2NlZHVyZURlc2NyaXB0b3IgPSBjbGFzcyB7CiAgY29uc3RydWN0b3IoaXNFeHRlbnNpb24gPSBmYWxzZSwgaXNBc3luYyA9IGZhbHNlKSB7CiAgICB0aGlzLmlzRXh0ZW5zaW9uID0gaXNFeHRlbnNpb247CiAgICB0aGlzLmlzQXN5bmMgPSBpc0FzeW5jOwogIH0KICBpc1Byb2NlZHVyZSA9IHRydWU7CiAgaXNQdXJlID0gZmFsc2U7CiAgcGFyYW1ldGVyVHlwZXMgPSBbXTsKICBwYXJhbWV0ZXJOYW1lcyA9IFtdOwogIGRlcHJlY2F0ZWQ7CiAgbWFwVHlwZShzY29wZSkgewogICAgY29uc3QgcGFyYW1ldGVyVHlwZXMgPSB0aGlzLnBhcmFtZXRlclR5cGVzOwogICAgcmV0dXJuIG5ldyBQcm9jZWR1cmVUeXBlKAogICAgICB0aGlzLnBhcmFtZXRlck5hbWVzLAogICAgICBwYXJhbWV0ZXJUeXBlcy5tYXAoKHQpID0+IHQubWFwVHlwZShzY29wZSkpLAogICAgICB0aGlzLmlzRXh0ZW5zaW9uLAogICAgICB0aGlzLmlzQXN5bmMsCiAgICAgIHRoaXMuZGVwcmVjYXRlZAogICAgKTsKICB9Cn07CnZhciBFbGFuQ2xhc3NEZXNjcmlwdG9yID0gY2xhc3MgewogIGNvbnN0cnVjdG9yKHR5cGVPcHRpb25zID0gbm9UeXBlT3B0aW9ucywgb2ZUeXBlcyA9IFtdLCBwYXJhbWV0ZXJOYW1lcyA9IFtdLCBwYXJhbWV0ZXJUeXBlcyA9IFtdLCBpbmhlcml0cyA9IFtdLCBhbGlhcykgewogICAgdGhpcy50eXBlT3B0aW9ucyA9IHR5cGVPcHRpb25zOwogICAgdGhpcy5vZlR5cGVzID0gb2ZUeXBlczsKICAgIHRoaXMucGFyYW1ldGVyTmFtZXMgPSBwYXJhbWV0ZXJOYW1lczsKICAgIHRoaXMucGFyYW1ldGVyVHlwZXMgPSBwYXJhbWV0ZXJUeXBlczsKICAgIHRoaXMuaW5oZXJpdHMgPSBpbmhlcml0czsKICAgIHRoaXMuYWxpYXMgPSBhbGlhczsKICB9CiAgZGVwcmVjYXRlZDsKICBtYXBUeXBlKHNjb3BlKSB7CiAgICBjb25zdCBwYXJhbWV0ZXJUeXBlcyA9IHRoaXMucGFyYW1ldGVyVHlwZXM7CiAgICByZXR1cm4gbmV3IFByb2NlZHVyZVR5cGUoCiAgICAgIHRoaXMucGFyYW1ldGVyTmFtZXMsCiAgICAgIHBhcmFtZXRlclR5cGVzLm1hcCgodCkgPT4gdC5tYXBUeXBlKHNjb3BlKSksCiAgICAgIGZhbHNlLAogICAgICBmYWxzZQogICAgKTsKICB9Cn07CnZhciBFbGFuRnVuY3Rpb25EZXNjcmlwdG9yID0gY2xhc3MgewogIGNvbnN0cnVjdG9yKGlzRXh0ZW5zaW9uID0gZmFsc2UsIGlzUHVyZSA9IHRydWUsIGlzQXN5bmMgPSBmYWxzZSwgcmV0dXJuVHlwZSkgewogICAgdGhpcy5pc0V4dGVuc2lvbiA9IGlzRXh0ZW5zaW9uOwogICAgdGhpcy5pc1B1cmUgPSBpc1B1cmU7CiAgICB0aGlzLmlzQXN5bmMgPSBpc0FzeW5jOwogICAgdGhpcy5yZXR1cm5UeXBlID0gcmV0dXJuVHlwZTsKICB9CiAgaXNGdW5jdGlvbiA9IHRydWU7CiAgcGFyYW1ldGVyVHlwZXMgPSBbXTsKICBwYXJhbWV0ZXJOYW1lcyA9IFtdOwogIGRlcHJlY2F0ZWQ7CiAgbWFwVHlwZShzY29wZSkgewogICAgY29uc3QgcmV0VHlwZSA9IHRoaXMucmV0dXJuVHlwZTsKICAgIGNvbnN0IHBhcmFtZXRlclR5cGVzID0gdGhpcy5wYXJhbWV0ZXJUeXBlczsKICAgIHJldHVybiBuZXcgRnVuY3Rpb25UeXBlKAogICAgICB0aGlzLnBhcmFtZXRlck5hbWVzLAogICAgICBwYXJhbWV0ZXJUeXBlcy5tYXAoKHQpID0+IHQubWFwVHlwZShzY29wZSkpLAogICAgICByZXRUeXBlLm1hcFR5cGUoc2NvcGUpLAogICAgICB0aGlzLmlzRXh0ZW5zaW9uLAogICAgICB0aGlzLmlzUHVyZSwKICAgICAgdGhpcy5pc0FzeW5jLAogICAgICB0aGlzLmRlcHJlY2F0ZWQKICAgICk7CiAgfQp9Owp2YXIgRWxhblNpZ25hdHVyZURlc2NyaXB0b3IgPSBjbGFzcyB7CiAgaXNQdXJlID0gZmFsc2U7CiAgaXNFeHRlbnNpb24gPSBmYWxzZTsKICBpc0FzeW5jID0gZmFsc2U7CiAgcGFyYW1ldGVyTmFtZXMgPSBbXTsKICBwYXJhbWV0ZXJUeXBlcyA9IFtdOwogIHJldHVyblR5cGU7Cn07CnZhciBFbGFuVmFsdWVUeXBlRGVzY3JpcHRvciA9IGNsYXNzIHsKICBjb25zdHJ1Y3RvcihuYW1lLCBvZlR5cGUsIHZhbHVlVHlwZSkgewogICAgdGhpcy5uYW1lID0gbmFtZTsKICAgIHRoaXMub2ZUeXBlID0gb2ZUeXBlOwogICAgdGhpcy52YWx1ZVR5cGUgPSB2YWx1ZVR5cGU7CiAgfQogIGlzQ29uc3RhbnQgPSB0cnVlOwogIG1hcFR5cGUoX3Njb3BlKSB7CiAgICBzd2l0Y2ggKHRoaXMubmFtZSkgewogICAgICBjYXNlIEZsb2F0TmFtZToKICAgICAgICByZXR1cm4gRmxvYXRUeXBlLkluc3RhbmNlOwogICAgICBjYXNlIFN0cmluZ05hbWU6CiAgICAgICAgcmV0dXJuIFN0cmluZ1R5cGUuSW5zdGFuY2U7CiAgICAgIGNhc2UgSW50TmFtZToKICAgICAgICByZXR1cm4gSW50VHlwZS5JbnN0YW5jZTsKICAgICAgY2FzZSBCb29sZWFuTmFtZToKICAgICAgICByZXR1cm4gQm9vbGVhblR5cGUuSW5zdGFuY2U7CiAgICAgIGNhc2UgUmVnRXhwTmFtZToKICAgICAgICByZXR1cm4gUmVnRXhwVHlwZS5JbnN0YW5jZTsKICAgIH0KICAgIHRocm93IG5ldyBFcnJvcigiTm90SW1wbGVtZW50ZWQ6ICIgKyB0aGlzLm5hbWUpOwogIH0KfTsKdmFyIEVsYW5HZW5lcmljVHlwZURlc2NyaXB0b3IgPSBjbGFzcyB7CiAgY29uc3RydWN0b3IobmFtZSwgY29uc3RyYWludCkgewogICAgdGhpcy5uYW1lID0gbmFtZTsKICAgIHRoaXMuY29uc3RyYWludCA9IGNvbnN0cmFpbnQ7CiAgfQogIGlzQ29uc3RhbnQgPSB0cnVlOwogIG1hcFR5cGUoc2NvcGUpIHsKICAgIHJldHVybiBuZXcgR2VuZXJpY1BhcmFtZXRlclR5cGUodGhpcy5uYW1lLCB0aGlzLmNvbnN0cmFpbnQ/Lm1hcFR5cGUoc2NvcGUpKTsKICB9Cn07CnZhciBFbGFuRnVuY1R5cGVEZXNjcmlwdG9yID0gY2xhc3MgewogIGNvbnN0cnVjdG9yKHBhcmFtZXRlcnMsIHJldHVyblR5cGUpIHsKICAgIHRoaXMucGFyYW1ldGVycyA9IHBhcmFtZXRlcnM7CiAgICB0aGlzLnJldHVyblR5cGUgPSByZXR1cm5UeXBlOwogIH0KICBpc0NvbnN0YW50ID0gdHJ1ZTsKICBuYW1lID0gRnVuY05hbWU7CiAgbWFwVHlwZShzY29wZSkgewogICAgcmV0dXJuIG5ldyBGdW5jdGlvblR5cGUoCiAgICAgIHRoaXMucGFyYW1ldGVycy5tYXAoKHQpID0+IHQubmFtZSksCiAgICAgIHRoaXMucGFyYW1ldGVycy5tYXAoKHApID0+IHAubWFwVHlwZShzY29wZSkpLAogICAgICB0aGlzLnJldHVyblR5cGUubWFwVHlwZShzY29wZSksCiAgICAgIGZhbHNlLAogICAgICB0cnVlLAogICAgICBmYWxzZSwKICAgICAgdm9pZCAwCiAgICApOwogIH0KfTsKdmFyIEVsYW5UdXBsZVR5cGVEZXNjcmlwdG9yID0gY2xhc3MgewogIGNvbnN0cnVjdG9yKHBhcmFtZXRlcnMpIHsKICAgIHRoaXMucGFyYW1ldGVycyA9IHBhcmFtZXRlcnM7CiAgfQogIG5hbWUgPSBUdXBsZU5hbWU7CiAgaXNDb25zdGFudCA9IHRydWU7CiAgbWFwVHlwZShzY29wZSkgewogICAgcmV0dXJuIG5ldyBUdXBsZVR5cGUodGhpcy5wYXJhbWV0ZXJzLm1hcCgocCkgPT4gcC5tYXBUeXBlKHNjb3BlKSkpOwogIH0KfTsKdmFyIHRlbXBNYXAgPSAvKiBAX19QVVJFX18gKi8gbmV3IE1hcCgpOwpmdW5jdGlvbiByZW1vdmVVbmRlcnNjb3JlKG5hbWUpIHsKICByZXR1cm4gbmFtZS5zdGFydHNXaXRoKCJfIikgPyBuYW1lLnNsaWNlKDEpIDogbmFtZTsKfQp2YXIgRWxhbkNsYXNzVHlwZURlc2NyaXB0b3IgPSBjbGFzcyB7CiAgY29uc3RydWN0b3IoY2xzLCBvZlR5cGVzKSB7CiAgICB0aGlzLmNscyA9IGNsczsKICAgIHRoaXMub2ZUeXBlcyA9IG9mVHlwZXM7CiAgfQogIGlzQ2xhc3MgPSB0cnVlOwogIG5hbWUgPSBDbGFzc05hbWU7CiAgZGVwcmVjYXRlZDsKICBjbGFzc0lkKGNsYXNzTmFtZSwgY2xhc3NNZXRhZGF0YSkgewogICAgY29uc3Qgb2ZUeXBlTmFtZXMgPSAodGhpcy5vZlR5cGVzID8/IGNsYXNzTWV0YWRhdGEub2ZUeXBlcykubWFwKCh0ZCkgPT4gdGQubmFtZSkuam9pbigiXyIpOwogICAgcmV0dXJuIGAke2NsYXNzTmFtZX1fJHtvZlR5cGVOYW1lc31gOwogIH0KICBnZXROZXdDbGFzc1R5cGVEZWYoY2xhc3NNZXRhZGF0YSwgY2xhc3NOYW1lLCBzY29wZSkgewogICAgY29uc3QgbmFtZXMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyh0aGlzLmNscy5wcm90b3R5cGUpLmNvbmNhdCgKICAgICAgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXModGhpcy5jbHMuZW1wdHlJbnN0YW5jZSgpKQogICAgKTsKICAgIGNvbnN0IGNoaWxkcmVuID0gW107CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5hbWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgIGNvbnN0IG5hbWUgPSBuYW1lc1tpXTsKICAgICAgY29uc3QgbWV0YWRhdGEgPSBSZWZsZWN0LmdldE1ldGFkYXRhKGVsYW5NZXRhZGF0YUtleSwgdGhpcy5jbHMucHJvdG90eXBlLCBuYW1lKTsKICAgICAgaWYgKG5hbWUgPT09ICJjb25zdHJ1Y3RvciIpIHsKICAgICAgICBjaGlsZHJlbi5wdXNoKFsKICAgICAgICAgIGBfXyR7Y29uc3RydWN0b3JLZXl3b3JkfWAsCiAgICAgICAgICBjbGFzc01ldGFkYXRhLm1hcFR5cGUoc2NvcGUpLAogICAgICAgICAgMiAvKiBwcm9jZWR1cmUgKi8KICAgICAgICBdKTsKICAgICAgfQogICAgICBpZiAoaXNGdW5jdGlvbkRlc2NyaXB0b3IobWV0YWRhdGEpKSB7CiAgICAgICAgY2hpbGRyZW4ucHVzaChbbmFtZSwgbWV0YWRhdGEubWFwVHlwZShzY29wZSksIDEgLyogZnVuY3Rpb24gKi9dKTsKICAgICAgfQogICAgICBpZiAoaXNQcm9jZWR1cmVEZXNjcmlwdG9yKG1ldGFkYXRhKSkgewogICAgICAgIGNoaWxkcmVuLnB1c2goW25hbWUsIG1ldGFkYXRhLm1hcFR5cGUoc2NvcGUpLCAyIC8qIHByb2NlZHVyZSAqL10pOwogICAgICB9CiAgICAgIGlmIChpc0NvbnN0YW50RGVzY3JpcHRvcihtZXRhZGF0YSkpIHsKICAgICAgICBjaGlsZHJlbi5wdXNoKFtuYW1lLCBtZXRhZGF0YS5tYXBUeXBlKHNjb3BlKSwgMCAvKiBwcm9wZXJ0eSAqL10pOwogICAgICB9CiAgICB9CiAgICBjb25zdCBjbGFzc1R5cGVEZWYgPSBuZXcgU3RkTGliQ2xhc3MoCiAgICAgIGNsYXNzTmFtZSwKICAgICAgY2xhc3NNZXRhZGF0YS50eXBlT3B0aW9ucy5pc0Fic3RyYWN0LAogICAgICBjbGFzc01ldGFkYXRhLnR5cGVPcHRpb25zLAogICAgICBbXSwKICAgICAgW10sCiAgICAgIFtdLAogICAgICBzY29wZSwKICAgICAgdGhpcy5kZXByZWNhdGVkCiAgICApOwogICAgZm9yIChjb25zdCBjIG9mIGNoaWxkcmVuKSB7CiAgICAgIGNsYXNzVHlwZURlZi5jaGlsZHJlbi5wdXNoKGdldFN5bWJvbChjWzBdLCBjWzFdLCA2IC8qIG1lbWJlciAqLywgY1syXSwgY2xhc3NUeXBlRGVmKSk7CiAgICB9CiAgICBjb25zdCBhY3R1YWxPZlR5cGVzID0gdGhpcy5vZlR5cGVzID8/IGNsYXNzTWV0YWRhdGEub2ZUeXBlczsKICAgIGZvciAoY29uc3Qgb3Qgb2YgYWN0dWFsT2ZUeXBlcykgewogICAgICBjbGFzc1R5cGVEZWYub2ZUeXBlcy5wdXNoKG90Lm1hcFR5cGUoc2NvcGUpKTsKICAgIH0KICAgIGZvciAoY29uc3QgaW5oZXJpdHMgb2YgY2xhc3NNZXRhZGF0YS5pbmhlcml0cykgewogICAgICBjbGFzc1R5cGVEZWYuaW5oZXJpdFR5cGVzLnB1c2goaW5oZXJpdHMubWFwVHlwZShzY29wZSkpOwogICAgfQogICAgU3RkTGliQ2xhc3NDYWNoZS5zZXQoc3RkbGliQ2xhc3NVbmlxdWVJZChjbGFzc05hbWUsIHRoaXMub2ZUeXBlcyksIGNsYXNzVHlwZURlZik7CiAgICByZXR1cm4gY2xhc3NUeXBlRGVmOwogIH0KICBtYXBUeXBlKHNjb3BlKSB7CiAgICBjb25zdCBjbGFzc01ldGFkYXRhID0gUmVmbGVjdC5nZXRNZXRhZGF0YShlbGFuTWV0YWRhdGFLZXksIHRoaXMuY2xzKSA/PyBuZXcgRWxhbkNsYXNzRGVzY3JpcHRvcigpOwogICAgY29uc3QgY2xhc3NOYW1lID0gY2xhc3NNZXRhZGF0YS5hbGlhcyA/PyByZW1vdmVVbmRlcnNjb3JlKHRoaXMuY2xzLm5hbWUpOwogICAgY29uc3QgY2xhc3NJZCA9IHRoaXMuY2xhc3NJZChjbGFzc05hbWUsIGNsYXNzTWV0YWRhdGEpOwogICAgaWYgKHRlbXBNYXAuaGFzKGNsYXNzSWQpKSB7CiAgICAgIHJldHVybiB0ZW1wTWFwLmdldChjbGFzc0lkKTsKICAgIH0KICAgIHRlbXBNYXAuc2V0KAogICAgICBjbGFzc0lkLAogICAgICBuZXcgQ2xhc3NUeXBlKGNsYXNzTmFtZSwgMCAvKiBjb25jcmV0ZSAqLywgZmFsc2UsIG5vVHlwZU9wdGlvbnMsIFtdLCB2b2lkIDApCiAgICApOwogICAgY29uc3QgY2xhc3NUeXBlRGVmID0gU3RkTGliQ2xhc3NDYWNoZS5nZXQoc3RkbGliQ2xhc3NVbmlxdWVJZChjbGFzc05hbWUsIHRoaXMub2ZUeXBlcykpID8/IHRoaXMuZ2V0TmV3Q2xhc3NUeXBlRGVmKGNsYXNzTWV0YWRhdGEsIGNsYXNzTmFtZSwgc2NvcGUpOwogICAgY29uc3QgY2xhc3NUeXBlID0gdGVtcE1hcC5nZXQoY2xhc3NJZCk7CiAgICB0ZW1wTWFwLmRlbGV0ZShjbGFzc0lkKTsKICAgIHJldHVybiBjbGFzc1R5cGUudXBkYXRlRnJvbShjbGFzc1R5cGVEZWYuc3ltYm9sVHlwZSgpKTsKICB9Cn07CnZhciBFbGFuQ2xhc3NOYW1lVHlwZURlc2NyaXB0b3IgPSBjbGFzcyB7CiAgY29uc3RydWN0b3IoY2xhc3NOYW1lLCBvZlR5cGVzKSB7CiAgICB0aGlzLmNsYXNzTmFtZSA9IGNsYXNzTmFtZTsKICAgIHRoaXMub2ZUeXBlcyA9IG9mVHlwZXM7CiAgfQogIGlzQ2xhc3MgPSB0cnVlOwogIG5hbWUgPSBDbGFzc05hbWU7CiAgbWFwVHlwZShzY29wZSkgewogICAgY29uc3QgY2xzID0gbmFtZVRvVHlwZU1hcC5nZXQodGhpcy5jbGFzc05hbWUpOwogICAgaWYgKGNscykgewogICAgICBjb25zdCB0ZCA9IG5ldyBFbGFuQ2xhc3NUeXBlRGVzY3JpcHRvcihjbHMsIHRoaXMub2ZUeXBlcyk7CiAgICAgIHJldHVybiB0ZC5tYXBUeXBlKHNjb3BlKTsKICAgIH0KICAgIHJldHVybiBVbmtub3duVHlwZS5JbnN0YW5jZTsKICB9Cn07CnZhciBUeXBlc2NyaXB0VHlwZURlc2NyaXB0b3IgPSBjbGFzcyB7CiAgY29uc3RydWN0b3IobmFtZSkgewogICAgdGhpcy5uYW1lID0gbmFtZTsKICB9CiAgaXNDb25zdGFudCA9IHRydWU7CiAgbWFwVHlwZShfc2NvcGUpIHsKICAgIHN3aXRjaCAodGhpcy5uYW1lKSB7CiAgICAgIGNhc2UgIk51bWJlciI6CiAgICAgICAgcmV0dXJuIEZsb2F0VHlwZS5JbnN0YW5jZTsKICAgICAgY2FzZSAiU3RyaW5nIjoKICAgICAgICByZXR1cm4gU3RyaW5nVHlwZS5JbnN0YW5jZTsKICAgICAgY2FzZSAiQm9vbGVhbiI6CiAgICAgICAgcmV0dXJuIEJvb2xlYW5UeXBlLkluc3RhbmNlOwogICAgICBjYXNlICJSZWdFeHAiOgogICAgICAgIHJldHVybiBSZWdFeHBUeXBlLkluc3RhbmNlOwogICAgICBjYXNlICJGdW5jdGlvbiI6CiAgICAgICAgdGhyb3cgbmV3IEVsYW5Db21waWxlckVycm9yKCJUeXBlc2NyaXB0ICdGdW5jdGlvbicgbXVzdCBiZSBtYXBwZWQgaW50byBFbGFuIHR5cGVzIik7CiAgICAgIGNhc2UgIkFycmF5IjoKICAgICAgICB0aHJvdyBuZXcgRWxhbkNvbXBpbGVyRXJyb3IoIlR5cGVzY3JpcHQgJ0FycmF5JyBtdXN0IGJlIG1hcHBlZCBpbnRvIEVsYW4gdHlwZXMiKTsKICAgIH0KICAgIHRocm93IG5ldyBFbGFuQ29tcGlsZXJFcnJvcigiTWlzc2luZyB0eXBlIGFubm90YXRpb24gaW4gc3RkbGliIGNsYXNzIik7CiAgfQp9OwpmdW5jdGlvbiBtYXBUeXBlc2NyaXB0VHlwZSh0KSB7CiAgcmV0dXJuIG5ldyBUeXBlc2NyaXB0VHlwZURlc2NyaXB0b3IodC5uYW1lKTsKfQpmdW5jdGlvbiBlbGFuRnVuY3Rpb24ocGFyYW1ldGVyTmFtZXMsIG9wdGlvbnMsIHJldFR5cGUpIHsKICBjb25zdCBmbGFncyA9IG1hcEZ1bmN0aW9uT3B0aW9ucyhvcHRpb25zID8/IDAgLyogcHVyZSAqLywgcmV0VHlwZSk7CiAgcmV0dXJuIGVsYW5NZXRob2QocGFyYW1ldGVyTmFtZXMsIG5ldyBFbGFuRnVuY3Rpb25EZXNjcmlwdG9yKC4uLmZsYWdzKSk7Cn0KZnVuY3Rpb24gZWxhblByb2NlZHVyZShwYXJhbWV0ZXJOYW1lcywgb3B0aW9ucykgewogIGNvbnN0IGZsYWdzID0gbWFwUHJvY2VkdXJlT3B0aW9ucyhvcHRpb25zID8/IDAgLyogZGVmYXVsdCAqLyk7CiAgcmV0dXJuIGVsYW5NZXRob2QocGFyYW1ldGVyTmFtZXMsIG5ldyBFbGFuUHJvY2VkdXJlRGVzY3JpcHRvciguLi5mbGFncykpOwp9CmZ1bmN0aW9uIGVsYW5NZXRob2QocGFyYW1ldGVyTmFtZXMsIGVsYW5EZXNjKSB7CiAgcmV0dXJuIGZ1bmN0aW9uKHRhcmdldCwgcHJvcGVydHlLZXksIF9kZXNjcmlwdG9yKSB7CiAgICBjb25zdCBwYXJhbVR5cGVzTWV0YWRhdGEgPSBSZWZsZWN0LmdldE1ldGFkYXRhKCJkZXNpZ246cGFyYW10eXBlcyIsIHRhcmdldCwgcHJvcGVydHlLZXkpOwogICAgY29uc3QgcmV0VHlwZU1ldGFkYXRhID0gUmVmbGVjdC5nZXRNZXRhZGF0YSgiZGVzaWduOnJldHVybnR5cGUiLCB0YXJnZXQsIHByb3BlcnR5S2V5KTsKICAgIGlmIChBcnJheS5pc0FycmF5KHBhcmFtVHlwZXNNZXRhZGF0YSkpIHsKICAgICAgZWxhbkRlc2MucGFyYW1ldGVyVHlwZXMgPSBwYXJhbVR5cGVzTWV0YWRhdGEubWFwKCh0KSA9PiBtYXBUeXBlc2NyaXB0VHlwZSh0KSk7CiAgICB9CiAgICBpZiAoaXNGdW5jdGlvbkRlc2NyaXB0b3IoZWxhbkRlc2MpICYmICFlbGFuRGVzYy5yZXR1cm5UeXBlICYmIHJldFR5cGVNZXRhZGF0YSAmJiByZXRUeXBlTWV0YWRhdGEubmFtZSkgewogICAgICBlbGFuRGVzYy5yZXR1cm5UeXBlID0gbmV3IFR5cGVzY3JpcHRUeXBlRGVzY3JpcHRvcihyZXRUeXBlTWV0YWRhdGEubmFtZSk7CiAgICB9CiAgICBjb25zdCBtZXRhRGF0YSA9IFJlZmxlY3QuZ2V0T3duTWV0YWRhdGEoZWxhbk1ldGFkYXRhS2V5LCB0YXJnZXQsIHByb3BlcnR5S2V5KSA/PyBuZXcgRWxhblNpZ25hdHVyZURlc2NyaXB0b3IoKTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZWxhbkRlc2MucGFyYW1ldGVyVHlwZXMubGVuZ3RoOyBpKyspIHsKICAgICAgY29uc3QgdXBkYXRlZFBhcmFtID0gbWV0YURhdGEucGFyYW1ldGVyVHlwZXNbaV07CiAgICAgIGlmICh1cGRhdGVkUGFyYW0pIHsKICAgICAgICBlbGFuRGVzYy5wYXJhbWV0ZXJUeXBlc1tpXSA9IHVwZGF0ZWRQYXJhbTsKICAgICAgfQogICAgfQogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBlbGFuRGVzYy5wYXJhbWV0ZXJUeXBlcy5sZW5ndGg7IGkrKykgewogICAgICBpZiAoaSA8IHBhcmFtZXRlck5hbWVzLmxlbmd0aCkgewogICAgICAgIGVsYW5EZXNjLnBhcmFtZXRlck5hbWVzW2ldID0gcGFyYW1ldGVyTmFtZXNbaV07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZWxhbkRlc2MucGFyYW1ldGVyTmFtZXNbaV0gPSBgcGFyYW1ldGVyJHtpfWA7CiAgICAgIH0KICAgIH0KICAgIFJlZmxlY3QuZGVmaW5lTWV0YWRhdGEoZWxhbk1ldGFkYXRhS2V5LCBlbGFuRGVzYywgdGFyZ2V0LCBwcm9wZXJ0eUtleSk7CiAgfTsKfQpmdW5jdGlvbiBlbGFuQ2xhc3Mob3B0aW9uLCBvZlR5cGVzLCBuYW1lcywgcGFyYW1zLCBpbmhlcml0cywgYWxpYXMpIHsKICBjb25zdCB0eXBlT3B0aW9ucyA9IG1hcENsYXNzT3B0aW9uKG9wdGlvbiA/PyAwIC8qIGNvbmNyZXRlICovKTsKICBjb25zdCBjbGFzc0Rlc2MgPSBuZXcgRWxhbkNsYXNzRGVzY3JpcHRvcigKICAgIHR5cGVPcHRpb25zLAogICAgb2ZUeXBlcyA/PyBbXSwKICAgIG5hbWVzID8/IFtdLAogICAgcGFyYW1zID8/IFtdLAogICAgaW5oZXJpdHMgPz8gW10sCiAgICBhbGlhcwogICk7CiAgcmV0dXJuIGZ1bmN0aW9uKHRhcmdldCkgewogICAgUmVmbGVjdC5kZWZpbmVNZXRhZGF0YShlbGFuTWV0YWRhdGFLZXksIGNsYXNzRGVzYywgdGFyZ2V0KTsKICB9Owp9CmZ1bmN0aW9uIGVsYW5Db25zdGFudChlbGFuRGVzYykgewogIHJldHVybiBmdW5jdGlvbih0YXJnZXQsIHByb3BlcnR5S2V5KSB7CiAgICBjb25zdCB0eXBlTWV0YWRhdGEgPSBSZWZsZWN0LmdldE1ldGFkYXRhKCJkZXNpZ246dHlwZSIsIHRhcmdldCwgcHJvcGVydHlLZXkpOwogICAgaWYgKCFlbGFuRGVzYyAmJiB0eXBlTWV0YWRhdGEgJiYgdHlwZU1ldGFkYXRhLm5hbWUpIHsKICAgICAgZWxhbkRlc2MgPSBuZXcgVHlwZXNjcmlwdFR5cGVEZXNjcmlwdG9yKHR5cGVNZXRhZGF0YS5uYW1lKTsKICAgIH0KICAgIFJlZmxlY3QuZGVmaW5lTWV0YWRhdGEoZWxhbk1ldGFkYXRhS2V5LCBlbGFuRGVzYywgdGFyZ2V0LCBwcm9wZXJ0eUtleSk7CiAgfTsKfQpmdW5jdGlvbiBlbGFuUHJvcGVydHkoZWxhbkRlc2MpIHsKICByZXR1cm4gZnVuY3Rpb24odGFyZ2V0LCBwcm9wZXJ0eUtleSkgewogICAgY29uc3QgdHlwZU1ldGFkYXRhID0gUmVmbGVjdC5nZXRNZXRhZGF0YSgiZGVzaWduOnR5cGUiLCB0YXJnZXQsIHByb3BlcnR5S2V5KTsKICAgIGlmICghZWxhbkRlc2MgJiYgdHlwZU1ldGFkYXRhICYmIHR5cGVNZXRhZGF0YS5uYW1lKSB7CiAgICAgIGVsYW5EZXNjID0gbmV3IFR5cGVzY3JpcHRUeXBlRGVzY3JpcHRvcih0eXBlTWV0YWRhdGEubmFtZSk7CiAgICB9CiAgICBSZWZsZWN0LmRlZmluZU1ldGFkYXRhKGVsYW5NZXRhZGF0YUtleSwgZWxhbkRlc2MsIHRhcmdldCwgcHJvcGVydHlLZXkpOwogIH07Cn0KZnVuY3Rpb24gZWxhbkNsYXNzRXhwb3J0KGNscykgewogIG5hbWVUb1R5cGVNYXAuc2V0KGNscy5uYW1lLCBjbHMpOwogIGxldCBlbGFuRGVzYyA9IEVsYW5DbGFzcyhjbHMpOwogIHJldHVybiBmdW5jdGlvbih0YXJnZXQsIHByb3BlcnR5S2V5KSB7CiAgICBjb25zdCB0eXBlTWV0YWRhdGEgPSBSZWZsZWN0LmdldE1ldGFkYXRhKCJkZXNpZ246dHlwZSIsIHRhcmdldCwgcHJvcGVydHlLZXkpOwogICAgaWYgKCFlbGFuRGVzYyAmJiB0eXBlTWV0YWRhdGEgJiYgdHlwZU1ldGFkYXRhLm5hbWUpIHsKICAgICAgZWxhbkRlc2MgPSBuZXcgVHlwZXNjcmlwdFR5cGVEZXNjcmlwdG9yKHR5cGVNZXRhZGF0YS5uYW1lKTsKICAgIH0KICAgIFJlZmxlY3QuZGVmaW5lTWV0YWRhdGEoZWxhbk1ldGFkYXRhS2V5LCBlbGFuRGVzYywgdGFyZ2V0LCBwcm9wZXJ0eUtleSk7CiAgfTsKfQpmdW5jdGlvbiBlbGFuVHlwZShlVHlwZSkgewogIHJldHVybiBmdW5jdGlvbih0YXJnZXQsIHByb3BlcnR5S2V5LCBwYXJhbWV0ZXJJbmRleCkgewogICAgY29uc3QgbWV0YURhdGEgPSBSZWZsZWN0LmdldE93bk1ldGFkYXRhKGVsYW5NZXRhZGF0YUtleSwgdGFyZ2V0LCBwcm9wZXJ0eUtleSkgPz8gbmV3IEVsYW5TaWduYXR1cmVEZXNjcmlwdG9yKCk7CiAgICBtZXRhRGF0YS5wYXJhbWV0ZXJUeXBlc1twYXJhbWV0ZXJJbmRleF0gPSBlVHlwZTsKICAgIFJlZmxlY3QuZGVmaW5lTWV0YWRhdGEoZWxhbk1ldGFkYXRhS2V5LCBtZXRhRGF0YSwgdGFyZ2V0LCBwcm9wZXJ0eUtleSk7CiAgfTsKfQpmdW5jdGlvbiBnZXREZXByZWNhdGVkKHJlYXNvbiwgZnJvbU1ham9yLCBmcm9tTWlub3IsIG1lc3NhZ2UpIHsKICByZXR1cm4gewogICAgcmVhc29uLAogICAgZnJvbU1ham9yLAogICAgZnJvbU1pbm9yLAogICAgbWVzc2FnZQogIH07Cn0KZnVuY3Rpb24gZWxhbkRlcHJlY2F0ZWQocmVhc29uLCBmcm9tTWFqb3IsIGZyb21NaW5vciwgbWVzc2FnZSkgewogIHJldHVybiBmdW5jdGlvbih0YXJnZXQsIHByb3BlcnR5S2V5LCBwcm9wZXJ0eURlc2NyaXB0b3IpIHsKICAgIGlmIChwcm9wZXJ0eURlc2NyaXB0b3IpIHsKICAgICAgY29uc3QgbWV0YURhdGEgPSBSZWZsZWN0LmdldE93bk1ldGFkYXRhKGVsYW5NZXRhZGF0YUtleSwgdGFyZ2V0LCBwcm9wZXJ0eUtleSkgPz8gbmV3IEVsYW5TaWduYXR1cmVEZXNjcmlwdG9yKCk7CiAgICAgIG1ldGFEYXRhLmRlcHJlY2F0ZWQgPSBnZXREZXByZWNhdGVkKHJlYXNvbiwgZnJvbU1ham9yLCBmcm9tTWlub3IsIG1lc3NhZ2UpOwogICAgICBSZWZsZWN0LmRlZmluZU1ldGFkYXRhKGVsYW5NZXRhZGF0YUtleSwgbWV0YURhdGEsIHRhcmdldCwgcHJvcGVydHlLZXkpOwogICAgfSBlbHNlIHsKICAgICAgY29uc3QgdHlwZU1ldGFkYXRhID0gUmVmbGVjdC5nZXRNZXRhZGF0YShlbGFuTWV0YWRhdGFLZXksIHRhcmdldCwgcHJvcGVydHlLZXkpOwogICAgICBpZiAodHlwZU1ldGFkYXRhKSB7CiAgICAgICAgdHlwZU1ldGFkYXRhLmRlcHJlY2F0ZWQgPSBnZXREZXByZWNhdGVkKHJlYXNvbiwgZnJvbU1ham9yLCBmcm9tTWlub3IsIG1lc3NhZ2UpOwogICAgICAgIFJlZmxlY3QuZGVmaW5lTWV0YWRhdGEoZWxhbk1ldGFkYXRhS2V5LCB0eXBlTWV0YWRhdGEsIHRhcmdldCwgcHJvcGVydHlLZXkpOwogICAgICB9CiAgICB9CiAgfTsKfQp2YXIgRWxhbkludCA9IG5ldyBFbGFuVmFsdWVUeXBlRGVzY3JpcHRvcihJbnROYW1lKTsKdmFyIEVsYW5GbG9hdCA9IG5ldyBFbGFuVmFsdWVUeXBlRGVzY3JpcHRvcihGbG9hdE5hbWUpOwp2YXIgRWxhblN0cmluZyA9IG5ldyBFbGFuVmFsdWVUeXBlRGVzY3JpcHRvcihTdHJpbmdOYW1lKTsKdmFyIEVsYW5Cb29sZWFuID0gbmV3IEVsYW5WYWx1ZVR5cGVEZXNjcmlwdG9yKEJvb2xlYW5OYW1lKTsKdmFyIEVsYW5SZWdFeHAgPSBuZXcgRWxhblZhbHVlVHlwZURlc2NyaXB0b3IoUmVnRXhwTmFtZSk7CnZhciBFbGFuVDEgPSBuZXcgRWxhbkdlbmVyaWNUeXBlRGVzY3JpcHRvcigiVDEiKTsKdmFyIEVsYW5UMiA9IG5ldyBFbGFuR2VuZXJpY1R5cGVEZXNjcmlwdG9yKCJUMiIpOwpmdW5jdGlvbiBFbGFuVDFDb25zdHJhaW5lZChjb25zdHJhaW50KSB7CiAgcmV0dXJuIG5ldyBFbGFuR2VuZXJpY1R5cGVEZXNjcmlwdG9yKCJUMSIsIGNvbnN0cmFpbnQpOwp9CmZ1bmN0aW9uIEVsYW5UMkNvbnN0cmFpbmVkKGNvbnN0cmFpbnQpIHsKICByZXR1cm4gbmV3IEVsYW5HZW5lcmljVHlwZURlc2NyaXB0b3IoIlQyIiwgY29uc3RyYWludCk7Cn0KZnVuY3Rpb24gRWxhbkNsYXNzKGNscywgb2ZUeXBlcykgewogIHJldHVybiBuZXcgRWxhbkNsYXNzVHlwZURlc2NyaXB0b3IoY2xzLCBvZlR5cGVzKTsKfQpmdW5jdGlvbiBFbGFuQ2xhc3NOYW1lKGNsYXNzTmFtZSwgX29mVHlwZXMpIHsKICByZXR1cm4gbmV3IEVsYW5DbGFzc05hbWVUeXBlRGVzY3JpcHRvcihjbGFzc05hbWUpOwp9CmZ1bmN0aW9uIEVsYW5UdXBsZShvZlR5cGVzKSB7CiAgcmV0dXJuIG5ldyBFbGFuVHVwbGVUeXBlRGVzY3JpcHRvcihvZlR5cGVzKTsKfQpmdW5jdGlvbiBFbGFuRnVuYyhwYXJhbWV0ZXJzLCByZXR1cm5UeXBlKSB7CiAgcmV0dXJuIG5ldyBFbGFuRnVuY1R5cGVEZXNjcmlwdG9yKHBhcmFtZXRlcnMsIHJldHVyblR5cGUpOwp9CmZ1bmN0aW9uIGVsYW5JbnRUeXBlKCkgewogIHJldHVybiBlbGFuVHlwZShFbGFuSW50KTsKfQpmdW5jdGlvbiBlbGFuRmxvYXRUeXBlKCkgewogIHJldHVybiBlbGFuVHlwZShFbGFuRmxvYXQpOwp9CmZ1bmN0aW9uIGVsYW5TdHJpbmdUeXBlKCkgewogIHJldHVybiBlbGFuVHlwZShFbGFuU3RyaW5nKTsKfQpmdW5jdGlvbiBlbGFuR2VuZXJpY1BhcmFtVDFUeXBlKGNvbnN0cmFpbnQpIHsKICByZXR1cm4gZWxhblR5cGUoY29uc3RyYWludCA/IEVsYW5UMUNvbnN0cmFpbmVkKGNvbnN0cmFpbnQpIDogRWxhblQxKTsKfQpmdW5jdGlvbiBlbGFuR2VuZXJpY1BhcmFtVDJUeXBlKGNvbnN0cmFpbnQpIHsKICByZXR1cm4gZWxhblR5cGUoY29uc3RyYWludCA/IEVsYW5UMkNvbnN0cmFpbmVkKGNvbnN0cmFpbnQpIDogRWxhblQyKTsKfQpmdW5jdGlvbiBlbGFuRnVuY1R5cGUocGFyYW1ldGVycywgcmV0dXJuVHlwZSkgewogIHJldHVybiBlbGFuVHlwZShFbGFuRnVuYyhwYXJhbWV0ZXJzLCByZXR1cm5UeXBlKSk7Cn0KZnVuY3Rpb24gZWxhbkNsYXNzVHlwZShjbHMsIG9mVHlwZXMpIHsKICByZXR1cm4gZWxhblR5cGUoRWxhbkNsYXNzKGNscywgb2ZUeXBlcykpOwp9CmZ1bmN0aW9uIG1hcEZ1bmN0aW9uT3B0aW9ucyhvcHRpb25zLCByZXRUeXBlKSB7CiAgc3dpdGNoIChvcHRpb25zKSB7CiAgICBjYXNlIDAgLyogcHVyZSAqLzoKICAgICAgcmV0dXJuIFtmYWxzZSwgdHJ1ZSwgZmFsc2UsIHJldFR5cGVdOwogICAgY2FzZSAxIC8qIHB1cmVFeHRlbnNpb24gKi86CiAgICAgIHJldHVybiBbdHJ1ZSwgdHJ1ZSwgZmFsc2UsIHJldFR5cGVdOwogICAgY2FzZSAyIC8qIHB1cmVBc3luYyAqLzoKICAgICAgcmV0dXJuIFtmYWxzZSwgdHJ1ZSwgdHJ1ZSwgcmV0VHlwZV07CiAgICBjYXNlIDMgLyogcHVyZUFzeW5jRXh0ZW5zaW9uICovOgogICAgICByZXR1cm4gW3RydWUsIHRydWUsIHRydWUsIHJldFR5cGVdOwogICAgY2FzZSA0IC8qIGltcHVyZSAqLzoKICAgICAgcmV0dXJuIFtmYWxzZSwgZmFsc2UsIGZhbHNlLCByZXRUeXBlXTsKICAgIGNhc2UgNSAvKiBpbXB1cmVFeHRlbnNpb24gKi86CiAgICAgIHJldHVybiBbdHJ1ZSwgZmFsc2UsIGZhbHNlLCByZXRUeXBlXTsKICAgIGNhc2UgNiAvKiBpbXB1cmVBc3luYyAqLzoKICAgICAgcmV0dXJuIFtmYWxzZSwgZmFsc2UsIHRydWUsIHJldFR5cGVdOwogICAgY2FzZSA3IC8qIGltcHVyZUFzeW5jRXh0ZW5zaW9uICovOgogICAgICByZXR1cm4gW3RydWUsIGZhbHNlLCB0cnVlLCByZXRUeXBlXTsKICB9Cn0KZnVuY3Rpb24gbWFwUHJvY2VkdXJlT3B0aW9ucyhvcHRpb25zKSB7CiAgc3dpdGNoIChvcHRpb25zKSB7CiAgICBjYXNlIDAgLyogZGVmYXVsdCAqLzoKICAgICAgcmV0dXJuIFtmYWxzZSwgZmFsc2VdOwogICAgY2FzZSAxIC8qIGV4dGVuc2lvbiAqLzoKICAgICAgcmV0dXJuIFt0cnVlLCBmYWxzZV07CiAgICBjYXNlIDIgLyogYXN5bmMgKi86CiAgICAgIHJldHVybiBbZmFsc2UsIHRydWVdOwogICAgY2FzZSAzIC8qIGFzeW5jRXh0ZW5zaW9uICovOgogICAgICByZXR1cm4gW3RydWUsIHRydWVdOwogIH0KfQpmdW5jdGlvbiBtYXBDbGFzc09wdGlvbihvcHRpb25zKSB7CiAgY29uc3Qgb3B0ID0gZ2V0VHlwZU9wdGlvbnMoKTsKICBzd2l0Y2ggKG9wdGlvbnMpIHsKICAgIGNhc2UgMCAvKiBjb25jcmV0ZSAqLzoKICAgICAgcmV0dXJuIG9wdDsKICAgIGNhc2UgMSAvKiBhYnN0cmFjdCAqLzoKICAgICAgb3B0LmlzQWJzdHJhY3QgPSB0cnVlOwogICAgICByZXR1cm4gb3B0OwogICAgY2FzZSAyIC8qIHJlY29yZCAqLzoKICAgICAgb3B0LmlzSW1tdXRhYmxlID0gdHJ1ZTsKICAgICAgcmV0dXJuIG9wdDsKICAgIGNhc2UgMyAvKiBsaXN0ICovOgogICAgICBvcHQuaXNJbmRleGFibGUgPSBvcHQuaXNJdGVyYWJsZSA9IHRydWU7CiAgICAgIHJldHVybiBvcHQ7CiAgICBjYXNlIDQgLyogYXJyYXkgKi86CiAgICAgIG9wdC5pc0luZGV4YWJsZSA9IG9wdC5pc0l0ZXJhYmxlID0gdHJ1ZTsKICAgICAgcmV0dXJuIG9wdDsKICAgIGNhc2UgNSAvKiBhcnJheTJEICovOgogICAgICBvcHQuaXNEb3VibGVJbmRleGFibGUgPSB0cnVlOwogICAgICByZXR1cm4gb3B0OwogICAgY2FzZSA2IC8qIGxpc3RJbW11dGFibGUgKi86CiAgICAgIG9wdC5pc0ltbXV0YWJsZSA9IG9wdC5pc0luZGV4YWJsZSA9IG9wdC5pc0l0ZXJhYmxlID0gdHJ1ZTsKICAgICAgcmV0dXJuIG9wdDsKICAgIGNhc2UgNyAvKiBkaWN0aW9uYXJ5ICovOgogICAgICBvcHQuaXNJbmRleGFibGUgPSB0cnVlOwogICAgICByZXR1cm4gb3B0OwogICAgY2FzZSA4IC8qIGRpY3Rpb25hcnlJbW11dGFibGUgKi86CiAgICAgIG9wdC5pc0ltbXV0YWJsZSA9IG9wdC5pc0luZGV4YWJsZSA9IHRydWU7CiAgICAgIHJldHVybiBvcHQ7CiAgfQp9CmZ1bmN0aW9uIGdldFN5bWJvbChpZCwgc3QsIHNzLCBtdCwgY2xzKSB7CiAgaWYgKHN0IGluc3RhbmNlb2YgQ2xhc3NUeXBlKSB7CiAgICByZXR1cm4gc3Quc2NvcGU7CiAgfQogIGxldCBzeW1ib2w7CiAgaWYgKHNzID09PSA2IC8qIG1lbWJlciAqLykgewogICAgc3ltYm9sID0gewogICAgICBzeW1ib2xJZDogaWQsCiAgICAgIHN5bWJvbFR5cGU6ICgpID0+IHN0LAogICAgICBzeW1ib2xTY29wZTogc3MsCiAgICAgIGlzTWVtYmVyOiB0cnVlLAogICAgICBwcml2YXRlOiBmYWxzZSwKICAgICAgaXNBYnN0cmFjdDogZmFsc2UsCiAgICAgIGdldENsYXNzOiAoKSA9PiBjbHMKICAgIH07CiAgfSBlbHNlIHsKICAgIHN5bWJvbCA9IHsKICAgICAgc3ltYm9sSWQ6IGlkLAogICAgICBzeW1ib2xUeXBlOiAoKSA9PiBzdCwKICAgICAgc3ltYm9sU2NvcGU6IHNzCiAgICB9OwogIH0KICBpZiAobXQgPT09IDAgLyogcHJvcGVydHkgKi8pIHsKICAgIHN5bWJvbFsiaXNQcm9wZXJ0eSJdID0gdHJ1ZTsKICB9CiAgcmV0dXJuIHN5bWJvbDsKfQoKLy8gc3JjL2NvbXBpbGVyL2Fzc2VydC1vdXRjb21lLnRzCnZhciBBc3NlcnRPdXRjb21lID0gY2xhc3MgewogIGNvbnN0cnVjdG9yKHN0YXR1cywgYWN0dWFsLCBleHBlY3RlZCwgaHRtbElkLCBlcnJvcikgewogICAgdGhpcy5zdGF0dXMgPSBzdGF0dXM7CiAgICB0aGlzLmFjdHVhbCA9IGFjdHVhbDsKICAgIHRoaXMuZXhwZWN0ZWQgPSBleHBlY3RlZDsKICAgIHRoaXMuaHRtbElkID0gaHRtbElkOwogICAgdGhpcy5lcnJvciA9IGVycm9yOwogIH0KfTsKCi8vIHNyYy9jb21waWxlci9zdGFuZGFyZC1saWJyYXJ5L2VsYW4tcnVudGltZS1lcnJvci50cwp2YXIgRWxhblJ1bnRpbWVFcnJvciA9IGNsYXNzIGV4dGVuZHMgRXJyb3IgewogIGNvbnN0cnVjdG9yKGVycikgewogICAgc3VwZXIoZXJyIGluc3RhbmNlb2YgRXJyb3IgPyBlcnIubWVzc2FnZSA6IGVycik7CiAgICB0aGlzLmVyciA9IGVycjsKICB9CiAgdXNlTGluZSh0b2tlbikgewogICAgcmV0dXJuICEodG9rZW4uc3RhcnRzV2l0aCgiZGF0YSIpIHx8IHRva2VuLnN0YXJ0c1dpdGgoImh0dHAiKSB8fCB0b2tlbi5zdGFydHNXaXRoKCJhc3luYyIpIHx8IHRva2VuLnN0YXJ0c1dpdGgoIkFycmF5IikgfHwgdG9rZW4uc3RhcnRzV2l0aCgiU3lzdGVtIikgfHwgdG9rZW4uc3RhcnRzV2l0aCgib25tZXNzYWdlIikpOwogIH0KICB1cGRhdGVMaW5lMChsMCkgewogICAgaWYgKGwwLnN0YXJ0c1dpdGgoIlJhbmdlRXJyb3IiKSkgewogICAgICByZXR1cm4gIkVycm9yOiBTdGFjayBPdmVyZmxvdyI7CiAgICB9CiAgICByZXR1cm4gbDA7CiAgfQogIGdldCBlbGFuU3RhY2soKSB7CiAgICBjb25zdCBqc1N0YWNrID0gdGhpcy5lcnIgaW5zdGFuY2VvZiBFcnJvciA/IHRoaXMuZXJyLnN0YWNrIDogdGhpcy5zdGFjazsKICAgIGNvbnN0IGVsYW5TdGFjayA9IFtdOwogICAgaWYgKGpzU3RhY2spIHsKICAgICAgbGV0IGxpbmVzID0ganNTdGFjay5zcGxpdCgiXG4iKS5tYXAoKGwpID0+IGwudHJpbSgpKTsKICAgICAgaWYgKGxpbmVzLmxlbmd0aCA+IDApIHsKICAgICAgICBlbGFuU3RhY2sucHVzaCh0aGlzLnVwZGF0ZUxpbmUwKGxpbmVzWzBdKSk7CiAgICAgICAgbGluZXMgPSBsaW5lcy5zbGljZSgxKTsKICAgICAgICBmb3IgKGNvbnN0IGwgb2YgbGluZXMpIHsKICAgICAgICAgIGNvbnN0IGxpbmUgPSBsLnNwbGl0KCIgIik7CiAgICAgICAgICBpZiAobGluZS5sZW5ndGggPiAxKSB7CiAgICAgICAgICAgIGxldCBmbiA9IGxpbmVbMV07CiAgICAgICAgICAgIGZuID0gZm4gPT09ICJydW5UZXN0cyIgPyAidGVzdCIgOiBmbjsKICAgICAgICAgICAgZm4gPSBmbiA9PT0gIlN5c3RlbS5wcmludExpbmUiID8gInByaW50IiA6IGZuOwogICAgICAgICAgICBpZiAodGhpcy51c2VMaW5lKGZuKSkgewogICAgICAgICAgICAgIGVsYW5TdGFjay5wdXNoKGBhdCAke2ZufWApOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBpZiAoZWxhblN0YWNrLmxlbmd0aCA+IDApIHsKICAgICAgcmV0dXJuIGVsYW5TdGFjay5qb2luKCJcbiIpOwogICAgfQogICAgcmV0dXJuICIiOwogIH0KfTsKCi8vIHNyYy9jb21waWxlci9zdGFuZGFyZC1saWJyYXJ5L2RhdGEtc3RydWN0dXJlLWhlbHBlcnMudHMKZnVuY3Rpb24gY2hlY2tJbmRleChjb250ZW50cywgaW5kZXgpIHsKICBjb25zdCBzaXplID0gY29udGVudHMubGVuZ3RoOwogIGlmIChpbmRleCA+PSBzaXplIHx8IGluZGV4IDwgMCkgewogICAgdGhyb3cgbmV3IEVsYW5SdW50aW1lRXJyb3IoYE91dCBvZiByYW5nZSBpbmRleDogJHtpbmRleH0gc2l6ZTogJHtzaXplfWApOwogIH0KfQpmdW5jdGlvbiB3aXRoQXBwZW5kSGVscGVyKGNvbnRlbnRzLCB2YWx1ZSkgewogIGNvbnN0IG5ld0xpc3QgPSBbLi4uY29udGVudHNdOwogIG5ld0xpc3QucHVzaCh2YWx1ZSk7CiAgcmV0dXJuIG5ld0xpc3Q7Cn0KZnVuY3Rpb24gd2l0aEFwcGVuZExpc3RIZWxwZXIoY29udGVudHMsIGxpc3RCKSB7CiAgY29uc3QgbmV3TGlzdCA9IFsuLi5jb250ZW50c107CiAgbmV3TGlzdC5wdXNoKC4uLmxpc3RCKTsKICByZXR1cm4gbmV3TGlzdDsKfQpmdW5jdGlvbiB3aXRoUHV0SGVscGVyKGNvbnRlbnRzLCBpbmRleCwgdmFsdWUpIHsKICBjaGVja0luZGV4KGNvbnRlbnRzLCBpbmRleCk7CiAgY29uc3QgbmV3TGlzdCA9IFsuLi5jb250ZW50c107CiAgbmV3TGlzdFtpbmRleF0gPSB2YWx1ZTsKICByZXR1cm4gbmV3TGlzdDsKfQpmdW5jdGlvbiB3aXRoSW5zZXJ0SGVscGVyKGNvbnRlbnRzLCBpbmRleCwgdmFsdWUpIHsKICByZXR1cm4gY29udGVudHMudG9TcGxpY2VkKGluZGV4LCAwLCB2YWx1ZSk7Cn0KZnVuY3Rpb24gd2l0aFJlbW92ZUF0SGVscGVyKGNvbnRlbnRzLCBpbmRleCkgewogIGNoZWNrSW5kZXgoY29udGVudHMsIGluZGV4KTsKICByZXR1cm4gY29udGVudHMudG9TcGxpY2VkKGluZGV4LCAxKTsKfQpmdW5jdGlvbiB3aXRoUmVtb3ZlRmlyc3RIZWxwZXIoY29udGVudHMsIHZhbHVlLCBzeXN0ZW0pIHsKICBsZXQgbmV3TGlzdCA9IFsuLi5jb250ZW50c107CiAgY29uc3QgaW5kZXggPSBzeXN0ZW0uZWxhbkluZGV4T2YobmV3TGlzdCwgdmFsdWUpOwogIGlmIChpbmRleCA+IC0xKSB7CiAgICBuZXdMaXN0ID0gbmV3TGlzdC50b1NwbGljZWQoaW5kZXgsIDEpOwogIH0KICByZXR1cm4gbmV3TGlzdDsKfQpmdW5jdGlvbiB3aXRoUmVtb3ZlQWxsSGVscGVyKGNvbnRlbnRzLCB2YWx1ZSwgc3lzdGVtKSB7CiAgbGV0IG5ld0xpc3QgPSBbLi4uY29udGVudHNdOwogIGxldCBpbmRleCA9IHN5c3RlbS5lbGFuSW5kZXhPZihuZXdMaXN0LCB2YWx1ZSk7CiAgd2hpbGUgKGluZGV4ID4gLTEpIHsKICAgIG5ld0xpc3QgPSBuZXdMaXN0LnRvU3BsaWNlZChpbmRleCwgMSk7CiAgICBpbmRleCA9IHN5c3RlbS5lbGFuSW5kZXhPZihuZXdMaXN0LCB2YWx1ZSk7CiAgfQogIHJldHVybiBuZXdMaXN0Owp9CmFzeW5jIGZ1bmN0aW9uIGZpbHRlckhlbHBlcihjb250ZW50cywgcHJlZGljYXRlKSB7CiAgY29uc3QgbGlzdCA9IFsuLi5jb250ZW50c107CiAgY29uc3QgYXN5bmNGaWx0ZXIgPSBhc3luYyAobGlzdDIsIHByZWRpY2F0ZTIpID0+IHsKICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBQcm9taXNlLmFsbChsaXN0Mi5tYXAocHJlZGljYXRlMikpOwogICAgcmV0dXJuIGxpc3QyLmZpbHRlcigoX3YsIGluZGV4KSA9PiByZXN1bHRzW2luZGV4XSk7CiAgfTsKICByZXR1cm4gYXdhaXQgYXN5bmNGaWx0ZXIobGlzdCwgcHJlZGljYXRlKTsKfQphc3luYyBmdW5jdGlvbiBtYXBIZWxwZXIoY29udGVudHMsIHByZWRpY2F0ZSkgewogIGNvbnN0IGxpc3QgPSBbLi4uY29udGVudHNdOwogIHJldHVybiBhd2FpdCBQcm9taXNlLmFsbChsaXN0Lm1hcChwcmVkaWNhdGUpKTsKfQphc3luYyBmdW5jdGlvbiByZWR1Y2VIZWxwZXIoY29udGVudHMsIGluaXRWYWx1ZSwgcHJlZGljYXRlKSB7CiAgY29uc3QgbGlzdCA9IFsuLi5jb250ZW50c107CiAgbGV0IGFjYyA9IGluaXRWYWx1ZTsKICBmb3IgKGNvbnN0IGkgb2YgbGlzdCkgewogICAgYWNjID0gYXdhaXQgcHJlZGljYXRlKGFjYywgaSk7CiAgfQogIHJldHVybiBhY2M7Cn0KYXN5bmMgZnVuY3Rpb24gbWF4QnlIZWxwZXIoY29udGVudHMsIHByZWRpY2F0ZSwgc3lzdGVtKSB7CiAgY29uc3QgbW0gPSBhd2FpdCBtYXBIZWxwZXIoY29udGVudHMsIHByZWRpY2F0ZSk7CiAgY29uc3QgbWF4ID0gTWF0aC5tYXgoLi4ubW0pOwogIGNvbnN0IGkgPSBzeXN0ZW0uZWxhbkluZGV4T2YobW0sIG1heCk7CiAgcmV0dXJuIGNvbnRlbnRzW2ldOwp9CmFzeW5jIGZ1bmN0aW9uIG1pbkJ5SGVscGVyKGNvbnRlbnRzLCBwcmVkaWNhdGUsIHN5c3RlbSkgewogIGNvbnN0IG1tID0gYXdhaXQgbWFwSGVscGVyKGNvbnRlbnRzLCBwcmVkaWNhdGUpOwogIGNvbnN0IG1pbiA9IE1hdGgubWluKC4uLm1tKTsKICBjb25zdCBpID0gc3lzdGVtLmVsYW5JbmRleE9mKG1tLCBtaW4pOwogIHJldHVybiBjb250ZW50c1tpXTsKfQphc3luYyBmdW5jdGlvbiBzb3J0QnlIZWxwZXIoY29udGVudHMsIHByZWRpY2F0ZSwgc3lzdGVtKSB7CiAgY29uc3QgY2xvbmUgPSBbLi4uY29udGVudHNdOwogIHJldHVybiBhd2FpdCBzeXN0ZW0ucXVpY2tTb3J0KGNsb25lLCBwcmVkaWNhdGUpOwp9CgovLyBzcmMvY29tcGlsZXIvc3RhbmRhcmQtbGlicmFyeS9saXN0LnRzCnZhciBMaXN0ID0gY2xhc3MgewogIC8vIHRoaXMgbXVzdCBiZSBpbXBsZW1lbnRlZCBieSBoYW5kIG9uIGFsbCBzdGRsaWIgY2xhc3NlcwogIHN0YXRpYyBlbXB0eUluc3RhbmNlKCkgewogICAgcmV0dXJuIG5ldyBMaXN0KCk7CiAgfQogIGFzeW5jIF9pbml0aWFsaXNlKCkgewogICAgcmV0dXJuIHRoaXM7CiAgfQogIGNvbnN0cnVjdG9yKGFycikgewogICAgdGhpcy5jb250ZW50cyA9IGFyciA/IFsuLi5hcnJdIDogW107CiAgfQogIGNvbnRlbnRzOwogIHN5c3RlbTsKICBbU3ltYm9sLml0ZXJhdG9yXSgpIHsKICAgIGxldCBpbmRleCA9IDA7CiAgICByZXR1cm4gewogICAgICBuZXh0OiAoKSA9PiB7CiAgICAgICAgaWYgKGluZGV4IDwgdGhpcy5jb250ZW50cy5sZW5ndGgpIHsKICAgICAgICAgIHJldHVybiB7IHZhbHVlOiB0aGlzLmNvbnRlbnRzW2luZGV4KytdLCBkb25lOiBmYWxzZSB9OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXR1cm4geyBkb25lOiB0cnVlIH07CiAgICAgICAgfQogICAgICB9CiAgICB9OwogIH0KICByZWFkKGluZGV4KSB7CiAgICByZXR1cm4gdGhpcy5jb250ZW50c1tpbmRleF07CiAgfQogIHB1dChpbmRleCwgdmFsdWUpIHsKICAgIHRoaXMuc3lzdGVtLnNhZmVMaXN0U2V0KHRoaXMuY29udGVudHMsIGluZGV4LCB2YWx1ZSk7CiAgfQogIGluc2VydChpbmRleCwgdmFsdWUpIHsKICAgIHRoaXMuY29udGVudHMuc3BsaWNlKGluZGV4LCAwLCB2YWx1ZSk7CiAgfQogIHJlbW92ZUF0KGluZGV4KSB7CiAgICB0aGlzLmNvbnRlbnRzLnNwbGljZShpbmRleCwgMSk7CiAgfQogIHJlbW92ZUZpcnN0KHZhbHVlKSB7CiAgICBjb25zdCBpbmRleCA9IHRoaXMuc3lzdGVtLmVsYW5JbmRleE9mKHRoaXMuY29udGVudHMsIHZhbHVlKTsKICAgIGlmIChpbmRleCA+IC0xKSB7CiAgICAgIHRoaXMuY29udGVudHMuc3BsaWNlKGluZGV4LCAxKTsKICAgIH0KICB9CiAgcmVtb3ZlQWxsKHZhbHVlKSB7CiAgICBsZXQgaW5kZXggPSB0aGlzLnN5c3RlbS5lbGFuSW5kZXhPZih0aGlzLmNvbnRlbnRzLCB2YWx1ZSk7CiAgICB3aGlsZSAoaW5kZXggPiAtMSkgewogICAgICB0aGlzLmNvbnRlbnRzLnNwbGljZShpbmRleCwgMSk7CiAgICAgIGluZGV4ID0gdGhpcy5zeXN0ZW0uZWxhbkluZGV4T2YodGhpcy5jb250ZW50cywgdmFsdWUpOwogICAgfQogIH0KICBhcHBlbmQodmFsdWUpIHsKICAgIHRoaXMuY29udGVudHMucHVzaCh2YWx1ZSk7CiAgfQogIGFwcGVuZExpc3QobGlzdEIpIHsKICAgIHRoaXMuY29udGVudHMucHVzaCguLi5saXN0Qi5jb250ZW50cyk7CiAgfQogIHByZXBlbmQodmFsdWUpIHsKICAgIHRoaXMuY29udGVudHMudW5zaGlmdCh2YWx1ZSk7CiAgfQogIHByZXBlbmRMaXN0KGxpc3RCKSB7CiAgICB0aGlzLmNvbnRlbnRzLnVuc2hpZnQoLi4ubGlzdEIuY29udGVudHMpOwogIH0KICBsZW5ndGgoKSB7CiAgICByZXR1cm4gdGhpcy5jb250ZW50cy5sZW5ndGg7CiAgfQogIGluZGV4T2YoaXRlbSkgewogICAgcmV0dXJuIHRoaXMuc3lzdGVtLmVsYW5JbmRleE9mKHRoaXMuY29udGVudHMsIGl0ZW0pOwogIH0KICBjb250YWlucyhpdGVtKSB7CiAgICByZXR1cm4gdGhpcy5pbmRleE9mKGl0ZW0pICE9PSAtMTsKICB9CiAgbmV3TGlzdChuZXdDb250ZW50cykgewogICAgcmV0dXJuIHRoaXMuc3lzdGVtLmluaXRpYWxpc2UobmV3IExpc3QobmV3Q29udGVudHMpKTsKICB9CiAgYXN5bmMgZmlsdGVyKHByZWRpY2F0ZSkgewogICAgcmV0dXJuIHRoaXMubmV3TGlzdChhd2FpdCBmaWx0ZXJIZWxwZXIodGhpcy5jb250ZW50cywgcHJlZGljYXRlKSk7CiAgfQogIGFzeW5jIG1hcChwcmVkaWNhdGUpIHsKICAgIHJldHVybiB0aGlzLm5ld0xpc3QoYXdhaXQgbWFwSGVscGVyKHRoaXMuY29udGVudHMsIHByZWRpY2F0ZSkpOwogIH0KICBhc3luYyByZWR1Y2UoaW5pdFZhbHVlLCBwcmVkaWNhdGUpIHsKICAgIHJldHVybiByZWR1Y2VIZWxwZXIodGhpcy5jb250ZW50cywgaW5pdFZhbHVlLCBwcmVkaWNhdGUpOwogIH0KICBhc3luYyBtYXhCeShwcmVkaWNhdGUpIHsKICAgIHJldHVybiBtYXhCeUhlbHBlcih0aGlzLmNvbnRlbnRzLCBwcmVkaWNhdGUsIHRoaXMuc3lzdGVtKTsKICB9CiAgYXN5bmMgbWluQnkocHJlZGljYXRlKSB7CiAgICByZXR1cm4gbWluQnlIZWxwZXIodGhpcy5jb250ZW50cywgcHJlZGljYXRlLCB0aGlzLnN5c3RlbSk7CiAgfQogIGFzeW5jIHNvcnRCeShwcmVkaWNhdGUpIHsKICAgIHJldHVybiB0aGlzLm5ld0xpc3QoYXdhaXQgc29ydEJ5SGVscGVyKHRoaXMuY29udGVudHMsIHByZWRpY2F0ZSwgdGhpcy5zeXN0ZW0pKTsKICB9CiAgaGVhZCgpIHsKICAgIHJldHVybiB0aGlzLnNhZmVJbmRleCgwKTsKICB9CiAgdGFpbCgpIHsKICAgIGNvbnN0IFtfLCAuLi50bF0gPSB0aGlzLmNvbnRlbnRzOwogICAgcmV0dXJuIHRoaXMuc3lzdGVtLmluaXRpYWxpc2UobmV3IExpc3QodGwpKTsKICB9CiAgYXN5bmMgYXNTdHJpbmcoKSB7CiAgICBjb25zdCBpdGVtcyA9IFtdOwogICAgZm9yIChjb25zdCBpIG9mIHRoaXMuY29udGVudHMpIHsKICAgICAgY29uc3QgcyA9IGF3YWl0IHRoaXMuc3lzdGVtLmFzU3RyaW5nKGkpOwogICAgICBpdGVtcy5wdXNoKHMpOwogICAgfQogICAgcmV0dXJuIGBbJHtpdGVtcy5qb2luKCIsICIpfV1gOwogIH0KICBzYWZlSW5kZXgoaW5kZXgpIHsKICAgIGNvbnN0IHIgPSB0aGlzLmNvbnRlbnRzW2luZGV4XTsKICAgIGlmIChyID09PSB2b2lkIDApIHsKICAgICAgdGhpcy5zeXN0ZW0udGhyb3dSYW5nZUVycm9yKHRoaXMuY29udGVudHMsIGluZGV4KTsKICAgIH0KICAgIHJldHVybiByOwogIH0KICBzYWZlU2xpY2UoaW5kZXgxLCBpbmRleDIpIHsKICAgIGlmIChpbmRleDEgJiYgaW5kZXgxIDwgMCkgewogICAgICB0aGlzLnN5c3RlbS50aHJvd1JhbmdlRXJyb3IodGhpcy5jb250ZW50cywgaW5kZXgxKTsKICAgIH0KICAgIGlmIChpbmRleDIgJiYgaW5kZXgyIDwgMCkgewogICAgICB0aGlzLnN5c3RlbS50aHJvd1JhbmdlRXJyb3IodGhpcy5jb250ZW50cywgaW5kZXgyKTsKICAgIH0KICAgIGNvbnN0IHIgPSB0aGlzLmNvbnRlbnRzLnNsaWNlKGluZGV4MSwgaW5kZXgyKTsKICAgIHJldHVybiB0aGlzLnN5c3RlbS5pbml0aWFsaXNlKG5ldyBMaXN0KHIpKTsKICB9CiAgZGVjb25zdHJ1Y3RMaXN0KCkgewogICAgY29uc3QgW2hkLCAuLi50bF0gPSB0aGlzLmNvbnRlbnRzOwogICAgcmV0dXJuIFtoZCwgdGhpcy5zeXN0ZW0uaW5pdGlhbGlzZShuZXcgTGlzdCh0bCkpXTsKICB9CiAgZXF1YWxzKG90aGVyKSB7CiAgICBpZiAob3RoZXIgaW5zdGFuY2VvZiBMaXN0KSB7CiAgICAgIGlmICh0aGlzLmNvbnRlbnRzLmxlbmd0aCA9PT0gb3RoZXIuY29udGVudHMubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY29udGVudHMuZXZlcnkoKGMsIGkpID0+IHRoaXMuc3lzdGVtLmVxdWFscyhjLCBvdGhlci5jb250ZW50c1tpXSkpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIHdpdGhBcHBlbmQodmFsdWUpIHsKICAgIHJldHVybiB0aGlzLm5ld0xpc3Qod2l0aEFwcGVuZEhlbHBlcih0aGlzLmNvbnRlbnRzLCB2YWx1ZSkpOwogIH0KICB3aXRoQXBwZW5kTGlzdCh0b0FwcGVuZCkgewogICAgcmV0dXJuIHRoaXMubmV3TGlzdCh3aXRoQXBwZW5kTGlzdEhlbHBlcih0aGlzLmNvbnRlbnRzLCB0b0FwcGVuZC5jb250ZW50cykpOwogIH0KICB3aXRoUHJlcGVuZCh2YWx1ZSkgewogICAgcmV0dXJuIHRoaXMud2l0aEluc2VydCgwLCB2YWx1ZSk7CiAgfQogIHdpdGhQcmVwZW5kTGlzdCh0b1ByZXBlbmQpIHsKICAgIHJldHVybiB0b1ByZXBlbmQud2l0aEFwcGVuZExpc3QodGhpcyk7CiAgfQogIHdpdGhQdXQoaW5kZXgsIHZhbHVlKSB7CiAgICByZXR1cm4gdGhpcy5uZXdMaXN0KHdpdGhQdXRIZWxwZXIodGhpcy5jb250ZW50cywgaW5kZXgsIHZhbHVlKSk7CiAgfQogIHdpdGhJbnNlcnQoaW5kZXgsIHZhbHVlKSB7CiAgICByZXR1cm4gdGhpcy5uZXdMaXN0KHdpdGhJbnNlcnRIZWxwZXIodGhpcy5jb250ZW50cywgaW5kZXgsIHZhbHVlKSk7CiAgfQogIHdpdGhSZW1vdmVBdChpbmRleCkgewogICAgcmV0dXJuIHRoaXMubmV3TGlzdCh3aXRoUmVtb3ZlQXRIZWxwZXIodGhpcy5jb250ZW50cywgaW5kZXgpKTsKICB9CiAgd2l0aFJlbW92ZUZpcnN0KHZhbHVlKSB7CiAgICByZXR1cm4gdGhpcy5uZXdMaXN0KHdpdGhSZW1vdmVGaXJzdEhlbHBlcih0aGlzLmNvbnRlbnRzLCB2YWx1ZSwgdGhpcy5zeXN0ZW0pKTsKICB9CiAgd2l0aFJlbW92ZUFsbCh2YWx1ZSkgewogICAgcmV0dXJuIHRoaXMubmV3TGlzdCh3aXRoUmVtb3ZlQWxsSGVscGVyKHRoaXMuY29udGVudHMsIHZhbHVlLCB0aGlzLnN5c3RlbSkpOwogIH0KICBhc3luYyBqb2luKHNlcGFyYXRvcikgewogICAgY29uc3QgYXNTdHJpbmdzID0gYXdhaXQgbWFwSGVscGVyKAogICAgICB0aGlzLmNvbnRlbnRzLAogICAgICBhc3luYyAoaSkgPT4gYXdhaXQgdGhpcy5zeXN0ZW0uYXNTdHJpbmcoaSkKICAgICk7CiAgICByZXR1cm4gYXNTdHJpbmdzLmpvaW4oc2VwYXJhdG9yKTsKICB9CiAgYXNMaXN0SW1tdXRhYmxlKCkgewogICAgcmV0dXJuIHRoaXMuc3lzdGVtLmxpc3RBc0xpc3RJbW11dGFibGUodGhpcyk7CiAgfQogIGFzU2V0KCkgewogICAgcmV0dXJuIHRoaXMuc3lzdGVtLmxpc3RBc1NldCh0aGlzKTsKICB9CiAgYXNBcnJheSgpIHsKICAgIHJldHVybiB0aGlzLnN5c3RlbS5saXN0QXNBcnJheSh0aGlzKTsKICB9Cn07Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhblByb2NlZHVyZShbImluZGV4IiwgInZhbHVlIl0pLAogIF9fZGVjb3JhdGVQYXJhbSgwLCBlbGFuSW50VHlwZSgpKSwKICBfX2RlY29yYXRlUGFyYW0oMSwgZWxhbkdlbmVyaWNQYXJhbVQxVHlwZSgpKQpdLCBMaXN0LnByb3RvdHlwZSwgInB1dCIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5Qcm9jZWR1cmUoWyJpbmRleCIsICJ2YWx1ZSJdKSwKICBfX2RlY29yYXRlUGFyYW0oMCwgZWxhbkludFR5cGUoKSksCiAgX19kZWNvcmF0ZVBhcmFtKDEsIGVsYW5HZW5lcmljUGFyYW1UMVR5cGUoKSkKXSwgTGlzdC5wcm90b3R5cGUsICJpbnNlcnQiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuUHJvY2VkdXJlKFsiaW5kZXgiXSksCiAgX19kZWNvcmF0ZVBhcmFtKDAsIGVsYW5JbnRUeXBlKCkpCl0sIExpc3QucHJvdG90eXBlLCAicmVtb3ZlQXQiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuUHJvY2VkdXJlKFsidmFsdWUiXSksCiAgX19kZWNvcmF0ZVBhcmFtKDAsIGVsYW5HZW5lcmljUGFyYW1UMVR5cGUoKSkKXSwgTGlzdC5wcm90b3R5cGUsICJyZW1vdmVGaXJzdCIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5Qcm9jZWR1cmUoWyJ2YWx1ZSJdKSwKICBfX2RlY29yYXRlUGFyYW0oMCwgZWxhbkdlbmVyaWNQYXJhbVQxVHlwZSgpKQpdLCBMaXN0LnByb3RvdHlwZSwgInJlbW92ZUFsbCIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5Qcm9jZWR1cmUoWyJ2YWx1ZSJdKSwKICBfX2RlY29yYXRlUGFyYW0oMCwgZWxhbkdlbmVyaWNQYXJhbVQxVHlwZSgpKQpdLCBMaXN0LnByb3RvdHlwZSwgImFwcGVuZCIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5Qcm9jZWR1cmUoWyJvdGhlciJdKSwKICBfX2RlY29yYXRlUGFyYW0oMCwgZWxhbkNsYXNzVHlwZShMaXN0LCBbRWxhblQyQ29uc3RyYWluZWQoRWxhblQxKV0pKQpdLCBMaXN0LnByb3RvdHlwZSwgImFwcGVuZExpc3QiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuUHJvY2VkdXJlKFsib3RoZXIiXSksCiAgX19kZWNvcmF0ZVBhcmFtKDAsIGVsYW5HZW5lcmljUGFyYW1UMVR5cGUoKSkKXSwgTGlzdC5wcm90b3R5cGUsICJwcmVwZW5kIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhblByb2NlZHVyZShbIm90aGVyIl0pLAogIF9fZGVjb3JhdGVQYXJhbSgwLCBlbGFuQ2xhc3NUeXBlKExpc3QpKQpdLCBMaXN0LnByb3RvdHlwZSwgInByZXBlbmRMaXN0IiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFtdLCAwIC8qIHB1cmUgKi8sIEVsYW5JbnQpCl0sIExpc3QucHJvdG90eXBlLCAibGVuZ3RoIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFsiaXRlbSJdLCAwIC8qIHB1cmUgKi8sIEVsYW5JbnQpLAogIF9fZGVjb3JhdGVQYXJhbSgwLCBlbGFuR2VuZXJpY1BhcmFtVDFUeXBlKCkpCl0sIExpc3QucHJvdG90eXBlLCAiaW5kZXhPZiIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbIml0ZW0iXSwgMCAvKiBwdXJlICovKSwKICBfX2RlY29yYXRlUGFyYW0oMCwgZWxhbkdlbmVyaWNQYXJhbVQxVHlwZSgpKQpdLCBMaXN0LnByb3RvdHlwZSwgImNvbnRhaW5zIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFsibGFtYmRhT3JGdW5jdGlvblJlZiJdLCAyIC8qIHB1cmVBc3luYyAqLywgRWxhbkNsYXNzKExpc3QpKSwKICBfX2RlY29yYXRlUGFyYW0oMCwgZWxhbkZ1bmNUeXBlKFtFbGFuVDFdLCBFbGFuQm9vbGVhbikpCl0sIExpc3QucHJvdG90eXBlLCAiZmlsdGVyIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFsibGFtYmRhT3JGdW5jdGlvblJlZiJdLCAyIC8qIHB1cmVBc3luYyAqLywgRWxhbkNsYXNzKExpc3QsIFtFbGFuVDJdKSksCiAgX19kZWNvcmF0ZVBhcmFtKDAsIGVsYW5GdW5jVHlwZShbRWxhblQxXSwgRWxhblQyKSkKXSwgTGlzdC5wcm90b3R5cGUsICJtYXAiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oWyJpbml0aWFsVmFsdWUiLCAibGFtYmRhT3JGdW5jdGlvblJlZiJdLCAyIC8qIHB1cmVBc3luYyAqLywgRWxhblQyKSwKICBfX2RlY29yYXRlUGFyYW0oMCwgZWxhbkdlbmVyaWNQYXJhbVQyVHlwZSgpKSwKICBfX2RlY29yYXRlUGFyYW0oMSwgZWxhbkZ1bmNUeXBlKFtFbGFuVDIsIEVsYW5UMV0sIEVsYW5UMikpCl0sIExpc3QucHJvdG90eXBlLCAicmVkdWNlIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFsibGFtYmRhT3JGdW5jdGlvblJlZiJdLCAyIC8qIHB1cmVBc3luYyAqLywgRWxhblQxKSwKICBfX2RlY29yYXRlUGFyYW0oMCwgZWxhbkZ1bmNUeXBlKFtFbGFuVDFdLCBFbGFuRmxvYXQpKQpdLCBMaXN0LnByb3RvdHlwZSwgIm1heEJ5IiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFsibGFtYmRhT3JGdW5jdGlvblJlZiJdLCAyIC8qIHB1cmVBc3luYyAqLywgRWxhblQxKSwKICBfX2RlY29yYXRlUGFyYW0oMCwgZWxhbkZ1bmNUeXBlKFtFbGFuVDFdLCBFbGFuRmxvYXQpKQpdLCBMaXN0LnByb3RvdHlwZSwgIm1pbkJ5IiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFsibGFtYmRhT3JGdW5jdGlvblJlZiJdLCAyIC8qIHB1cmVBc3luYyAqLywgRWxhbkNsYXNzKExpc3QpKSwKICBfX2RlY29yYXRlUGFyYW0oMCwgZWxhbkZ1bmNUeXBlKFtFbGFuVDEsIEVsYW5UMV0sIEVsYW5JbnQpKQpdLCBMaXN0LnByb3RvdHlwZSwgInNvcnRCeSIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbXSwgMCAvKiBwdXJlICovLCBFbGFuVDEpCl0sIExpc3QucHJvdG90eXBlLCAiaGVhZCIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbXSwgMCAvKiBwdXJlICovLCBFbGFuQ2xhc3MoTGlzdCkpCl0sIExpc3QucHJvdG90eXBlLCAidGFpbCIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbImluZGV4IiwgInZhbHVlIl0sIDAgLyogcHVyZSAqLywgRWxhbkNsYXNzKExpc3QpKSwKICBfX2RlY29yYXRlUGFyYW0oMCwgZWxhbkdlbmVyaWNQYXJhbVQxVHlwZSgpKQpdLCBMaXN0LnByb3RvdHlwZSwgIndpdGhBcHBlbmQiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oWyJ0b0FwcGVuZCJdLCAwIC8qIHB1cmUgKi8sIEVsYW5DbGFzcyhMaXN0KSksCiAgX19kZWNvcmF0ZVBhcmFtKDAsIGVsYW5DbGFzc1R5cGUoTGlzdCkpCl0sIExpc3QucHJvdG90eXBlLCAid2l0aEFwcGVuZExpc3QiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oWyJpbmRleCIsICJ2YWx1ZSJdLCAwIC8qIHB1cmUgKi8sIEVsYW5DbGFzcyhMaXN0KSksCiAgX19kZWNvcmF0ZVBhcmFtKDAsIGVsYW5HZW5lcmljUGFyYW1UMVR5cGUoKSkKXSwgTGlzdC5wcm90b3R5cGUsICJ3aXRoUHJlcGVuZCIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbInRvUHJlcGVuZCJdLCAwIC8qIHB1cmUgKi8sIEVsYW5DbGFzcyhMaXN0KSksCiAgX19kZWNvcmF0ZVBhcmFtKDAsIGVsYW5DbGFzc1R5cGUoTGlzdCkpCl0sIExpc3QucHJvdG90eXBlLCAid2l0aFByZXBlbmRMaXN0IiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFsiaW5kZXgiLCAidmFsdWUiXSwgMCAvKiBwdXJlICovLCBFbGFuQ2xhc3MoTGlzdCkpLAogIF9fZGVjb3JhdGVQYXJhbSgwLCBlbGFuSW50VHlwZSgpKSwKICBfX2RlY29yYXRlUGFyYW0oMSwgZWxhbkdlbmVyaWNQYXJhbVQxVHlwZSgpKQpdLCBMaXN0LnByb3RvdHlwZSwgIndpdGhQdXQiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oWyJpbmRleCIsICJ2YWx1ZSJdLCAwIC8qIHB1cmUgKi8sIEVsYW5DbGFzcyhMaXN0KSksCiAgX19kZWNvcmF0ZVBhcmFtKDAsIGVsYW5JbnRUeXBlKCkpLAogIF9fZGVjb3JhdGVQYXJhbSgxLCBlbGFuR2VuZXJpY1BhcmFtVDFUeXBlKCkpCl0sIExpc3QucHJvdG90eXBlLCAid2l0aEluc2VydCIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbImluZGV4Il0sIDAgLyogcHVyZSAqLywgRWxhbkNsYXNzKExpc3QpKSwKICBfX2RlY29yYXRlUGFyYW0oMCwgZWxhbkludFR5cGUoKSkKXSwgTGlzdC5wcm90b3R5cGUsICJ3aXRoUmVtb3ZlQXQiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oWyJ2YWx1ZSJdLCAwIC8qIHB1cmUgKi8sIEVsYW5DbGFzcyhMaXN0KSksCiAgX19kZWNvcmF0ZVBhcmFtKDAsIGVsYW5HZW5lcmljUGFyYW1UMVR5cGUoKSkKXSwgTGlzdC5wcm90b3R5cGUsICJ3aXRoUmVtb3ZlRmlyc3QiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oWyJ2YWx1ZSJdLCAwIC8qIHB1cmUgKi8sIEVsYW5DbGFzcyhMaXN0KSksCiAgX19kZWNvcmF0ZVBhcmFtKDAsIGVsYW5HZW5lcmljUGFyYW1UMVR5cGUoKSkKXSwgTGlzdC5wcm90b3R5cGUsICJ3aXRoUmVtb3ZlQWxsIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFsic2VwYXJhdG9yIl0sIDIgLyogcHVyZUFzeW5jICovLCBFbGFuU3RyaW5nKQpdLCBMaXN0LnByb3RvdHlwZSwgImpvaW4iLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oW10sIDAgLyogcHVyZSAqLywgRWxhbkNsYXNzTmFtZSgiTGlzdEltbXV0YWJsZSIpKQpdLCBMaXN0LnByb3RvdHlwZSwgImFzTGlzdEltbXV0YWJsZSIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbXSwgMCAvKiBwdXJlICovLCBFbGFuQ2xhc3NOYW1lKCJFbGFuU2V0IikpCl0sIExpc3QucHJvdG90eXBlLCAiYXNTZXQiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oW10sIDAgLyogcHVyZSAqLywgRWxhbkNsYXNzTmFtZSgiRWxhbkFycmF5IikpCl0sIExpc3QucHJvdG90eXBlLCAiYXNBcnJheSIsIDEpOwpMaXN0ID0gX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuQ2xhc3MoMyAvKiBsaXN0ICovLCBbRWxhblQxXSwgW10sIFtdLCBbXSkKXSwgTGlzdCk7CgovLyBzcmMvY29tcGlsZXIvc3RhbmRhcmQtbGlicmFyeS9kaWN0aW9uYXJ5LnRzCnZhciBEaWN0aW9uYXJ5ID0gY2xhc3MgewogIC8vIHRoaXMgbXVzdCBiZSBpbXBsZW1lbnRlZCBieSBoYW5kIG9uIGFsbCBzdGRsaWIgY2xhc3NlcwogIHN0YXRpYyBlbXB0eUluc3RhbmNlKCkgewogICAgcmV0dXJuIG5ldyBEaWN0aW9uYXJ5KCk7CiAgfQogIGFzeW5jIF9pbml0aWFsaXNlKCkgewogICAgcmV0dXJuIHRoaXM7CiAgfQogIGNvbnN0cnVjdG9yKGRpY3QpIHsKICAgIHRoaXMuY29udGVudHMgPSBkaWN0ID8gbmV3IE1hcChkaWN0KSA6IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7CiAgfQogIGNvbnRlbnRzOwogIHN5c3RlbTsKICBmaW5kUmVhbEtleShrZXkpIHsKICAgIGZvciAoY29uc3Qgcmsgb2YgdGhpcy5jb250ZW50cy5rZXlzKCkpIHsKICAgICAgaWYgKHRoaXMuc3lzdGVtLmVxdWFscyhrZXksIHJrKSkgewogICAgICAgIHJldHVybiByazsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGtleTsKICB9CiAgcmVtb3ZlQXQoa2V5KSB7CiAgICBjb25zdCByayA9IHRoaXMuZmluZFJlYWxLZXkoa2V5KTsKICAgIHRoaXMuY29udGVudHMuZGVsZXRlKHJrKTsKICB9CiAgcHV0KGtleSwgdmFsdWUpIHsKICAgIGNvbnN0IHJrID0gdGhpcy5maW5kUmVhbEtleShrZXkpOwogICAgdGhpcy5jb250ZW50cy5zZXQocmssIHZhbHVlKTsKICB9CiAga2V5cygpIHsKICAgIGNvbnN0IGxzdCA9IFsuLi50aGlzLmNvbnRlbnRzLmtleXMoKV07CiAgICByZXR1cm4gdGhpcy5zeXN0ZW0uaW5pdGlhbGlzZShuZXcgTGlzdChsc3QpKTsKICB9CiAgdmFsdWVzKCkgewogICAgY29uc3QgbHN0ID0gWy4uLnRoaXMuY29udGVudHMudmFsdWVzKCldOwogICAgcmV0dXJuIHRoaXMuc3lzdGVtLmluaXRpYWxpc2UobmV3IExpc3QobHN0KSk7CiAgfQogIGhhc0tleShrZXkpIHsKICAgIGNvbnN0IHJrID0gdGhpcy5maW5kUmVhbEtleShrZXkpOwogICAgcmV0dXJuIHRoaXMuY29udGVudHMuaGFzKHJrKTsKICB9CiAgYXN5bmMgYXNTdHJpbmcoKSB7CiAgICBjb25zdCBpdGVtcyA9IFtdOwogICAgZm9yIChjb25zdCBrIG9mIHRoaXMuY29udGVudHMua2V5cygpKSB7CiAgICAgIGNvbnN0IGtTdHIgPSBhd2FpdCB0aGlzLnN5c3RlbS5hc1N0cmluZyhrKTsKICAgICAgY29uc3QgdlN0ciA9IGF3YWl0IHRoaXMuc3lzdGVtLmFzU3RyaW5nKHRoaXMuY29udGVudHMuZ2V0KGspKTsKICAgICAgaXRlbXMucHVzaChgJHtrU3RyfToke3ZTdHJ9YCk7CiAgICB9CiAgICByZXR1cm4gYFske2l0ZW1zLmpvaW4oIiwgIil9XWA7CiAgfQogIGFzeW5jIGFzQ2xvbmVhYmxlT2JqZWN0KCkgewogICAgY29uc3QgZGljdCA9IHt9OwogICAgZm9yIChjb25zdCBrIG9mIHRoaXMuY29udGVudHMua2V5cygpKSB7CiAgICAgIGNvbnN0IGtTdHIgPSBhd2FpdCB0aGlzLnN5c3RlbS5hc1N0cmluZyhrKTsKICAgICAgY29uc3QgdiA9IGF3YWl0IHRoaXMuc3lzdGVtPy5hc0Nsb25lYWJsZU9iamVjdCh0aGlzLmNvbnRlbnRzLmdldChrKSk7CiAgICAgIGRpY3Rba1N0cl0gPSB2OwogICAgfQogICAgcmV0dXJuIGRpY3Q7CiAgfQogIHNhZmVJbmRleChrZXkpIHsKICAgIGNvbnN0IHJrID0gdGhpcy5maW5kUmVhbEtleShrZXkpOwogICAgaWYgKCF0aGlzLmNvbnRlbnRzLmhhcyhyaykpIHsKICAgICAgdGhpcy5zeXN0ZW0udGhyb3dLZXlFcnJvcihrZXkpOwogICAgfQogICAgcmV0dXJuIHRoaXMuY29udGVudHMuZ2V0KHJrKTsKICB9CiAgZXF1YWxzKG90aGVyKSB7CiAgICBpZiAob3RoZXIgaW5zdGFuY2VvZiBEaWN0aW9uYXJ5KSB7CiAgICAgIGlmICh0aGlzLmNvbnRlbnRzLnNpemUgPT09IG90aGVyLmNvbnRlbnRzLnNpemUpIHsKICAgICAgICByZXR1cm4gdGhpcy5jb250ZW50cy5rZXlzKCkuZXZlcnkoKGspID0+IHRoaXMuc3lzdGVtLmVxdWFscyh0aGlzLmNvbnRlbnRzLmdldChrKSwgb3RoZXIuY29udGVudHMuZ2V0KGspKSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9CiAgd2l0aFJlbW92ZUF0KGtleSkgewogICAgY29uc3QgcmsgPSB0aGlzLmZpbmRSZWFsS2V5KGtleSk7CiAgICBjb25zdCBuZXdEaWN0ID0gbmV3IE1hcCh0aGlzLmNvbnRlbnRzKTsKICAgIG5ld0RpY3QuZGVsZXRlKHJrKTsKICAgIHJldHVybiB0aGlzLnN5c3RlbS5pbml0aWFsaXNlKG5ldyBEaWN0aW9uYXJ5KFsuLi5uZXdEaWN0LmVudHJpZXMoKV0pKTsKICB9CiAgd2l0aFB1dChrZXksIHZhbHVlKSB7CiAgICBjb25zdCByayA9IHRoaXMuZmluZFJlYWxLZXkoa2V5KTsKICAgIGNvbnN0IG5ld0RpY3QgPSBuZXcgTWFwKHRoaXMuY29udGVudHMpOwogICAgbmV3RGljdC5zZXQocmssIHZhbHVlKTsKICAgIHJldHVybiB0aGlzLnN5c3RlbS5pbml0aWFsaXNlKG5ldyBEaWN0aW9uYXJ5KFsuLi5uZXdEaWN0LmVudHJpZXMoKV0pKTsKICB9CiAgYXNEaWN0aW9uYXJ5SW1tdXRhYmxlKCkgewogICAgcmV0dXJuIHRoaXMuc3lzdGVtLmRpY3Rpb25hcnlBc0RpY3Rpb25hcnlJbW11dGFibGUodGhpcyk7CiAgfQp9OwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5Qcm9jZWR1cmUoWyJrZXkiXSksCiAgX19kZWNvcmF0ZVBhcmFtKDAsIGVsYW5HZW5lcmljUGFyYW1UMVR5cGUoKSkKXSwgRGljdGlvbmFyeS5wcm90b3R5cGUsICJyZW1vdmVBdCIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5Qcm9jZWR1cmUoWyJrZXkiLCAidmFsdWUiXSksCiAgX19kZWNvcmF0ZVBhcmFtKDAsIGVsYW5HZW5lcmljUGFyYW1UMVR5cGUoKSksCiAgX19kZWNvcmF0ZVBhcmFtKDEsIGVsYW5HZW5lcmljUGFyYW1UMlR5cGUoKSkKXSwgRGljdGlvbmFyeS5wcm90b3R5cGUsICJwdXQiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oW10sIDAgLyogcHVyZSAqLywgRWxhbkNsYXNzKExpc3QsIFtFbGFuVDFdKSkKXSwgRGljdGlvbmFyeS5wcm90b3R5cGUsICJrZXlzIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFtdLCAwIC8qIHB1cmUgKi8sIEVsYW5DbGFzcyhMaXN0LCBbRWxhblQyXSkpCl0sIERpY3Rpb25hcnkucHJvdG90eXBlLCAidmFsdWVzIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFsia2V5Il0sIDAgLyogcHVyZSAqLywgRWxhbkJvb2xlYW4pLAogIF9fZGVjb3JhdGVQYXJhbSgwLCBlbGFuR2VuZXJpY1BhcmFtVDFUeXBlKCkpCl0sIERpY3Rpb25hcnkucHJvdG90eXBlLCAiaGFzS2V5IiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFsia2V5Il0sIDAgLyogcHVyZSAqLywgRWxhbkNsYXNzKERpY3Rpb25hcnkpKSwKICBfX2RlY29yYXRlUGFyYW0oMCwgZWxhbkdlbmVyaWNQYXJhbVQxVHlwZSgpKQpdLCBEaWN0aW9uYXJ5LnByb3RvdHlwZSwgIndpdGhSZW1vdmVBdCIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbImtleSIsICJ2YWx1ZSJdLCAwIC8qIHB1cmUgKi8sIEVsYW5DbGFzcyhEaWN0aW9uYXJ5KSksCiAgX19kZWNvcmF0ZVBhcmFtKDAsIGVsYW5HZW5lcmljUGFyYW1UMVR5cGUoKSksCiAgX19kZWNvcmF0ZVBhcmFtKDEsIGVsYW5HZW5lcmljUGFyYW1UMlR5cGUoKSkKXSwgRGljdGlvbmFyeS5wcm90b3R5cGUsICJ3aXRoUHV0IiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFtdLCAwIC8qIHB1cmUgKi8sIEVsYW5DbGFzc05hbWUoIkRpY3Rpb25hcnlJbW11dGFibGUiKSkKXSwgRGljdGlvbmFyeS5wcm90b3R5cGUsICJhc0RpY3Rpb25hcnlJbW11dGFibGUiLCAxKTsKRGljdGlvbmFyeSA9IF9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkNsYXNzKDcgLyogZGljdGlvbmFyeSAqLywgW0VsYW5UMSwgRWxhblQyXSkKXSwgRGljdGlvbmFyeSk7CgovLyBzcmMvY29tcGlsZXIvc3RhbmRhcmQtbGlicmFyeS9saXN0LWltbXV0YWJsZS50cwp2YXIgTGlzdEltbXV0YWJsZSA9IGNsYXNzIHsKICAvLyB0aGlzIG11c3QgYmUgaW1wbGVtZW50ZWQgYnkgaGFuZCBvbiBhbGwgc3RkbGliIGNsYXNzZXMKICBzdGF0aWMgZW1wdHlJbnN0YW5jZSgpIHsKICAgIHJldHVybiBuZXcgTGlzdEltbXV0YWJsZSgpOwogIH0KICBhc3luYyBfaW5pdGlhbGlzZSgpIHsKICAgIHJldHVybiB0aGlzOwogIH0KICBjb25zdHJ1Y3RvcihhcnIpIHsKICAgIHRoaXMuY29udGVudHMgPSBhcnIgPyBbLi4uYXJyXSA6IFtdOwogIH0KICBjb250ZW50czsKICBzeXN0ZW07CiAgW1N5bWJvbC5pdGVyYXRvcl0oKSB7CiAgICBsZXQgaW5kZXggPSAwOwogICAgcmV0dXJuIHsKICAgICAgbmV4dDogKCkgPT4gewogICAgICAgIGlmIChpbmRleCA8IHRoaXMuY29udGVudHMubGVuZ3RoKSB7CiAgICAgICAgICByZXR1cm4geyB2YWx1ZTogdGhpcy5jb250ZW50c1tpbmRleCsrXSwgZG9uZTogZmFsc2UgfTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIHsgZG9uZTogdHJ1ZSB9OwogICAgICAgIH0KICAgICAgfQogICAgfTsKICB9CiAgbmV3TGlzdChuZXdDb250ZW50cykgewogICAgcmV0dXJuIHRoaXMuc3lzdGVtLmluaXRpYWxpc2UobmV3IExpc3RJbW11dGFibGUobmV3Q29udGVudHMpKTsKICB9CiAgd2l0aEFwcGVuZCh2YWx1ZSkgewogICAgcmV0dXJuIHRoaXMubmV3TGlzdCh3aXRoQXBwZW5kSGVscGVyKHRoaXMuY29udGVudHMsIHZhbHVlKSk7CiAgfQogIHdpdGhBcHBlbmRMaXN0KHRvQXBwZW5kKSB7CiAgICByZXR1cm4gdGhpcy5uZXdMaXN0KHdpdGhBcHBlbmRMaXN0SGVscGVyKHRoaXMuY29udGVudHMsIHRvQXBwZW5kLmNvbnRlbnRzKSk7CiAgfQogIHdpdGhQcmVwZW5kKHZhbHVlKSB7CiAgICByZXR1cm4gdGhpcy53aXRoSW5zZXJ0KDAsIHZhbHVlKTsKICB9CiAgd2l0aFByZXBlbmRMaXN0KHRvUHJlcGVuZCkgewogICAgcmV0dXJuIHRvUHJlcGVuZC53aXRoQXBwZW5kTGlzdCh0aGlzKTsKICB9CiAgd2l0aFB1dChpbmRleCwgdmFsdWUpIHsKICAgIHJldHVybiB0aGlzLm5ld0xpc3Qod2l0aFB1dEhlbHBlcih0aGlzLmNvbnRlbnRzLCBpbmRleCwgdmFsdWUpKTsKICB9CiAgd2l0aEluc2VydChpbmRleCwgdmFsdWUpIHsKICAgIHJldHVybiB0aGlzLm5ld0xpc3Qod2l0aEluc2VydEhlbHBlcih0aGlzLmNvbnRlbnRzLCBpbmRleCwgdmFsdWUpKTsKICB9CiAgd2l0aFJlbW92ZUF0KGluZGV4KSB7CiAgICByZXR1cm4gdGhpcy5uZXdMaXN0KHdpdGhSZW1vdmVBdEhlbHBlcih0aGlzLmNvbnRlbnRzLCBpbmRleCkpOwogIH0KICB3aXRoUmVtb3ZlRmlyc3QodmFsdWUpIHsKICAgIHJldHVybiB0aGlzLm5ld0xpc3Qod2l0aFJlbW92ZUZpcnN0SGVscGVyKHRoaXMuY29udGVudHMsIHZhbHVlLCB0aGlzLnN5c3RlbSkpOwogIH0KICB3aXRoUmVtb3ZlQWxsKHZhbHVlKSB7CiAgICByZXR1cm4gdGhpcy5uZXdMaXN0KHdpdGhSZW1vdmVBbGxIZWxwZXIodGhpcy5jb250ZW50cywgdmFsdWUsIHRoaXMuc3lzdGVtKSk7CiAgfQogIGxlbmd0aCgpIHsKICAgIHJldHVybiB0aGlzLmNvbnRlbnRzLmxlbmd0aDsKICB9CiAgaW5kZXhPZihpdGVtKSB7CiAgICByZXR1cm4gdGhpcy5zeXN0ZW0uZWxhbkluZGV4T2YodGhpcy5jb250ZW50cywgaXRlbSk7CiAgfQogIGNvbnRhaW5zKGl0ZW0pIHsKICAgIHJldHVybiB0aGlzLmluZGV4T2YoaXRlbSkgIT09IC0xOwogIH0KICBhc3luYyBmaWx0ZXIocHJlZGljYXRlKSB7CiAgICByZXR1cm4gdGhpcy5uZXdMaXN0KGF3YWl0IGZpbHRlckhlbHBlcih0aGlzLmNvbnRlbnRzLCBwcmVkaWNhdGUpKTsKICB9CiAgYXN5bmMgbWFwKHByZWRpY2F0ZSkgewogICAgcmV0dXJuIHRoaXMubmV3TGlzdChhd2FpdCBtYXBIZWxwZXIodGhpcy5jb250ZW50cywgcHJlZGljYXRlKSk7CiAgfQogIGFzeW5jIHJlZHVjZShpbml0VmFsdWUsIHByZWRpY2F0ZSkgewogICAgcmV0dXJuIHJlZHVjZUhlbHBlcih0aGlzLmNvbnRlbnRzLCBpbml0VmFsdWUsIHByZWRpY2F0ZSk7CiAgfQogIGFzeW5jIG1heEJ5KHByZWRpY2F0ZSkgewogICAgcmV0dXJuIG1heEJ5SGVscGVyKHRoaXMuY29udGVudHMsIHByZWRpY2F0ZSwgdGhpcy5zeXN0ZW0pOwogIH0KICBhc3luYyBtaW5CeShwcmVkaWNhdGUpIHsKICAgIHJldHVybiBtaW5CeUhlbHBlcih0aGlzLmNvbnRlbnRzLCBwcmVkaWNhdGUsIHRoaXMuc3lzdGVtKTsKICB9CiAgYXN5bmMgc29ydEJ5KHByZWRpY2F0ZSkgewogICAgY29uc3QgYXJyID0gYXdhaXQgc29ydEJ5SGVscGVyKHRoaXMuY29udGVudHMsIHByZWRpY2F0ZSwgdGhpcy5zeXN0ZW0pOwogICAgcmV0dXJuIHRoaXMubmV3TGlzdChhcnIpOwogIH0KICBoZWFkKCkgewogICAgcmV0dXJuIHRoaXMuc2FmZUluZGV4KDApOwogIH0KICB0YWlsKCkgewogICAgY29uc3QgW18sIC4uLnRsXSA9IHRoaXMuY29udGVudHM7CiAgICByZXR1cm4gdGhpcy5zeXN0ZW0uaW5pdGlhbGlzZShuZXcgTGlzdEltbXV0YWJsZSh0bCkpOwogIH0KICBhc3luYyBhc1N0cmluZygpIHsKICAgIGNvbnN0IGl0ZW1zID0gW107CiAgICBmb3IgKGNvbnN0IGkgb2YgdGhpcy5jb250ZW50cykgewogICAgICBjb25zdCBzID0gYXdhaXQgdGhpcy5zeXN0ZW0uYXNTdHJpbmcoaSk7CiAgICAgIGl0ZW1zLnB1c2gocyk7CiAgICB9CiAgICByZXR1cm4gYHske2l0ZW1zLmpvaW4oIiwgIil9fWA7CiAgfQogIHNhZmVJbmRleChpbmRleCkgewogICAgY29uc3QgciA9IHRoaXMuY29udGVudHNbaW5kZXhdOwogICAgaWYgKHIgPT09IHZvaWQgMCkgewogICAgICB0aGlzLnN5c3RlbS50aHJvd1JhbmdlRXJyb3IodGhpcy5jb250ZW50cywgaW5kZXgpOwogICAgfQogICAgcmV0dXJuIHI7CiAgfQogIHNhZmVTbGljZShpbmRleDEsIGluZGV4MikgewogICAgaWYgKGluZGV4MSAmJiBpbmRleDEgPCAwKSB7CiAgICAgIHRoaXMuc3lzdGVtLnRocm93UmFuZ2VFcnJvcih0aGlzLmNvbnRlbnRzLCBpbmRleDEpOwogICAgfQogICAgaWYgKGluZGV4MiAmJiBpbmRleDIgPCAwKSB7CiAgICAgIHRoaXMuc3lzdGVtLnRocm93UmFuZ2VFcnJvcih0aGlzLmNvbnRlbnRzLCBpbmRleDIpOwogICAgfQogICAgY29uc3QgciA9IHRoaXMuY29udGVudHMuc2xpY2UoaW5kZXgxLCBpbmRleDIpOwogICAgcmV0dXJuIHRoaXMuc3lzdGVtLmluaXRpYWxpc2UobmV3IExpc3RJbW11dGFibGUocikpOwogIH0KICBkZWNvbnN0cnVjdExpc3QoKSB7CiAgICBjb25zdCBbaGQsIC4uLnRsXSA9IHRoaXMuY29udGVudHM7CiAgICByZXR1cm4gW2hkLCB0aGlzLnN5c3RlbS5pbml0aWFsaXNlKG5ldyBMaXN0SW1tdXRhYmxlKHRsKSldOwogIH0KICBlcXVhbHMob3RoZXIpIHsKICAgIGlmIChvdGhlciBpbnN0YW5jZW9mIExpc3RJbW11dGFibGUpIHsKICAgICAgaWYgKHRoaXMuY29udGVudHMubGVuZ3RoID09PSBvdGhlci5jb250ZW50cy5sZW5ndGgpIHsKICAgICAgICByZXR1cm4gdGhpcy5jb250ZW50cy5ldmVyeSgoYywgaSkgPT4gdGhpcy5zeXN0ZW0uZXF1YWxzKGMsIG90aGVyLmNvbnRlbnRzW2ldKSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9CiAgYXN5bmMgam9pbihzZXBhcmF0b3IpIHsKICAgIGNvbnN0IGFzU3RyaW5ncyA9IGF3YWl0IG1hcEhlbHBlcigKICAgICAgdGhpcy5jb250ZW50cywKICAgICAgYXN5bmMgKGkpID0+IGF3YWl0IHRoaXMuc3lzdGVtLmFzU3RyaW5nKGkpCiAgICApOwogICAgcmV0dXJuIGFzU3RyaW5ncy5qb2luKHNlcGFyYXRvcik7CiAgfQogIGFzTGlzdCgpIHsKICAgIHJldHVybiB0aGlzLnN5c3RlbS5saXN0SW1tdXRhYmxlQXNMaXN0KHRoaXMpOwogIH0KICBhc1NldCgpIHsKICAgIHJldHVybiB0aGlzLnN5c3RlbS5saXN0SW1tdXRhYmxlQXNTZXQodGhpcyk7CiAgfQogIGFzQXJyYXkoKSB7CiAgICByZXR1cm4gdGhpcy5zeXN0ZW0ubGlzdEltbXV0YWJsZUFzQXJyYXkodGhpcyk7CiAgfQp9OwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbInZhbHVlIl0sIDAgLyogcHVyZSAqLywgRWxhbkNsYXNzKExpc3RJbW11dGFibGUpKSwKICBfX2RlY29yYXRlUGFyYW0oMCwgZWxhbkdlbmVyaWNQYXJhbVQxVHlwZSgpKQpdLCBMaXN0SW1tdXRhYmxlLnByb3RvdHlwZSwgIndpdGhBcHBlbmQiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oWyJ0b0FwcGVuZCJdLCAwIC8qIHB1cmUgKi8sIEVsYW5DbGFzcyhMaXN0SW1tdXRhYmxlKSksCiAgX19kZWNvcmF0ZVBhcmFtKDAsIGVsYW5DbGFzc1R5cGUoTGlzdEltbXV0YWJsZSkpCl0sIExpc3RJbW11dGFibGUucHJvdG90eXBlLCAid2l0aEFwcGVuZExpc3QiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oWyJ2YWx1ZSJdLCAwIC8qIHB1cmUgKi8sIEVsYW5DbGFzcyhMaXN0SW1tdXRhYmxlKSksCiAgX19kZWNvcmF0ZVBhcmFtKDAsIGVsYW5HZW5lcmljUGFyYW1UMVR5cGUoKSkKXSwgTGlzdEltbXV0YWJsZS5wcm90b3R5cGUsICJ3aXRoUHJlcGVuZCIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbInRvUHJlcGVuZCJdLCAwIC8qIHB1cmUgKi8sIEVsYW5DbGFzcyhMaXN0SW1tdXRhYmxlKSksCiAgX19kZWNvcmF0ZVBhcmFtKDAsIGVsYW5DbGFzc1R5cGUoTGlzdEltbXV0YWJsZSkpCl0sIExpc3RJbW11dGFibGUucHJvdG90eXBlLCAid2l0aFByZXBlbmRMaXN0IiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFsiaW5kZXgiLCAidmFsdWUiXSwgMCAvKiBwdXJlICovLCBFbGFuQ2xhc3MoTGlzdEltbXV0YWJsZSkpLAogIF9fZGVjb3JhdGVQYXJhbSgwLCBlbGFuSW50VHlwZSgpKSwKICBfX2RlY29yYXRlUGFyYW0oMSwgZWxhbkdlbmVyaWNQYXJhbVQxVHlwZSgpKQpdLCBMaXN0SW1tdXRhYmxlLnByb3RvdHlwZSwgIndpdGhQdXQiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oWyJpbmRleCIsICJ2YWx1ZSJdLCAwIC8qIHB1cmUgKi8sIEVsYW5DbGFzcyhMaXN0SW1tdXRhYmxlKSksCiAgX19kZWNvcmF0ZVBhcmFtKDAsIGVsYW5JbnRUeXBlKCkpLAogIF9fZGVjb3JhdGVQYXJhbSgxLCBlbGFuR2VuZXJpY1BhcmFtVDFUeXBlKCkpCl0sIExpc3RJbW11dGFibGUucHJvdG90eXBlLCAid2l0aEluc2VydCIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbImluZGV4Il0sIDAgLyogcHVyZSAqLywgRWxhbkNsYXNzKExpc3RJbW11dGFibGUpKSwKICBfX2RlY29yYXRlUGFyYW0oMCwgZWxhbkludFR5cGUoKSkKXSwgTGlzdEltbXV0YWJsZS5wcm90b3R5cGUsICJ3aXRoUmVtb3ZlQXQiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oWyJ2YWx1ZSJdLCAwIC8qIHB1cmUgKi8sIEVsYW5DbGFzcyhMaXN0SW1tdXRhYmxlKSksCiAgX19kZWNvcmF0ZVBhcmFtKDAsIGVsYW5HZW5lcmljUGFyYW1UMVR5cGUoKSkKXSwgTGlzdEltbXV0YWJsZS5wcm90b3R5cGUsICJ3aXRoUmVtb3ZlRmlyc3QiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oWyJ2YWx1ZSJdLCAwIC8qIHB1cmUgKi8sIEVsYW5DbGFzcyhMaXN0SW1tdXRhYmxlKSksCiAgX19kZWNvcmF0ZVBhcmFtKDAsIGVsYW5HZW5lcmljUGFyYW1UMVR5cGUoKSkKXSwgTGlzdEltbXV0YWJsZS5wcm90b3R5cGUsICJ3aXRoUmVtb3ZlQWxsIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFtdLCAwIC8qIHB1cmUgKi8sIEVsYW5JbnQpCl0sIExpc3RJbW11dGFibGUucHJvdG90eXBlLCAibGVuZ3RoIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFsiaXRlbSJdLCAwIC8qIHB1cmUgKi8sIEVsYW5JbnQpLAogIF9fZGVjb3JhdGVQYXJhbSgwLCBlbGFuR2VuZXJpY1BhcmFtVDFUeXBlKCkpCl0sIExpc3RJbW11dGFibGUucHJvdG90eXBlLCAiaW5kZXhPZiIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbIml0ZW0iXSwgMCAvKiBwdXJlICovKSwKICBfX2RlY29yYXRlUGFyYW0oMCwgZWxhbkdlbmVyaWNQYXJhbVQxVHlwZSgpKQpdLCBMaXN0SW1tdXRhYmxlLnByb3RvdHlwZSwgImNvbnRhaW5zIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFsibGFtYmRhT3JGdW5jdGlvblJlZiJdLCAyIC8qIHB1cmVBc3luYyAqLywgRWxhbkNsYXNzKExpc3RJbW11dGFibGUpKSwKICBfX2RlY29yYXRlUGFyYW0oMCwgZWxhbkZ1bmNUeXBlKFtFbGFuVDFdLCBFbGFuQm9vbGVhbikpCl0sIExpc3RJbW11dGFibGUucHJvdG90eXBlLCAiZmlsdGVyIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKAogICAgWyJsYW1iZGFPckZ1bmN0aW9uUmVmIl0sCiAgICAyIC8qIHB1cmVBc3luYyAqLywKICAgIEVsYW5DbGFzcyhMaXN0SW1tdXRhYmxlLCBbRWxhblQyXSkKICApLAogIF9fZGVjb3JhdGVQYXJhbSgwLCBlbGFuRnVuY1R5cGUoW0VsYW5UMV0sIEVsYW5UMikpCl0sIExpc3RJbW11dGFibGUucHJvdG90eXBlLCAibWFwIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFsiaW5pdGlhbFZhbHVlIiwgImxhbWJkYU9yRnVuY3Rpb25SZWYiXSwgMiAvKiBwdXJlQXN5bmMgKi8sIEVsYW5UMiksCiAgX19kZWNvcmF0ZVBhcmFtKDAsIGVsYW5HZW5lcmljUGFyYW1UMlR5cGUoKSksCiAgX19kZWNvcmF0ZVBhcmFtKDEsIGVsYW5GdW5jVHlwZShbRWxhblQyLCBFbGFuVDFdLCBFbGFuVDIpKQpdLCBMaXN0SW1tdXRhYmxlLnByb3RvdHlwZSwgInJlZHVjZSIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbImxhbWJkYU9yRnVuY3Rpb25SZWYiXSwgMiAvKiBwdXJlQXN5bmMgKi8sIEVsYW5UMSksCiAgX19kZWNvcmF0ZVBhcmFtKDAsIGVsYW5GdW5jVHlwZShbRWxhblQxXSwgRWxhbkZsb2F0KSkKXSwgTGlzdEltbXV0YWJsZS5wcm90b3R5cGUsICJtYXhCeSIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbImxhbWJkYU9yRnVuY3Rpb25SZWYiXSwgMiAvKiBwdXJlQXN5bmMgKi8sIEVsYW5UMSksCiAgX19kZWNvcmF0ZVBhcmFtKDAsIGVsYW5GdW5jVHlwZShbRWxhblQxXSwgRWxhbkZsb2F0KSkKXSwgTGlzdEltbXV0YWJsZS5wcm90b3R5cGUsICJtaW5CeSIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbImxhbWJkYU9yRnVuY3Rpb25SZWYiXSwgMiAvKiBwdXJlQXN5bmMgKi8sIEVsYW5DbGFzcyhMaXN0SW1tdXRhYmxlKSksCiAgX19kZWNvcmF0ZVBhcmFtKDAsIGVsYW5GdW5jVHlwZShbRWxhblQxLCBFbGFuVDFdLCBFbGFuSW50KSkKXSwgTGlzdEltbXV0YWJsZS5wcm90b3R5cGUsICJzb3J0QnkiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oW10sIDAgLyogcHVyZSAqLywgRWxhblQxKQpdLCBMaXN0SW1tdXRhYmxlLnByb3RvdHlwZSwgImhlYWQiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oW10sIDAgLyogcHVyZSAqLywgRWxhbkNsYXNzKExpc3RJbW11dGFibGUpKQpdLCBMaXN0SW1tdXRhYmxlLnByb3RvdHlwZSwgInRhaWwiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oWyJzZXBhcmF0b3IiXSwgMiAvKiBwdXJlQXN5bmMgKi8sIEVsYW5TdHJpbmcpCl0sIExpc3RJbW11dGFibGUucHJvdG90eXBlLCAiam9pbiIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbXSwgMCAvKiBwdXJlICovLCBFbGFuQ2xhc3NOYW1lKCJMaXN0IikpCl0sIExpc3RJbW11dGFibGUucHJvdG90eXBlLCAiYXNMaXN0IiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFtdLCAwIC8qIHB1cmUgKi8sIEVsYW5DbGFzc05hbWUoIkVsYW5TZXQiKSkKXSwgTGlzdEltbXV0YWJsZS5wcm90b3R5cGUsICJhc1NldCIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbXSwgMCAvKiBwdXJlICovLCBFbGFuQ2xhc3NOYW1lKCJFbGFuQXJyYXkiKSkKXSwgTGlzdEltbXV0YWJsZS5wcm90b3R5cGUsICJhc0FycmF5IiwgMSk7Ckxpc3RJbW11dGFibGUgPSBfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5DbGFzcyg2IC8qIGxpc3RJbW11dGFibGUgKi8sIFtFbGFuVDFdLCBbXSwgW10sIFtdKQpdLCBMaXN0SW1tdXRhYmxlKTsKCi8vIHNyYy9jb21waWxlci9zdGFuZGFyZC1saWJyYXJ5L2RpY3Rpb25hcnktaW1tdXRhYmxlLnRzCnZhciBEaWN0aW9uYXJ5SW1tdXRhYmxlID0gY2xhc3MgewogIC8vIHRoaXMgbXVzdCBiZSBpbXBsZW1lbnRlZCBieSBoYW5kIG9uIGFsbCBzdGRsaWIgY2xhc3NlcwogIHN0YXRpYyBlbXB0eUluc3RhbmNlKCkgewogICAgcmV0dXJuIG5ldyBEaWN0aW9uYXJ5SW1tdXRhYmxlKCk7CiAgfQogIGFzeW5jIF9pbml0aWFsaXNlKCkgewogICAgcmV0dXJuIHRoaXM7CiAgfQogIGNvbnN0cnVjdG9yKGRpY3QpIHsKICAgIHRoaXMuY29udGVudHMgPSBkaWN0ID8gbmV3IE1hcChkaWN0KSA6IC8qIEBfX1BVUkVfXyAqLyBuZXcgTWFwKCk7CiAgfQogIGNvbnRlbnRzOwogIHN5c3RlbTsKICBmaW5kUmVhbEtleShrZXkpIHsKICAgIGZvciAoY29uc3Qgcmsgb2YgdGhpcy5jb250ZW50cy5rZXlzKCkpIHsKICAgICAgaWYgKHRoaXMuc3lzdGVtLmVxdWFscyhrZXksIHJrKSkgewogICAgICAgIHJldHVybiByazsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGtleTsKICB9CiAgd2l0aFJlbW92ZUF0KGtleSkgewogICAgY29uc3QgcmsgPSB0aGlzLmZpbmRSZWFsS2V5KGtleSk7CiAgICBjb25zdCBuZXdEaWN0ID0gbmV3IE1hcCh0aGlzLmNvbnRlbnRzKTsKICAgIG5ld0RpY3QuZGVsZXRlKHJrKTsKICAgIHJldHVybiB0aGlzLnN5c3RlbS5pbml0aWFsaXNlKG5ldyBEaWN0aW9uYXJ5SW1tdXRhYmxlKFsuLi5uZXdEaWN0LmVudHJpZXMoKV0pKTsKICB9CiAgd2l0aFB1dChrZXksIHZhbHVlKSB7CiAgICBjb25zdCByayA9IHRoaXMuZmluZFJlYWxLZXkoa2V5KTsKICAgIGNvbnN0IG5ld0RpY3QgPSBuZXcgTWFwKHRoaXMuY29udGVudHMpOwogICAgbmV3RGljdC5zZXQocmssIHZhbHVlKTsKICAgIHJldHVybiB0aGlzLnN5c3RlbS5pbml0aWFsaXNlKG5ldyBEaWN0aW9uYXJ5SW1tdXRhYmxlKFsuLi5uZXdEaWN0LmVudHJpZXMoKV0pKTsKICB9CiAga2V5cygpIHsKICAgIGNvbnN0IGxzdCA9IFsuLi50aGlzLmNvbnRlbnRzLmtleXMoKV07CiAgICByZXR1cm4gdGhpcy5zeXN0ZW0uaW5pdGlhbGlzZShuZXcgTGlzdEltbXV0YWJsZShsc3QpKTsKICB9CiAgdmFsdWVzKCkgewogICAgY29uc3QgbHN0ID0gWy4uLnRoaXMuY29udGVudHMudmFsdWVzKCldOwogICAgcmV0dXJuIHRoaXMuc3lzdGVtLmluaXRpYWxpc2UobmV3IExpc3RJbW11dGFibGUobHN0KSk7CiAgfQogIGhhc0tleShrZXkpIHsKICAgIGNvbnN0IHJrID0gdGhpcy5maW5kUmVhbEtleShrZXkpOwogICAgcmV0dXJuIHRoaXMuY29udGVudHMuaGFzKHJrKTsKICB9CiAgYXNEaWN0aW9uYXJ5KCkgewogICAgcmV0dXJuIHRoaXMuc3lzdGVtLmRpY3Rpb25hcnlJbW11dGFibGVBc0RpY3Rpb25hcnkodGhpcyk7CiAgfQogIGFzeW5jIGFzU3RyaW5nKCkgewogICAgY29uc3QgaXRlbXMgPSBbXTsKICAgIGZvciAoY29uc3QgayBvZiB0aGlzLmNvbnRlbnRzLmtleXMoKSkgewogICAgICBjb25zdCBrU3RyID0gYXdhaXQgdGhpcy5zeXN0ZW0uYXNTdHJpbmcoayk7CiAgICAgIGNvbnN0IHZTdHIgPSBhd2FpdCB0aGlzLnN5c3RlbS5hc1N0cmluZyh0aGlzLmNvbnRlbnRzLmdldChrKSk7CiAgICAgIGl0ZW1zLnB1c2goYCR7a1N0cn06JHt2U3RyfWApOwogICAgfQogICAgcmV0dXJuIGB7JHtpdGVtcy5qb2luKCIsICIpfX1gOwogIH0KICBhc3luYyBhc0Nsb25lYWJsZU9iamVjdCgpIHsKICAgIGNvbnN0IGRpY3QgPSB7fTsKICAgIGZvciAoY29uc3QgayBvZiB0aGlzLmNvbnRlbnRzLmtleXMoKSkgewogICAgICBjb25zdCBrU3RyID0gYXdhaXQgdGhpcy5zeXN0ZW0uYXNTdHJpbmcoayk7CiAgICAgIGNvbnN0IHYgPSBhd2FpdCB0aGlzLnN5c3RlbT8uYXNDbG9uZWFibGVPYmplY3QodGhpcy5jb250ZW50cy5nZXQoaykpOwogICAgICBkaWN0W2tTdHJdID0gdjsKICAgIH0KICAgIHJldHVybiBkaWN0OwogIH0KICBzYWZlSW5kZXgoa2V5KSB7CiAgICBjb25zdCByayA9IHRoaXMuZmluZFJlYWxLZXkoa2V5KTsKICAgIGlmICghdGhpcy5jb250ZW50cy5oYXMocmspKSB7CiAgICAgIHRoaXMuc3lzdGVtLnRocm93S2V5RXJyb3Ioa2V5KTsKICAgIH0KICAgIHJldHVybiB0aGlzLmNvbnRlbnRzLmdldChyayk7CiAgfQogIGVxdWFscyhvdGhlcikgewogICAgaWYgKG90aGVyIGluc3RhbmNlb2YgRGljdGlvbmFyeUltbXV0YWJsZSkgewogICAgICBpZiAodGhpcy5jb250ZW50cy5zaXplID09PSBvdGhlci5jb250ZW50cy5zaXplKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY29udGVudHMua2V5cygpLmV2ZXJ5KChrKSA9PiB0aGlzLnN5c3RlbS5lcXVhbHModGhpcy5jb250ZW50cy5nZXQoayksIG90aGVyLmNvbnRlbnRzLmdldChrKSkpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gZmFsc2U7CiAgfQp9OwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbImtleSJdLCAwIC8qIHB1cmUgKi8sIEVsYW5DbGFzcyhEaWN0aW9uYXJ5SW1tdXRhYmxlKSksCiAgX19kZWNvcmF0ZVBhcmFtKDAsIGVsYW5HZW5lcmljUGFyYW1UMVR5cGUoKSkKXSwgRGljdGlvbmFyeUltbXV0YWJsZS5wcm90b3R5cGUsICJ3aXRoUmVtb3ZlQXQiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oWyJrZXkiLCAidmFsdWUiXSwgMCAvKiBwdXJlICovLCBFbGFuQ2xhc3MoRGljdGlvbmFyeUltbXV0YWJsZSkpLAogIF9fZGVjb3JhdGVQYXJhbSgwLCBlbGFuR2VuZXJpY1BhcmFtVDFUeXBlKCkpLAogIF9fZGVjb3JhdGVQYXJhbSgxLCBlbGFuR2VuZXJpY1BhcmFtVDJUeXBlKCkpCl0sIERpY3Rpb25hcnlJbW11dGFibGUucHJvdG90eXBlLCAid2l0aFB1dCIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbXSwgMCAvKiBwdXJlICovLCBFbGFuQ2xhc3MoTGlzdEltbXV0YWJsZSwgW0VsYW5UMV0pKQpdLCBEaWN0aW9uYXJ5SW1tdXRhYmxlLnByb3RvdHlwZSwgImtleXMiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oW10sIDAgLyogcHVyZSAqLywgRWxhbkNsYXNzKExpc3RJbW11dGFibGUsIFtFbGFuVDJdKSkKXSwgRGljdGlvbmFyeUltbXV0YWJsZS5wcm90b3R5cGUsICJ2YWx1ZXMiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oWyJrZXkiXSwgMCAvKiBwdXJlICovLCBFbGFuQm9vbGVhbiksCiAgX19kZWNvcmF0ZVBhcmFtKDAsIGVsYW5HZW5lcmljUGFyYW1UMVR5cGUoKSkKXSwgRGljdGlvbmFyeUltbXV0YWJsZS5wcm90b3R5cGUsICJoYXNLZXkiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oW10sIDAgLyogcHVyZSAqLywgRWxhbkNsYXNzTmFtZSgiRGljdGlvbmFyeSIpKQpdLCBEaWN0aW9uYXJ5SW1tdXRhYmxlLnByb3RvdHlwZSwgImFzRGljdGlvbmFyeSIsIDEpOwpEaWN0aW9uYXJ5SW1tdXRhYmxlID0gX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuQ2xhc3MoOCAvKiBkaWN0aW9uYXJ5SW1tdXRhYmxlICovLCBbRWxhblQxLCBFbGFuVDJdKQpdLCBEaWN0aW9uYXJ5SW1tdXRhYmxlKTsKCi8vIHNyYy9jb21waWxlci9zdGFuZGFyZC1saWJyYXJ5L2VsYW4tYXJyYXkudHMKdmFyIEVsYW5BcnJheSA9IGNsYXNzIHsKICAvLyB0aGlzIG11c3QgYmUgaW1wbGVtZW50ZWQgYnkgaGFuZCBvbiBhbGwgc3RkbGliIGNsYXNzZXMKICBzdGF0aWMgZW1wdHlJbnN0YW5jZSgpIHsKICAgIHJldHVybiBuZXcgRWxhbkFycmF5KCk7CiAgfQogIGFzeW5jIF9pbml0aWFsaXNlKHNpemUsIHZhbHVlKSB7CiAgICBpZiAoc2l6ZSA8PSAwKSB7CiAgICAgIHRocm93IG5ldyBFbGFuUnVudGltZUVycm9yKGBTaXplIG9mIEFycmF5IG11c3QgYmUgbm9uIHplcm8sIHBvc2l0aXZlIHZhbHVlYCk7CiAgICB9CiAgICBpZiAoISh0eXBlb2YgdmFsdWUgPT09ICJib29sZWFuIiB8fCB0eXBlb2YgdmFsdWUgPT09ICJzdHJpbmciIHx8IHR5cGVvZiB2YWx1ZSA9PT0gIm51bWJlciIpKSB7CiAgICAgIHRocm93IG5ldyBFbGFuUnVudGltZUVycm9yKAogICAgICAgIGBBcnJheSBtdXN0IGJlIG9mIFR5cGU6IEludCwgRmxvYXQsIFN0cmluZywgb3IgQm9vbGVhbiwgd2l0aCBtYXRjaGluZyBpbml0aWFsIHZhbHVlYAogICAgICApOwogICAgfQogICAgY29uc3QgdG9Jbml0ID0gW107CiAgICB0b0luaXQubGVuZ3RoID0gc2l6ZTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2l6ZTsgaSsrKSB7CiAgICAgIHRvSW5pdFtpXSA9IHZhbHVlOwogICAgfQogICAgdGhpcy5jb250ZW50cyA9IHRvSW5pdDsKICAgIHJldHVybiB0aGlzOwogIH0KICBjb25zdHJ1Y3RvcihhcnIpIHsKICAgIHRoaXMuY29udGVudHMgPSBhcnIgPyBbLi4uYXJyXSA6IFtdOwogIH0KICBjb250ZW50czsKICBzeXN0ZW07CiAgW1N5bWJvbC5pdGVyYXRvcl0oKSB7CiAgICBsZXQgaW5kZXggPSAwOwogICAgcmV0dXJuIHsKICAgICAgbmV4dDogKCkgPT4gewogICAgICAgIGlmIChpbmRleCA8IHRoaXMuY29udGVudHMubGVuZ3RoKSB7CiAgICAgICAgICByZXR1cm4geyB2YWx1ZTogdGhpcy5jb250ZW50c1tpbmRleCsrXSwgZG9uZTogZmFsc2UgfTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIHsgZG9uZTogdHJ1ZSB9OwogICAgICAgIH0KICAgICAgfQogICAgfTsKICB9CiAgbmV3QXJyYXkobmV3Q29udGVudHMpIHsKICAgIHJldHVybiB0aGlzLnN5c3RlbS5pbml0aWFsaXNlKG5ldyBFbGFuQXJyYXkobmV3Q29udGVudHMpKTsKICB9CiAgcHV0KGluZGV4LCB2YWx1ZSkgewogICAgdGhpcy5zeXN0ZW0uc2FmZUxpc3RTZXQodGhpcy5jb250ZW50cywgaW5kZXgsIHZhbHVlKTsKICB9CiAgd2l0aFB1dChpbmRleCwgdmFsdWUpIHsKICAgIHJldHVybiB0aGlzLm5ld0FycmF5KHdpdGhQdXRIZWxwZXIodGhpcy5jb250ZW50cywgaW5kZXgsIHZhbHVlKSk7CiAgfQogIGxlbmd0aCgpIHsKICAgIHJldHVybiB0aGlzLmNvbnRlbnRzLmxlbmd0aDsKICB9CiAgaW5kZXhPZihpdGVtKSB7CiAgICByZXR1cm4gdGhpcy5zeXN0ZW0uZWxhbkluZGV4T2YodGhpcy5jb250ZW50cywgaXRlbSk7CiAgfQogIGNvbnRhaW5zKGl0ZW0pIHsKICAgIHJldHVybiB0aGlzLmluZGV4T2YoaXRlbSkgIT09IC0xOwogIH0KICBhc3luYyBhc1N0cmluZygpIHsKICAgIGNvbnN0IGl0ZW1zID0gW107CiAgICBmb3IgKGNvbnN0IGkgb2YgdGhpcy5jb250ZW50cykgewogICAgICBjb25zdCBzID0gYXdhaXQgdGhpcy5zeXN0ZW0uYXNTdHJpbmcoaSk7CiAgICAgIGl0ZW1zLnB1c2gocyk7CiAgICB9CiAgICByZXR1cm4gYFske2l0ZW1zLmpvaW4oIiwgIil9XWA7CiAgfQogIHNhZmVJbmRleChpbmRleCkgewogICAgY29uc3QgciA9IHRoaXMuY29udGVudHNbaW5kZXhdOwogICAgaWYgKHIgPT09IHZvaWQgMCkgewogICAgICB0aGlzLnN5c3RlbS50aHJvd1JhbmdlRXJyb3IodGhpcy5jb250ZW50cywgaW5kZXgpOwogICAgfQogICAgcmV0dXJuIHI7CiAgfQogIHNhZmVTbGljZShpbmRleDEsIGluZGV4MikgewogICAgaWYgKGluZGV4MSAmJiBpbmRleDEgPCAwKSB7CiAgICAgIHRoaXMuc3lzdGVtLnRocm93UmFuZ2VFcnJvcih0aGlzLmNvbnRlbnRzLCBpbmRleDEpOwogICAgfQogICAgaWYgKGluZGV4MiAmJiBpbmRleDIgPCAwKSB7CiAgICAgIHRoaXMuc3lzdGVtLnRocm93UmFuZ2VFcnJvcih0aGlzLmNvbnRlbnRzLCBpbmRleDIpOwogICAgfQogICAgY29uc3QgciA9IHRoaXMuY29udGVudHMuc2xpY2UoaW5kZXgxLCBpbmRleDIpOwogICAgcmV0dXJuIHRoaXMuc3lzdGVtLmluaXRpYWxpc2UobmV3IEVsYW5BcnJheShyKSk7CiAgfQogIGVxdWFscyhvdGhlcikgewogICAgaWYgKG90aGVyIGluc3RhbmNlb2YgRWxhbkFycmF5KSB7CiAgICAgIGlmICh0aGlzLmNvbnRlbnRzLmxlbmd0aCA9PT0gb3RoZXIuY29udGVudHMubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIHRoaXMuY29udGVudHMuZXZlcnkoKGMsIGkpID0+IHRoaXMuc3lzdGVtLmVxdWFscyhjLCBvdGhlci5jb250ZW50c1tpXSkpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGFzU2V0KCkgewogICAgcmV0dXJuIHRoaXMuc3lzdGVtLmFycmF5QXNTZXQodGhpcyk7CiAgfQogIGFzTGlzdCgpIHsKICAgIHJldHVybiB0aGlzLnN5c3RlbS5hcnJheUFzTGlzdCh0aGlzKTsKICB9Cn07Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhblByb2NlZHVyZShbImluZGV4IiwgInZhbHVlIl0pLAogIF9fZGVjb3JhdGVQYXJhbSgwLCBlbGFuSW50VHlwZSgpKSwKICBfX2RlY29yYXRlUGFyYW0oMSwgZWxhbkdlbmVyaWNQYXJhbVQxVHlwZSgpKQpdLCBFbGFuQXJyYXkucHJvdG90eXBlLCAicHV0IiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFsiaW5kZXgiLCAidmFsdWUiXSwgMCAvKiBwdXJlICovLCBFbGFuQ2xhc3MoRWxhbkFycmF5KSksCiAgX19kZWNvcmF0ZVBhcmFtKDAsIGVsYW5JbnRUeXBlKCkpLAogIF9fZGVjb3JhdGVQYXJhbSgxLCBlbGFuR2VuZXJpY1BhcmFtVDFUeXBlKCkpCl0sIEVsYW5BcnJheS5wcm90b3R5cGUsICJ3aXRoUHV0IiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFtdLCAwIC8qIHB1cmUgKi8sIEVsYW5JbnQpCl0sIEVsYW5BcnJheS5wcm90b3R5cGUsICJsZW5ndGgiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oWyJpdGVtIl0sIDAgLyogcHVyZSAqLywgRWxhbkludCksCiAgX19kZWNvcmF0ZVBhcmFtKDAsIGVsYW5HZW5lcmljUGFyYW1UMVR5cGUoKSkKXSwgRWxhbkFycmF5LnByb3RvdHlwZSwgImluZGV4T2YiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oWyJpdGVtIl0sIDAgLyogcHVyZSAqLyksCiAgX19kZWNvcmF0ZVBhcmFtKDAsIGVsYW5HZW5lcmljUGFyYW1UMVR5cGUoKSkKXSwgRWxhbkFycmF5LnByb3RvdHlwZSwgImNvbnRhaW5zIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFtdLCAwIC8qIHB1cmUgKi8sIEVsYW5DbGFzc05hbWUoIkVsYW5TZXQiKSkKXSwgRWxhbkFycmF5LnByb3RvdHlwZSwgImFzU2V0IiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFtdLCAwIC8qIHB1cmUgKi8sIEVsYW5DbGFzc05hbWUoIkxpc3QiKSkKXSwgRWxhbkFycmF5LnByb3RvdHlwZSwgImFzTGlzdCIsIDEpOwpFbGFuQXJyYXkgPSBfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5DbGFzcyg0IC8qIGFycmF5ICovLCBbRWxhblQxXSwgWyJzaXplIiwgImluaXRpYWxWYWx1ZSJdLCBbRWxhbkludCwgRWxhblQxXSwgW10sICJBcnJheSIpCl0sIEVsYW5BcnJheSk7CgovLyBzcmMvY29tcGlsZXIvc3RhbmRhcmQtbGlicmFyeS9lbGFuLXNldC50cwp2YXIgRWxhblNldCA9IGNsYXNzIHsKICAvLyB0aGlzIG11c3QgYmUgaW1wbGVtZW50ZWQgYnkgaGFuZCBvbiBhbGwgc3RkbGliIGNsYXNzZXMKICBzdGF0aWMgZW1wdHlJbnN0YW5jZSgpIHsKICAgIHJldHVybiBuZXcgRWxhblNldCgpOwogIH0KICBhc3luYyBfaW5pdGlhbGlzZSgpIHsKICAgIHJldHVybiB0aGlzOwogIH0KICBfc3lzdGVtOwogIHNldCBzeXN0ZW0odmFsdWUpIHsKICAgIHRoaXMuX3N5c3RlbSA9IHZhbHVlOwogIH0KICBnZXQgc3lzdGVtKCkgewogICAgcmV0dXJuIHRoaXMuX3N5c3RlbTsKICB9CiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnkKICBzdGRsaWI7CiAgLy8gaW5qZWN0ZWQKICBjb25zdHJ1Y3RvcihhcnIpIHsKICAgIHRoaXMuY29udGVudHMgPSBhcnIgPyBuZXcgU2V0KGFycikgOiAvKiBAX19QVVJFX18gKi8gbmV3IFNldCgpOwogIH0KICBjb250ZW50czsKICBjb3B5T2ZUaGlzKCkgewogICAgY29uc3QgY29weSA9IHRoaXMuc3lzdGVtLmluaXRpYWxpc2UobmV3IEVsYW5TZXQoKSk7CiAgICBjb3B5LmNvbnRlbnRzID0gbmV3IFNldCh0aGlzLmNvbnRlbnRzKTsKICAgIHJldHVybiBjb3B5OwogIH0KICBsZW5ndGgoKSB7CiAgICByZXR1cm4gdGhpcy5jb250ZW50cy5zaXplOwogIH0KICBjb250YWlucyhpdGVtKSB7CiAgICByZXR1cm4gdGhpcy5jb250ZW50cy5oYXMoaXRlbSk7CiAgfQogIGFkZChpdGVtKSB7CiAgICBjb25zdCBjb3B5ID0gdGhpcy5jb3B5T2ZUaGlzKCk7CiAgICBjb3B5LmNvbnRlbnRzLmFkZChpdGVtKTsKICAgIHJldHVybiBjb3B5OwogIH0KICBhZGRGcm9tTGlzdChsaXN0KSB7CiAgICBjb25zdCBjb3B5ID0gdGhpcy5jb3B5T2ZUaGlzKCk7CiAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgbGlzdCkgewogICAgICBjb3B5LmNvbnRlbnRzLmFkZChpdGVtKTsKICAgIH0KICAgIHJldHVybiBjb3B5OwogIH0KICByZW1vdmUoaXRlbSkgewogICAgY29uc3QgY29weSA9IHRoaXMuY29weU9mVGhpcygpOwogICAgY29weS5jb250ZW50cy5kZWxldGUoaXRlbSk7CiAgICByZXR1cm4gY29weTsKICB9CiAgdW5pb24ob3RoZXIpIHsKICAgIGNvbnN0IGNvcHkgPSB0aGlzLmNvcHlPZlRoaXMoKTsKICAgIGNvcHkuY29udGVudHMgPSB0aGlzLmNvbnRlbnRzLnVuaW9uKG90aGVyLmNvbnRlbnRzKTsKICAgIHJldHVybiBjb3B5OwogIH0KICBkaWZmZXJlbmNlKG90aGVyKSB7CiAgICBjb25zdCBjb3B5ID0gdGhpcy5jb3B5T2ZUaGlzKCk7CiAgICBjb3B5LmNvbnRlbnRzID0gdGhpcy5jb250ZW50cy5kaWZmZXJlbmNlKG90aGVyLmNvbnRlbnRzKTsKICAgIHJldHVybiBjb3B5OwogIH0KICBpbnRlcnNlY3Rpb24ob3RoZXIpIHsKICAgIGNvbnN0IGNvcHkgPSB0aGlzLmNvcHlPZlRoaXMoKTsKICAgIGNvcHkuY29udGVudHMgPSB0aGlzLmNvbnRlbnRzLmludGVyc2VjdGlvbihvdGhlci5jb250ZW50cyk7CiAgICByZXR1cm4gY29weTsKICB9CiAgaXNEaXNqb2ludEZyb20ob3RoZXIpIHsKICAgIHJldHVybiB0aGlzLmNvbnRlbnRzLmlzRGlzam9pbnRGcm9tKG90aGVyLmNvbnRlbnRzKTsKICB9CiAgaXNTdWJzZXRPZihvdGhlcikgewogICAgcmV0dXJuIHRoaXMuY29udGVudHMuaXNTdWJzZXRPZihvdGhlci5jb250ZW50cyk7CiAgfQogIGlzU3VwZXJzZXRPZihvdGhlcikgewogICAgcmV0dXJuIHRoaXMuY29udGVudHMuaXNTdXBlcnNldE9mKG90aGVyLmNvbnRlbnRzKTsKICB9CiAgYXNMaXN0KCkgewogICAgcmV0dXJuIHRoaXMuc3lzdGVtLmluaXRpYWxpc2UobmV3IExpc3QoQXJyYXkuZnJvbSh0aGlzLmNvbnRlbnRzKSkpOwogIH0KICBhc3luYyBhc1N0cmluZygpIHsKICAgIGNvbnN0IGxpc3RJbW0gPSB0aGlzLnN5c3RlbS5pbml0aWFsaXNlKG5ldyBMaXN0SW1tdXRhYmxlKEFycmF5LmZyb20odGhpcy5jb250ZW50cykpKTsKICAgIHJldHVybiBhd2FpdCB0aGlzLnN0ZGxpYi5hc1N0cmluZyhsaXN0SW1tKTsKICB9Cn07Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFtdLCAwIC8qIHB1cmUgKi8sIEVsYW5JbnQpCl0sIEVsYW5TZXQucHJvdG90eXBlLCAibGVuZ3RoIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFtdLCAwIC8qIHB1cmUgKi8sIEVsYW5Cb29sZWFuKSwKICBfX2RlY29yYXRlUGFyYW0oMCwgZWxhbkdlbmVyaWNQYXJhbVQxVHlwZSgpKQpdLCBFbGFuU2V0LnByb3RvdHlwZSwgImNvbnRhaW5zIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFtdLCAwIC8qIHB1cmUgKi8sIEVsYW5DbGFzcyhFbGFuU2V0KSksCiAgX19kZWNvcmF0ZVBhcmFtKDAsIGVsYW5HZW5lcmljUGFyYW1UMVR5cGUoKSkKXSwgRWxhblNldC5wcm90b3R5cGUsICJhZGQiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oW10sIDAgLyogcHVyZSAqLywgRWxhbkNsYXNzKEVsYW5TZXQpKSwKICBfX2RlY29yYXRlUGFyYW0oMCwgZWxhbkNsYXNzVHlwZShMaXN0KSkKXSwgRWxhblNldC5wcm90b3R5cGUsICJhZGRGcm9tTGlzdCIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbXSwgNCAvKiBpbXB1cmUgKi8sIEVsYW5DbGFzcyhFbGFuU2V0KSksCiAgX19kZWNvcmF0ZVBhcmFtKDAsIGVsYW5HZW5lcmljUGFyYW1UMVR5cGUoKSkKXSwgRWxhblNldC5wcm90b3R5cGUsICJyZW1vdmUiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oW10sIDAgLyogcHVyZSAqLywgRWxhbkNsYXNzKEVsYW5TZXQpKSwKICBfX2RlY29yYXRlUGFyYW0oMCwgZWxhbkNsYXNzVHlwZShFbGFuU2V0KSkKXSwgRWxhblNldC5wcm90b3R5cGUsICJ1bmlvbiIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbXSwgMCAvKiBwdXJlICovLCBFbGFuQ2xhc3MoRWxhblNldCkpLAogIF9fZGVjb3JhdGVQYXJhbSgwLCBlbGFuQ2xhc3NUeXBlKEVsYW5TZXQpKQpdLCBFbGFuU2V0LnByb3RvdHlwZSwgImRpZmZlcmVuY2UiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oW10sIDAgLyogcHVyZSAqLywgRWxhbkNsYXNzKEVsYW5TZXQpKSwKICBfX2RlY29yYXRlUGFyYW0oMCwgZWxhbkNsYXNzVHlwZShFbGFuU2V0KSkKXSwgRWxhblNldC5wcm90b3R5cGUsICJpbnRlcnNlY3Rpb24iLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oW10sIDAgLyogcHVyZSAqLyksCiAgX19kZWNvcmF0ZVBhcmFtKDAsIGVsYW5DbGFzc1R5cGUoRWxhblNldCkpCl0sIEVsYW5TZXQucHJvdG90eXBlLCAiaXNEaXNqb2ludEZyb20iLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oW10sIDAgLyogcHVyZSAqLywgRWxhbkJvb2xlYW4pLAogIF9fZGVjb3JhdGVQYXJhbSgwLCBlbGFuQ2xhc3NUeXBlKEVsYW5TZXQpKQpdLCBFbGFuU2V0LnByb3RvdHlwZSwgImlzU3Vic2V0T2YiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oW10sIDAgLyogcHVyZSAqLywgRWxhbkJvb2xlYW4pLAogIF9fZGVjb3JhdGVQYXJhbSgwLCBlbGFuQ2xhc3NUeXBlKEVsYW5TZXQpKQpdLCBFbGFuU2V0LnByb3RvdHlwZSwgImlzU3VwZXJzZXRPZiIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbXSwgMCAvKiBwdXJlICovLCBFbGFuQ2xhc3MoTGlzdCkpCl0sIEVsYW5TZXQucHJvdG90eXBlLCAiYXNMaXN0IiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFtdLCAyIC8qIHB1cmVBc3luYyAqLywgRWxhblN0cmluZykKXSwgRWxhblNldC5wcm90b3R5cGUsICJhc1N0cmluZyIsIDEpOwpFbGFuU2V0ID0gX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuQ2xhc3MoMiAvKiByZWNvcmQgKi8sIFtFbGFuVDFdLCBbXSwgW10sIFtdLCAiU2V0IikKXSwgRWxhblNldCk7CgovLyBzcmMvY29tcGlsZXIvc3lzdGVtLnRzCnZhciBTeXN0ZW0gPSBjbGFzcyB7CiAgY29uc3RydWN0b3IoZWxhbklucHV0T3V0cHV0KSB7CiAgICB0aGlzLmVsYW5JbnB1dE91dHB1dCA9IGVsYW5JbnB1dE91dHB1dDsKICB9CiAgX3N0ZGxpYjsKICBzZXQgc3RkbGliKHN0ZGxpYikgewogICAgdGhpcy5fc3RkbGliID0gc3RkbGliOwogIH0KICAvLyBjb25zdGFudCBpbW11dGFibGVzCiAgZW1wdHlJbW11dGFibGVMaXN0U2luZ2xldG9uID0gdGhpcy5pbml0aWFsaXNlKG5ldyBMaXN0SW1tdXRhYmxlKFtdKSk7CiAgZW1wdHlEaWN0aW9uYXJ5SW1tdXRhYmxlU2luZ2xldG9uID0gdGhpcy5kaWN0aW9uYXJ5SW1tdXRhYmxlKFtdKTsKICBlbXB0eVJlZ0V4cFNpbmdsZXRvbiA9IC8oPzopLzsKICBlbXB0eVJlZ0V4cCgpIHsKICAgIHJldHVybiB0aGlzLmVtcHR5UmVnRXhwU2luZ2xldG9uOwogIH0KICBlbXB0eVR1cGxlKHRvSW5pdCkgewogICAgY29uc3QgdCA9IFsuLi50b0luaXRdOwogICAgcmV0dXJuIHRoaXMudHVwbGUodCk7CiAgfQogIGVtcHR5RnVuYyhydCkgewogICAgcmV0dXJuICgpID0+IHJ0OwogIH0KICB0dXBsZSh0KSB7CiAgICByZXR1cm4gdDsKICB9CiAgbGlzdEltbXV0YWJsZSh0KSB7CiAgICByZXR1cm4gdGhpcy5pbml0aWFsaXNlKG5ldyBMaXN0SW1tdXRhYmxlKHQpKTsKICB9CiAgZGljdGlvbmFyeSh0KSB7CiAgICByZXR1cm4gdGhpcy5pbml0aWFsaXNlKG5ldyBEaWN0aW9uYXJ5KHQpKTsKICB9CiAgZGljdGlvbmFyeUltbXV0YWJsZSh0KSB7CiAgICByZXR1cm4gdGhpcy5pbml0aWFsaXNlKG5ldyBEaWN0aW9uYXJ5SW1tdXRhYmxlKHQpKTsKICB9CiAgbGlzdCh0KSB7CiAgICByZXR1cm4gdGhpcy5pbml0aWFsaXNlKG5ldyBMaXN0KHQpKTsKICB9CiAgaW5pdGlhbGlzZSh0b0luaXQpIHsKICAgIGlmICgic3lzdGVtIiBpbiB0b0luaXQpIHsKICAgICAgdG9Jbml0LnN5c3RlbSA9IHRoaXM7CiAgICB9CiAgICBpZiAoInN0ZGxpYiIgaW4gdG9Jbml0KSB7CiAgICAgIHRvSW5pdC5zdGRsaWIgPSB0aGlzLl9zdGRsaWI7CiAgICB9CiAgICByZXR1cm4gdG9Jbml0OwogIH0KICBlbXB0eUNsYXNzKHR5cGUsIHByb3BlcnRpZXMpIHsKICAgIGNvbnN0IHQgPSBPYmplY3QuY3JlYXRlKHR5cGUucHJvdG90eXBlKTsKICAgIGZvciAoY29uc3QgcCBvZiBwcm9wZXJ0aWVzKSB7CiAgICAgIHRbcFswXV0gPSBwWzFdOwogICAgfQogICAgcmV0dXJuIHQ7CiAgfQogIHNhZmVJbmRleChpbmRleGFibGUsIGluZGV4MSwgaW5kZXgyKSB7CiAgICBpZiAodHlwZW9mIGluZGV4YWJsZSAhPT0gInN0cmluZyIgJiYgInNhZmVJbmRleCIgaW4gaW5kZXhhYmxlKSB7CiAgICAgIHJldHVybiBpbmRleGFibGUuc2FmZUluZGV4KGluZGV4MSwgaW5kZXgyKTsKICAgIH0KICAgIGlmIChpbmRleGFibGUgPT09IHZvaWQgMCkgewogICAgICB0aHJvdyBuZXcgRWxhblJ1bnRpbWVFcnJvcihgT3V0IG9mIHJhbmdlIGluZGV4YCk7CiAgICB9CiAgICBjb25zdCByID0gaW5kZXhhYmxlW2luZGV4MV07CiAgICBpZiAociA9PT0gdm9pZCAwKSB7CiAgICAgIHRoaXMudGhyb3dSYW5nZUVycm9yKGluZGV4YWJsZSwgaW5kZXgxKTsKICAgIH0KICAgIHJldHVybiByOwogIH0KICBzYWZlU2xpY2UoaW5kZXhhYmxlLCBpbmRleDEsIGluZGV4MikgewogICAgaWYgKGluZGV4YWJsZSA9PT0gdm9pZCAwKSB7CiAgICAgIHRocm93IG5ldyBFbGFuUnVudGltZUVycm9yKGBPdXQgb2YgcmFuZ2UgaW5kZXhgKTsKICAgIH0KICAgIGlmICh0eXBlb2YgaW5kZXhhYmxlICE9PSAic3RyaW5nIiAmJiAic2FmZVNsaWNlIiBpbiBpbmRleGFibGUpIHsKICAgICAgcmV0dXJuIGluZGV4YWJsZS5zYWZlU2xpY2UoaW5kZXgxLCBpbmRleDIpOwogICAgfQogICAgaWYgKHR5cGVvZiBpbmRleGFibGUgIT09ICJzdHJpbmciKSB7CiAgICAgIHRocm93IG5ldyBFbGFuUnVudGltZUVycm9yKGBPdXQgb2YgcmFuZ2UgaW5kZXhgKTsKICAgIH0KICAgIGlmIChpbmRleDEgJiYgaW5kZXgxIDwgMCkgewogICAgICB0aGlzLnRocm93UmFuZ2VFcnJvcihpbmRleGFibGUsIGluZGV4MSk7CiAgICB9CiAgICBpZiAoaW5kZXgyICYmIGluZGV4MiA8IDApIHsKICAgICAgdGhpcy50aHJvd1JhbmdlRXJyb3IoaW5kZXhhYmxlLCBpbmRleDIpOwogICAgfQogICAgcmV0dXJuIGluZGV4YWJsZS5zbGljZShpbmRleDEsIGluZGV4Mik7CiAgfQogIHRocm93UmFuZ2VFcnJvcih0b0luZGV4LCBpbmRleCkgewogICAgY29uc3Qgc2l6ZSA9IHRvSW5kZXgubGVuZ3RoOwogICAgaWYgKHNpemUgIT09IHZvaWQgMCkgewogICAgICB0aHJvdyBuZXcgRWxhblJ1bnRpbWVFcnJvcihgT3V0IG9mIHJhbmdlIGluZGV4OiAke2luZGV4fSBzaXplOiAke3NpemV9YCk7CiAgICB9CiAgICB0aHJvdyBuZXcgRWxhblJ1bnRpbWVFcnJvcihgTm8gc3VjaCBrZXk6ICR7aW5kZXh9YCk7CiAgfQogIHRocm93S2V5RXJyb3IoaW5kZXgpIHsKICAgIHRocm93IG5ldyBFbGFuUnVudGltZUVycm9yKGBObyBzdWNoIGtleTogJHtpbmRleH1gKTsKICB9CiAgc2FmZUxpc3RTZXQodG9JbmRleCwgaW5kZXgsIHZhbHVlKSB7CiAgICBjb25zdCBzaXplID0gdG9JbmRleC5sZW5ndGg7CiAgICBpZiAoaW5kZXggPj0gc2l6ZSkgewogICAgICB0aHJvdyBuZXcgRWxhblJ1bnRpbWVFcnJvcihgT3V0IG9mIHJhbmdlIGluZGV4OiAke2luZGV4fSBzaXplOiAke3NpemV9YCk7CiAgICB9CiAgICB0b0luZGV4W2luZGV4XSA9IHZhbHVlOwogIH0KICBzYWZlQXJyYXkyRFNldCh0b0luZGV4LCBjb2wsIHJvdywgdmFsdWUpIHsKICAgIGNvbnN0IHNpemUgPSB0b0luZGV4Lmxlbmd0aDsKICAgIGlmIChjb2wgPj0gc2l6ZSkgewogICAgICB0aHJvdyBuZXcgRWxhblJ1bnRpbWVFcnJvcihgT3V0IG9mIHJhbmdlIGluZGV4OiAke2NvbH0gc2l6ZTogJHtzaXplfWApOwogICAgfQogICAgdGhpcy5zYWZlTGlzdFNldCh0b0luZGV4W2NvbF0sIHJvdywgdmFsdWUpOwogIH0KICBhc3luYyBwcmludExpbmUocykgewogICAgY29uc3Qgc3MgPSBhd2FpdCB0aGlzLl9zdGRsaWIuYXNTdHJpbmcocyk7CiAgICBhd2FpdCB0aGlzLmVsYW5JbnB1dE91dHB1dC5wcmludExpbmUoc3MpOwogIH0KICBhc3luYyBpbnB1dCgpIHsKICAgIHJldHVybiBhd2FpdCB0aGlzLmVsYW5JbnB1dE91dHB1dC5yZWFkTGluZSgpOwogIH0KICBlcXVhbHMoaTEsIGkyKSB7CiAgICBjb25zdCB0ID0gdHlwZW9mIGkxOwogICAgaWYgKHQgPT09ICJib29sZWFuIiB8fCB0ID09PSAic3RyaW5nIiB8fCB0ID09PSAibnVtYmVyIikgewogICAgICByZXR1cm4gaTEgPT09IGkyOwogICAgfQogICAgcmV0dXJuIHRoaXMub2JqZWN0RXF1YWxzKGkxLCBpMik7CiAgfQogIG9iamVjdEVxdWFscyhvMSwgbzIpIHsKICAgIGlmIChvMSA9PT0gbzIpIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICBpZiAobzE/LmNvbnN0cnVjdG9yPy5uYW1lICE9PSBvMj8uY29uc3RydWN0b3I/Lm5hbWUpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgaWYgKG8xPy5jb25zdHJ1Y3Rvcj8ubmFtZSA9PT0gbzI/LmNvbnN0cnVjdG9yPy5uYW1lICYmIG8yPy5jb25zdHJ1Y3Rvcj8ubmFtZSA9PT0gIkZ1bmN0aW9uIikgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAoImVxdWFscyIgaW4gbzEpIHsKICAgICAgcmV0dXJuIG8xLmVxdWFscyhvMik7CiAgICB9CiAgICBjb25zdCBvMWl0ZW1zID0gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMobzEpOwogICAgY29uc3QgbzJpdGVtcyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKG8yKTsKICAgIGlmIChvMWl0ZW1zLmxlbmd0aCAhPT0gbzJpdGVtcy5sZW5ndGgpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgaWYgKG8xaXRlbXMuam9pbigpICE9PSBvMml0ZW1zLmpvaW4oKSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBmb3IgKGNvbnN0IGkgb2YgbzFpdGVtcy5maWx0ZXIoKGkyKSA9PiAhaTIuc3RhcnRzV2l0aCgiXyIpKSkgewogICAgICBpZiAoIXRoaXMuZXF1YWxzKG8xW2ldLCBvMltpXSkpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiB0cnVlOwogIH0KICBhc3luYyBhc3NlcnQoYWN0dWFsRnVuYywgZXhwZWN0ZWQsIGh0bWxJZCwgc3RkbGliLCBpZ25vcmVkKSB7CiAgICBpZiAoaWdub3JlZCkgewogICAgICByZXR1cm4gbmV3IEFzc2VydE91dGNvbWUoMiAvKiBpZ25vcmVkICovLCAiIiwgIiIsIGh0bWxJZCk7CiAgICB9CiAgICB0cnkgewogICAgICBjb25zdCBhY3R1YWwgPSBhd2FpdCBhY3R1YWxGdW5jKCk7CiAgICAgIHJldHVybiBhd2FpdCB0aGlzLmRvQXNzZXJ0KGFjdHVhbCwgZXhwZWN0ZWQsIGh0bWxJZCwgc3RkbGliKTsKICAgIH0gY2F0Y2ggKGVycikgewogICAgICByZXR1cm4gYXdhaXQgdGhpcy5kb0Fzc2VydChlcnIubWVzc2FnZSwgZXhwZWN0ZWQsIGh0bWxJZCwgc3RkbGliKTsKICAgIH0KICB9CiAgYXN5bmMgZG9Bc3NlcnQoYWN0dWFsLCBleHBlY3RlZCwgaHRtbElkLCBzdGRsaWIpIHsKICAgIGlmICghdGhpcy5lcXVhbHMoYWN0dWFsLCBleHBlY3RlZCkpIHsKICAgICAgcmV0dXJuIG5ldyBBc3NlcnRPdXRjb21lKAogICAgICAgIDEgLyogZmFpbCAqLywKICAgICAgICBgJHthd2FpdCBzdGRsaWIuYXNTdHJpbmcoYWN0dWFsKX1gLAogICAgICAgIGAke2F3YWl0IHN0ZGxpYi5hc1N0cmluZyhleHBlY3RlZCl9YCwKICAgICAgICBodG1sSWQKICAgICAgKTsKICAgIH0KICAgIHJldHVybiBuZXcgQXNzZXJ0T3V0Y29tZSgKICAgICAgNCAvKiBwYXNzICovLAogICAgICBgJHthd2FpdCBzdGRsaWIuYXNTdHJpbmcoYWN0dWFsKX1gLAogICAgICBgJHthd2FpdCBzdGRsaWIuYXNTdHJpbmcoZXhwZWN0ZWQpfWAsCiAgICAgIGh0bWxJZAogICAgKTsKICB9CiAgZGVjb25zdHJ1Y3RMaXN0KGxpc3QpIHsKICAgIHJldHVybiBsaXN0LmRlY29uc3RydWN0TGlzdCgpOwogIH0KICB1bmhhbmRsZWRFeHByZXNzaW9uKHYpIHsKICAgIGNvbnN0IHMgPSB0aGlzLl9zdGRsaWIuYXNTdHJpbmcodik7CiAgICB0aHJvdyBuZXcgRWxhblJ1bnRpbWVFcnJvcihgJyR7c30nIG5vdCBjb3ZlcmVkIGluIHN3aXRjaCBzdGF0ZW1lbnRgKTsKICB9CiAgYXN5bmMgcnVuVGVzdHModGVzdHMpIHsKICAgIGNvbnN0IGFsbE91dGNvbWVzID0gW107CiAgICBmb3IgKGNvbnN0IHQgb2YgdGVzdHMpIHsKICAgICAgY29uc3Qgb3V0Y29tZXMgPSBbXTsKICAgICAgY29uc3QgdGVzdElkID0gdFswXTsKICAgICAgdHJ5IHsKICAgICAgICBhd2FpdCB0WzFdKG91dGNvbWVzKTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGNvbnN0IG1zZyA9IGUubWVzc2FnZSB8fCAiVGVzdCB0aHJldyBlcnJvciI7CiAgICAgICAgb3V0Y29tZXMucHVzaChuZXcgQXNzZXJ0T3V0Y29tZSgwIC8qIGVycm9yICovLCBtc2csICIiLCAiIiwgZSkpOwogICAgICB9CiAgICAgIGFsbE91dGNvbWVzLnB1c2goW3Rlc3RJZCwgb3V0Y29tZXNdKTsKICAgIH0KICAgIHRlc3RzLmxlbmd0aCA9IDA7CiAgICByZXR1cm4gYWxsT3V0Y29tZXM7CiAgfQogIGlnbm9yZWRQcm9wZXJ0eShzKSB7CiAgICByZXR1cm4gcyA9PT0gInN5c3RlbSIgfHwgcyA9PT0gInN0ZGxpYiIgfHwgcy5zdGFydHNXaXRoKCJfIik7CiAgfQogIGFzeW5jIGFzQ2xvbmVhYmxlT2JqZWN0KHYpIHsKICAgIGlmICh0eXBlb2YgdiA9PT0gImJvb2xlYW4iIHx8IHR5cGVvZiB2ID09PSAic3RyaW5nIiB8fCB0eXBlb2YgdiA9PT0gIm51bWJlciIpIHsKICAgICAgcmV0dXJuIHY7CiAgICB9CiAgICBpZiAodiBpbnN0YW5jZW9mIFJlZ0V4cCkgewogICAgICByZXR1cm4gYC8ke3Yuc291cmNlfS9gOwogICAgfQogICAgaWYgKCJhc0Nsb25lYWJsZU9iamVjdCIgaW4gdikgewogICAgICByZXR1cm4gYXdhaXQgdi5hc0Nsb25lYWJsZU9iamVjdCgpOwogICAgfQogICAgaWYgKHR5cGVvZiB2W1N5bWJvbC5pdGVyYXRvcl0gPT09ICJmdW5jdGlvbiIpIHsKICAgICAgY29uc3QgYXJyID0gW107CiAgICAgIGZvciAoY29uc3QgbyBvZiB2KSB7CiAgICAgICAgYXJyLnB1c2goYXdhaXQgdGhpcy5hc0Nsb25lYWJsZU9iamVjdChvKSk7CiAgICAgIH0KICAgICAgcmV0dXJuIGFycjsKICAgIH0KICAgIGNvbnN0IGdldHRlcnMgPSBbXTsKICAgIGNvbnN0IHByb3RvID0gT2JqZWN0LmdldFByb3RvdHlwZU9mKHYpOwogICAgY29uc3QgZGVzY3JpcHRvcnMgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9ycyhwcm90byk7CiAgICBjb25zdCBkS2V5cyA9IE9iamVjdC5rZXlzKGRlc2NyaXB0b3JzKTsKICAgIGZvciAoY29uc3QgZCBvZiBkS2V5cykgewogICAgICBjb25zdCBkZCA9IGRlc2NyaXB0b3JzW2RdOwogICAgICBjb25zdCBpc0dldCA9IGRkLmdldDsKICAgICAgaWYgKGlzR2V0KSB7CiAgICAgICAgZ2V0dGVycy5wdXNoKGQpOwogICAgICB9CiAgICB9CiAgICBjb25zdCBjbG9uZSA9IHt9OwogICAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKHYpLmZpbHRlcigoaykgPT4gIXRoaXMuaWdub3JlZFByb3BlcnR5KGspKTsKICAgIGNvbnN0IGtleVNldCA9IG5ldyBTZXQoa2V5cy5jb25jYXQoZ2V0dGVycykpOwogICAgZm9yIChjb25zdCBrIG9mIGtleVNldCkgewogICAgICBjbG9uZVtrXSA9IGF3YWl0IHRoaXMuYXNDbG9uZWFibGVPYmplY3QodltrXSk7CiAgICB9CiAgICByZXR1cm4gY2xvbmU7CiAgfQogIGFzeW5jIGRlYnVnU3ltYm9sKGlkLCBzeW1ib2wsIHR5cGVNYXApIHsKICAgIGNvbnN0IGFzQ2xvbmVhYmxlID0gYXdhaXQgdGhpcy5hc0Nsb25lYWJsZU9iamVjdChzeW1ib2wpOwogICAgdHJ5IHsKICAgICAgcmV0dXJuIHsKICAgICAgICBuYW1lOiBpZCwKICAgICAgICB2YWx1ZTogYXNDbG9uZWFibGUsCiAgICAgICAgdHlwZU1hcAogICAgICB9OwogICAgfSBjYXRjaCAoX2UpIHsKICAgICAgcmV0dXJuICJlcnJvciByZXNvbHZpbmciOwogICAgfQogIH0KICBlbGFuSW5kZXhPZihsaXN0LCBlbGVtKSB7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgY29uc3QgaXRlbSA9IGxpc3RbaV07CiAgICAgIGlmICh0aGlzLmVxdWFscyhpdGVtLCBlbGVtKSkgewogICAgICAgIHJldHVybiBpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gLTE7CiAgfQogIGVsYW4yREluZGV4T2YobGlzdCwgZWxlbSkgewogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsaXN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgIGNvbnN0IHN1YkFyciA9IGxpc3RbaV07CiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgc3ViQXJyLmxlbmd0aDsgaisrKSB7CiAgICAgICAgY29uc3QgaXRlbSA9IHN1YkFycltqXTsKICAgICAgICBpZiAodGhpcy5lcXVhbHMoaXRlbSwgZWxlbSkpIHsKICAgICAgICAgIHJldHVybiBbaSwgal07CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gWy0xLCAtMV07CiAgfQogIGFzeW5jIGFzU3RyaW5nKGEpIHsKICAgIHJldHVybiBhd2FpdCB0aGlzLl9zdGRsaWIuYXNTdHJpbmcoYSk7CiAgfQogIGFzeW5jIGJyZWFrUG9pbnQoYWxsU2NvcGVkU3ltYm9sczIsIGlkLCBzaW5nbGVzdGVwLCBwYXVzZSkgewogICAgaWYgKHNpbmdsZXN0ZXAgJiYgIXBhdXNlKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHJldHVybiBhd2FpdCB0aGlzLmVsYW5JbnB1dE91dHB1dC5icmVha1BvaW50KGFsbFNjb3BlZFN5bWJvbHMyLCBpZCwgc2luZ2xlc3RlcCk7CiAgfQogIGFzeW5jIGdldFBpdm90KHgsIHksIHosIGNvbXBhcmUpIHsKICAgIGlmIChhd2FpdCBjb21wYXJlKHgsIHkpIDwgMCkgewogICAgICBpZiAoYXdhaXQgY29tcGFyZSh5LCB6KSA8IDApIHsKICAgICAgICByZXR1cm4geTsKICAgICAgfSBlbHNlIGlmIChhd2FpdCBjb21wYXJlKHosIHgpIDwgMCkgewogICAgICAgIHJldHVybiB4OwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiB6OwogICAgICB9CiAgICB9IGVsc2UgaWYgKGF3YWl0IGNvbXBhcmUoeSwgeikgPiAwKSB7CiAgICAgIHJldHVybiB5OwogICAgfSBlbHNlIGlmIChhd2FpdCBjb21wYXJlKHosIHgpID4gMCkgewogICAgICByZXR1cm4geDsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiB6OwogICAgfQogIH0KICAvLyBmcm9tIGdpdGh1YiBodHRwczovL2dpc3QuZ2l0aHViLmNvbS9raW1hbXVsYS9mYTM0MTkwZGI2MjQyMzkxMTFiYmUwZGViYTcyYTZhYgogIGFzeW5jIHF1aWNrU29ydChhcnIsIGNvbXBhcmUsIGxlZnQgPSAwLCByaWdodCA9IGFyci5sZW5ndGggLSAxKSB7CiAgICBpZiAobGVmdCA8IHJpZ2h0KSB7CiAgICAgIGxldCBpID0gbGVmdCwgaiA9IHJpZ2h0LCB0bXA7CiAgICAgIGNvbnN0IHBpdm90ID0gYXdhaXQgdGhpcy5nZXRQaXZvdChhcnJbaV0sIGFycltpICsgTWF0aC5mbG9vcigoaiAtIGkpIC8gMildLCBhcnJbal0sIGNvbXBhcmUpOwogICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgIHdoaWxlIChhd2FpdCBjb21wYXJlKGFycltpXSwgcGl2b3QpIDwgMCkgewogICAgICAgICAgaSsrOwogICAgICAgIH0KICAgICAgICB3aGlsZSAoYXdhaXQgY29tcGFyZShwaXZvdCwgYXJyW2pdKSA8IDApIHsKICAgICAgICAgIGotLTsKICAgICAgICB9CiAgICAgICAgaWYgKGkgPj0gaikgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIHRtcCA9IGFycltpXTsKICAgICAgICBhcnJbaV0gPSBhcnJbal07CiAgICAgICAgYXJyW2pdID0gdG1wOwogICAgICAgIGkrKzsKICAgICAgICBqLS07CiAgICAgIH0KICAgICAgYXdhaXQgdGhpcy5xdWlja1NvcnQoYXJyLCBjb21wYXJlLCBsZWZ0LCBpIC0gMSk7CiAgICAgIGF3YWl0IHRoaXMucXVpY2tTb3J0KGFyciwgY29tcGFyZSwgaiArIDEsIHJpZ2h0KTsKICAgIH0KICAgIHJldHVybiBhcnI7CiAgfQogIGxpc3RJbW11dGFibGVBc0xpc3QobGlzdCkgewogICAgY29uc3QgbmV3TGlzdCA9IFsuLi5saXN0XTsKICAgIHJldHVybiB0aGlzLmluaXRpYWxpc2UobmV3IExpc3QobmV3TGlzdCkpOwogIH0KICBsaXN0SW1tdXRhYmxlQXNTZXQobGlzdCkgewogICAgY29uc3QgbmV3TGlzdCA9IFsuLi5saXN0XTsKICAgIHJldHVybiB0aGlzLmluaXRpYWxpc2UobmV3IEVsYW5TZXQobmV3TGlzdCkpOwogIH0KICBsaXN0SW1tdXRhYmxlQXNBcnJheShsaXN0KSB7CiAgICBjb25zdCBuZXdMaXN0ID0gWy4uLmxpc3RdOwogICAgcmV0dXJuIHRoaXMuaW5pdGlhbGlzZShuZXcgRWxhbkFycmF5KG5ld0xpc3QpKTsKICB9CiAgbGlzdEFzTGlzdEltbXV0YWJsZShsaXN0KSB7CiAgICBjb25zdCBuZXdMaXN0ID0gWy4uLmxpc3RdOwogICAgcmV0dXJuIHRoaXMuaW5pdGlhbGlzZShuZXcgTGlzdEltbXV0YWJsZShuZXdMaXN0KSk7CiAgfQogIGxpc3RBc1NldChsaXN0KSB7CiAgICBjb25zdCBuZXdMaXN0ID0gWy4uLmxpc3RdOwogICAgcmV0dXJuIHRoaXMuaW5pdGlhbGlzZShuZXcgRWxhblNldChuZXdMaXN0KSk7CiAgfQogIGxpc3RBc0FycmF5KGxpc3QpIHsKICAgIGNvbnN0IG5ld0xpc3QgPSBbLi4ubGlzdF07CiAgICByZXR1cm4gdGhpcy5pbml0aWFsaXNlKG5ldyBFbGFuQXJyYXkobmV3TGlzdCkpOwogIH0KICBhcnJheUFzTGlzdEltbXV0YWJsZShsaXN0KSB7CiAgICBjb25zdCBuZXdMaXN0ID0gWy4uLmxpc3RdOwogICAgcmV0dXJuIHRoaXMuaW5pdGlhbGlzZShuZXcgTGlzdEltbXV0YWJsZShuZXdMaXN0KSk7CiAgfQogIGFycmF5QXNTZXQobGlzdCkgewogICAgY29uc3QgbmV3TGlzdCA9IFsuLi5saXN0XTsKICAgIHJldHVybiB0aGlzLmluaXRpYWxpc2UobmV3IEVsYW5TZXQobmV3TGlzdCkpOwogIH0KICBhcnJheUFzTGlzdChsaXN0KSB7CiAgICBjb25zdCBuZXdMaXN0ID0gWy4uLmxpc3RdOwogICAgcmV0dXJuIHRoaXMuaW5pdGlhbGlzZShuZXcgTGlzdChuZXdMaXN0KSk7CiAgfQogIGRpY3Rpb25hcnlBc0RpY3Rpb25hcnlJbW11dGFibGUoZGljdGlvbmFyeSkgewogICAgcmV0dXJuIHRoaXMuaW5pdGlhbGlzZShuZXcgRGljdGlvbmFyeUltbXV0YWJsZShbLi4uZGljdGlvbmFyeS5jb250ZW50cy5lbnRyaWVzKCldKSk7CiAgfQogIGRpY3Rpb25hcnlJbW11dGFibGVBc0RpY3Rpb25hcnkoZGljdGlvbmFyeSkgewogICAgcmV0dXJuIHRoaXMuaW5pdGlhbGlzZShuZXcgRGljdGlvbmFyeShbLi4uZGljdGlvbmFyeS5jb250ZW50cy5lbnRyaWVzKCldKSk7CiAgfQp9OwoKLy8gc3JjL2NvbXBpbGVyL3N0YW5kYXJkLWxpYnJhcnkvdmVjdG9yLWdyYXBoaWMudHMKdmFyIFZlY3RvckdyYXBoaWMgPSBjbGFzcyB7CiAgLy8gdGhpcyBtdXN0IGJlIGltcGxlbWVudGVkIGJ5IGhhbmQgb24gYWxsIHN0ZGxpYiBjbGFzc2VzCiAgc3RhdGljIGVtcHR5SW5zdGFuY2UoKSB7CiAgICByZXR1cm4gbmV3IFZlY3RvckdyYXBoaWMoKTsKICB9CiAgYXNTVkcoKSB7CiAgICByZXR1cm4gIiI7CiAgfQogIGFzQ29sb3VyKGNvbG91cikgewogICAgaWYgKGNvbG91ciA+IDE2Nzc3MjE1IHx8IGNvbG91ciA8IDApIHsKICAgICAgdGhyb3cgbmV3IEVsYW5SdW50aW1lRXJyb3IoYGNvbG91ciBtdXN0IGJlIGluIHRoZSByYW5nZSAweDAgdG8gMHhmZmZmZmYgKDAgdG8gMTY3NzcyMTUpYCk7CiAgICB9CiAgICBjb25zdCBoZXggPSBgMDAwMDAwJHtjb2xvdXIudG9TdHJpbmcoMTYpfWA7CiAgICBjb25zdCByZ2IgPSBoZXguc3Vic3RyaW5nKGhleC5sZW5ndGggLSA2LCBoZXgubGVuZ3RoKTsKICAgIHJldHVybiBgIyR7cmdifWA7CiAgfQogIHN0cm9rZUNvbG91ckFzSGV4KHN0cm9rZUNvbG91cikgewogICAgaWYgKHN0cm9rZUNvbG91ciA8IDApIHsKICAgICAgdGhyb3cgbmV3IEVsYW5SdW50aW1lRXJyb3IoYHN0cm9rZUNvbG91ciBjYW5ub3QgYmUgdHJhbnNwYXJlbnQgKG5lZ2F0aXZlIHZhbHVlKWApOwogICAgfQogICAgcmV0dXJuIHRoaXMuYXNDb2xvdXIoc3Ryb2tlQ29sb3VyKTsKICB9CiAgZmlsbENvbG91ckFzSGV4KGZpbGxDb2xvdXIpIHsKICAgIGxldCBjb2xvdXIgPSAiIjsKICAgIGlmIChmaWxsQ29sb3VyIDwgMCkgewogICAgICBjb2xvdXIgPSAibm9uZSI7CiAgICB9IGVsc2UgewogICAgICBjb2xvdXIgPSB0aGlzLmFzQ29sb3VyKGZpbGxDb2xvdXIpOwogICAgfQogICAgcmV0dXJuIGNvbG91cjsKICB9CiAgc3Ryb2tlQXNIdG1sKHN0cm9rZVdpZHRoLCBzdHJva2VDb2xvdXIpIHsKICAgIHJldHVybiBgc3Ryb2tlPSIke3RoaXMuc3Ryb2tlQ29sb3VyQXNIZXgoc3Ryb2tlQ29sb3VyKX0iIHN0cm9rZS13aWR0aD0iJHtzdHJva2VXaWR0aCAqIDAuM30lImA7CiAgfQogIGZpbGxBc0h0bWwoZmlsbENvbG91cikgewogICAgcmV0dXJuIGBmaWxsPSIke3RoaXMuZmlsbENvbG91ckFzSGV4KGZpbGxDb2xvdXIpfSJgOwogIH0KfTsKVmVjdG9yR3JhcGhpYyA9IF9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkNsYXNzKDEgLyogYWJzdHJhY3QgKi8pCl0sIFZlY3RvckdyYXBoaWMpOwoKLy8gc3JjL2NvbXBpbGVyL3N0YW5kYXJkLWxpYnJhcnkvY2lyY2xlLXZnLnRzCnZhciBDaXJjbGVWRyA9IGNsYXNzIGV4dGVuZHMgVmVjdG9yR3JhcGhpYyB7CiAgc3RhdGljIGVtcHR5SW5zdGFuY2UoKSB7CiAgICByZXR1cm4gbmV3IENpcmNsZVZHKCk7CiAgfQogIGFzeW5jIF9pbml0aWFsaXNlKCkgewogICAgcmV0dXJuIHRoaXM7CiAgfQogIHN5c3RlbTsKICBjb25zdHJ1Y3Rvcihjb3B5KSB7CiAgICBzdXBlcigpOwogICAgdGhpcy5jZW50cmVYID0gY29weSA/IGNvcHkuY2VudHJlWCA6IDUwOwogICAgdGhpcy5jZW50cmVZID0gY29weSA/IGNvcHkuY2VudHJlWSA6IDM3LjU7CiAgICB0aGlzLnJhZGl1cyA9IGNvcHkgPyBjb3B5LnJhZGl1cyA6IDEwOwogICAgdGhpcy5maWxsQ29sb3VyID0gY29weSA/IGNvcHkuZmlsbENvbG91ciA6IDE2Nzc2OTYwOwogICAgdGhpcy5zdHJva2VDb2xvdXIgPSBjb3B5ID8gY29weS5zdHJva2VDb2xvdXIgOiAwOwogICAgdGhpcy5zdHJva2VXaWR0aCA9IGNvcHkgPyBjb3B5LnN0cm9rZVdpZHRoIDogMTsKICB9CiAgY2VudHJlWCA9IDA7CiAgc2V0Q2VudHJlWChjZW50cmVYKSB7CiAgICB0aGlzLmNlbnRyZVggPSBjZW50cmVYOwogIH0KICB3aXRoQ2VudHJlWChjZW50cmVYKSB7CiAgICBjb25zdCBjb3B5ID0gdGhpcy5zeXN0ZW0uaW5pdGlhbGlzZShuZXcgQ2lyY2xlVkcodGhpcykpOwogICAgY29weS5jZW50cmVYID0gY2VudHJlWDsKICAgIHJldHVybiBjb3B5OwogIH0KICBjZW50cmVZID0gMDsKICBzZXRDZW50cmVZKGNlbnRyZVkpIHsKICAgIHRoaXMuY2VudHJlWSA9IGNlbnRyZVk7CiAgfQogIHdpdGhDZW50cmVZKGNlbnRyZVkpIHsKICAgIGNvbnN0IGNvcHkgPSB0aGlzLnN5c3RlbS5pbml0aWFsaXNlKG5ldyBDaXJjbGVWRyh0aGlzKSk7CiAgICBjb3B5LmNlbnRyZVkgPSBjZW50cmVZOwogICAgcmV0dXJuIGNvcHk7CiAgfQogIHJhZGl1cyA9IDA7CiAgc2V0UmFkaXVzKHIpIHsKICAgIHRoaXMucmFkaXVzID0gcjsKICB9CiAgd2l0aFJhZGl1cyhyKSB7CiAgICBjb25zdCBjb3B5ID0gdGhpcy5zeXN0ZW0uaW5pdGlhbGlzZShuZXcgQ2lyY2xlVkcodGhpcykpOwogICAgY29weS5yYWRpdXMgPSByOwogICAgcmV0dXJuIGNvcHk7CiAgfQogIHN0cm9rZUNvbG91ciA9IDA7CiAgc2V0U3Ryb2tlQ29sb3VyKHN0cm9rZUNvbG91cikgewogICAgdGhpcy5zdHJva2VDb2xvdXIgPSBzdHJva2VDb2xvdXI7CiAgfQogIHdpdGhTdHJva2VDb2xvdXIoc3Ryb2tlQ29sb3VyKSB7CiAgICBjb25zdCBjb3B5ID0gdGhpcy5zeXN0ZW0uaW5pdGlhbGlzZShuZXcgQ2lyY2xlVkcodGhpcykpOwogICAgY29weS5zdHJva2VDb2xvdXIgPSBzdHJva2VDb2xvdXI7CiAgICByZXR1cm4gY29weTsKICB9CiAgc3Ryb2tlV2lkdGggPSAwOwogIHNldFN0cm9rZVdpZHRoKHN0cm9rZVdpZHRoKSB7CiAgICB0aGlzLnN0cm9rZVdpZHRoID0gc3Ryb2tlV2lkdGg7CiAgfQogIHdpdGhTdHJva2VXaWR0aChzdHJva2VXaWR0aCkgewogICAgY29uc3QgY29weSA9IHRoaXMuc3lzdGVtLmluaXRpYWxpc2UobmV3IENpcmNsZVZHKHRoaXMpKTsKICAgIGNvcHkuc3Ryb2tlV2lkdGggPSBzdHJva2VXaWR0aDsKICAgIHJldHVybiBjb3B5OwogIH0KICBmaWxsQ29sb3VyID0gMDsKICBzZXRGaWxsQ29sb3VyKGZpbGxDb2xvdXIpIHsKICAgIHRoaXMuZmlsbENvbG91ciA9IGZpbGxDb2xvdXI7CiAgfQogIHdpdGhGaWxsQ29sb3VyKGZpbGxDb2xvdXIpIHsKICAgIGNvbnN0IGNvcHkgPSB0aGlzLnN5c3RlbS5pbml0aWFsaXNlKG5ldyBDaXJjbGVWRyh0aGlzKSk7CiAgICBjb3B5LmZpbGxDb2xvdXIgPSBmaWxsQ29sb3VyOwogICAgcmV0dXJuIGNvcHk7CiAgfQogIGFzU1ZHKCkgewogICAgcmV0dXJuIGA8Y2lyY2xlIGN4PSIke3RoaXMuY2VudHJlWH0lIiBjeT0iJHt0aGlzLmNlbnRyZVkgLyAwLjc1fSUiIHI9IiR7dGhpcy5yYWRpdXMgKiAxLjEyNX0lIiAke3RoaXMuc3Ryb2tlQXNIdG1sKHRoaXMuc3Ryb2tlV2lkdGgsIHRoaXMuc3Ryb2tlQ29sb3VyKX0gJHt0aGlzLmZpbGxBc0h0bWwodGhpcy5maWxsQ29sb3VyKX0vPmA7CiAgfQp9OwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5Qcm9wZXJ0eSgpCl0sIENpcmNsZVZHLnByb3RvdHlwZSwgImNlbnRyZVgiLCAyKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuUHJvY2VkdXJlKFsiY2VudHJlWCJdKQpdLCBDaXJjbGVWRy5wcm90b3R5cGUsICJzZXRDZW50cmVYIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFsiY2VudHJlWCJdLCAwIC8qIHB1cmUgKi8sIEVsYW5DbGFzcyhDaXJjbGVWRykpCl0sIENpcmNsZVZHLnByb3RvdHlwZSwgIndpdGhDZW50cmVYIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhblByb3BlcnR5KCkKXSwgQ2lyY2xlVkcucHJvdG90eXBlLCAiY2VudHJlWSIsIDIpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5Qcm9jZWR1cmUoWyJjZW50cmVZIl0pCl0sIENpcmNsZVZHLnByb3RvdHlwZSwgInNldENlbnRyZVkiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oWyJjZW50cmVZIl0sIDAgLyogcHVyZSAqLywgRWxhbkNsYXNzKENpcmNsZVZHKSkKXSwgQ2lyY2xlVkcucHJvdG90eXBlLCAid2l0aENlbnRyZVkiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuUHJvcGVydHkoKQpdLCBDaXJjbGVWRy5wcm90b3R5cGUsICJyYWRpdXMiLCAyKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuUHJvY2VkdXJlKFsicmFkaXVzIl0pCl0sIENpcmNsZVZHLnByb3RvdHlwZSwgInNldFJhZGl1cyIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbInJhZGl1cyJdLCAwIC8qIHB1cmUgKi8sIEVsYW5DbGFzcyhDaXJjbGVWRykpCl0sIENpcmNsZVZHLnByb3RvdHlwZSwgIndpdGhSYWRpdXMiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuUHJvcGVydHkoRWxhbkludCkKXSwgQ2lyY2xlVkcucHJvdG90eXBlLCAic3Ryb2tlQ29sb3VyIiwgMik7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhblByb2NlZHVyZShbImNvbG91ciJdKQpdLCBDaXJjbGVWRy5wcm90b3R5cGUsICJzZXRTdHJva2VDb2xvdXIiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oWyJjb2xvdXIiXSwgMCAvKiBwdXJlICovLCBFbGFuQ2xhc3MoQ2lyY2xlVkcpKQpdLCBDaXJjbGVWRy5wcm90b3R5cGUsICJ3aXRoU3Ryb2tlQ29sb3VyIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhblByb3BlcnR5KCkKXSwgQ2lyY2xlVkcucHJvdG90eXBlLCAic3Ryb2tlV2lkdGgiLCAyKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuUHJvY2VkdXJlKFsic3Ryb2tlV2lkdGgiXSkKXSwgQ2lyY2xlVkcucHJvdG90eXBlLCAic2V0U3Ryb2tlV2lkdGgiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oWyJ3aWR0aCJdLCAwIC8qIHB1cmUgKi8sIEVsYW5DbGFzcyhDaXJjbGVWRykpCl0sIENpcmNsZVZHLnByb3RvdHlwZSwgIndpdGhTdHJva2VXaWR0aCIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5Qcm9wZXJ0eShFbGFuSW50KQpdLCBDaXJjbGVWRy5wcm90b3R5cGUsICJmaWxsQ29sb3VyIiwgMik7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhblByb2NlZHVyZShbImZpbGxDb2xvdXIiXSkKXSwgQ2lyY2xlVkcucHJvdG90eXBlLCAic2V0RmlsbENvbG91ciIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbImNvbG91ciJdLCAwIC8qIHB1cmUgKi8sIEVsYW5DbGFzcyhDaXJjbGVWRykpCl0sIENpcmNsZVZHLnByb3RvdHlwZSwgIndpdGhGaWxsQ29sb3VyIiwgMSk7CkNpcmNsZVZHID0gX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuQ2xhc3MoMCAvKiBjb25jcmV0ZSAqLywgW10sIFtdLCBbXSwgW0VsYW5DbGFzcyhWZWN0b3JHcmFwaGljKV0pCl0sIENpcmNsZVZHKTsKCi8vIHNyYy9jb21waWxlci9zdGFuZGFyZC1saWJyYXJ5L2VsYW4tYXJyYXktMmQudHMKdmFyIEVsYW5BcnJheTJEID0gY2xhc3MgewogIC8vIHRoaXMgbXVzdCBiZSBpbXBsZW1lbnRlZCBieSBoYW5kIG9uIGFsbCBzdGRsaWIgY2xhc3NlcwogIHN0YXRpYyBlbXB0eUluc3RhbmNlKCkgewogICAgcmV0dXJuIG5ldyBFbGFuQXJyYXkyRCgpOwogIH0KICBhc3luYyBfaW5pdGlhbGlzZSh4LCB5LCB2YWx1ZSkgewogICAgaWYgKHggPD0gMCB8fCB5IDw9IDApIHsKICAgICAgdGhyb3cgbmV3IEVsYW5SdW50aW1lRXJyb3IoYEVhY2ggZGltZW5zaW9uIG9mIEFycmF5MkQgbXVzdCBiZSBub24gemVybywgcG9zaXRpdmUgdmFsdWVgKTsKICAgIH0KICAgIGlmICghKHR5cGVvZiB2YWx1ZSA9PT0gImJvb2xlYW4iIHx8IHR5cGVvZiB2YWx1ZSA9PT0gInN0cmluZyIgfHwgdHlwZW9mIHZhbHVlID09PSAibnVtYmVyIikpIHsKICAgICAgdGhyb3cgbmV3IEVsYW5SdW50aW1lRXJyb3IoCiAgICAgICAgYEFycmF5MkQgbXVzdCBiZSBvZiBUeXBlOiBJbnQsIEZsb2F0LCBTdHJpbmcsIG9yIEJvb2xlYW4sIHdpdGggbWF0Y2hpbmcgaW5pdGlhbCB2YWx1ZWAKICAgICAgKTsKICAgIH0KICAgIGNvbnN0IHRvSW5pdCA9IFtdOwogICAgdG9Jbml0Lmxlbmd0aCA9IHg7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHg7IGkrKykgewogICAgICBjb25zdCBzdWJBcnIgPSBbXTsKICAgICAgc3ViQXJyLmxlbmd0aCA9IHk7CiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgeTsgaisrKSB7CiAgICAgICAgc3ViQXJyW2pdID0gdmFsdWU7CiAgICAgIH0KICAgICAgdG9Jbml0W2ldID0gc3ViQXJyOwogICAgfQogICAgdGhpcy5jb250ZW50cyA9IHRvSW5pdDsKICAgIHJldHVybiB0aGlzOwogIH0KICBjb25zdHJ1Y3RvcihhcnIpIHsKICAgIHRoaXMuY29udGVudHMgPSBhcnIgPyBbLi4uYXJyXSA6IFtdOwogIH0KICBjb250ZW50czsKICByZWFkKHgsIHkpIHsKICAgIHJldHVybiB0aGlzLmNvbnRlbnRzW3hdW3ldOwogIH0KICBzeXN0ZW07CiAgcHV0KGNvbCwgcm93LCB2YWx1ZSkgewogICAgdGhpcy5zeXN0ZW0uc2FmZUFycmF5MkRTZXQodGhpcy5jb250ZW50cywgY29sLCByb3csIHZhbHVlKTsKICB9CiAgd2l0aFB1dChjb2wsIHJvdywgdmFsdWUpIHsKICAgIGNvbnN0IG5ld0xpc3QgPSBbLi4udGhpcy5jb250ZW50c107CiAgICB0aGlzLnN5c3RlbS5zYWZlQXJyYXkyRFNldChuZXdMaXN0LCBjb2wsIHJvdywgdmFsdWUpOwogICAgcmV0dXJuIHRoaXMuc3lzdGVtLmluaXRpYWxpc2UobmV3IEVsYW5BcnJheTJEKG5ld0xpc3QpKTsKICB9CiAgY29sdW1ucygpIHsKICAgIHJldHVybiB0aGlzLmNvbnRlbnRzLmxlbmd0aDsKICB9CiAgcm93cygpIHsKICAgIHJldHVybiB0aGlzLmNvbnRlbnRzWzBdLmxlbmd0aDsKICB9CiAgaW5kZXhPZihpdGVtKSB7CiAgICByZXR1cm4gdGhpcy5zeXN0ZW0udHVwbGUodGhpcy5zeXN0ZW0uZWxhbjJESW5kZXhPZih0aGlzLmNvbnRlbnRzLCBpdGVtKSk7CiAgfQogIGNvbnRhaW5zKGl0ZW0pIHsKICAgIGNvbnN0IFtpLCBfXSA9IHRoaXMuc3lzdGVtLmVsYW4yREluZGV4T2YodGhpcy5jb250ZW50cywgaXRlbSk7CiAgICByZXR1cm4gaSAhPT0gLTE7CiAgfQogIGFzeW5jIGFzU3RyaW5nKCkgewogICAgY29uc3QgY29sdW1ucyA9IFtdOwogICAgZm9yIChjb25zdCBjb2x1bW4gb2YgdGhpcy5jb250ZW50cykgewogICAgICBjb25zdCByb3dzID0gW107CiAgICAgIGZvciAoY29uc3Qgcm93IG9mIGNvbHVtbikgewogICAgICAgIGNvbnN0IHMgPSBhd2FpdCB0aGlzLnN5c3RlbS5hc1N0cmluZyhyb3cpOwogICAgICAgIHJvd3MucHVzaChzKTsKICAgICAgfQogICAgICBjb2x1bW5zLnB1c2goYFske3Jvd3Muam9pbigiLCAiKX1dYCk7CiAgICB9CiAgICByZXR1cm4gYFske2NvbHVtbnMuam9pbigiLCAiKX1dYDsKICB9CiAgYXN5bmMgYXNDbG9uZWFibGVPYmplY3QoKSB7CiAgICByZXR1cm4gdGhpcy5jb250ZW50czsKICB9CiAgc2FmZUluZGV4KGluZGV4MSwgaW5kZXgyKSB7CiAgICBpZiAoaW5kZXgyID09PSB2b2lkIDApIHsKICAgICAgdGhpcy5zeXN0ZW0udGhyb3dSYW5nZUVycm9yKHRoaXMuY29udGVudHMsIGluZGV4Mik7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHIgPSB0aGlzLmNvbnRlbnRzW2luZGV4MV07CiAgICBpZiAociA9PT0gdm9pZCAwKSB7CiAgICAgIHRoaXMuc3lzdGVtLnRocm93UmFuZ2VFcnJvcih0aGlzLmNvbnRlbnRzLCBpbmRleDEpOwogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCByMSA9IHJbaW5kZXgyXTsKICAgIGlmIChyMSA9PT0gdm9pZCAwKSB7CiAgICAgIHRoaXMuc3lzdGVtLnRocm93UmFuZ2VFcnJvcihyLCBpbmRleDIpOwogICAgICByZXR1cm47CiAgICB9CiAgICByZXR1cm4gcjE7CiAgfQp9OwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5Qcm9jZWR1cmUoWyJjb2x1bW4iLCAicm93IiwgInZhbHVlIl0pLAogIF9fZGVjb3JhdGVQYXJhbSgwLCBlbGFuSW50VHlwZSgpKSwKICBfX2RlY29yYXRlUGFyYW0oMSwgZWxhbkludFR5cGUoKSksCiAgX19kZWNvcmF0ZVBhcmFtKDIsIGVsYW5HZW5lcmljUGFyYW1UMVR5cGUoKSkKXSwgRWxhbkFycmF5MkQucHJvdG90eXBlLCAicHV0IiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFsiY29sdW1uIiwgInJvdyIsICJ2YWx1ZSJdLCAwIC8qIHB1cmUgKi8sIEVsYW5DbGFzcyhFbGFuQXJyYXkyRCkpLAogIF9fZGVjb3JhdGVQYXJhbSgwLCBlbGFuSW50VHlwZSgpKSwKICBfX2RlY29yYXRlUGFyYW0oMSwgZWxhbkludFR5cGUoKSksCiAgX19kZWNvcmF0ZVBhcmFtKDIsIGVsYW5HZW5lcmljUGFyYW1UMVR5cGUoKSkKXSwgRWxhbkFycmF5MkQucHJvdG90eXBlLCAid2l0aFB1dCIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbXSwgMCAvKiBwdXJlICovLCBFbGFuSW50KQpdLCBFbGFuQXJyYXkyRC5wcm90b3R5cGUsICJjb2x1bW5zIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFtdLCAwIC8qIHB1cmUgKi8sIEVsYW5JbnQpCl0sIEVsYW5BcnJheTJELnByb3RvdHlwZSwgInJvd3MiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oWyJpdGVtIl0sIDAgLyogcHVyZSAqLywgRWxhblR1cGxlKFtFbGFuSW50LCBFbGFuSW50XSkpLAogIF9fZGVjb3JhdGVQYXJhbSgwLCBlbGFuR2VuZXJpY1BhcmFtVDFUeXBlKCkpCl0sIEVsYW5BcnJheTJELnByb3RvdHlwZSwgImluZGV4T2YiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oWyJpdGVtIl0sIDAgLyogcHVyZSAqLyksCiAgX19kZWNvcmF0ZVBhcmFtKDAsIGVsYW5HZW5lcmljUGFyYW1UMVR5cGUoKSkKXSwgRWxhbkFycmF5MkQucHJvdG90eXBlLCAiY29udGFpbnMiLCAxKTsKRWxhbkFycmF5MkQgPSBfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5DbGFzcygKICAgIDUgLyogYXJyYXkyRCAqLywKICAgIFtFbGFuVDFdLAogICAgWyJjb2x1bW5zIiwgInJvd3MiLCAiaW5pdGlhbFZhbHVlIl0sCiAgICBbRWxhbkludCwgRWxhbkludCwgRWxhblQxXSwKICAgIFtdLAogICAgIkFycmF5MkQiCiAgKQpdLCBFbGFuQXJyYXkyRCk7CgovLyBzcmMvY29tcGlsZXIvc3RhbmRhcmQtbGlicmFyeS9pbWFnZS12Zy50cwp2YXIgSW1hZ2VWRyA9IGNsYXNzIGV4dGVuZHMgVmVjdG9yR3JhcGhpYyB7CiAgc3RhdGljIGVtcHR5SW5zdGFuY2UoKSB7CiAgICByZXR1cm4gbmV3IEltYWdlVkcoKTsKICB9CiAgYXN5bmMgX2luaXRpYWxpc2UodXJsKSB7CiAgICB0aGlzLnVybCA9IHVybDsKICAgIHJldHVybiB0aGlzOwogIH0KICBzeXN0ZW07CiAgY29uc3RydWN0b3IoY29weSkgewogICAgc3VwZXIoKTsKICAgIHRoaXMueCA9IGNvcHkgPyBjb3B5LnggOiAwOwogICAgdGhpcy55ID0gY29weSA/IGNvcHkueSA6IDA7CiAgICB0aGlzLndpZHRoID0gY29weSA/IGNvcHkud2lkdGggOiAxMy4yOwogICAgdGhpcy5oZWlnaHQgPSBjb3B5ID8gY29weS5oZWlnaHQgOiAxMy4yOwogICAgdGhpcy51cmwgPSBjb3B5ID8gY29weS51cmwgOiAiIjsKICAgIHRoaXMuYWx0ID0gY29weSA/IGNvcHkuYWx0IDogIiI7CiAgfQogIHggPSAwOwogIHNldFgoeCkgewogICAgdGhpcy54ID0geDsKICB9CiAgd2l0aFgoeCkgewogICAgY29uc3QgY29weSA9IHRoaXMuc3lzdGVtLmluaXRpYWxpc2UobmV3IEltYWdlVkcodGhpcykpOwogICAgY29weS54ID0geDsKICAgIHJldHVybiBjb3B5OwogIH0KICB5ID0gMDsKICBzZXRZKHkpIHsKICAgIHRoaXMueSA9IHk7CiAgfQogIHdpdGhZKHkpIHsKICAgIGNvbnN0IGNvcHkgPSB0aGlzLnN5c3RlbS5pbml0aWFsaXNlKG5ldyBJbWFnZVZHKHRoaXMpKTsKICAgIGNvcHkueSA9IHk7CiAgICByZXR1cm4gY29weTsKICB9CiAgYWx0OwogIHNldEFsdChhbHQpIHsKICAgIHRoaXMuYWx0ID0gYWx0OwogIH0KICB3aXRoQWx0KGFsdCkgewogICAgY29uc3QgY29weSA9IHRoaXMuc3lzdGVtLmluaXRpYWxpc2UobmV3IEltYWdlVkcodGhpcykpOwogICAgY29weS5hbHQgPSBhbHQ7CiAgICByZXR1cm4gY29weTsKICB9CiAgd2lkdGg7CiAgc2V0V2lkdGgod2lkdGgpIHsKICAgIHRoaXMud2lkdGggPSB3aWR0aDsKICB9CiAgd2l0aFdpZHRoKHdpZHRoKSB7CiAgICBjb25zdCBjb3B5ID0gdGhpcy5zeXN0ZW0uaW5pdGlhbGlzZShuZXcgSW1hZ2VWRyh0aGlzKSk7CiAgICBjb3B5LndpZHRoID0gd2lkdGg7CiAgICByZXR1cm4gY29weTsKICB9CiAgaGVpZ2h0ID0gMTMuMjsKICBzZXRIZWlnaHQoaGVpZ2h0KSB7CiAgICB0aGlzLmhlaWdodCA9IGhlaWdodDsKICB9CiAgd2l0aEhlaWdodChoZWlnaHQpIHsKICAgIGNvbnN0IGNvcHkgPSB0aGlzLnN5c3RlbS5pbml0aWFsaXNlKG5ldyBJbWFnZVZHKHRoaXMpKTsKICAgIGNvcHkuaGVpZ2h0ID0gaGVpZ2h0OwogICAgcmV0dXJuIGNvcHk7CiAgfQogIHVybCA9ICIiOwogIGdldFVybCgpIHsKICAgIHJldHVybiB0aGlzLnVybDsKICB9CiAgdGl0bGUgPSAiIjsKICBzZXRUaXRsZSh0aXRsZSkgewogICAgdGhpcy50aXRsZSA9IHRpdGxlOwogIH0KICB3aXRoVGl0bGUodGl0bGUpIHsKICAgIGNvbnN0IGNvcHkgPSB0aGlzLnN5c3RlbS5pbml0aWFsaXNlKG5ldyBJbWFnZVZHKHRoaXMpKTsKICAgIGNvcHkudGl0bGUgPSB0aXRsZTsKICAgIHJldHVybiBjb3B5OwogIH0KICBhc1NWRygpIHsKICAgIHJldHVybiBgPGltYWdlIHg9IiR7dGhpcy54fSUiIHk9IiR7dGhpcy55IC8gMC43NX0lIiB3aWR0aD0iJHt0aGlzLndpZHRofSIgaGVpZ2h0PSIke3RoaXMuaGVpZ2h0IC8gMC43NX0iIGhyZWY9IiR7dGhpcy51cmx9IiB0aXRsZT0iJHt0aGlzLnRpdGxlfSIgYWx0PSIke3RoaXMuYWx0fSIvPmA7CiAgfQogIGFzeW5jIGFzU3RyaW5nKCkgewogICAgcmV0dXJuIGA8aW1nIHNyYz0nJHt0aGlzLnVybH0nIHdpZHRoPScke3RoaXMud2lkdGh9JyBoZWlnaHQ9JyR7dGhpcy5oZWlnaHR9JyB0aXRsZT0nJHt0aGlzLnRpdGxlfScgYWx0PScke3RoaXMuYWx0fSc+YDsKICB9Cn07Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhblByb3BlcnR5KCkKXSwgSW1hZ2VWRy5wcm90b3R5cGUsICJ4IiwgMik7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhblByb2NlZHVyZShbIngiXSkKXSwgSW1hZ2VWRy5wcm90b3R5cGUsICJzZXRYIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFsieCJdLCAwIC8qIHB1cmUgKi8sIEVsYW5DbGFzcyhJbWFnZVZHKSkKXSwgSW1hZ2VWRy5wcm90b3R5cGUsICJ3aXRoWCIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5Qcm9wZXJ0eSgpCl0sIEltYWdlVkcucHJvdG90eXBlLCAieSIsIDIpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5Qcm9jZWR1cmUoWyJ5Il0pCl0sIEltYWdlVkcucHJvdG90eXBlLCAic2V0WSIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbInkiXSwgMCAvKiBwdXJlICovLCBFbGFuQ2xhc3MoSW1hZ2VWRykpCl0sIEltYWdlVkcucHJvdG90eXBlLCAid2l0aFkiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuUHJvcGVydHkoKQpdLCBJbWFnZVZHLnByb3RvdHlwZSwgImFsdCIsIDIpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5Qcm9jZWR1cmUoWyJhbHQiXSkKXSwgSW1hZ2VWRy5wcm90b3R5cGUsICJzZXRBbHQiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oWyJhbHQiXSwgMCAvKiBwdXJlICovLCBFbGFuQ2xhc3MoSW1hZ2VWRykpCl0sIEltYWdlVkcucHJvdG90eXBlLCAid2l0aEFsdCIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5Qcm9wZXJ0eSgpCl0sIEltYWdlVkcucHJvdG90eXBlLCAid2lkdGgiLCAyKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuUHJvY2VkdXJlKFsid2lkdGgiXSkKXSwgSW1hZ2VWRy5wcm90b3R5cGUsICJzZXRXaWR0aCIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbIndpZHRoIl0sIDAgLyogcHVyZSAqLywgRWxhbkNsYXNzKEltYWdlVkcpKQpdLCBJbWFnZVZHLnByb3RvdHlwZSwgIndpdGhXaWR0aCIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5Qcm9wZXJ0eSgpCl0sIEltYWdlVkcucHJvdG90eXBlLCAiaGVpZ2h0IiwgMik7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhblByb2NlZHVyZShbImhlaWdodCJdKQpdLCBJbWFnZVZHLnByb3RvdHlwZSwgInNldEhlaWdodCIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbImhlaWdodCJdLCAwIC8qIHB1cmUgKi8sIEVsYW5DbGFzcyhJbWFnZVZHKSkKXSwgSW1hZ2VWRy5wcm90b3R5cGUsICJ3aXRoSGVpZ2h0IiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhblByb3BlcnR5KCkKXSwgSW1hZ2VWRy5wcm90b3R5cGUsICJ1cmwiLCAyKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oW10sIDAgLyogcHVyZSAqLykKXSwgSW1hZ2VWRy5wcm90b3R5cGUsICJnZXRVcmwiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuUHJvcGVydHkoKQpdLCBJbWFnZVZHLnByb3RvdHlwZSwgInRpdGxlIiwgMik7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhblByb2NlZHVyZShbInRpdGxlIl0pCl0sIEltYWdlVkcucHJvdG90eXBlLCAic2V0VGl0bGUiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oWyJ0aXRsZSJdLCAwIC8qIHB1cmUgKi8sIEVsYW5DbGFzcyhJbWFnZVZHKSkKXSwgSW1hZ2VWRy5wcm90b3R5cGUsICJ3aXRoVGl0bGUiLCAxKTsKSW1hZ2VWRyA9IF9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkNsYXNzKDAgLyogY29uY3JldGUgKi8sIFtdLCBbXSwgW0VsYW5TdHJpbmddLCBbRWxhbkNsYXNzKFZlY3RvckdyYXBoaWMpXSkKXSwgSW1hZ2VWRyk7CgovLyBzcmMvY29tcGlsZXIvc3RhbmRhcmQtbGlicmFyeS9saW5lLXZnLnRzCnZhciBMaW5lVkcgPSBjbGFzcyBleHRlbmRzIFZlY3RvckdyYXBoaWMgewogIHN0YXRpYyBlbXB0eUluc3RhbmNlKCkgewogICAgcmV0dXJuIG5ldyBMaW5lVkcoKTsKICB9CiAgYXN5bmMgX2luaXRpYWxpc2UoKSB7CiAgICByZXR1cm4gdGhpczsKICB9CiAgc3lzdGVtOwogIGNvbnN0cnVjdG9yKGNvcHkpIHsKICAgIHN1cGVyKCk7CiAgICB0aGlzLngxID0gY29weSA/IGNvcHkueDEgOiAxMDsKICAgIHRoaXMueTEgPSBjb3B5ID8gY29weS55MSA6IDEwOwogICAgdGhpcy54MiA9IGNvcHkgPyBjb3B5LngyIDogNzA7CiAgICB0aGlzLnkyID0gY29weSA/IGNvcHkueTIgOiA0MDsKICAgIHRoaXMuc3Ryb2tlQ29sb3VyID0gY29weSA/IGNvcHkuc3Ryb2tlQ29sb3VyIDogMDsKICAgIHRoaXMuc3Ryb2tlV2lkdGggPSBjb3B5ID8gY29weS5zdHJva2VXaWR0aCA6IDE7CiAgfQogIHgxID0gMDsKICBzZXRYMSh4MSkgewogICAgdGhpcy54MSA9IHgxOwogIH0KICB3aXRoWDEoeDEpIHsKICAgIGNvbnN0IGNvcHkgPSB0aGlzLnN5c3RlbS5pbml0aWFsaXNlKG5ldyBMaW5lVkcodGhpcykpOwogICAgY29weS54MSA9IHgxOwogICAgcmV0dXJuIGNvcHk7CiAgfQogIHkxID0gMDsKICBzZXRZMSh5MSkgewogICAgdGhpcy55MSA9IHkxOwogIH0KICB3aXRoWTEoeTEpIHsKICAgIGNvbnN0IGNvcHkgPSB0aGlzLnN5c3RlbS5pbml0aWFsaXNlKG5ldyBMaW5lVkcodGhpcykpOwogICAgY29weS55MSA9IHkxOwogICAgcmV0dXJuIGNvcHk7CiAgfQogIHgyID0gMDsKICBzZXRYMih4MikgewogICAgdGhpcy54MiA9IHgyOwogIH0KICB3aXRoWDIoeDIpIHsKICAgIGNvbnN0IGNvcHkgPSB0aGlzLnN5c3RlbS5pbml0aWFsaXNlKG5ldyBMaW5lVkcodGhpcykpOwogICAgY29weS54MiA9IHgyOwogICAgcmV0dXJuIGNvcHk7CiAgfQogIHkyID0gMDsKICBzZXRZMih5MikgewogICAgdGhpcy55MiA9IHkyOwogIH0KICB3aXRoWTIoeTIpIHsKICAgIGNvbnN0IGNvcHkgPSB0aGlzLnN5c3RlbS5pbml0aWFsaXNlKG5ldyBMaW5lVkcodGhpcykpOwogICAgY29weS55MiA9IHkyOwogICAgcmV0dXJuIGNvcHk7CiAgfQogIHN0cm9rZUNvbG91ciA9IDA7CiAgc2V0U3Ryb2tlQ29sb3VyKHN0cm9rZUNvbG91cikgewogICAgdGhpcy5zdHJva2VDb2xvdXIgPSBzdHJva2VDb2xvdXI7CiAgfQogIHdpdGhTdHJva2VDb2xvdXIoc3Ryb2tlQ29sb3VyKSB7CiAgICBjb25zdCBjb3B5ID0gdGhpcy5zeXN0ZW0uaW5pdGlhbGlzZShuZXcgTGluZVZHKHRoaXMpKTsKICAgIGNvcHkuc3Ryb2tlQ29sb3VyID0gc3Ryb2tlQ29sb3VyOwogICAgcmV0dXJuIGNvcHk7CiAgfQogIHN0cm9rZVdpZHRoID0gMDsKICBzZXRTdHJva2VXaWR0aChzdHJva2VXaWR0aCkgewogICAgdGhpcy5zdHJva2VXaWR0aCA9IHN0cm9rZVdpZHRoOwogIH0KICB3aXRoU3Ryb2tlV2lkdGgoc3Ryb2tlV2lkdGgpIHsKICAgIGNvbnN0IGNvcHkgPSB0aGlzLnN5c3RlbS5pbml0aWFsaXNlKG5ldyBMaW5lVkcodGhpcykpOwogICAgY29weS5zdHJva2VXaWR0aCA9IHN0cm9rZVdpZHRoOwogICAgcmV0dXJuIGNvcHk7CiAgfQogIGFzU1ZHKCkgewogICAgcmV0dXJuIGA8bGluZSB4MT0iJHt0aGlzLngxfSUiIHkxPSIke3RoaXMueTEgLyAwLjc1fSUiIHgyPSIke3RoaXMueDJ9JSIgeTI9IiR7dGhpcy55MiAvIDAuNzV9JSIgJHt0aGlzLnN0cm9rZUFzSHRtbCh0aGlzLnN0cm9rZVdpZHRoLCB0aGlzLnN0cm9rZUNvbG91cil9Lz5gOwogIH0KfTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuUHJvcGVydHkoKQpdLCBMaW5lVkcucHJvdG90eXBlLCAieDEiLCAyKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuUHJvY2VkdXJlKFsieDEiXSkKXSwgTGluZVZHLnByb3RvdHlwZSwgInNldFgxIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFsieDEiXSwgMCAvKiBwdXJlICovLCBFbGFuQ2xhc3MoTGluZVZHKSkKXSwgTGluZVZHLnByb3RvdHlwZSwgIndpdGhYMSIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5Qcm9wZXJ0eSgpCl0sIExpbmVWRy5wcm90b3R5cGUsICJ5MSIsIDIpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5Qcm9jZWR1cmUoWyJ5MSJdKQpdLCBMaW5lVkcucHJvdG90eXBlLCAic2V0WTEiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oWyJ5MSJdLCAwIC8qIHB1cmUgKi8sIEVsYW5DbGFzcyhMaW5lVkcpKQpdLCBMaW5lVkcucHJvdG90eXBlLCAid2l0aFkxIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhblByb3BlcnR5KCkKXSwgTGluZVZHLnByb3RvdHlwZSwgIngyIiwgMik7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhblByb2NlZHVyZShbIngyIl0pCl0sIExpbmVWRy5wcm90b3R5cGUsICJzZXRYMiIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbIngyIl0sIDAgLyogcHVyZSAqLywgRWxhbkNsYXNzKExpbmVWRykpCl0sIExpbmVWRy5wcm90b3R5cGUsICJ3aXRoWDIiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuUHJvcGVydHkoKQpdLCBMaW5lVkcucHJvdG90eXBlLCAieTIiLCAyKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuUHJvY2VkdXJlKFsieDIiXSkKXSwgTGluZVZHLnByb3RvdHlwZSwgInNldFkyIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFsieDIiXSwgMCAvKiBwdXJlICovLCBFbGFuQ2xhc3MoTGluZVZHKSkKXSwgTGluZVZHLnByb3RvdHlwZSwgIndpdGhZMiIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5Qcm9wZXJ0eShFbGFuSW50KQpdLCBMaW5lVkcucHJvdG90eXBlLCAic3Ryb2tlQ29sb3VyIiwgMik7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhblByb2NlZHVyZShbImNvbG91ciJdKQpdLCBMaW5lVkcucHJvdG90eXBlLCAic2V0U3Ryb2tlQ29sb3VyIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFsiY29sb3VyIl0sIDAgLyogcHVyZSAqLywgRWxhbkNsYXNzKExpbmVWRykpCl0sIExpbmVWRy5wcm90b3R5cGUsICJ3aXRoU3Ryb2tlQ29sb3VyIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhblByb3BlcnR5KCkKXSwgTGluZVZHLnByb3RvdHlwZSwgInN0cm9rZVdpZHRoIiwgMik7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhblByb2NlZHVyZShbInN0cm9rZVdpZHRoIl0pCl0sIExpbmVWRy5wcm90b3R5cGUsICJzZXRTdHJva2VXaWR0aCIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbIndpZHRoIl0sIDAgLyogcHVyZSAqLywgRWxhbkNsYXNzKExpbmVWRykpCl0sIExpbmVWRy5wcm90b3R5cGUsICJ3aXRoU3Ryb2tlV2lkdGgiLCAxKTsKTGluZVZHID0gX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuQ2xhc3MoMiAvKiByZWNvcmQgKi8sIFtdLCBbXSwgW10sIFtFbGFuQ2xhc3MoVmVjdG9yR3JhcGhpYyldKQpdLCBMaW5lVkcpOwoKLy8gc3JjL2NvbXBpbGVyL3N0YW5kYXJkLWxpYnJhcnkvcXVldWUudHMKdmFyIFF1ZXVlID0gY2xhc3MgewogIC8vIHRoaXMgbXVzdCBiZSBpbXBsZW1lbnRlZCBieSBoYW5kIG9uIGFsbCBzdGRsaWIgY2xhc3NlcwogIHN0YXRpYyBlbXB0eUluc3RhbmNlKCkgewogICAgcmV0dXJuIG5ldyBRdWV1ZSgpOwogIH0KICBhc3luYyBfaW5pdGlhbGlzZSgpIHsKICAgIHJldHVybiB0aGlzOwogIH0KICBjb25zdHJ1Y3RvcihhcnIpIHsKICAgIHRoaXMuY29udGVudHMgPSBhcnIgPyBbLi4uYXJyXSA6IFtdOwogIH0KICBjb250ZW50czsKICBzeXN0ZW07CiAgcGVlaygpIHsKICAgIGlmICh0aGlzLmNvbnRlbnRzLmxlbmd0aCA9PT0gMCkgewogICAgICB0aHJvdyBuZXcgRWxhblJ1bnRpbWVFcnJvcihgQ2Fubm90IHBlZWsgYW4gZW1wdHkgUXVldWUgLSBjaGVjayB1c2luZyBsZW5ndGgoKWApOwogICAgfQogICAgcmV0dXJuIHRoaXMuY29udGVudHNbMF07CiAgfQogIGxlbmd0aCgpIHsKICAgIHJldHVybiB0aGlzLmNvbnRlbnRzLmxlbmd0aDsKICB9CiAgZW5xdWV1ZShpdGVtKSB7CiAgICBjb25zdCBuZXdDb250ZW50cyA9IFsuLi50aGlzLmNvbnRlbnRzXTsKICAgIG5ld0NvbnRlbnRzLnB1c2goaXRlbSk7CiAgICByZXR1cm4gdGhpcy5zeXN0ZW0uaW5pdGlhbGlzZShuZXcgUXVldWUobmV3Q29udGVudHMpKTsKICB9CiAgZGVxdWV1ZSgpIHsKICAgIGlmICh0aGlzLmNvbnRlbnRzLmxlbmd0aCA9PT0gMCkgewogICAgICB0aHJvdyBuZXcgRWxhblJ1bnRpbWVFcnJvcihgQ2Fubm90IGRlcXVldWUgYW4gZW1wdHkgUXVldWUgLSBjaGVjayB1c2luZyBsZW5ndGgoKWApOwogICAgfQogICAgY29uc3QgbmV3Q29udGVudHMgPSBbLi4udGhpcy5jb250ZW50c107CiAgICBjb25zdCBpdGVtID0gbmV3Q29udGVudHMuc2hpZnQoKTsKICAgIGNvbnN0IG5ld1F1ZXVlID0gdGhpcy5zeXN0ZW0uaW5pdGlhbGlzZShuZXcgUXVldWUobmV3Q29udGVudHMpKTsKICAgIHJldHVybiB0aGlzLnN5c3RlbS50dXBsZShbaXRlbSwgbmV3UXVldWVdKTsKICB9CiAgYXN5bmMgYXNTdHJpbmcoKSB7CiAgICBjb25zdCBpdGVtcyA9IFtdOwogICAgZm9yIChjb25zdCBpIG9mIHRoaXMuY29udGVudHMpIHsKICAgICAgY29uc3QgcyA9IGF3YWl0IHRoaXMuc3lzdGVtLmFzU3RyaW5nKGkpOwogICAgICBpdGVtcy5wdXNoKHMpOwogICAgfQogICAgcmV0dXJuIGBbJHtpdGVtcy5qb2luKCIsICIpfV1gOwogIH0KfTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oW10sIDAgLyogcHVyZSAqLywgRWxhblQxKQpdLCBRdWV1ZS5wcm90b3R5cGUsICJwZWVrIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFtdLCAwIC8qIHB1cmUgKi8sIEVsYW5JbnQpCl0sIFF1ZXVlLnByb3RvdHlwZSwgImxlbmd0aCIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbXSwgMCAvKiBwdXJlICovLCBFbGFuQ2xhc3MoUXVldWUpKSwKICBfX2RlY29yYXRlUGFyYW0oMCwgZWxhbkdlbmVyaWNQYXJhbVQxVHlwZSgpKQpdLCBRdWV1ZS5wcm90b3R5cGUsICJlbnF1ZXVlIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFtdLCA0IC8qIGltcHVyZSAqLywgRWxhblR1cGxlKFtFbGFuVDEsIEVsYW5DbGFzcyhRdWV1ZSldKSkKXSwgUXVldWUucHJvdG90eXBlLCAiZGVxdWV1ZSIsIDEpOwpRdWV1ZSA9IF9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkNsYXNzKDIgLyogcmVjb3JkICovLCBbRWxhblQxXSkKXSwgUXVldWUpOwoKLy8gc3JjL2NvbXBpbGVyL3N0YW5kYXJkLWxpYnJhcnkvcmFuZG9tLnRzCnZhciBSYW5kb20gPSBjbGFzcyB7CiAgLy8gdGhpcyBtdXN0IGJlIGltcGxlbWVudGVkIGJ5IGhhbmQgb24gYWxsIHN0ZGxpYiBjbGFzc2VzCiAgc3RhdGljIGVtcHR5SW5zdGFuY2UoKSB7CiAgICByZXR1cm4gbmV3IFJhbmRvbSgpOwogIH0KICBhc3luYyBfaW5pdGlhbGlzZSgpIHsKICAgIHJldHVybiB0aGlzOwogIH0KICBjb25zdHJ1Y3RvcigpIHsKICAgIHRoaXMudSA9IDUyMTI4ODYyOTsKICAgIHRoaXMudiA9IDM2MjQzNjA2OTsKICB9CiAgc3lzdGVtOwogIHU7CiAgdjsKICBuZXh0KCkgewogICAgcmV0dXJuIHRoaXMubmV4dEltcGwoKTsKICB9CiAgbmV4dEltcGwoKSB7CiAgICBjb25zdCB2YWx1ZSA9IHRoaXMubG8zMih0aGlzLmxvMzIodGhpcy51ICogNjU1MzYpICsgdGhpcy52ICsgMSkgKiAyMzI4MzA2NDM1NDU0NDk0ZS0yNTsKICAgIGNvbnN0IHJuZDIgPSB0aGlzLnN5c3RlbS5pbml0aWFsaXNlKG5ldyBSYW5kb20oKSk7CiAgICBybmQyLnUgPSAzNjk2OSAqICh0aGlzLnUgJSA2NTUzNikgKyB0aGlzLnUgLyA2NTUzNjsKICAgIHJuZDIudiA9IDE4ZTMgKiAodGhpcy52ICUgNjU1MzYpICsgdGhpcy52IC8gNjU1MzY7CiAgICByZXR1cm4gW3ZhbHVlLCBybmQyXTsKICB9CiAgbG8zMihuKSB7CiAgICByZXR1cm4gbiAlIDQyOTQ5NjcyOTY7CiAgfQogIG5leHRJbnQobWluLCBtYXgpIHsKICAgIGNvbnN0IFtmbG9hdCwgcm5kMl0gPSB0aGlzLm5leHRJbXBsKCk7CiAgICBjb25zdCB2YWx1ZSA9IE1hdGguZmxvb3IoZmxvYXQgKiAobWF4IC0gbWluICsgMSkgKyBtaW4pOwogICAgcmV0dXJuIFt2YWx1ZSwgcm5kMl07CiAgfQogIGluaXRpYWxpc2VGcm9tQ2xvY2soKSB7CiAgICBjb25zdCBjID0gKC8qIEBfX1BVUkVfXyAqLyBuZXcgRGF0ZSgpKS5nZXRUaW1lKCk7CiAgICB0aGlzLnUgPSBjICUgMWUzICogMWU2OwogICAgdGhpcy52ID0gMDsKICB9Cn07Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFtdLCAwIC8qIHB1cmUgKi8sIEVsYW5UdXBsZShbRWxhbkZsb2F0LCBFbGFuQ2xhc3MoUmFuZG9tKV0pKQpdLCBSYW5kb20ucHJvdG90eXBlLCAibmV4dCIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbXSwgMCAvKiBwdXJlICovLCBFbGFuVHVwbGUoW0VsYW5JbnQsIEVsYW5DbGFzcyhSYW5kb20pXSkpLAogIF9fZGVjb3JhdGVQYXJhbSgwLCBlbGFuSW50VHlwZSgpKSwKICBfX2RlY29yYXRlUGFyYW0oMSwgZWxhbkludFR5cGUoKSkKXSwgUmFuZG9tLnByb3RvdHlwZSwgIm5leHRJbnQiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuUHJvY2VkdXJlKFtdKQpdLCBSYW5kb20ucHJvdG90eXBlLCAiaW5pdGlhbGlzZUZyb21DbG9jayIsIDEpOwpSYW5kb20gPSBfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5DbGFzcygyIC8qIHJlY29yZCAqLykKXSwgUmFuZG9tKTsKCi8vIHNyYy9jb21waWxlci9zdGFuZGFyZC1saWJyYXJ5L3JlY3RhbmdsZS12Zy50cwp2YXIgUmVjdGFuZ2xlVkcgPSBjbGFzcyBleHRlbmRzIFZlY3RvckdyYXBoaWMgewogIHN0YXRpYyBlbXB0eUluc3RhbmNlKCkgewogICAgcmV0dXJuIG5ldyBSZWN0YW5nbGVWRygpOwogIH0KICBhc3luYyBfaW5pdGlhbGlzZSgpIHsKICAgIHJldHVybiB0aGlzOwogIH0KICBzeXN0ZW07CiAgY29uc3RydWN0b3IoY29weSkgewogICAgc3VwZXIoKTsKICAgIHRoaXMueCA9IGNvcHkgPyBjb3B5LnggOiAxMDsKICAgIHRoaXMueSA9IGNvcHkgPyBjb3B5LnkgOiAxMDsKICAgIHRoaXMud2lkdGggPSBjb3B5ID8gY29weS53aWR0aCA6IDQwOwogICAgdGhpcy5oZWlnaHQgPSBjb3B5ID8gY29weS5oZWlnaHQgOiAyMDsKICAgIHRoaXMuZmlsbENvbG91ciA9IGNvcHkgPyBjb3B5LmZpbGxDb2xvdXIgOiAxNjc3Njk2MDsKICAgIHRoaXMuc3Ryb2tlQ29sb3VyID0gY29weSA/IGNvcHkuc3Ryb2tlQ29sb3VyIDogMDsKICAgIHRoaXMuc3Ryb2tlV2lkdGggPSBjb3B5ID8gY29weS5zdHJva2VXaWR0aCA6IDE7CiAgfQogIHggPSAwOwogIHNldFgoeCkgewogICAgdGhpcy54ID0geDsKICB9CiAgd2l0aFgoeCkgewogICAgY29uc3QgY29weSA9IHRoaXMuc3lzdGVtLmluaXRpYWxpc2UobmV3IFJlY3RhbmdsZVZHKHRoaXMpKTsKICAgIGNvcHkueCA9IHg7CiAgICByZXR1cm4gY29weTsKICB9CiAgeSA9IDA7CiAgc2V0WSh5KSB7CiAgICB0aGlzLnkgPSB5OwogIH0KICB3aXRoWSh5KSB7CiAgICBjb25zdCBjb3B5ID0gdGhpcy5zeXN0ZW0uaW5pdGlhbGlzZShuZXcgUmVjdGFuZ2xlVkcodGhpcykpOwogICAgY29weS55ID0geTsKICAgIHJldHVybiBjb3B5OwogIH0KICB3aWR0aCA9IDA7CiAgc2V0V2lkdGgod2lkdGgpIHsKICAgIHRoaXMud2lkdGggPSB3aWR0aDsKICB9CiAgd2l0aFdpZHRoKHdpZHRoKSB7CiAgICBjb25zdCBjb3B5ID0gdGhpcy5zeXN0ZW0uaW5pdGlhbGlzZShuZXcgUmVjdGFuZ2xlVkcodGhpcykpOwogICAgY29weS53aWR0aCA9IHdpZHRoOwogICAgcmV0dXJuIGNvcHk7CiAgfQogIGhlaWdodCA9IDA7CiAgc2V0SGVpZ2h0KGhlaWdodCkgewogICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7CiAgfQogIHdpdGhIZWlnaHQoaGVpZ2h0KSB7CiAgICBjb25zdCBjb3B5ID0gdGhpcy5zeXN0ZW0uaW5pdGlhbGlzZShuZXcgUmVjdGFuZ2xlVkcodGhpcykpOwogICAgY29weS5oZWlnaHQgPSBoZWlnaHQ7CiAgICByZXR1cm4gY29weTsKICB9CiAgc3Ryb2tlQ29sb3VyID0gMDsKICBzZXRTdHJva2VDb2xvdXIoc3Ryb2tlQ29sb3VyKSB7CiAgICB0aGlzLnN0cm9rZUNvbG91ciA9IHN0cm9rZUNvbG91cjsKICB9CiAgd2l0aFN0cm9rZUNvbG91cihzdHJva2VDb2xvdXIpIHsKICAgIGNvbnN0IGNvcHkgPSB0aGlzLnN5c3RlbS5pbml0aWFsaXNlKG5ldyBSZWN0YW5nbGVWRyh0aGlzKSk7CiAgICBjb3B5LnN0cm9rZUNvbG91ciA9IHN0cm9rZUNvbG91cjsKICAgIHJldHVybiBjb3B5OwogIH0KICBzdHJva2VXaWR0aCA9IDA7CiAgc2V0U3Ryb2tlV2lkdGgoc3Ryb2tlV2lkdGgpIHsKICAgIHRoaXMuc3Ryb2tlV2lkdGggPSBzdHJva2VXaWR0aDsKICB9CiAgd2l0aFN0cm9rZVdpZHRoKHN0cm9rZVdpZHRoKSB7CiAgICBjb25zdCBjb3B5ID0gdGhpcy5zeXN0ZW0uaW5pdGlhbGlzZShuZXcgUmVjdGFuZ2xlVkcodGhpcykpOwogICAgY29weS5zdHJva2VXaWR0aCA9IHN0cm9rZVdpZHRoOwogICAgcmV0dXJuIGNvcHk7CiAgfQogIGZpbGxDb2xvdXIgPSAwOwogIHNldEZpbGxDb2xvdXIoZmlsbENvbG91cikgewogICAgdGhpcy5maWxsQ29sb3VyID0gZmlsbENvbG91cjsKICB9CiAgd2l0aEZpbGxDb2xvdXIoZmlsbENvbG91cikgewogICAgY29uc3QgY29weSA9IHRoaXMuc3lzdGVtLmluaXRpYWxpc2UobmV3IFJlY3RhbmdsZVZHKHRoaXMpKTsKICAgIGNvcHkuZmlsbENvbG91ciA9IGZpbGxDb2xvdXI7CiAgICByZXR1cm4gY29weTsKICB9CiAgYXNTVkcoKSB7CiAgICByZXR1cm4gYDxyZWN0IHg9IiR7dGhpcy54fSUiIHk9IiR7dGhpcy55IC8gMC43NX0lIiB3aWR0aD0iJHt0aGlzLndpZHRofSUiIGhlaWdodD0iJHt0aGlzLmhlaWdodCAvIDAuNzV9JSIgJHt0aGlzLnN0cm9rZUFzSHRtbCh0aGlzLnN0cm9rZVdpZHRoLCB0aGlzLnN0cm9rZUNvbG91cil9ICR7dGhpcy5maWxsQXNIdG1sKHRoaXMuZmlsbENvbG91cil9Lz5gOwogIH0KfTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuUHJvcGVydHkoKQpdLCBSZWN0YW5nbGVWRy5wcm90b3R5cGUsICJ4IiwgMik7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhblByb2NlZHVyZShbIngiXSkKXSwgUmVjdGFuZ2xlVkcucHJvdG90eXBlLCAic2V0WCIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbIngiXSwgMCAvKiBwdXJlICovLCBFbGFuQ2xhc3MoUmVjdGFuZ2xlVkcpKQpdLCBSZWN0YW5nbGVWRy5wcm90b3R5cGUsICJ3aXRoWCIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5Qcm9wZXJ0eSgpCl0sIFJlY3RhbmdsZVZHLnByb3RvdHlwZSwgInkiLCAyKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuUHJvY2VkdXJlKFsieSJdKQpdLCBSZWN0YW5nbGVWRy5wcm90b3R5cGUsICJzZXRZIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFsieSJdLCAwIC8qIHB1cmUgKi8sIEVsYW5DbGFzcyhSZWN0YW5nbGVWRykpCl0sIFJlY3RhbmdsZVZHLnByb3RvdHlwZSwgIndpdGhZIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhblByb3BlcnR5KCkKXSwgUmVjdGFuZ2xlVkcucHJvdG90eXBlLCAid2lkdGgiLCAyKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuUHJvY2VkdXJlKFsid2lkdGgiXSkKXSwgUmVjdGFuZ2xlVkcucHJvdG90eXBlLCAic2V0V2lkdGgiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oWyJ3aWR0aCJdLCAwIC8qIHB1cmUgKi8sIEVsYW5DbGFzcyhSZWN0YW5nbGVWRykpCl0sIFJlY3RhbmdsZVZHLnByb3RvdHlwZSwgIndpdGhXaWR0aCIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5Qcm9wZXJ0eSgpCl0sIFJlY3RhbmdsZVZHLnByb3RvdHlwZSwgImhlaWdodCIsIDIpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5Qcm9jZWR1cmUoWyJoZWlnaHQiXSkKXSwgUmVjdGFuZ2xlVkcucHJvdG90eXBlLCAic2V0SGVpZ2h0IiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFsiaGVpZ2h0Il0sIDAgLyogcHVyZSAqLywgRWxhbkNsYXNzKFJlY3RhbmdsZVZHKSkKXSwgUmVjdGFuZ2xlVkcucHJvdG90eXBlLCAid2l0aEhlaWdodCIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5Qcm9wZXJ0eShFbGFuSW50KQpdLCBSZWN0YW5nbGVWRy5wcm90b3R5cGUsICJzdHJva2VDb2xvdXIiLCAyKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuUHJvY2VkdXJlKFsiY29sb3VyIl0pCl0sIFJlY3RhbmdsZVZHLnByb3RvdHlwZSwgInNldFN0cm9rZUNvbG91ciIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbImNvbG91ciJdLCAwIC8qIHB1cmUgKi8sIEVsYW5DbGFzcyhSZWN0YW5nbGVWRykpCl0sIFJlY3RhbmdsZVZHLnByb3RvdHlwZSwgIndpdGhTdHJva2VDb2xvdXIiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuUHJvcGVydHkoKQpdLCBSZWN0YW5nbGVWRy5wcm90b3R5cGUsICJzdHJva2VXaWR0aCIsIDIpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5Qcm9jZWR1cmUoWyJzdHJva2VXaWR0aCJdKQpdLCBSZWN0YW5nbGVWRy5wcm90b3R5cGUsICJzZXRTdHJva2VXaWR0aCIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbIndpZHRoIl0sIDAgLyogcHVyZSAqLywgRWxhbkNsYXNzKFJlY3RhbmdsZVZHKSkKXSwgUmVjdGFuZ2xlVkcucHJvdG90eXBlLCAid2l0aFN0cm9rZVdpZHRoIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhblByb3BlcnR5KEVsYW5JbnQpCl0sIFJlY3RhbmdsZVZHLnByb3RvdHlwZSwgImZpbGxDb2xvdXIiLCAyKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuUHJvY2VkdXJlKFsiZmlsbENvbG91ciJdKQpdLCBSZWN0YW5nbGVWRy5wcm90b3R5cGUsICJzZXRGaWxsQ29sb3VyIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFsiY29sb3VyIl0sIDAgLyogcHVyZSAqLywgRWxhbkNsYXNzKFJlY3RhbmdsZVZHKSkKXSwgUmVjdGFuZ2xlVkcucHJvdG90eXBlLCAid2l0aEZpbGxDb2xvdXIiLCAxKTsKUmVjdGFuZ2xlVkcgPSBfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5DbGFzcygyIC8qIHJlY29yZCAqLywgW10sIFtdLCBbXSwgW0VsYW5DbGFzcyhWZWN0b3JHcmFwaGljKV0pCl0sIFJlY3RhbmdsZVZHKTsKCi8vIHNyYy9jb21waWxlci9zdGFuZGFyZC1saWJyYXJ5L3N0YWNrLnRzCnZhciBTdGFjayA9IGNsYXNzIHsKICAvLyB0aGlzIG11c3QgYmUgaW1wbGVtZW50ZWQgYnkgaGFuZCBvbiBhbGwgc3RkbGliIGNsYXNzZXMKICBzdGF0aWMgZW1wdHlJbnN0YW5jZSgpIHsKICAgIHJldHVybiBuZXcgU3RhY2soKTsKICB9CiAgYXN5bmMgX2luaXRpYWxpc2UoKSB7CiAgICByZXR1cm4gdGhpczsKICB9CiAgY29uc3RydWN0b3IoYXJyKSB7CiAgICB0aGlzLmNvbnRlbnRzID0gYXJyID8gWy4uLmFycl0gOiBbXTsKICB9CiAgY29udGVudHM7CiAgc3lzdGVtOwogIHBlZWsoKSB7CiAgICBpZiAodGhpcy5jb250ZW50cy5sZW5ndGggPT09IDApIHsKICAgICAgdGhyb3cgbmV3IEVsYW5SdW50aW1lRXJyb3IoYENhbm5vdCBwZWVrIGFuIGVtcHR5IFN0YWNrIC0gY2hlY2sgdXNpbmcgbGVuZ3RoKClgKTsKICAgIH0KICAgIHJldHVybiB0aGlzLmNvbnRlbnRzWzBdOwogIH0KICBsZW5ndGgoKSB7CiAgICByZXR1cm4gdGhpcy5jb250ZW50cy5sZW5ndGg7CiAgfQogIHB1c2goaXRlbSkgewogICAgY29uc3QgbmV3Q29udGVudHMgPSBbLi4udGhpcy5jb250ZW50c107CiAgICBuZXdDb250ZW50cy51bnNoaWZ0KGl0ZW0pOwogICAgcmV0dXJuIHRoaXMuc3lzdGVtLmluaXRpYWxpc2UobmV3IFN0YWNrKG5ld0NvbnRlbnRzKSk7CiAgfQogIHBvcCgpIHsKICAgIGlmICh0aGlzLmNvbnRlbnRzLmxlbmd0aCA9PT0gMCkgewogICAgICB0aHJvdyBuZXcgRWxhblJ1bnRpbWVFcnJvcihgQ2Fubm90IHBvcCBhbiBlbXB0eSBTdGFjayAtIGNoZWNrIHVzaW5nIGxlbmd0aCgpYCk7CiAgICB9CiAgICBjb25zdCBuZXdDb250ZW50cyA9IFsuLi50aGlzLmNvbnRlbnRzXTsKICAgIGNvbnN0IGl0ZW0gPSBuZXdDb250ZW50cy5zaGlmdCgpOwogICAgY29uc3QgbmV3U3RhY2sgPSB0aGlzLnN5c3RlbS5pbml0aWFsaXNlKG5ldyBTdGFjayhuZXdDb250ZW50cykpOwogICAgcmV0dXJuIHRoaXMuc3lzdGVtLnR1cGxlKFtpdGVtLCBuZXdTdGFja10pOwogIH0KICBhc3luYyBhc1N0cmluZygpIHsKICAgIGNvbnN0IGl0ZW1zID0gW107CiAgICBmb3IgKGNvbnN0IGkgb2YgdGhpcy5jb250ZW50cykgewogICAgICBjb25zdCBzID0gYXdhaXQgdGhpcy5zeXN0ZW0uYXNTdHJpbmcoaSk7CiAgICAgIGl0ZW1zLnB1c2gocyk7CiAgICB9CiAgICByZXR1cm4gYFske2l0ZW1zLmpvaW4oIiwgIil9XWA7CiAgfQp9OwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbXSwgMCAvKiBwdXJlICovLCBFbGFuVDEpCl0sIFN0YWNrLnByb3RvdHlwZSwgInBlZWsiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oW10sIDAgLyogcHVyZSAqLywgRWxhbkludCkKXSwgU3RhY2sucHJvdG90eXBlLCAibGVuZ3RoIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFtdLCAwIC8qIHB1cmUgKi8sIEVsYW5DbGFzcyhTdGFjaykpLAogIF9fZGVjb3JhdGVQYXJhbSgwLCBlbGFuR2VuZXJpY1BhcmFtVDFUeXBlKCkpCl0sIFN0YWNrLnByb3RvdHlwZSwgInB1c2giLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oW10sIDQgLyogaW1wdXJlICovLCBFbGFuVHVwbGUoW0VsYW5UMSwgRWxhbkNsYXNzKFN0YWNrKV0pKQpdLCBTdGFjay5wcm90b3R5cGUsICJwb3AiLCAxKTsKU3RhY2sgPSBfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5DbGFzcygyIC8qIHJlY29yZCAqLywgW0VsYW5UMV0pCl0sIFN0YWNrKTsKCi8vIHNyYy9jb21waWxlci9zdGFuZGFyZC1saWJyYXJ5L3RleHQtZmlsZS1yZWFkZXIudHMKdmFyIF9UZXh0RmlsZVJlYWRlciA9IGNsYXNzIF9UZXh0RmlsZVJlYWRlciB7CiAgLy8gdGhpcyBtdXN0IGJlIGltcGxlbWVudGVkIGJ5IGhhbmQgb24gYWxsIHN0ZGxpYiBjbGFzc2VzCiAgc3RhdGljIGVtcHR5SW5zdGFuY2UoKSB7CiAgICByZXR1cm4gbmV3IF9UZXh0RmlsZVJlYWRlcigpOwogIH0KICBhc3luYyBfaW5pdGlhbGlzZSgpIHsKICAgIHJldHVybiB0aGlzOwogIH0KICBjb25zdHJ1Y3RvcigpIHsKICB9CiAgc3lzdGVtOwogIHN0YXR1cyA9IDA7CiAgLy8wID0gQ2xvc2VkLCAxID0gT3BlbgogIGNvbnRlbnQgPSBbXTsKICBjdXJyZW50TGluZSA9IDA7CiAgcmVhZExpbmUoKSB7CiAgICBpZiAodGhpcy5zdGF0dXMgPT09IDApIHsKICAgICAgdGhyb3cgbmV3IEVsYW5SdW50aW1lRXJyb3IodGhpcy5jYW5ub3RVc2VPbkNsb3NlZCk7CiAgICB9CiAgICBsZXQgbGluZSA9ICIiOwogICAgaWYgKHRoaXMuY3VycmVudExpbmUgPCB0aGlzLmNvbnRlbnQubGVuZ3RoKSB7CiAgICAgIGxpbmUgPSB0aGlzLmNvbnRlbnRbdGhpcy5jdXJyZW50TGluZV0udHJpbSgpOwogICAgICB0aGlzLmN1cnJlbnRMaW5lKys7CiAgICB9CiAgICByZXR1cm4gbGluZTsKICB9CiAgY2Fubm90VXNlT25DbG9zZWQgPSAiQ2Fubm90IHVzZSBhbnkgbWV0aG9kIG9uIGEgY2xvc2VkIGZpbGUiOwogIHJlYWRXaG9sZUZpbGUoKSB7CiAgICBpZiAodGhpcy5zdGF0dXMgPT09IDApIHsKICAgICAgdGhyb3cgbmV3IEVsYW5SdW50aW1lRXJyb3IodGhpcy5jYW5ub3RVc2VPbkNsb3NlZCk7CiAgICB9CiAgICB0aGlzLnN0YXR1cyA9IDA7CiAgICByZXR1cm4gdGhpcy5jb250ZW50LmpvaW4oIlxuIik7CiAgfQogIGNsb3NlKCkgewogICAgaWYgKHRoaXMuc3RhdHVzID09PSAwKSB7CiAgICAgIHRocm93IG5ldyBFbGFuUnVudGltZUVycm9yKHRoaXMuY2Fubm90VXNlT25DbG9zZWQpOwogICAgfQogICAgdGhpcy5zdGF0dXMgPSAwOwogIH0KICBlbmRPZkZpbGUoKSB7CiAgICBpZiAodGhpcy5zdGF0dXMgPT09IDApIHsKICAgICAgdGhyb3cgbmV3IEVsYW5SdW50aW1lRXJyb3IodGhpcy5jYW5ub3RVc2VPbkNsb3NlZCk7CiAgICB9CiAgICByZXR1cm4gdGhpcy5jdXJyZW50TGluZSA+PSB0aGlzLmNvbnRlbnQubGVuZ3RoOwogIH0KfTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oW10sIDQgLyogaW1wdXJlICovLCBFbGFuU3RyaW5nKQpdLCBfVGV4dEZpbGVSZWFkZXIucHJvdG90eXBlLCAicmVhZExpbmUiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oW10sIDQgLyogaW1wdXJlICovLCBFbGFuU3RyaW5nKQpdLCBfVGV4dEZpbGVSZWFkZXIucHJvdG90eXBlLCAicmVhZFdob2xlRmlsZSIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5Qcm9jZWR1cmUoW10pCl0sIF9UZXh0RmlsZVJlYWRlci5wcm90b3R5cGUsICJjbG9zZSIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbXSwgMCAvKiBwdXJlICovLCBFbGFuQm9vbGVhbikKXSwgX1RleHRGaWxlUmVhZGVyLnByb3RvdHlwZSwgImVuZE9mRmlsZSIsIDEpOwp2YXIgVGV4dEZpbGVSZWFkZXIgPSBfVGV4dEZpbGVSZWFkZXI7CgovLyBzcmMvY29tcGlsZXIvc3RhbmRhcmQtbGlicmFyeS90ZXh0LWZpbGUtd3JpdGVyLnRzCnZhciBfVGV4dEZpbGVXcml0ZXIgPSBjbGFzcyBfVGV4dEZpbGVXcml0ZXIgewogIC8vIHRoaXMgbXVzdCBiZSBpbXBsZW1lbnRlZCBieSBoYW5kIG9uIGFsbCBzdGRsaWIgY2xhc3NlcwogIHN0YXRpYyBlbXB0eUluc3RhbmNlKCkgewogICAgcmV0dXJuIG5ldyBfVGV4dEZpbGVXcml0ZXIoKTsKICB9CiAgYXN5bmMgX2luaXRpYWxpc2UoKSB7CiAgICByZXR1cm4gdGhpczsKICB9CiAgY29uc3RydWN0b3IoKSB7CiAgfQogIHN5c3RlbTsKICBzdGF0dXMgPSAwOwogIC8vMCA9IENsb3NlZCwgMSA9IE9wZW4KICBmaWxlTmFtZSA9ICIiOwogIGNvbnRlbnQgPSBbXTsKICBjdXJyZW50TGluZSA9IDA7CiAgY2Fubm90VXNlT25DbG9zZWQgPSAiQ2Fubm90IHVzZSBhbnkgbWV0aG9kIG9uIGEgY2xvc2VkIGZpbGUiOwogIHdyaXRlTGluZShkYXRhKSB7CiAgICBpZiAodGhpcy5zdGF0dXMgPT09IDApIHsKICAgICAgdGhyb3cgbmV3IEVsYW5SdW50aW1lRXJyb3IodGhpcy5jYW5ub3RVc2VPbkNsb3NlZCk7CiAgICB9CiAgICB0aGlzLmNvbnRlbnQucHVzaChkYXRhKTsKICB9CiAgYXN5bmMgd3JpdGVXaG9sZUZpbGUoZGF0YSkgewogICAgaWYgKHRoaXMuc3RhdHVzID09PSAwKSB7CiAgICAgIHRocm93IG5ldyBFbGFuUnVudGltZUVycm9yKHRoaXMuY2Fubm90VXNlT25DbG9zZWQpOwogICAgfQogICAgaWYgKHRoaXMuY29udGVudC5sZW5ndGggPiAwKSB7CiAgICAgIHRocm93IG5ldyBFbGFuUnVudGltZUVycm9yKAogICAgICAgICJDYW5ub3QgY2FsbCAnd3JpdGVXaG9sZUZpbGUnIGlmIGNvbnRlbnQgaGFzIGFscmVhZHkgYmVlbiB3cml0dGVuIHVzaW5nICd3cml0ZUxpbmUnIgogICAgICApOwogICAgfQogICAgdGhpcy5zdGF0dXMgPSAwOwogICAgdHJ5IHsKICAgICAgYXdhaXQgdGhpcy5zeXN0ZW0uZWxhbklucHV0T3V0cHV0LndyaXRlRmlsZSh0aGlzLmZpbGVOYW1lLCBkYXRhKTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgdGhyb3cgbmV3IEVsYW5SdW50aW1lRXJyb3IoZSk7CiAgICB9CiAgfQogIGFzeW5jIHNhdmVBbmRDbG9zZSgpIHsKICAgIGlmICh0aGlzLnN0YXR1cyA9PT0gMCkgewogICAgICB0aHJvdyBuZXcgRWxhblJ1bnRpbWVFcnJvcih0aGlzLmNhbm5vdFVzZU9uQ2xvc2VkKTsKICAgIH0KICAgIHRoaXMuc3RhdHVzID0gMDsKICAgIHRyeSB7CiAgICAgIGF3YWl0IHRoaXMuc3lzdGVtLmVsYW5JbnB1dE91dHB1dC53cml0ZUZpbGUodGhpcy5maWxlTmFtZSwgdGhpcy5jb250ZW50LmpvaW4oIlxuIikpOwogICAgfSBjYXRjaCAoZSkgewogICAgICB0aHJvdyBuZXcgRWxhblJ1bnRpbWVFcnJvcihlKTsKICAgIH0KICB9Cn07Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhblByb2NlZHVyZShbXSkKXSwgX1RleHRGaWxlV3JpdGVyLnByb3RvdHlwZSwgIndyaXRlTGluZSIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5Qcm9jZWR1cmUoW10sIDIgLyogYXN5bmMgKi8pCl0sIF9UZXh0RmlsZVdyaXRlci5wcm90b3R5cGUsICJ3cml0ZVdob2xlRmlsZSIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5Qcm9jZWR1cmUoW10sIDIgLyogYXN5bmMgKi8pCl0sIF9UZXh0RmlsZVdyaXRlci5wcm90b3R5cGUsICJzYXZlQW5kQ2xvc2UiLCAxKTsKdmFyIFRleHRGaWxlV3JpdGVyID0gX1RleHRGaWxlV3JpdGVyOwoKLy8gc3JjL2NvbXBpbGVyL3N0YW5kYXJkLWxpYnJhcnkvZ3JhcGhpY3MtYmFzZS50cwp2YXIgR3JhcGhpY3NCYXNlID0gY2xhc3MgewogIC8vIHRoaXMgbXVzdCBiZSBpbXBsZW1lbnRlZCBieSBoYW5kIG9uIGFsbCBzdGRsaWIgY2xhc3NlcwogIHN0YXRpYyBlbXB0eUluc3RhbmNlKCkgewogICAgcmV0dXJuIG5ldyBHcmFwaGljc0Jhc2UoKTsKICB9CiAgY29uc3RydWN0b3IoKSB7CiAgfQogIGFzSHRtbCgpIHsKICAgIHJldHVybiAiIjsKICB9Cn07CkdyYXBoaWNzQmFzZSA9IF9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkNsYXNzKDEgLyogYWJzdHJhY3QgKi8pCl0sIEdyYXBoaWNzQmFzZSk7CgovLyBzcmMvY29tcGlsZXIvc3RhbmRhcmQtbGlicmFyeS90dXJ0bGUudHMKdmFyIFR1cnRsZSA9IGNsYXNzIGV4dGVuZHMgR3JhcGhpY3NCYXNlIHsKICAvLyB0aGlzIG11c3QgPSBpbXBsZW1lbnRlZCBieSBoYW5kIG9uIGFsbCBzdGRsaWIgY2xhc3NlcwogIHN0YXRpYyBlbXB0eUluc3RhbmNlKCkgewogICAgcmV0dXJuIG5ldyBUdXJ0bGUoKTsKICB9CiAgYXN5bmMgX2luaXRpYWxpc2UoKSB7CiAgICByZXR1cm4gdGhpczsKICB9CiAgX3N5c3RlbTsKICBzZXQgc3lzdGVtKHZhbHVlKSB7CiAgICB0aGlzLl9zeXN0ZW0gPSB2YWx1ZTsKICAgIHRoaXMudmcgPSB0aGlzLl9zeXN0ZW0uaW5pdGlhbGlzZShuZXcgTGlzdCgpKTsKICB9CiAgY29uc3RydWN0b3IoKSB7CiAgICBzdXBlcigpOwogICAgdGhpcy54ID0gMDsKICAgIHRoaXMueSA9IDA7CiAgICB0aGlzLmhlYWRpbmcgPSAwOwogICAgdGhpcy5wZW4gPSB0cnVlOwogICAgdGhpcy5zaG93biA9IHRydWU7CiAgICB0aGlzLmNvbG91ciA9IDA7CiAgICB0aGlzLndpZHRoID0gMTsKICAgIHRoaXMudmcgPSBuZXcgTGlzdCgpOwogIH0KICByZXNldCgpIHsKICAgIHRoaXMueCA9IDA7CiAgICB0aGlzLnkgPSAwOwogICAgdGhpcy5oZWFkaW5nID0gMDsKICAgIHRoaXMucGVuID0gdHJ1ZTsKICAgIHRoaXMuc2hvd24gPSB0cnVlOwogICAgdGhpcy5jb2xvdXIgPSAwOwogICAgdGhpcy53aWR0aCA9IDE7CiAgfQogIHN0ZGxpYjsKICAvLyBpbmplY3RlZAogIHZnOwogIHg7CiAgeTsKICBoZWFkaW5nOwogIHBlbjsKICBzaG93bjsKICBjb2xvdXI7CiAgd2lkdGg7CiAgYXN5bmMgc2hvdygpIHsKICAgIHRoaXMucmVtb3ZlVHVydGxlSWZTaG93bigpOwogICAgdGhpcy5zaG93biA9IHRydWU7CiAgICB0aGlzLmFkZFR1cnRsZUlmU2hvd24oKTsKICAgIGF3YWl0IHRoaXMuc3RkbGliLmRpc3BsYXlWZWN0b3JHcmFwaGljcyh0aGlzLnZnKTsKICB9CiAgYXN5bmMgY2xlYXJBbmRSZXNldCgpIHsKICAgIHRoaXMudmcgPSB0aGlzLl9zeXN0ZW0uaW5pdGlhbGlzZShuZXcgTGlzdCgpKTsKICAgIHRoaXMueCA9IDA7CiAgICB0aGlzLnkgPSAwOwogICAgdGhpcy5oZWFkaW5nID0gMDsKICAgIHRoaXMucGVuID0gdHJ1ZTsKICAgIHRoaXMuY29sb3VyID0gMDsKICAgIHRoaXMud2lkdGggPSAxOwogICAgYXdhaXQgdGhpcy5zdGRsaWIuZGlzcGxheVZlY3RvckdyYXBoaWNzKHRoaXMudmcpOwogIH0KICBhc3luYyBoaWRlKCkgewogICAgdGhpcy5yZW1vdmVUdXJ0bGVJZlNob3duKCk7CiAgICB0aGlzLnNob3duID0gZmFsc2U7CiAgICBhd2FpdCB0aGlzLnN0ZGxpYi5kaXNwbGF5VmVjdG9yR3JhcGhpY3ModGhpcy52Zyk7CiAgfQogIHBlblVwKCkgewogICAgdGhpcy5wZW4gPSBmYWxzZTsKICB9CiAgcGVuRG93bigpIHsKICAgIHRoaXMucGVuID0gdHJ1ZTsKICB9CiAgYWRkVHVydGxlSWZTaG93bigpIHsKICAgIGlmICh0aGlzLnNob3duKSB7CiAgICAgIGNvbnN0IHR1cnRsZSA9IG5ldyBDaXJjbGVWRygpOwogICAgICB0dXJ0bGUuY2VudHJlWCA9IHRoaXMuYXNWR3godGhpcy54KTsKICAgICAgdHVydGxlLmNlbnRyZVkgPSB0aGlzLmFzVkd5KHRoaXMueSk7CiAgICAgIHR1cnRsZS5yYWRpdXMgPSAyOwogICAgICB0dXJ0bGUuZmlsbENvbG91ciA9IDMyNzY4OwogICAgICB0dXJ0bGUuc3Ryb2tlV2lkdGggPSAwOwogICAgICBjb25zdCBbeDIsIHkyXSA9IHRoaXMuZ2V0RGVzdGluYXRpb24oMik7CiAgICAgIGNvbnN0IHBvaW50ZXIgPSBuZXcgTGluZVZHKCk7CiAgICAgIHBvaW50ZXIueDEgPSB0aGlzLmFzVkd4KHRoaXMueCk7CiAgICAgIHBvaW50ZXIueTEgPSB0aGlzLmFzVkd5KHRoaXMueSk7CiAgICAgIHBvaW50ZXIueDIgPSB0aGlzLmFzVkd4KHgyKTsKICAgICAgcG9pbnRlci55MiA9IHRoaXMuYXNWR3koeTIpOwogICAgICBwb2ludGVyLnN0cm9rZVdpZHRoID0gMjsKICAgICAgdGhpcy52Zy5hcHBlbmQodHVydGxlKTsKICAgICAgdGhpcy52Zy5hcHBlbmQocG9pbnRlcik7CiAgICB9CiAgfQogIHJlbW92ZVR1cnRsZUlmU2hvd24oKSB7CiAgICBpZiAodGhpcy5zaG93bikgewogICAgICBjb25zdCBsZW4gPSB0aGlzLnZnLmxlbmd0aCgpOwogICAgICB0aGlzLnZnLnJlbW92ZUF0KGxlbiAtIDEpOwogICAgICB0aGlzLnZnLnJlbW92ZUF0KGxlbiAtIDIpOwogICAgfQogIH0KICBnZXREZXN0aW5hdGlvbihkaXN0YW5jZSkgewogICAgY29uc3QgbmV3WCA9IHRoaXMueCArIGRpc3RhbmNlICogdGhpcy5zdGRsaWIuc2luRGVnKHRoaXMuaGVhZGluZyk7CiAgICBjb25zdCBuZXdZID0gdGhpcy55ICsgZGlzdGFuY2UgKiB0aGlzLnN0ZGxpYi5jb3NEZWcodGhpcy5oZWFkaW5nKTsKICAgIHJldHVybiBbbmV3WCwgbmV3WV07CiAgfQogIGFzeW5jIG1vdmUoZGlzdGFuY2UpIHsKICAgIGNvbnN0IFt4LCB5XSA9IHRoaXMuZ2V0RGVzdGluYXRpb24oZGlzdGFuY2UpOwogICAgYXdhaXQgdGhpcy5tb3ZlVG8oeCwgeSk7CiAgfQogIGFzVkd4KHgpIHsKICAgIHJldHVybiB4IC8gMiArIDUwOwogIH0KICBhc1ZHeSh5KSB7CiAgICByZXR1cm4gLXkgLyAyICsgMzcuNTsKICB9CiAgYXN5bmMgbW92ZVRvKHgsIHkpIHsKICAgIHRoaXMucmVtb3ZlVHVydGxlSWZTaG93bigpOwogICAgaWYgKHRoaXMucGVuKSB7CiAgICAgIGNvbnN0IGxpbmUgPSBuZXcgTGluZVZHKCk7CiAgICAgIGxpbmUueDEgPSB0aGlzLmFzVkd4KHRoaXMueCk7CiAgICAgIGxpbmUueTEgPSB0aGlzLmFzVkd5KHRoaXMueSk7CiAgICAgIGxpbmUueDIgPSB0aGlzLmFzVkd4KHgpOwogICAgICBsaW5lLnkyID0gdGhpcy5hc1ZHeSh5KTsKICAgICAgbGluZS5zdHJva2VDb2xvdXIgPSB0aGlzLmNvbG91cjsKICAgICAgbGluZS5zdHJva2VXaWR0aCA9IHRoaXMud2lkdGg7CiAgICAgIHRoaXMudmcuYXBwZW5kKGxpbmUpOwogICAgfQogICAgdGhpcy54ID0geDsKICAgIHRoaXMueSA9IHk7CiAgICB0aGlzLmFkZFR1cnRsZUlmU2hvd24oKTsKICAgIGF3YWl0IHRoaXMuc3RkbGliLmRpc3BsYXlWZWN0b3JHcmFwaGljcyh0aGlzLnZnKTsKICB9CiAgYXN5bmMgdHVybihkZWdyZWVzKSB7CiAgICBhd2FpdCB0aGlzLnR1cm5Ub0hlYWRpbmcodGhpcy5oZWFkaW5nICsgZGVncmVlcyk7CiAgfQogIGFzeW5jIHR1cm5Ub0hlYWRpbmcoaGVhZGluZykgewogICAgdGhpcy5yZW1vdmVUdXJ0bGVJZlNob3duKCk7CiAgICB0aGlzLmhlYWRpbmcgPSB0aGlzLm5vcm1hbGlzZUhlYWRpbmcoaGVhZGluZyk7CiAgICB0aGlzLmFkZFR1cnRsZUlmU2hvd24oKTsKICAgIGF3YWl0IHRoaXMuc3RkbGliLmRpc3BsYXlWZWN0b3JHcmFwaGljcyh0aGlzLnZnKTsKICB9CiAgbm9ybWFsaXNlSGVhZGluZyh4KSB7CiAgICByZXR1cm4geCA+PSAzNjAgPyB0aGlzLm5vcm1hbGlzZUhlYWRpbmcoeCAtIDM2MCkgOiB4IDwgMCA/IHRoaXMubm9ybWFsaXNlSGVhZGluZyh4ICsgMzYwKSA6IHg7CiAgfQogIHBlbkNvbG91cihjb2xvdXIpIHsKICAgIHRoaXMuY29sb3VyID0gY29sb3VyOwogIH0KICBwZW5XaWR0aCh3aWR0aCkgewogICAgdGhpcy53aWR0aCA9IHdpZHRoID4gMCA/IHdpZHRoIDogMTsKICB9CiAgYXN5bmMgcGxhY2VBdCh4LCB5KSB7CiAgICB0aGlzLnJlbW92ZVR1cnRsZUlmU2hvd24oKTsKICAgIHRoaXMueCA9IHg7CiAgICB0aGlzLnkgPSB5OwogICAgdGhpcy5hZGRUdXJ0bGVJZlNob3duKCk7CiAgICBhd2FpdCB0aGlzLnN0ZGxpYi5kaXNwbGF5VmVjdG9yR3JhcGhpY3ModGhpcy52Zyk7CiAgfQogIGFzSHRtbCgpIHsKICAgIHJldHVybiB0aGlzLnN0ZGxpYi52ZWN0b3JHcmFwaGljc0FzSHRtbCh0aGlzLnZnKTsKICB9CiAgLyogICBAZWxhblByb2NlZHVyZShbIm90aGVyVHVydGxlIl0pCiAgc2hhcmVEaXNwbGF5V2l0aChAZWxhbkNsYXNzVHlwZShUdXJ0bGUpIHQyOiBUdXJ0bGUpIHsKICAgIGNvbnN0IHZnID0gdDIudmc7CiAgICB2Zy5hcHBlbmRMaXN0KHRoaXMudmcpOwogICAgdGhpcy52ZyA9IHZnOwogIH0gKi8KfTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuUHJvcGVydHkoKQpdLCBUdXJ0bGUucHJvdG90eXBlLCAieCIsIDIpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5Qcm9wZXJ0eSgpCl0sIFR1cnRsZS5wcm90b3R5cGUsICJ5IiwgMik7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhblByb3BlcnR5KCkKXSwgVHVydGxlLnByb3RvdHlwZSwgImhlYWRpbmciLCAyKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuUHJvY2VkdXJlKFtdLCAyIC8qIGFzeW5jICovKQpdLCBUdXJ0bGUucHJvdG90eXBlLCAic2hvdyIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5Qcm9jZWR1cmUoW10sIDIgLyogYXN5bmMgKi8pCl0sIFR1cnRsZS5wcm90b3R5cGUsICJjbGVhckFuZFJlc2V0IiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhblByb2NlZHVyZShbXSwgMiAvKiBhc3luYyAqLykKXSwgVHVydGxlLnByb3RvdHlwZSwgImhpZGUiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuUHJvY2VkdXJlKFtdKQpdLCBUdXJ0bGUucHJvdG90eXBlLCAicGVuVXAiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuUHJvY2VkdXJlKFtdKQpdLCBUdXJ0bGUucHJvdG90eXBlLCAicGVuRG93biIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5Qcm9jZWR1cmUoWyJkaXN0YW5jZSJdLCAyIC8qIGFzeW5jICovKQpdLCBUdXJ0bGUucHJvdG90eXBlLCAibW92ZSIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5Qcm9jZWR1cmUoWyJ4IiwgInkiXSwgMiAvKiBhc3luYyAqLykKXSwgVHVydGxlLnByb3RvdHlwZSwgIm1vdmVUbyIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5Qcm9jZWR1cmUoWyJkZWdyZWVzIl0sIDIgLyogYXN5bmMgKi8pCl0sIFR1cnRsZS5wcm90b3R5cGUsICJ0dXJuIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhblByb2NlZHVyZShbXSwgMiAvKiBhc3luYyAqLykKXSwgVHVydGxlLnByb3RvdHlwZSwgInR1cm5Ub0hlYWRpbmciLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuUHJvY2VkdXJlKFsiY29sb3VyIl0pLAogIF9fZGVjb3JhdGVQYXJhbSgwLCBlbGFuSW50VHlwZSgpKQpdLCBUdXJ0bGUucHJvdG90eXBlLCAicGVuQ29sb3VyIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhblByb2NlZHVyZShbIndpZHRoIl0pLAogIF9fZGVjb3JhdGVQYXJhbSgwLCBlbGFuRmxvYXRUeXBlKCkpCl0sIFR1cnRsZS5wcm90b3R5cGUsICJwZW5XaWR0aCIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5Qcm9jZWR1cmUoWyJ4IiwgInkiXSwgMiAvKiBhc3luYyAqLykKXSwgVHVydGxlLnByb3RvdHlwZSwgInBsYWNlQXQiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oW10sIDAgLyogcHVyZSAqLykKXSwgVHVydGxlLnByb3RvdHlwZSwgImFzSHRtbCIsIDEpOwpUdXJ0bGUgPSBfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5DbGFzcygwIC8qIGNvbmNyZXRlICovLCBbXSwgW10sIFtdLCBbRWxhbkNsYXNzKEdyYXBoaWNzQmFzZSldKQpdLCBUdXJ0bGUpOwoKLy8gc3JjL2NvbXBpbGVyL3N0YW5kYXJkLWxpYnJhcnkvc3RkLWxpYi50cwp2YXIgX1N0ZExpYiA9IGNsYXNzIF9TdGRMaWIgewogIGNvbnN0cnVjdG9yKGlvKSB7CiAgICB0aGlzLnN5c3RlbSA9IG5ldyBTeXN0ZW0oaW8pOwogIH0KICBzdGF0aWMgbmVnYXRhYmxlTGl0SW50T25seSA9IC9eXHMqLT8oKDBiWzAtMV0rKXwoMHhbMC05YS1mQS1GXSspfChbMC05XSspKSQvOwogIHN0YXRpYyBuZWdhdGFibGVMaXRGbG9hdE9ubHkgPSAvXlxzKi0/WzAtOV0rKFwuWzAtOV0rKT8oKGV8RSlbKy1dP1swLTldKyk/JC87CiAgc3lzdGVtOwogIFRleHRGaWxlUmVhZGVyID0gVGV4dEZpbGVSZWFkZXI7CiAgVGV4dEZpbGVXcml0ZXIgPSBUZXh0RmlsZVdyaXRlcjsKICBSYW5kb20gPSBSYW5kb207CiAgU3RhY2sgPSBTdGFjazsKICBRdWV1ZSA9IFF1ZXVlOwogIFNldCA9IEVsYW5TZXQ7CiAgVHVydGxlID0gVHVydGxlOwogIFZlY3RvckdyYXBoaWMgPSBWZWN0b3JHcmFwaGljOwogIENpcmNsZVZHID0gQ2lyY2xlVkc7CiAgTGluZVZHID0gTGluZVZHOwogIFJlY3RhbmdsZVZHID0gUmVjdGFuZ2xlVkc7CiAgSW1hZ2VWRyA9IEltYWdlVkc7CiAgTGlzdCA9IExpc3Q7CiAgQXJyYXkgPSBFbGFuQXJyYXk7CiAgQXJyYXkyRCA9IEVsYW5BcnJheTJEOwogIExpc3RJbW11dGFibGUgPSBMaXN0SW1tdXRhYmxlOwogIERpY3Rpb25hcnkgPSBEaWN0aW9uYXJ5OwogIERpY3Rpb25hcnlJbW11dGFibGUgPSBEaWN0aW9uYXJ5SW1tdXRhYmxlOwogIGJsYWNrID0gMDsKICBncmV5ID0gODQyMTUwNDsKICB3aGl0ZSA9IDE2Nzc3MjE1OwogIHJlZCA9IDE2NzExNjgwOwogIGdyZWVuID0gMzI3Njg7CiAgYmx1ZSA9IDI1NTsKICB5ZWxsb3cgPSAxNjc3Njk2MDsKICBicm93biA9IDEwODI0MjM0OwogIHRyYW5zcGFyZW50ID0gLTE7CiAgdHJ1ZSA9IHRydWU7CiAgZmFsc2UgPSBmYWxzZTsKICBwaSA9IE1hdGguUEk7CiAgbWVhbmluZ09mTGlmZSA9IDQyOwogIHF1b3RlcyA9IGAiYDsKICBvcGVuQnJhY2UgPSBge2A7CiAgY2xvc2VCcmFjZSA9IGB9YDsKICBpc1ZhbHVlVHlwZSh2KSB7CiAgICByZXR1cm4gdHlwZW9mIHYgPT09ICJib29sZWFuIiB8fCB0eXBlb2YgdiA9PT0gInN0cmluZyIgfHwgdHlwZW9mIHYgPT09ICJudW1iZXIiOwogIH0KICBhc3luYyBhc1N0cmluZyh2KSB7CiAgICBpZiAodiA9PT0gdm9pZCAwIHx8IHYgPT09IG51bGwpIHsKICAgICAgdGhyb3cgbmV3IEVsYW5SdW50aW1lRXJyb3IoYE91dCBvZiByYW5nZSBlcnJvcmApOwogICAgfQogICAgaWYgKHR5cGVvZiB2ID09PSAiYm9vbGVhbiIpIHsKICAgICAgcmV0dXJuIHYgPyAidHJ1ZSIgOiAiZmFsc2UiOwogICAgfQogICAgaWYgKHR5cGVvZiB2ID09PSAic3RyaW5nIikgewogICAgICByZXR1cm4gdi50b1N0cmluZygpOwogICAgfQogICAgaWYgKHR5cGVvZiB2ID09PSAibnVtYmVyIikgewogICAgICByZXR1cm4gdi50b1N0cmluZygpOwogICAgfQogICAgaWYgKHYgaW5zdGFuY2VvZiBSZWdFeHApIHsKICAgICAgcmV0dXJuICJBIFJlZ0V4cCI7CiAgICB9CiAgICBpZiAoQXJyYXkuaXNBcnJheSh2KSkgewogICAgICBjb25zdCBpdGVtcyA9IFtdOwogICAgICBmb3IgKGNvbnN0IGkgb2YgdikgewogICAgICAgIGNvbnN0IHMgPSBhd2FpdCB0aGlzLmFzU3RyaW5nKGkpOwogICAgICAgIGl0ZW1zLnB1c2gocyk7CiAgICAgIH0KICAgICAgaWYgKGl0ZW1zLmxlbmd0aCA8IDIpIHsKICAgICAgICByZXR1cm4gaXRlbXMuam9pbigiIik7CiAgICAgIH0KICAgICAgcmV0dXJuIGB0dXBsZSgke2l0ZW1zLmpvaW4oIiwgIil9KWA7CiAgICB9CiAgICBpZiAodHlwZW9mIHYgPT09ICJvYmplY3QiICYmICJhc1N0cmluZyIgaW4gdikgewogICAgICByZXR1cm4gYXdhaXQgdi5hc1N0cmluZygpOwogICAgfQogICAgaWYgKHR5cGVvZiB2ID09PSAib2JqZWN0IikgewogICAgICByZXR1cm4gYGEgJHt2LmNvbnN0cnVjdG9yLm5hbWV9YDsKICAgIH0KICAgIGlmICh0eXBlb2YgdiA9PT0gImZ1bmN0aW9uIikgewogICAgICByZXR1cm4gYGZ1bmN0aW9uICR7di5uYW1lfWA7CiAgICB9CiAgICB0aHJvdyBuZXcgRWxhbkNvbXBpbGVyRXJyb3IoIk5vdCBpbXBsZW1lbnRlZDogIiArIHR5cGVvZiB2KTsKICB9CiAgdW5pY29kZShuKSB7CiAgICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZShuKTsKICB9CiAgYXNVbmljb2RlKHMpIHsKICAgIHJldHVybiBzLmNoYXJDb2RlQXQoMCk7CiAgfQogIGluZGV4T2YocywgaXRlbSkgewogICAgcmV0dXJuIHMuaW5kZXhPZihpdGVtKTsKICB9CiAgc2VxdWVuY2Uoc3RhcnQsIGVuZCkgewogICAgY29uc3Qgc2VxID0gW107CiAgICBmb3IgKGxldCBpID0gc3RhcnQ7IGkgPD0gZW5kOyBpKyspIHsKICAgICAgc2VxLnB1c2goaSk7CiAgICB9CiAgICByZXR1cm4gdGhpcy5zeXN0ZW0uaW5pdGlhbGlzZShuZXcgTGlzdChzZXEpKTsKICB9CiAgc2VxdWVuY2VXaXRoU3RlcChzdGFydCwgZW5kLCBzdGVwKSB7CiAgICBjb25zdCBzZXEgPSBbXTsKICAgIGlmIChzdGVwID09PSAwKSB7CiAgICAgIHRocm93IG5ldyBFbGFuUnVudGltZUVycm9yKCJ2YWx1ZSBmb3Igc3RlcCBjYW5ub3QgYmUgemVybyIpOwogICAgfSBlbHNlIGlmIChzdGVwID4gMCkgewogICAgICBmb3IgKGxldCBpID0gc3RhcnQ7IGkgPD0gZW5kOyBpID0gaSArIHN0ZXApIHsKICAgICAgICBzZXEucHVzaChpKTsKICAgICAgfQogICAgfSBlbHNlIGlmIChzdGVwIDwgMCkgewogICAgICBpZiAoc3RhcnQgPCBlbmQpIHsKICAgICAgICB0aHJvdyBuZXcgRWxhblJ1bnRpbWVFcnJvcigKICAgICAgICAgICJMb29wIHdpbGwgbm90IHRlcm1pbmF0ZSB3aGVuIHN0YXJ0IDwgZW5kIHN0YXJ0IHdpdGggbmVnYXRpdmUgc3RlcCIKICAgICAgICApOwogICAgICB9CiAgICAgIGZvciAobGV0IGkgPSBzdGFydDsgaSA+PSBlbmQ7IGkgPSBpICsgc3RlcCkgewogICAgICAgIHNlcS5wdXNoKGkpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gdGhpcy5zeXN0ZW0uaW5pdGlhbGlzZShuZXcgTGlzdChzZXEpKTsKICB9CiAgcmVwbGFjZShzMSwgbWF0Y2gsIHJlcGxhY2VtZW50KSB7CiAgICByZXR1cm4gczEucmVwbGFjZUFsbChtYXRjaCwgcmVwbGFjZW1lbnQpOwogIH0KICBsZW5ndGgoY29sbCkgewogICAgcmV0dXJuIGNvbGwubGVuZ3RoOwogIH0KICB1cHBlckNhc2UoczEpIHsKICAgIHJldHVybiBzMS50b1VwcGVyQ2FzZSgpOwogIH0KICBsb3dlckNhc2UoczEpIHsKICAgIHJldHVybiBzMS50b0xvd2VyQ2FzZSgpOwogIH0KICBpc0JlZm9yZShzMSwgczIpIHsKICAgIHJldHVybiBzMSA8IHMyOwogIH0KICBpc0FmdGVyKHMxLCBzMikgewogICAgcmV0dXJuIHMxID4gczI7CiAgfQogIGlzQWZ0ZXJPclNhbWVBcyhzMSwgczIpIHsKICAgIHJldHVybiBzMSA+IHMyIHx8IHMxID09PSBzMjsKICB9CiAgaXNCZWZvcmVPclNhbWVBcyhzMSwgczIpIHsKICAgIHJldHVybiBzMSA8IHMyIHx8IHMxID09PSBzMjsKICB9CiAgdHJpbShzKSB7CiAgICByZXR1cm4gcy50cmltKCk7CiAgfQogIHNwbGl0KHMsIHNlcGFyYXRvcikgewogICAgcmV0dXJuIHRoaXMuc3lzdGVtLmluaXRpYWxpc2UobmV3IExpc3Qocy5zcGxpdChzZXBhcmF0b3IpKSk7CiAgfQogIGZsb29yKG4pIHsKICAgIHJldHVybiBNYXRoLmZsb29yKG4pOwogIH0KICBpc05hTihuKSB7CiAgICByZXR1cm4gaXNOYU4obik7CiAgfQogIGlzSW5maW5pdGUobikgewogICAgcmV0dXJuIG4gPT09IE51bWJlci5QT1NJVElWRV9JTkZJTklUWSB8fCBuID09PSBOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFk7CiAgfQogIHJvdW5kKG4sIHBsYWNlcykgewogICAgY29uc3Qgc2hpZnQgPSAxMCAqKiBwbGFjZXM7CiAgICByZXR1cm4gTWF0aC5mbG9vcihuICogc2hpZnQgKyAwLjUpIC8gc2hpZnQ7CiAgfQogIGNlaWxpbmcobikgewogICAgY29uc3QgZmwgPSB0aGlzLmZsb29yKG4pOwogICAgcmV0dXJuIG4gPiBmbCA/IGZsICsgMSA6IGZsOwogIH0KICBtYXhGbG9hdChzb3VyY2UpIHsKICAgIHJldHVybiBNYXRoLm1heCguLi5zb3VyY2UpOwogIH0KICBtYXhJbnQoc291cmNlKSB7CiAgICByZXR1cm4gTWF0aC5tYXgoLi4uc291cmNlKTsKICB9CiAgbWluRmxvYXQoc291cmNlKSB7CiAgICByZXR1cm4gTWF0aC5taW4oLi4uc291cmNlKTsKICB9CiAgbWluSW50KHNvdXJjZSkgewogICAgcmV0dXJuIE1hdGgubWluKC4uLnNvdXJjZSk7CiAgfQogIGNvbnRhaW5zKHNvdXJjZSwgaXRlbSkgewogICAgcmV0dXJuIHNvdXJjZS5pbmNsdWRlcyhpdGVtKTsKICB9CiAgcGF1c2UobXMpIHsKICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gewogICAgICBzZXRUaW1lb3V0KCgpID0+IHJlc29sdmUoKSwgbXMpOwogICAgfSk7CiAgfQogIGNsb2NrKCkgewogICAgcmV0dXJuICgvKiBAX19QVVJFX18gKi8gbmV3IERhdGUoKSkuZ2V0VGltZSgpOwogIH0KICByYW5kb20oKSB7CiAgICByZXR1cm4gTWF0aC5yYW5kb20oKTsKICB9CiAgcmFuZG9tSW50KGxvdywgaGlnaCkgewogICAgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChoaWdoIC0gbG93ICsgMSkpICsgbG93OwogIH0KICBwYXJzZUFzRmxvYXQocykgewogICAgaWYgKF9TdGRMaWIubmVnYXRhYmxlTGl0RmxvYXRPbmx5LnRlc3QocykpIHsKICAgICAgY29uc3QgZiA9IHBhcnNlRmxvYXQocyk7CiAgICAgIGlmIChOdW1iZXIuaXNGaW5pdGUoZikpIHsKICAgICAgICByZXR1cm4gdGhpcy5zeXN0ZW0udHVwbGUoW3RydWUsIGZdKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHRoaXMuc3lzdGVtLnR1cGxlKFtmYWxzZSwgMF0pOwogIH0KICBwYXJzZUFzSW50KHMpIHsKICAgIGlmIChfU3RkTGliLm5lZ2F0YWJsZUxpdEludE9ubHkudGVzdChzKSkgewogICAgICBjb25zdCBpID0gcGFyc2VJbnQocyk7CiAgICAgIGlmIChpc0Zpbml0ZShpKSkgewogICAgICAgIHJldHVybiB0aGlzLnN5c3RlbS50dXBsZShbdHJ1ZSwgaV0pOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gdGhpcy5zeXN0ZW0udHVwbGUoW2ZhbHNlLCAwXSk7CiAgfQogIGFzeW5jIHByaW50TGluZShzKSB7CiAgICBhd2FpdCB0aGlzLnN5c3RlbS5lbGFuSW5wdXRPdXRwdXQucHJpbnQoYCR7c30KYCk7CiAgfQogIGFzeW5jIHByaW50Tm9MaW5lKHMpIHsKICAgIGF3YWl0IHRoaXMuc3lzdGVtLmVsYW5JbnB1dE91dHB1dC5wcmludChzKTsKICB9CiAgYXN5bmMgcHJpbnRUYWIocG9zaXRpb24sIHMpIHsKICAgIGF3YWl0IHRoaXMuc3lzdGVtLmVsYW5JbnB1dE91dHB1dC5wcmludFRhYihwb3NpdGlvbiwgcyk7CiAgfQogIGFzeW5jIGNsZWFyUHJpbnRlZFRleHQoKSB7CiAgICBhd2FpdCB0aGlzLnN5c3RlbS5lbGFuSW5wdXRPdXRwdXQuY2xlYXJQcmludGVkVGV4dCgpOwogIH0KICBjcmVhdGVMaXN0KHgsIHZhbHVlKSB7CiAgICBpZiAoIXRoaXMuaXNWYWx1ZVR5cGUodmFsdWUpKSB7CiAgICAgIHRocm93IG5ldyBFbGFuUnVudGltZUVycm9yKGBDYW4gb25seSBjcmVhdGUgTGlzdCB3aXRoIHNpbXBsZSB2YWx1ZWApOwogICAgfQogICAgY29uc3QgdG9Jbml0ID0gW107CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHg7IGkrKykgewogICAgICB0b0luaXRbaV0gPSB2YWx1ZTsKICAgIH0KICAgIHJldHVybiB0aGlzLnN5c3RlbS5pbml0aWFsaXNlKG5ldyBMaXN0KHRvSW5pdCkpOwogIH0KICAvL0lucHV0IGZ1bmN0aW9ucwogIGFzeW5jIHByb21wdChwcm9tcHQpIHsKICAgIGF3YWl0IHRoaXMucHJpbnRMaW5lKHByb21wdCk7CiAgfQogIGFzeW5jIGlucHV0U3RyaW5nKHByb21wdCkgewogICAgYXdhaXQgdGhpcy5wcm9tcHQocHJvbXB0KTsKICAgIHJldHVybiBhd2FpdCB0aGlzLnN5c3RlbS5pbnB1dCgpOwogIH0KICBhc3luYyBpbnB1dFN0cmluZ1dpdGhMaW1pdHMocHJvbXB0LCBtaW5MZW5ndGgsIG1heExlbmd0aCkgewogICAgY29uc3QgcyA9IGF3YWl0IHRoaXMuaW5wdXRTdHJpbmcocHJvbXB0KTsKICAgIGlmIChzLmxlbmd0aCA8IG1pbkxlbmd0aCkgewogICAgICBhd2FpdCB0aGlzLnByb21wdChgbWluaW11bSBsZW5ndGggJHttaW5MZW5ndGh9IGNoYXJhY3RlcnNgKTsKICAgIH0gZWxzZSBpZiAocy5sZW5ndGggPiBtYXhMZW5ndGgpIHsKICAgICAgYXdhaXQgdGhpcy5wcm9tcHQoYG1heGltdW0gbGVuZ3RoICR7bWF4TGVuZ3RofSBjaGFyYWN0ZXJzYCk7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gczsKICAgIH0KICAgIHJldHVybiBhd2FpdCB0aGlzLmlucHV0U3RyaW5nV2l0aExpbWl0cyhwcm9tcHQsIG1pbkxlbmd0aCwgbWF4TGVuZ3RoKTsKICB9CiAgYXN5bmMgaW5wdXRTdHJpbmdGcm9tT3B0aW9ucyhwcm9tcHQsIG9wdGlvbnMpIHsKICAgIGNvbnN0IHMgPSBhd2FpdCB0aGlzLmlucHV0U3RyaW5nKHByb21wdCk7CiAgICBpZiAob3B0aW9ucy5jb250YWlucyhzKSkgewogICAgICByZXR1cm4gczsKICAgIH0KICAgIGNvbnN0IHZhbGlkID0gYXdhaXQgb3B0aW9ucy5hc1N0cmluZygpOwogICAgYXdhaXQgdGhpcy5wcm9tcHQoYHJlc3BvbnNlIG11c3QgYmUgb25lIG9mICR7dmFsaWR9YCk7CiAgICByZXR1cm4gYXdhaXQgdGhpcy5pbnB1dFN0cmluZ0Zyb21PcHRpb25zKHByb21wdCwgb3B0aW9ucyk7CiAgfQogIGFzeW5jIGlucHV0SW50KHByb21wdCkgewogICAgY29uc3QgcyA9IGF3YWl0IHRoaXMuaW5wdXRTdHJpbmcocHJvbXB0KTsKICAgIGNvbnN0IFtiLCBpXSA9IHRoaXMucGFyc2VBc0ludChzKTsKICAgIGlmIChiICYmIGkudG9TdHJpbmcoKSA9PT0gcykgewogICAgICByZXR1cm4gaTsKICAgIH0KICAgIGF3YWl0IHRoaXMucHJvbXB0KCJtdXN0IGJlIGFuIGludGVnZXIiKTsKICAgIHJldHVybiBhd2FpdCB0aGlzLmlucHV0SW50KHByb21wdCk7CiAgfQogIGFzeW5jIGlucHV0SW50QmV0d2Vlbihwcm9tcHQsIG1pbiwgbWF4KSB7CiAgICBjb25zdCBzID0gYXdhaXQgdGhpcy5pbnB1dFN0cmluZyhwcm9tcHQpOwogICAgY29uc3QgW2IsIGldID0gdGhpcy5wYXJzZUFzSW50KHMpOwogICAgaWYgKGIgJiYgaS50b1N0cmluZygpID09PSBzICYmIGkgPj0gbWluICYmIGkgPD0gbWF4KSB7CiAgICAgIHJldHVybiBpOwogICAgfQogICAgYXdhaXQgdGhpcy5wcm9tcHQoYG11c3QgYmUgYW4gaW50ZWdlciBiZXR3ZWVuICR7bWlufSBhbmQgJHttYXh9IGluY2x1c2l2ZWApOwogICAgcmV0dXJuIGF3YWl0IHRoaXMuaW5wdXRJbnRCZXR3ZWVuKHByb21wdCwgbWluLCBtYXgpOwogIH0KICBhc3luYyBpbnB1dEZsb2F0KHByb21wdCkgewogICAgY29uc3QgcyA9IGF3YWl0IHRoaXMuaW5wdXRTdHJpbmcocHJvbXB0KTsKICAgIGNvbnN0IFtiLCBpXSA9IHRoaXMucGFyc2VBc0Zsb2F0KHMpOwogICAgaWYgKGIpIHsKICAgICAgcmV0dXJuIGk7CiAgICB9CiAgICBhd2FpdCB0aGlzLnByb21wdCgibm90IGEgbnVtYmVyIik7CiAgICByZXR1cm4gYXdhaXQgdGhpcy5pbnB1dEZsb2F0KHByb21wdCk7CiAgfQogIGFzeW5jIGlucHV0RmxvYXRCZXR3ZWVuKHByb21wdCwgbWluLCBtYXgpIHsKICAgIGNvbnN0IHMgPSBhd2FpdCB0aGlzLmlucHV0U3RyaW5nKHByb21wdCk7CiAgICBjb25zdCBbYiwgaV0gPSB0aGlzLnBhcnNlQXNGbG9hdChzKTsKICAgIGlmIChiICYmIGkgPj0gbWluICYmIGkgPD0gbWF4KSB7CiAgICAgIHJldHVybiBpOwogICAgfQogICAgYXdhaXQgdGhpcy5wcm9tcHQoYG11c3QgYmUgYSBudW1iZXIgYmV0d2VlbiAke21pbn0gYW5kICR7bWF4fSBpbmNsdXNpdmVgKTsKICAgIHJldHVybiBhd2FpdCB0aGlzLmlucHV0RmxvYXRCZXR3ZWVuKHByb21wdCwgbWluLCBtYXgpOwogIH0KICBhYnMoeCkgewogICAgcmV0dXJuIE1hdGguYWJzKHgpOwogIH0KICBhY29zKHgpIHsKICAgIHJldHVybiBNYXRoLmFjb3MoeCk7CiAgfQogIGFjb3NEZWcobikgewogICAgcmV0dXJuIHRoaXMucmFkVG9EZWcodGhpcy5hY29zKG4pKTsKICB9CiAgYXNpbih4KSB7CiAgICByZXR1cm4gTWF0aC5hc2luKHgpOwogIH0KICBhc2luRGVnKG4pIHsKICAgIHJldHVybiB0aGlzLnJhZFRvRGVnKHRoaXMuYXNpbihuKSk7CiAgfQogIGF0YW4oeCkgewogICAgcmV0dXJuIE1hdGguYXRhbih4KTsKICB9CiAgYXRhbkRlZyhuKSB7CiAgICByZXR1cm4gdGhpcy5yYWRUb0RlZyh0aGlzLmF0YW4obikpOwogIH0KICBjb3MoeCkgewogICAgcmV0dXJuIE1hdGguY29zKHgpOwogIH0KICBjb3NEZWcobikgewogICAgcmV0dXJuIHRoaXMuY29zKHRoaXMuZGVnVG9SYWQobikpOwogIH0KICBleHAoeCkgewogICAgcmV0dXJuIE1hdGguZXhwKHgpOwogIH0KICBsb2dFKHgpIHsKICAgIHJldHVybiBNYXRoLmxvZyh4KTsKICB9CiAgbG9nMTAoeCkgewogICAgcmV0dXJuIE1hdGgubG9nMTAoeCk7CiAgfQogIGxvZzIoeCkgewogICAgcmV0dXJuIE1hdGgubG9nMih4KTsKICB9CiAgc2luKHgpIHsKICAgIHJldHVybiBNYXRoLnNpbih4KTsKICB9CiAgc2luRGVnKG4pIHsKICAgIHJldHVybiB0aGlzLnNpbih0aGlzLmRlZ1RvUmFkKG4pKTsKICB9CiAgc3FydCh4KSB7CiAgICByZXR1cm4gTWF0aC5zcXJ0KHgpOwogIH0KICB0YW4oeCkgewogICAgcmV0dXJuIE1hdGgudGFuKHgpOwogIH0KICB0YW5EZWcobikgewogICAgcmV0dXJuIHRoaXMudGFuKHRoaXMuZGVnVG9SYWQobikpOwogIH0KICBkZWdUb1JhZChkKSB7CiAgICByZXR1cm4gZCAqIHRoaXMucGkgLyAxODA7CiAgfQogIHJhZFRvRGVnKHIpIHsKICAgIHJldHVybiByIC8gdGhpcy5waSAqIDE4MDsKICB9CiAgYml0QW5kKGEsIGIpIHsKICAgIHJldHVybiBhICYgYjsKICB9CiAgYml0T3IoYSwgYikgewogICAgcmV0dXJuIGEgfCBiOwogIH0KICBiaXRYb3IoYSwgYikgewogICAgcmV0dXJuIGEgXiBiOwogIH0KICBiaXROb3QoYSkgewogICAgcmV0dXJuIH5hOwogIH0KICBiaXRTaGlmdEwoYSwgc2hpZnQpIHsKICAgIHJldHVybiBhIDw8IHNoaWZ0OwogIH0KICBiaXRTaGlmdFIoYSwgc2hpZnQpIHsKICAgIHJldHVybiBhID4+PiBzaGlmdDsKICB9CiAgYXNCaW5hcnkoYSkgewogICAgcmV0dXJuIGEudG9TdHJpbmcoMik7CiAgfQogIG1hdGNoZXNSZWdFeHAoYSwgcikgewogICAgcmV0dXJuIHIudGVzdChhKTsKICB9CiAgYXNSZWdFeHAocGF0dGVybikgewogICAgcmV0dXJuIG5ldyBSZWdFeHAocGF0dGVybiwgIiIpOwogIH0KICBvcGVuRmlsZUZvclJlYWRpbmcoKSB7CiAgICByZXR1cm4gdGhpcy5zeXN0ZW0uZWxhbklucHV0T3V0cHV0LnJlYWRGaWxlKCkudGhlbigKICAgICAgKHMpID0+IHsKICAgICAgICBjb25zdCB0ZiA9IHRoaXMuc3lzdGVtLmluaXRpYWxpc2UobmV3IFRleHRGaWxlUmVhZGVyKCkpOwogICAgICAgIHRmLnN0YXR1cyA9IDE7CiAgICAgICAgdGYuY29udGVudCA9IHMgPyBzLnNwbGl0KCJcbiIpIDogW107CiAgICAgICAgcmV0dXJuIHRmOwogICAgICB9LAogICAgICAoZSkgPT4gewogICAgICAgIHRocm93IG5ldyBFbGFuUnVudGltZUVycm9yKGUpOwogICAgICB9CiAgICApOwogIH0KICBjcmVhdGVGaWxlRm9yV3JpdGluZyhmaWxlTmFtZSkgewogICAgY29uc3QgdGYgPSB0aGlzLnN5c3RlbS5pbml0aWFsaXNlKG5ldyBUZXh0RmlsZVdyaXRlcigpKTsKICAgIHRmLmZpbGVOYW1lID0gZmlsZU5hbWU7CiAgICB0Zi5zdGF0dXMgPSAxOwogICAgcmV0dXJuIHRmOwogIH0KICBhc3luYyB3YWl0Rm9yQW55S2V5KCkgewogICAgcmV0dXJuIGF3YWl0IHRoaXMuc3lzdGVtLmVsYW5JbnB1dE91dHB1dC53YWl0Rm9yQW55S2V5KCk7CiAgfQogIGFzeW5jIHByZXNzQW55S2V5VG9Db250aW51ZShwcm9tcHQpIHsKICAgIGlmIChwcm9tcHQpIHsKICAgICAgYXdhaXQgdGhpcy5wcm9tcHQoIlByZXNzIGFueSBrZXkgdG8gY29udGludWUiKTsKICAgIH0KICAgIGF3YWl0IHRoaXMud2FpdEZvcktleSgpOwogICAgcmV0dXJuOwogIH0KICBhc3luYyB3YWl0Rm9yS2V5KCkgewogICAgcmV0dXJuIGF3YWl0IHRoaXMuc3lzdGVtLmVsYW5JbnB1dE91dHB1dC53YWl0Rm9yS2V5KCk7CiAgfQogIGFzeW5jIGdldEtleSgpIHsKICAgIHJldHVybiBhd2FpdCB0aGlzLnN5c3RlbS5lbGFuSW5wdXRPdXRwdXQuZ2V0S2V5KCk7CiAgfQogIGFzeW5jIGdldEtleVdpdGhNb2RpZmllcigpIHsKICAgIHJldHVybiBhd2FpdCB0aGlzLnN5c3RlbS5lbGFuSW5wdXRPdXRwdXQuZ2V0S2V5V2l0aE1vZGlmaWVyKCk7CiAgfQogIGFzeW5jIGNsZWFyS2V5QnVmZmVyKCkgewogICAgYXdhaXQgdGhpcy5zeXN0ZW0uZWxhbklucHV0T3V0cHV0LmNsZWFyS2V5QnVmZmVyKCk7CiAgfQogIGJsb2Nrc0FzSHRtbChibG9ja3MpIHsKICAgIGxldCByZW5kZXJlZCA9IGBgOwogICAgZm9yIChsZXQgeSA9IDA7IHkgPCAzMDsgeSsrKSB7CiAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgNDA7IHgrKykgewogICAgICAgIGNvbnN0IGNvbG91ciA9IGJsb2Nrcy5yZWFkKHgsIHkpOwogICAgICAgIHJlbmRlcmVkID0gYCR7cmVuZGVyZWR9PGRpdiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjoke3RoaXMuYXNIZXgoY29sb3VyKX07Ij48L2Rpdj5gOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcmVuZGVyZWQ7CiAgfQogIGFzSGV4KG4pIHsKICAgIGNvbnN0IGggPSAiMDAwMDAwIiArIG4udG9TdHJpbmcoMTYpOwogICAgY29uc3QgaDYgPSBoLnN1YnN0cmluZyhoLmxlbmd0aCAtIDYpOwogICAgcmV0dXJuIGAjJHtoNn1gOwogIH0KICBhc3luYyBkaXNwbGF5QmxvY2tzKGJsb2NrcykgewogICAgaWYgKGJsb2Nrcy5jb2x1bW5zKCkgIT09IDQwIHx8IGJsb2Nrcy5yb3dzKCkgIT09IDMwKSB7CiAgICAgIHRocm93IG5ldyBFbGFuUnVudGltZUVycm9yKGBhcmd1bWVudCBtdXN0IGJlIEFycmF5MkQ8b2YgSW50PiB3aXRoIGRpbWVuc2lvbnMgNDAgeCAzMGApOwogICAgfQogICAgY29uc3QgaHRtbCA9IHRoaXMuYmxvY2tzQXNIdG1sKGJsb2Nrcyk7CiAgICByZXR1cm4gYXdhaXQgdGhpcy5zeXN0ZW0uZWxhbklucHV0T3V0cHV0LmRyYXdCbG9ja0dyYXBoaWNzKGh0bWwpOwogIH0KICBhc3luYyBjbGVhckJsb2NrcygpIHsKICAgIGF3YWl0IHRoaXMuc3lzdGVtLmVsYW5JbnB1dE91dHB1dC5jbGVhckJsb2NrR3JhcGhpY3MoKTsKICB9CiAgdmVjdG9yR3JhcGhpY3NBc0h0bWwodmdzKSB7CiAgICBsZXQgY29udGVudCA9IGBgOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCB2Z3MubGVuZ3RoKCk7IGkrKykgewogICAgICBjb25zdCB2ZyA9IHZncy5yZWFkKGkpOwogICAgICBjb250ZW50ID0gY29udGVudCArIHZnLmFzU1ZHKCkgKyAiXG4iOwogICAgfQogICAgY29uc3QgaHRtbCA9IGA8c3ZnIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiR7Y29udGVudH08L3N2Zz4KYDsKICAgIHJldHVybiBodG1sOwogIH0KICBhc3luYyBkaXNwbGF5VmVjdG9yR3JhcGhpY3ModmdzKSB7CiAgICBjb25zdCBodG1sID0gdGhpcy52ZWN0b3JHcmFwaGljc0FzSHRtbCh2Z3MpOwogICAgcmV0dXJuIGF3YWl0IHRoaXMuc3lzdGVtLmVsYW5JbnB1dE91dHB1dC5kcmF3VmVjdG9yR3JhcGhpY3MoaHRtbCk7CiAgfQogIGFzeW5jIGNsZWFyVmVjdG9yR3JhcGhpY3MoKSB7CiAgICBhd2FpdCB0aGlzLnN5c3RlbS5lbGFuSW5wdXRPdXRwdXQuY2xlYXJWZWN0b3JHcmFwaGljcygpOwogIH0KICBhc3luYyBkaXNwbGF5SHRtbChodG1sKSB7CiAgICByZXR1cm4gYXdhaXQgdGhpcy5zeXN0ZW0uZWxhbklucHV0T3V0cHV0LmRyYXdIdG1sKGh0bWwpOwogIH0KICBhc3luYyBjbGVhckh0bWwoKSB7CiAgICByZXR1cm4gYXdhaXQgdGhpcy5zeXN0ZW0uZWxhbklucHV0T3V0cHV0LmNsZWFySHRtbCgpOwogIH0KICBhc3luYyB0b25lKGR1cmF0aW9uLCBmcmVxdWVuY3ksIHZvbHVtZSkgewogICAgYXdhaXQgdGhpcy5zeXN0ZW0uZWxhbklucHV0T3V0cHV0LnRvbmUoZHVyYXRpb24sIGZyZXF1ZW5jeSwgdm9sdW1lKTsKICB9Cn07Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkNsYXNzRXhwb3J0KFRleHRGaWxlUmVhZGVyKQpdLCBfU3RkTGliLnByb3RvdHlwZSwgIlRleHRGaWxlUmVhZGVyIiwgMik7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkNsYXNzRXhwb3J0KFRleHRGaWxlV3JpdGVyKQpdLCBfU3RkTGliLnByb3RvdHlwZSwgIlRleHRGaWxlV3JpdGVyIiwgMik7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkNsYXNzRXhwb3J0KFJhbmRvbSkKXSwgX1N0ZExpYi5wcm90b3R5cGUsICJSYW5kb20iLCAyKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuQ2xhc3NFeHBvcnQoU3RhY2spCl0sIF9TdGRMaWIucHJvdG90eXBlLCAiU3RhY2siLCAyKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuQ2xhc3NFeHBvcnQoUXVldWUpCl0sIF9TdGRMaWIucHJvdG90eXBlLCAiUXVldWUiLCAyKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuQ2xhc3NFeHBvcnQoRWxhblNldCkKXSwgX1N0ZExpYi5wcm90b3R5cGUsICJTZXQiLCAyKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuQ2xhc3NFeHBvcnQoVHVydGxlKQpdLCBfU3RkTGliLnByb3RvdHlwZSwgIlR1cnRsZSIsIDIpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5DbGFzc0V4cG9ydChWZWN0b3JHcmFwaGljKQpdLCBfU3RkTGliLnByb3RvdHlwZSwgIlZlY3RvckdyYXBoaWMiLCAyKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuQ2xhc3NFeHBvcnQoQ2lyY2xlVkcpCl0sIF9TdGRMaWIucHJvdG90eXBlLCAiQ2lyY2xlVkciLCAyKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuQ2xhc3NFeHBvcnQoTGluZVZHKQpdLCBfU3RkTGliLnByb3RvdHlwZSwgIkxpbmVWRyIsIDIpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5DbGFzc0V4cG9ydChSZWN0YW5nbGVWRykKXSwgX1N0ZExpYi5wcm90b3R5cGUsICJSZWN0YW5nbGVWRyIsIDIpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5DbGFzc0V4cG9ydChJbWFnZVZHKQpdLCBfU3RkTGliLnByb3RvdHlwZSwgIkltYWdlVkciLCAyKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuQ2xhc3NFeHBvcnQoTGlzdCkKXSwgX1N0ZExpYi5wcm90b3R5cGUsICJMaXN0IiwgMik7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkNsYXNzRXhwb3J0KEVsYW5BcnJheSkKXSwgX1N0ZExpYi5wcm90b3R5cGUsICJBcnJheSIsIDIpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5DbGFzc0V4cG9ydChFbGFuQXJyYXkyRCkKXSwgX1N0ZExpYi5wcm90b3R5cGUsICJBcnJheTJEIiwgMik7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkNsYXNzRXhwb3J0KExpc3RJbW11dGFibGUpCl0sIF9TdGRMaWIucHJvdG90eXBlLCAiTGlzdEltbXV0YWJsZSIsIDIpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5DbGFzc0V4cG9ydChEaWN0aW9uYXJ5KQpdLCBfU3RkTGliLnByb3RvdHlwZSwgIkRpY3Rpb25hcnkiLCAyKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuQ2xhc3NFeHBvcnQoRGljdGlvbmFyeUltbXV0YWJsZSkKXSwgX1N0ZExpYi5wcm90b3R5cGUsICJEaWN0aW9uYXJ5SW1tdXRhYmxlIiwgMik7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkNvbnN0YW50KEVsYW5JbnQpCl0sIF9TdGRMaWIucHJvdG90eXBlLCAiYmxhY2siLCAyKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuQ29uc3RhbnQoRWxhbkludCkKXSwgX1N0ZExpYi5wcm90b3R5cGUsICJncmV5IiwgMik7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkNvbnN0YW50KEVsYW5JbnQpCl0sIF9TdGRMaWIucHJvdG90eXBlLCAid2hpdGUiLCAyKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuQ29uc3RhbnQoRWxhbkludCkKXSwgX1N0ZExpYi5wcm90b3R5cGUsICJyZWQiLCAyKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuQ29uc3RhbnQoRWxhbkludCkKXSwgX1N0ZExpYi5wcm90b3R5cGUsICJncmVlbiIsIDIpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5Db25zdGFudChFbGFuSW50KQpdLCBfU3RkTGliLnByb3RvdHlwZSwgImJsdWUiLCAyKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuQ29uc3RhbnQoRWxhbkludCkKXSwgX1N0ZExpYi5wcm90b3R5cGUsICJ5ZWxsb3ciLCAyKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuQ29uc3RhbnQoRWxhbkludCkKXSwgX1N0ZExpYi5wcm90b3R5cGUsICJicm93biIsIDIpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5Db25zdGFudChFbGFuSW50KQpdLCBfU3RkTGliLnByb3RvdHlwZSwgInRyYW5zcGFyZW50IiwgMik7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkNvbnN0YW50KEVsYW5Cb29sZWFuKQpdLCBfU3RkTGliLnByb3RvdHlwZSwgInRydWUiLCAyKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuQ29uc3RhbnQoRWxhbkJvb2xlYW4pCl0sIF9TdGRMaWIucHJvdG90eXBlLCAiZmFsc2UiLCAyKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuQ29uc3RhbnQoKQpdLCBfU3RkTGliLnByb3RvdHlwZSwgInBpIiwgMik7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkNvbnN0YW50KEVsYW5JbnQpCl0sIF9TdGRMaWIucHJvdG90eXBlLCAibWVhbmluZ09mTGlmZSIsIDIpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5Db25zdGFudChFbGFuU3RyaW5nKQpdLCBfU3RkTGliLnByb3RvdHlwZSwgInF1b3RlcyIsIDIpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5Db25zdGFudChFbGFuU3RyaW5nKQpdLCBfU3RkTGliLnByb3RvdHlwZSwgIm9wZW5CcmFjZSIsIDIpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5Db25zdGFudChFbGFuU3RyaW5nKQpdLCBfU3RkTGliLnByb3RvdHlwZSwgImNsb3NlQnJhY2UiLCAyKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oW10sIDMgLyogcHVyZUFzeW5jRXh0ZW5zaW9uICovLCBFbGFuU3RyaW5nKSwKICBfX2RlY29yYXRlUGFyYW0oMCwgZWxhbkdlbmVyaWNQYXJhbVQxVHlwZSgpKQpdLCBfU3RkTGliLnByb3RvdHlwZSwgImFzU3RyaW5nIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFsidmFsdWUiXSksCiAgX19kZWNvcmF0ZVBhcmFtKDAsIGVsYW5JbnRUeXBlKCkpCl0sIF9TdGRMaWIucHJvdG90eXBlLCAidW5pY29kZSIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbImNoYXJhY3RlciJdLCAxIC8qIHB1cmVFeHRlbnNpb24gKi8sIEVsYW5JbnQpCl0sIF9TdGRMaWIucHJvdG90eXBlLCAiYXNVbmljb2RlIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFsiIiwgIml0ZW0iXSwgMSAvKiBwdXJlRXh0ZW5zaW9uICovLCBFbGFuSW50KSwKICBfX2RlY29yYXRlUGFyYW0oMCwgZWxhblN0cmluZ1R5cGUoKSksCiAgX19kZWNvcmF0ZVBhcmFtKDEsIGVsYW5TdHJpbmdUeXBlKCkpCl0sIF9TdGRMaWIucHJvdG90eXBlLCAiaW5kZXhPZiIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbInN0YXJ0IiwgImVuZCJdLCAwIC8qIHB1cmUgKi8sIEVsYW5DbGFzcyhMaXN0LCBbRWxhbkludF0pKSwKICBfX2RlY29yYXRlUGFyYW0oMCwgZWxhbkludFR5cGUoKSksCiAgX19kZWNvcmF0ZVBhcmFtKDEsIGVsYW5JbnRUeXBlKCkpCl0sIF9TdGRMaWIucHJvdG90eXBlLCAic2VxdWVuY2UiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oWyJzdGFydCIsICJlbmQiLCAic3RlcCJdLCAwIC8qIHB1cmUgKi8sIEVsYW5DbGFzcyhMaXN0LCBbRWxhbkludF0pKSwKICBfX2RlY29yYXRlUGFyYW0oMCwgZWxhbkludFR5cGUoKSksCiAgX19kZWNvcmF0ZVBhcmFtKDEsIGVsYW5JbnRUeXBlKCkpLAogIF9fZGVjb3JhdGVQYXJhbSgyLCBlbGFuSW50VHlwZSgpKQpdLCBfU3RkTGliLnByb3RvdHlwZSwgInNlcXVlbmNlV2l0aFN0ZXAiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oWyJtYXRjaCIsICJyZXBsYWNlbWVudCJdLCAxIC8qIHB1cmVFeHRlbnNpb24gKi8pCl0sIF9TdGRMaWIucHJvdG90eXBlLCAicmVwbGFjZSIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbXSwgMSAvKiBwdXJlRXh0ZW5zaW9uICovLCBFbGFuSW50KQpdLCBfU3RkTGliLnByb3RvdHlwZSwgImxlbmd0aCIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbXSwgMSAvKiBwdXJlRXh0ZW5zaW9uICovKQpdLCBfU3RkTGliLnByb3RvdHlwZSwgInVwcGVyQ2FzZSIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbXSwgMSAvKiBwdXJlRXh0ZW5zaW9uICovKQpdLCBfU3RkTGliLnByb3RvdHlwZSwgImxvd2VyQ2FzZSIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbIm90aGVyIl0sIDEgLyogcHVyZUV4dGVuc2lvbiAqLykKXSwgX1N0ZExpYi5wcm90b3R5cGUsICJpc0JlZm9yZSIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbIm90aGVyIl0sIDEgLyogcHVyZUV4dGVuc2lvbiAqLykKXSwgX1N0ZExpYi5wcm90b3R5cGUsICJpc0FmdGVyIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFsib3RoZXIiXSwgMSAvKiBwdXJlRXh0ZW5zaW9uICovKQpdLCBfU3RkTGliLnByb3RvdHlwZSwgImlzQWZ0ZXJPclNhbWVBcyIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbIiIsICJvdGhlciJdLCAxIC8qIHB1cmVFeHRlbnNpb24gKi8pCl0sIF9TdGRMaWIucHJvdG90eXBlLCAiaXNCZWZvcmVPclNhbWVBcyIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbXSwgMSAvKiBwdXJlRXh0ZW5zaW9uICovKQpdLCBfU3RkTGliLnByb3RvdHlwZSwgInRyaW0iLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oWyIiLCAic2VwYXJhdG9yIl0sIDEgLyogcHVyZUV4dGVuc2lvbiAqLywgRWxhbkNsYXNzKExpc3QsIFtFbGFuU3RyaW5nXSkpCl0sIF9TdGRMaWIucHJvdG90eXBlLCAic3BsaXQiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oWyJudW1iZXIiXSwgMSAvKiBwdXJlRXh0ZW5zaW9uICovLCBFbGFuSW50KQpdLCBfU3RkTGliLnByb3RvdHlwZSwgImZsb29yIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFsibnVtYmVyIl0sIDEgLyogcHVyZUV4dGVuc2lvbiAqLywgRWxhbkJvb2xlYW4pCl0sIF9TdGRMaWIucHJvdG90eXBlLCAiaXNOYU4iLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oWyJudW1iZXIiXSwgMSAvKiBwdXJlRXh0ZW5zaW9uICovLCBFbGFuQm9vbGVhbikKXSwgX1N0ZExpYi5wcm90b3R5cGUsICJpc0luZmluaXRlIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFsibnVtYmVyIiwgImRlY2ltYWxQbGFjZXMiXSwgMSAvKiBwdXJlRXh0ZW5zaW9uICovKSwKICBfX2RlY29yYXRlUGFyYW0oMSwgZWxhbkludFR5cGUoKSkKXSwgX1N0ZExpYi5wcm90b3R5cGUsICJyb3VuZCIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbIm51bWJlciJdLCAxIC8qIHB1cmVFeHRlbnNpb24gKi8sIEVsYW5JbnQpCl0sIF9TdGRMaWIucHJvdG90eXBlLCAiY2VpbGluZyIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbImxpc3RPZkZsb2F0Il0sIDAgLyogcHVyZSAqLywgRWxhbkZsb2F0KSwKICBfX2RlY29yYXRlUGFyYW0oMCwgZWxhbkNsYXNzVHlwZShMaXN0LCBbRWxhbkZsb2F0XSkpCl0sIF9TdGRMaWIucHJvdG90eXBlLCAibWF4RmxvYXQiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oWyJsaXN0T2ZJbnQiXSwgMCAvKiBwdXJlICovLCBFbGFuSW50KSwKICBfX2RlY29yYXRlUGFyYW0oMCwgZWxhbkNsYXNzVHlwZShMaXN0LCBbRWxhbkludF0pKQpdLCBfU3RkTGliLnByb3RvdHlwZSwgIm1heEludCIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbImxpc3RPZkZsb2F0Il0sIDAgLyogcHVyZSAqLywgRWxhbkZsb2F0KSwKICBfX2RlY29yYXRlUGFyYW0oMCwgZWxhbkNsYXNzVHlwZShMaXN0LCBbRWxhbkZsb2F0XSkpCl0sIF9TdGRMaWIucHJvdG90eXBlLCAibWluRmxvYXQiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oWyJsaXN0T2ZJbnQiXSwgMCAvKiBwdXJlICovLCBFbGFuSW50KSwKICBfX2RlY29yYXRlUGFyYW0oMCwgZWxhbkNsYXNzVHlwZShMaXN0LCBbRWxhbkludF0pKQpdLCBfU3RkTGliLnByb3RvdHlwZSwgIm1pbkludCIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbIiIsICJpdGVtIl0sIDEgLyogcHVyZUV4dGVuc2lvbiAqLykKXSwgX1N0ZExpYi5wcm90b3R5cGUsICJjb250YWlucyIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5Qcm9jZWR1cmUoWyJtaWxsaXNlY29uZHMiXSwgMiAvKiBhc3luYyAqLyksCiAgX19kZWNvcmF0ZVBhcmFtKDAsIGVsYW5JbnRUeXBlKCkpCl0sIF9TdGRMaWIucHJvdG90eXBlLCAicGF1c2UiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oW10sIDQgLyogaW1wdXJlICovLCBFbGFuSW50KQpdLCBfU3RkTGliLnByb3RvdHlwZSwgImNsb2NrIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFtdLCA0IC8qIGltcHVyZSAqLykKXSwgX1N0ZExpYi5wcm90b3R5cGUsICJyYW5kb20iLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oWyJsb3ciLCAiaGlnaCJdLCA0IC8qIGltcHVyZSAqLywgRWxhbkludCksCiAgX19kZWNvcmF0ZVBhcmFtKDAsIGVsYW5JbnRUeXBlKCkpLAogIF9fZGVjb3JhdGVQYXJhbSgxLCBlbGFuSW50VHlwZSgpKQpdLCBfU3RkTGliLnByb3RvdHlwZSwgInJhbmRvbUludCIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbInN0cmluZyJdLCAwIC8qIHB1cmUgKi8sIEVsYW5UdXBsZShbRWxhbkJvb2xlYW4sIEVsYW5GbG9hdF0pKQpdLCBfU3RkTGliLnByb3RvdHlwZSwgInBhcnNlQXNGbG9hdCIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbInN0cmluZyJdLCAwIC8qIHB1cmUgKi8sIEVsYW5UdXBsZShbRWxhbkJvb2xlYW4sIEVsYW5JbnRdKSkKXSwgX1N0ZExpYi5wcm90b3R5cGUsICJwYXJzZUFzSW50IiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhblByb2NlZHVyZShbInRleHQiXSwgMiAvKiBhc3luYyAqLykKXSwgX1N0ZExpYi5wcm90b3R5cGUsICJwcmludExpbmUiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuUHJvY2VkdXJlKFsidGV4dCJdLCAyIC8qIGFzeW5jICovKQpdLCBfU3RkTGliLnByb3RvdHlwZSwgInByaW50Tm9MaW5lIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhblByb2NlZHVyZShbInBvc2l0aW9uIiwgInRleHQiXSwgMiAvKiBhc3luYyAqLyksCiAgX19kZWNvcmF0ZVBhcmFtKDAsIGVsYW5JbnRUeXBlKCkpCl0sIF9TdGRMaWIucHJvdG90eXBlLCAicHJpbnRUYWIiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuUHJvY2VkdXJlKFtdLCAyIC8qIGFzeW5jICovKQpdLCBfU3RkTGliLnByb3RvdHlwZSwgImNsZWFyUHJpbnRlZFRleHQiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oWyJzaXplIiwgImluaXRpYWxWYWx1ZSJdLCAwIC8qIHB1cmUgKi8sIEVsYW5DbGFzcyhMaXN0KSksCiAgX19kZWNvcmF0ZVBhcmFtKDAsIGVsYW5JbnRUeXBlKCkpLAogIF9fZGVjb3JhdGVQYXJhbSgxLCBlbGFuR2VuZXJpY1BhcmFtVDFUeXBlKCkpCl0sIF9TdGRMaWIucHJvdG90eXBlLCAiY3JlYXRlTGlzdCIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbInByb21wdCJdLCA2IC8qIGltcHVyZUFzeW5jICovLCBFbGFuU3RyaW5nKQpdLCBfU3RkTGliLnByb3RvdHlwZSwgImlucHV0U3RyaW5nIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFsicHJvbXB0IiwgIm1pbkxlbmd0aCIsICJtYXhMZW5ndGgiXSwgNiAvKiBpbXB1cmVBc3luYyAqLywgRWxhblN0cmluZyksCiAgX19kZWNvcmF0ZVBhcmFtKDEsIGVsYW5JbnRUeXBlKCkpLAogIF9fZGVjb3JhdGVQYXJhbSgyLCBlbGFuSW50VHlwZSgpKQpdLCBfU3RkTGliLnByb3RvdHlwZSwgImlucHV0U3RyaW5nV2l0aExpbWl0cyIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbInByb21wdCIsICJvcHRpb25zIl0sIDYgLyogaW1wdXJlQXN5bmMgKi8sIEVsYW5TdHJpbmcpLAogIF9fZGVjb3JhdGVQYXJhbSgxLCBlbGFuQ2xhc3NUeXBlKExpc3QsIFtFbGFuU3RyaW5nXSkpCl0sIF9TdGRMaWIucHJvdG90eXBlLCAiaW5wdXRTdHJpbmdGcm9tT3B0aW9ucyIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbInByb21wdCJdLCA2IC8qIGltcHVyZUFzeW5jICovLCBFbGFuSW50KQpdLCBfU3RkTGliLnByb3RvdHlwZSwgImlucHV0SW50IiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFsicHJvbXB0IiwgIm1pblZhbHVlIiwgIm1heFZhbHVlIl0sIDYgLyogaW1wdXJlQXN5bmMgKi8sIEVsYW5JbnQpLAogIF9fZGVjb3JhdGVQYXJhbSgxLCBlbGFuSW50VHlwZSgpKSwKICBfX2RlY29yYXRlUGFyYW0oMiwgZWxhbkludFR5cGUoKSkKXSwgX1N0ZExpYi5wcm90b3R5cGUsICJpbnB1dEludEJldHdlZW4iLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oWyJwcm9tcHQiXSwgNiAvKiBpbXB1cmVBc3luYyAqLywgRWxhbkZsb2F0KQpdLCBfU3RkTGliLnByb3RvdHlwZSwgImlucHV0RmxvYXQiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oWyJwcm9tcHQiLCAibWluVmFsdWUiLCAibWF4VmFsdWUiXSwgNiAvKiBpbXB1cmVBc3luYyAqLywgRWxhbkZsb2F0KQpdLCBfU3RkTGliLnByb3RvdHlwZSwgImlucHV0RmxvYXRCZXR3ZWVuIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFsibnVtYmVyIl0pCl0sIF9TdGRMaWIucHJvdG90eXBlLCAiYWJzIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFsidmFsdWUiXSkKXSwgX1N0ZExpYi5wcm90b3R5cGUsICJhY29zIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFsidmFsdWUiXSkKXSwgX1N0ZExpYi5wcm90b3R5cGUsICJhY29zRGVnIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFsidmFsdWUiXSkKXSwgX1N0ZExpYi5wcm90b3R5cGUsICJhc2luIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFsidmFsdWUiXSkKXSwgX1N0ZExpYi5wcm90b3R5cGUsICJhc2luRGVnIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFsidmFsdWUiXSkKXSwgX1N0ZExpYi5wcm90b3R5cGUsICJhdGFuIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFsidmFsdWUiXSkKXSwgX1N0ZExpYi5wcm90b3R5cGUsICJhdGFuRGVnIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFsicmFkaWFucyJdKQpdLCBfU3RkTGliLnByb3RvdHlwZSwgImNvcyIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbImRlZ3JlZXMiXSkKXSwgX1N0ZExpYi5wcm90b3R5cGUsICJjb3NEZWciLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oWyJ4Il0pCl0sIF9TdGRMaWIucHJvdG90eXBlLCAiZXhwIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFsibnVtYmVyIl0pCl0sIF9TdGRMaWIucHJvdG90eXBlLCAibG9nRSIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbIm51bWJlciJdKQpdLCBfU3RkTGliLnByb3RvdHlwZSwgImxvZzEwIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFsibnVtYmVyIl0pCl0sIF9TdGRMaWIucHJvdG90eXBlLCAibG9nMiIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbInJhZGlhbnMiXSkKXSwgX1N0ZExpYi5wcm90b3R5cGUsICJzaW4iLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oWyJkZWdyZWVzIl0pCl0sIF9TdGRMaWIucHJvdG90eXBlLCAic2luRGVnIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFsibnVtYmVyIl0pCl0sIF9TdGRMaWIucHJvdG90eXBlLCAic3FydCIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbInJhZGlhbnMiXSkKXSwgX1N0ZExpYi5wcm90b3R5cGUsICJ0YW4iLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oWyJkZWdyZWVzIl0pCl0sIF9TdGRMaWIucHJvdG90eXBlLCAidGFuRGVnIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFsiZGVncmVlcyJdKQpdLCBfU3RkTGliLnByb3RvdHlwZSwgImRlZ1RvUmFkIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFsicmFkaWFucyJdKQpdLCBfU3RkTGliLnByb3RvdHlwZSwgInJhZFRvRGVnIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFsiYSIsICJiIl0sIDAgLyogcHVyZSAqLywgRWxhbkludCksCiAgX19kZWNvcmF0ZVBhcmFtKDAsIGVsYW5JbnRUeXBlKCkpLAogIF9fZGVjb3JhdGVQYXJhbSgxLCBlbGFuSW50VHlwZSgpKQpdLCBfU3RkTGliLnByb3RvdHlwZSwgImJpdEFuZCIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbImEiLCAiYiJdLCAwIC8qIHB1cmUgKi8sIEVsYW5JbnQpLAogIF9fZGVjb3JhdGVQYXJhbSgwLCBlbGFuSW50VHlwZSgpKSwKICBfX2RlY29yYXRlUGFyYW0oMSwgZWxhbkludFR5cGUoKSkKXSwgX1N0ZExpYi5wcm90b3R5cGUsICJiaXRPciIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbImEiLCAiYiJdLCAwIC8qIHB1cmUgKi8sIEVsYW5JbnQpLAogIF9fZGVjb3JhdGVQYXJhbSgwLCBlbGFuSW50VHlwZSgpKSwKICBfX2RlY29yYXRlUGFyYW0oMSwgZWxhbkludFR5cGUoKSkKXSwgX1N0ZExpYi5wcm90b3R5cGUsICJiaXRYb3IiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oWyJhIl0sIDAgLyogcHVyZSAqLywgRWxhbkludCksCiAgX19kZWNvcmF0ZVBhcmFtKDAsIGVsYW5JbnRUeXBlKCkpCl0sIF9TdGRMaWIucHJvdG90eXBlLCAiYml0Tm90IiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFsiYSJdLCAwIC8qIHB1cmUgKi8sIEVsYW5JbnQpLAogIF9fZGVjb3JhdGVQYXJhbSgwLCBlbGFuSW50VHlwZSgpKSwKICBfX2RlY29yYXRlUGFyYW0oMSwgZWxhbkludFR5cGUoKSkKXSwgX1N0ZExpYi5wcm90b3R5cGUsICJiaXRTaGlmdEwiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oWyJhIl0sIDAgLyogcHVyZSAqLywgRWxhbkludCksCiAgX19kZWNvcmF0ZVBhcmFtKDAsIGVsYW5JbnRUeXBlKCkpLAogIF9fZGVjb3JhdGVQYXJhbSgxLCBlbGFuSW50VHlwZSgpKQpdLCBfU3RkTGliLnByb3RvdHlwZSwgImJpdFNoaWZ0UiIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbXSwgMSAvKiBwdXJlRXh0ZW5zaW9uICovKSwKICBfX2RlY29yYXRlUGFyYW0oMCwgZWxhbkludFR5cGUoKSkKXSwgX1N0ZExpYi5wcm90b3R5cGUsICJhc0JpbmFyeSIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbIiIsICJyZWdFeHAiXSwgMSAvKiBwdXJlRXh0ZW5zaW9uICovKQpdLCBfU3RkTGliLnByb3RvdHlwZSwgIm1hdGNoZXNSZWdFeHAiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oW10sIDEgLyogcHVyZUV4dGVuc2lvbiAqLykKXSwgX1N0ZExpYi5wcm90b3R5cGUsICJhc1JlZ0V4cCIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbXSwgNiAvKiBpbXB1cmVBc3luYyAqLywgRWxhbkNsYXNzKFRleHRGaWxlUmVhZGVyKSkKXSwgX1N0ZExpYi5wcm90b3R5cGUsICJvcGVuRmlsZUZvclJlYWRpbmciLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oWyJmaWxlTmFtZSJdLCAwIC8qIHB1cmUgKi8sIEVsYW5DbGFzcyhUZXh0RmlsZVdyaXRlcikpCl0sIF9TdGRMaWIucHJvdG90eXBlLCAiY3JlYXRlRmlsZUZvcldyaXRpbmciLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRGVwcmVjYXRlZCg2IC8qIG1ldGhvZEhpZGRlbiAqLywgMSwgMSwgIiIpLAogIGVsYW5Qcm9jZWR1cmUoW10sIDIgLyogYXN5bmMgKi8pCl0sIF9TdGRMaWIucHJvdG90eXBlLCAid2FpdEZvckFueUtleSIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5Qcm9jZWR1cmUoWyJwcm9tcHQiXSwgMiAvKiBhc3luYyAqLykKXSwgX1N0ZExpYi5wcm90b3R5cGUsICJwcmVzc0FueUtleVRvQ29udGludWUiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oW10sIDYgLyogaW1wdXJlQXN5bmMgKi8sIEVsYW5TdHJpbmcpCl0sIF9TdGRMaWIucHJvdG90eXBlLCAid2FpdEZvcktleSIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5GdW5jdGlvbihbXSwgNiAvKiBpbXB1cmVBc3luYyAqLywgRWxhblN0cmluZykKXSwgX1N0ZExpYi5wcm90b3R5cGUsICJnZXRLZXkiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oW10sIDYgLyogaW1wdXJlQXN5bmMgKi8sIEVsYW5UdXBsZShbRWxhblN0cmluZywgRWxhblN0cmluZ10pKQpdLCBfU3RkTGliLnByb3RvdHlwZSwgImdldEtleVdpdGhNb2RpZmllciIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5Qcm9jZWR1cmUoW10sIDIgLyogYXN5bmMgKi8pCl0sIF9TdGRMaWIucHJvdG90eXBlLCAiY2xlYXJLZXlCdWZmZXIiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuRnVuY3Rpb24oWyIiXSwgMSAvKiBwdXJlRXh0ZW5zaW9uICovKSwKICBfX2RlY29yYXRlUGFyYW0oMCwgZWxhbkNsYXNzVHlwZShFbGFuQXJyYXkyRCwgW0VsYW5JbnRdKSkKXSwgX1N0ZExpYi5wcm90b3R5cGUsICJibG9ja3NBc0h0bWwiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuUHJvY2VkdXJlKFsiYmxvY2tzIl0sIDIgLyogYXN5bmMgKi8pLAogIF9fZGVjb3JhdGVQYXJhbSgwLCBlbGFuQ2xhc3NUeXBlKEVsYW5BcnJheTJELCBbRWxhbkludF0pKQpdLCBfU3RkTGliLnByb3RvdHlwZSwgImRpc3BsYXlCbG9ja3MiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuUHJvY2VkdXJlKFtdLCAyIC8qIGFzeW5jICovKQpdLCBfU3RkTGliLnByb3RvdHlwZSwgImNsZWFyQmxvY2tzIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhbkZ1bmN0aW9uKFsiIl0sIDEgLyogcHVyZUV4dGVuc2lvbiAqLyksCiAgX19kZWNvcmF0ZVBhcmFtKDAsIGVsYW5DbGFzc1R5cGUoTGlzdCwgW0VsYW5UMUNvbnN0cmFpbmVkKEVsYW5DbGFzcyhWZWN0b3JHcmFwaGljKSldKSkKXSwgX1N0ZExpYi5wcm90b3R5cGUsICJ2ZWN0b3JHcmFwaGljc0FzSHRtbCIsIDEpOwpfX2RlY29yYXRlQ2xhc3MoWwogIGVsYW5Qcm9jZWR1cmUoWyJsaXN0T2ZWR3MiXSwgMiAvKiBhc3luYyAqLyksCiAgX19kZWNvcmF0ZVBhcmFtKDAsIGVsYW5DbGFzc1R5cGUoTGlzdCwgW0VsYW5UMUNvbnN0cmFpbmVkKEVsYW5DbGFzcyhWZWN0b3JHcmFwaGljKSldKSkKXSwgX1N0ZExpYi5wcm90b3R5cGUsICJkaXNwbGF5VmVjdG9yR3JhcGhpY3MiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuUHJvY2VkdXJlKFtdLCAyIC8qIGFzeW5jICovKQpdLCBfU3RkTGliLnByb3RvdHlwZSwgImNsZWFyVmVjdG9yR3JhcGhpY3MiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuUHJvY2VkdXJlKFsiaHRtbCJdLCAyIC8qIGFzeW5jICovKQpdLCBfU3RkTGliLnByb3RvdHlwZSwgImRpc3BsYXlIdG1sIiwgMSk7Cl9fZGVjb3JhdGVDbGFzcyhbCiAgZWxhblByb2NlZHVyZShbXSwgMiAvKiBhc3luYyAqLykKXSwgX1N0ZExpYi5wcm90b3R5cGUsICJjbGVhckh0bWwiLCAxKTsKX19kZWNvcmF0ZUNsYXNzKFsKICBlbGFuUHJvY2VkdXJlKFsiZHVyYXRpb25NcyIsICJmcmVxdWVuY3lIeiIsICJ2b2x1bWUiXSwgMiAvKiBhc3luYyAqLyksCiAgX19kZWNvcmF0ZVBhcmFtKDAsIGVsYW5JbnRUeXBlKCkpLAogIF9fZGVjb3JhdGVQYXJhbSgxLCBlbGFuRmxvYXRUeXBlKCkpLAogIF9fZGVjb3JhdGVQYXJhbSgyLCBlbGFuRmxvYXRUeXBlKCkpCl0sIF9TdGRMaWIucHJvdG90eXBlLCAidG9uZSIsIDEpOwp2YXIgU3RkTGliID0gX1N0ZExpYjsKCi8vIHNyYy9pZGUvc3R1Yi1pbnB1dC1vdXRwdXQudHMKdmFyIFN0dWJJbnB1dE91dHB1dCA9IGNsYXNzIHsKICBjb25zdHJ1Y3RvcigpIHsKICB9CiAgcmVhZEZpbGUoKSB7CiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJzLCByaikgPT4gewogICAgICBvbm1lc3NhZ2UgPSAoZSkgPT4gewogICAgICAgIGNvbnN0IGRhdGEgPSBlLmRhdGE7CiAgICAgICAgaWYgKGRhdGEudHlwZSA9PT0gInJlYWQiKSB7CiAgICAgICAgICBycyhkYXRhLnZhbHVlKTsKICAgICAgICB9CiAgICAgICAgaWYgKGRhdGEudHlwZSA9PT0gInN0YXR1cyIgJiYgZGF0YS5zdGF0dXMgPT09ICJlcnJvciIpIHsKICAgICAgICAgIHJqKGRhdGEuZXJyb3IpOwogICAgICAgIH0KICAgICAgfTsKICAgICAgcG9zdE1lc3NhZ2UodGhpcy53cml0ZU1zZygicmVhZEZpbGUiKSk7CiAgICB9KTsKICB9CiAgd3JpdGVGaWxlKGZpbGVOYW1lLCBkYXRhKSB7CiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJzLCByaikgPT4gewogICAgICBvbm1lc3NhZ2UgPSAoZSkgPT4gewogICAgICAgIGNvbnN0IGRhdGEyID0gZS5kYXRhOwogICAgICAgIGlmIChkYXRhMi50eXBlID09PSAicmVhZCIpIHsKICAgICAgICAgIHJzKCk7CiAgICAgICAgfQogICAgICAgIGlmIChkYXRhMi50eXBlID09PSAic3RhdHVzIiAmJiBkYXRhMi5zdGF0dXMgPT09ICJlcnJvciIpIHsKICAgICAgICAgIHJqKGRhdGEyLmVycm9yKTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIHBvc3RNZXNzYWdlKHRoaXMud3JpdGVNc2coIndyaXRlRmlsZSIsIFtmaWxlTmFtZSwgZGF0YV0pKTsKICAgIH0pOwogIH0KICB3cml0ZU1zZyhmdW5jLCBwYXJhbWV0ZXJzKSB7CiAgICByZXR1cm4geyB0eXBlOiAid3JpdGUiLCBmdW5jdGlvbjogZnVuYywgcGFyYW1ldGVyczogcGFyYW1ldGVycyA/PyBbXSB9OwogIH0KICBkcmF3QmxvY2tHcmFwaGljcyhodG1sKSB7CiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJzLCByaikgPT4gewogICAgICBvbm1lc3NhZ2UgPSAoZSkgPT4gewogICAgICAgIGNvbnN0IGRhdGEgPSBlLmRhdGE7CiAgICAgICAgaWYgKGRhdGEudHlwZSA9PT0gInJlYWQiKSB7CiAgICAgICAgICBycygpOwogICAgICAgIH0KICAgICAgICBpZiAoZGF0YS50eXBlID09PSAic3RhdHVzIiAmJiBkYXRhLnN0YXR1cyA9PT0gImVycm9yIikgewogICAgICAgICAgcmooZGF0YS5lcnJvcik7CiAgICAgICAgfQogICAgICB9OwogICAgICBwb3N0TWVzc2FnZSh0aGlzLndyaXRlTXNnKCJkcmF3QmxvY2tHcmFwaGljcyIsIFtodG1sXSkpOwogICAgfSk7CiAgfQogIGNsZWFyQmxvY2tHcmFwaGljcygpIHsKICAgIHJldHVybiBuZXcgUHJvbWlzZSgocnMsIHJqKSA9PiB7CiAgICAgIG9ubWVzc2FnZSA9IChlKSA9PiB7CiAgICAgICAgY29uc3QgZGF0YSA9IGUuZGF0YTsKICAgICAgICBpZiAoZGF0YS50eXBlID09PSAicmVhZCIpIHsKICAgICAgICAgIHJzKCk7CiAgICAgICAgfQogICAgICAgIGlmIChkYXRhLnR5cGUgPT09ICJzdGF0dXMiICYmIGRhdGEuc3RhdHVzID09PSAiZXJyb3IiKSB7CiAgICAgICAgICByaihkYXRhLmVycm9yKTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIHBvc3RNZXNzYWdlKHRoaXMud3JpdGVNc2coImNsZWFyQmxvY2tHcmFwaGljcyIpKTsKICAgIH0pOwogIH0KICBkcmF3VmVjdG9yR3JhcGhpY3MoaHRtbCkgewogICAgcmV0dXJuIG5ldyBQcm9taXNlKChycywgcmopID0+IHsKICAgICAgb25tZXNzYWdlID0gKGUpID0+IHsKICAgICAgICBjb25zdCBkYXRhID0gZS5kYXRhOwogICAgICAgIGlmIChkYXRhLnR5cGUgPT09ICJyZWFkIikgewogICAgICAgICAgcnMoKTsKICAgICAgICB9CiAgICAgICAgaWYgKGRhdGEudHlwZSA9PT0gInN0YXR1cyIgJiYgZGF0YS5zdGF0dXMgPT09ICJlcnJvciIpIHsKICAgICAgICAgIHJqKGRhdGEuZXJyb3IpOwogICAgICAgIH0KICAgICAgfTsKICAgICAgcG9zdE1lc3NhZ2UodGhpcy53cml0ZU1zZygiZHJhd1ZlY3RvckdyYXBoaWNzIiwgW2h0bWxdKSk7CiAgICB9KTsKICB9CiAgY2xlYXJWZWN0b3JHcmFwaGljcygpIHsKICAgIHJldHVybiBuZXcgUHJvbWlzZSgocnMsIHJqKSA9PiB7CiAgICAgIG9ubWVzc2FnZSA9IChlKSA9PiB7CiAgICAgICAgY29uc3QgZGF0YSA9IGUuZGF0YTsKICAgICAgICBpZiAoZGF0YS50eXBlID09PSAicmVhZCIpIHsKICAgICAgICAgIHJzKCk7CiAgICAgICAgfQogICAgICAgIGlmIChkYXRhLnR5cGUgPT09ICJzdGF0dXMiICYmIGRhdGEuc3RhdHVzID09PSAiZXJyb3IiKSB7CiAgICAgICAgICByaihkYXRhLmVycm9yKTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIHBvc3RNZXNzYWdlKHRoaXMud3JpdGVNc2coImNsZWFyVmVjdG9yR3JhcGhpY3MiKSk7CiAgICB9KTsKICB9CiAgY2xlYXJEaXNwbGF5KCkgewogICAgcmV0dXJuIG5ldyBQcm9taXNlKChycywgcmopID0+IHsKICAgICAgb25tZXNzYWdlID0gKGUpID0+IHsKICAgICAgICBjb25zdCBkYXRhID0gZS5kYXRhOwogICAgICAgIGlmIChkYXRhLnR5cGUgPT09ICJyZWFkIikgewogICAgICAgICAgcnMoKTsKICAgICAgICB9CiAgICAgICAgaWYgKGRhdGEudHlwZSA9PT0gInN0YXR1cyIgJiYgZGF0YS5zdGF0dXMgPT09ICJlcnJvciIpIHsKICAgICAgICAgIHJqKGRhdGEuZXJyb3IpOwogICAgICAgIH0KICAgICAgfTsKICAgICAgcG9zdE1lc3NhZ2UodGhpcy53cml0ZU1zZygiY2xlYXJBbGxHcmFwaGljcyIpKTsKICAgIH0pOwogIH0KICBwcmludExpbmUodGV4dCkgewogICAgcmV0dXJuIG5ldyBQcm9taXNlKChycywgcmopID0+IHsKICAgICAgb25tZXNzYWdlID0gKGUpID0+IHsKICAgICAgICBjb25zdCBkYXRhID0gZS5kYXRhOwogICAgICAgIGlmIChkYXRhLnR5cGUgPT09ICJyZWFkIikgewogICAgICAgICAgcnMoKTsKICAgICAgICB9CiAgICAgICAgaWYgKGRhdGEudHlwZSA9PT0gInN0YXR1cyIgJiYgZGF0YS5zdGF0dXMgPT09ICJlcnJvciIpIHsKICAgICAgICAgIHJqKGRhdGEuZXJyb3IpOwogICAgICAgIH0KICAgICAgfTsKICAgICAgcG9zdE1lc3NhZ2UodGhpcy53cml0ZU1zZygicHJpbnRMaW5lIiwgW3RleHRdKSk7CiAgICB9KTsKICB9CiAgcHJpbnQodGV4dCkgewogICAgcmV0dXJuIG5ldyBQcm9taXNlKChycywgcmopID0+IHsKICAgICAgb25tZXNzYWdlID0gKGUpID0+IHsKICAgICAgICBjb25zdCBkYXRhID0gZS5kYXRhOwogICAgICAgIGlmIChkYXRhLnR5cGUgPT09ICJyZWFkIikgewogICAgICAgICAgcnMoKTsKICAgICAgICB9CiAgICAgICAgaWYgKGRhdGEudHlwZSA9PT0gInN0YXR1cyIgJiYgZGF0YS5zdGF0dXMgPT09ICJlcnJvciIpIHsKICAgICAgICAgIHJqKGRhdGEuZXJyb3IpOwogICAgICAgIH0KICAgICAgfTsKICAgICAgcG9zdE1lc3NhZ2UodGhpcy53cml0ZU1zZygicHJpbnQiLCBbdGV4dF0pKTsKICAgIH0pOwogIH0KICBwcmludFRhYihwb3NpdGlvbiwgdGV4dCkgewogICAgcmV0dXJuIG5ldyBQcm9taXNlKChycywgcmopID0+IHsKICAgICAgb25tZXNzYWdlID0gKGUpID0+IHsKICAgICAgICBjb25zdCBkYXRhID0gZS5kYXRhOwogICAgICAgIGlmIChkYXRhLnR5cGUgPT09ICJyZWFkIikgewogICAgICAgICAgcnMoKTsKICAgICAgICB9CiAgICAgICAgaWYgKGRhdGEudHlwZSA9PT0gInN0YXR1cyIgJiYgZGF0YS5zdGF0dXMgPT09ICJlcnJvciIpIHsKICAgICAgICAgIHJqKGRhdGEuZXJyb3IpOwogICAgICAgIH0KICAgICAgfTsKICAgICAgcG9zdE1lc3NhZ2UodGhpcy53cml0ZU1zZygicHJpbnRUYWIiLCBbcG9zaXRpb24sIHRleHRdKSk7CiAgICB9KTsKICB9CiAgc3RvcFJlYWRpbmcoKSB7CiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJzLCByaikgPT4gewogICAgICBvbm1lc3NhZ2UgPSAoZSkgPT4gewogICAgICAgIGNvbnN0IGRhdGEgPSBlLmRhdGE7CiAgICAgICAgaWYgKGRhdGEudHlwZSA9PT0gInJlYWQiKSB7CiAgICAgICAgICBycygpOwogICAgICAgIH0KICAgICAgICBpZiAoZGF0YS50eXBlID09PSAic3RhdHVzIiAmJiBkYXRhLnN0YXR1cyA9PT0gImVycm9yIikgewogICAgICAgICAgcmooZGF0YS5lcnJvcik7CiAgICAgICAgfQogICAgICB9OwogICAgICBwb3N0TWVzc2FnZSh0aGlzLndyaXRlTXNnKCJzdG9wUmVhZGluZyIpKTsKICAgIH0pOwogIH0KICByZWFkTGluZSgpIHsKICAgIHJldHVybiBuZXcgUHJvbWlzZSgocnMpID0+IHsKICAgICAgb25tZXNzYWdlID0gKGUpID0+IHsKICAgICAgICBjb25zdCBkYXRhID0gZS5kYXRhOwogICAgICAgIGlmIChkYXRhLnR5cGUgPT09ICJyZWFkIikgewogICAgICAgICAgcnMoZGF0YS52YWx1ZSk7CiAgICAgICAgfQogICAgICB9OwogICAgICBwb3N0TWVzc2FnZSh0aGlzLndyaXRlTXNnKCJyZWFkTGluZSIpKTsKICAgIH0pOwogIH0KICB3YWl0Rm9yQW55S2V5KCkgewogICAgcmV0dXJuIG5ldyBQcm9taXNlKChycykgPT4gewogICAgICBvbm1lc3NhZ2UgPSAoX2UpID0+IHsKICAgICAgICBycygpOwogICAgICB9OwogICAgICBwb3N0TWVzc2FnZSh0aGlzLndyaXRlTXNnKCJ3YWl0Rm9yQW55S2V5IikpOwogICAgfSk7CiAgfQogIHdhaXRGb3JLZXkoKSB7CiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJzKSA9PiB7CiAgICAgIG9ubWVzc2FnZSA9IChlKSA9PiB7CiAgICAgICAgY29uc3QgZGF0YSA9IGUuZGF0YTsKICAgICAgICBpZiAoZGF0YS50eXBlID09PSAicmVhZCIpIHsKICAgICAgICAgIHJzKGRhdGEudmFsdWUpOwogICAgICAgIH0KICAgICAgfTsKICAgICAgcG9zdE1lc3NhZ2UodGhpcy53cml0ZU1zZygid2FpdEZvcktleSIpKTsKICAgIH0pOwogIH0KICBnZXRLZXkoKSB7CiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJzKSA9PiB7CiAgICAgIG9ubWVzc2FnZSA9IChlKSA9PiB7CiAgICAgICAgY29uc3QgZGF0YSA9IGUuZGF0YTsKICAgICAgICBpZiAoZGF0YS50eXBlID09PSAicmVhZCIpIHsKICAgICAgICAgIHJzKGRhdGEudmFsdWUpOwogICAgICAgIH0KICAgICAgfTsKICAgICAgcG9zdE1lc3NhZ2UodGhpcy53cml0ZU1zZygiZ2V0S2V5IikpOwogICAgfSk7CiAgfQogIGdldE1vZEtleShlKSB7CiAgICByZXR1cm4gZS5jdHJsS2V5ID8gIkNvbnRyb2wiIDogZS5zaGlmdEtleSA/ICJTaGlmdCIgOiBlLmFsdEtleSA/ICJBbHQiIDogIiI7CiAgfQogIGdldEtleVdpdGhNb2RpZmllcigpIHsKICAgIHJldHVybiBuZXcgUHJvbWlzZSgocnMpID0+IHsKICAgICAgb25tZXNzYWdlID0gKGUpID0+IHsKICAgICAgICBjb25zdCBkYXRhID0gZS5kYXRhOwogICAgICAgIGlmIChkYXRhLnR5cGUgPT09ICJyZWFkIikgewogICAgICAgICAgcnMoZGF0YS52YWx1ZSk7CiAgICAgICAgfQogICAgICB9OwogICAgICBwb3N0TWVzc2FnZSh0aGlzLndyaXRlTXNnKCJnZXRLZXlXaXRoTW9kaWZpZXIiKSk7CiAgICB9KTsKICB9CiAgY2xlYXJLZXlCdWZmZXIoKSB7CiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJzLCByaikgPT4gewogICAgICBvbm1lc3NhZ2UgPSAoZSkgPT4gewogICAgICAgIGNvbnN0IGRhdGEgPSBlLmRhdGE7CiAgICAgICAgaWYgKGRhdGEudHlwZSA9PT0gInJlYWQiKSB7CiAgICAgICAgICBycygpOwogICAgICAgIH0KICAgICAgICBpZiAoZGF0YS50eXBlID09PSAic3RhdHVzIiAmJiBkYXRhLnN0YXR1cyA9PT0gImVycm9yIikgewogICAgICAgICAgcmooZGF0YS5lcnJvcik7CiAgICAgICAgfQogICAgICB9OwogICAgICBwb3N0TWVzc2FnZSh0aGlzLndyaXRlTXNnKCJjbGVhcktleUJ1ZmZlciIpKTsKICAgIH0pOwogIH0KICBjbGVhclByaW50ZWRUZXh0KCkgewogICAgcmV0dXJuIG5ldyBQcm9taXNlKChycywgcmopID0+IHsKICAgICAgb25tZXNzYWdlID0gKGUpID0+IHsKICAgICAgICBjb25zdCBkYXRhID0gZS5kYXRhOwogICAgICAgIGlmIChkYXRhLnR5cGUgPT09ICJyZWFkIikgewogICAgICAgICAgcnMoKTsKICAgICAgICB9CiAgICAgICAgaWYgKGRhdGEudHlwZSA9PT0gInN0YXR1cyIgJiYgZGF0YS5zdGF0dXMgPT09ICJlcnJvciIpIHsKICAgICAgICAgIHJqKGRhdGEuZXJyb3IpOwogICAgICAgIH0KICAgICAgfTsKICAgICAgcG9zdE1lc3NhZ2UodGhpcy53cml0ZU1zZygiY2xlYXJQcmludGVkVGV4dCIpKTsKICAgIH0pOwogIH0KICBjbGVhclN5c3RlbUluZm8oKSB7CiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJzLCByaikgPT4gewogICAgICBvbm1lc3NhZ2UgPSAoZSkgPT4gewogICAgICAgIGNvbnN0IGRhdGEgPSBlLmRhdGE7CiAgICAgICAgaWYgKGRhdGEudHlwZSA9PT0gInJlYWQiKSB7CiAgICAgICAgICBycygpOwogICAgICAgIH0KICAgICAgICBpZiAoZGF0YS50eXBlID09PSAic3RhdHVzIiAmJiBkYXRhLnN0YXR1cyA9PT0gImVycm9yIikgewogICAgICAgICAgcmooZGF0YS5lcnJvcik7CiAgICAgICAgfQogICAgICB9OwogICAgICBwb3N0TWVzc2FnZSh0aGlzLndyaXRlTXNnKCJjbGVhclN5c3RlbUluZm8iKSk7CiAgICB9KTsKICB9CiAgZHJhd0h0bWwoaHRtbCkgewogICAgcmV0dXJuIG5ldyBQcm9taXNlKChycywgcmopID0+IHsKICAgICAgb25tZXNzYWdlID0gKGUpID0+IHsKICAgICAgICBjb25zdCBkYXRhID0gZS5kYXRhOwogICAgICAgIGlmIChkYXRhLnR5cGUgPT09ICJyZWFkIikgewogICAgICAgICAgcnMoKTsKICAgICAgICB9CiAgICAgICAgaWYgKGRhdGEudHlwZSA9PT0gInN0YXR1cyIgJiYgZGF0YS5zdGF0dXMgPT09ICJlcnJvciIpIHsKICAgICAgICAgIHJqKGRhdGEuZXJyb3IpOwogICAgICAgIH0KICAgICAgfTsKICAgICAgcG9zdE1lc3NhZ2UodGhpcy53cml0ZU1zZygiZHJhd0h0bWwiLCBbaHRtbF0pKTsKICAgIH0pOwogIH0KICBjbGVhckh0bWwoKSB7CiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJzLCByaikgPT4gewogICAgICBvbm1lc3NhZ2UgPSAoZSkgPT4gewogICAgICAgIGNvbnN0IGRhdGEgPSBlLmRhdGE7CiAgICAgICAgaWYgKGRhdGEudHlwZSA9PT0gInJlYWQiKSB7CiAgICAgICAgICBycygpOwogICAgICAgIH0KICAgICAgICBpZiAoZGF0YS50eXBlID09PSAic3RhdHVzIiAmJiBkYXRhLnN0YXR1cyA9PT0gImVycm9yIikgewogICAgICAgICAgcmooZGF0YS5lcnJvcik7CiAgICAgICAgfQogICAgICB9OwogICAgICBwb3N0TWVzc2FnZSh0aGlzLndyaXRlTXNnKCJjbGVhckh0bWwiKSk7CiAgICB9KTsKICB9CiAgdG9uZShkdXJhdGlvbiwgZnJlcXVlbmN5LCB2b2x1bWUpIHsKICAgIHJldHVybiBuZXcgUHJvbWlzZSgocnMsIHJqKSA9PiB7CiAgICAgIG9ubWVzc2FnZSA9IChlKSA9PiB7CiAgICAgICAgY29uc3QgZGF0YSA9IGUuZGF0YTsKICAgICAgICBpZiAoZGF0YS50eXBlID09PSAicmVhZCIpIHsKICAgICAgICAgIHJzKCk7CiAgICAgICAgfQogICAgICAgIGlmIChkYXRhLnR5cGUgPT09ICJzdGF0dXMiICYmIGRhdGEuc3RhdHVzID09PSAiZXJyb3IiKSB7CiAgICAgICAgICByaihkYXRhLmVycm9yKTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIHBvc3RNZXNzYWdlKHRoaXMud3JpdGVNc2coInRvbmUiLCBbZHVyYXRpb24sIGZyZXF1ZW5jeSwgdm9sdW1lXSkpOwogICAgfSk7CiAgfQogIGJyZWFrUG9pbnQoYWxsU2NvcGVkU3ltYm9sczIsIGlkLCBzaW5nbGVzdGVwKSB7CiAgICBsZXQgcGF1c2VkID0gdHJ1ZTsKICAgIGxldCBuZXh0UGF1c2UgPSBmYWxzZTsKICAgIGFkZEV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLCBhc3luYyAoZSkgPT4gewogICAgICBpZiAoZS5kYXRhLnR5cGUgPT09ICJyZXN1bWUiKSB7CiAgICAgICAgcGF1c2VkID0gZmFsc2U7CiAgICAgIH0KICAgICAgaWYgKGUuZGF0YS50eXBlID09PSAicGF1c2UiKSB7CiAgICAgICAgbmV4dFBhdXNlID0gdHJ1ZTsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJzKSA9PiB7CiAgICAgIHBvc3RNZXNzYWdlKHsKICAgICAgICB0eXBlOiBzaW5nbGVzdGVwID8gInNpbmdsZXN0ZXAiIDogImJyZWFrcG9pbnQiLAogICAgICAgIHZhbHVlOiBhbGxTY29wZWRTeW1ib2xzMiwKICAgICAgICBwYXVzZWRBdDogaWQKICAgICAgfSk7CiAgICAgIGNvbnN0IHRpbWVPdXQgPSBzZXRJbnRlcnZhbChhc3luYyAoKSA9PiB7CiAgICAgICAgaWYgKCFwYXVzZWQpIHsKICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGltZU91dCk7CiAgICAgICAgICBycyhuZXh0UGF1c2UpOwogICAgICAgIH0KICAgICAgfSwgMSk7CiAgICB9KTsKICB9Cn07CmV4cG9ydCB7CiAgU3RkTGliLAogIFN0dWJJbnB1dE91dHB1dAp9OwovKiEgQnVuZGxlZCBsaWNlbnNlIGluZm9ybWF0aW9uOgoKcmVmbGVjdC1tZXRhZGF0YS9SZWZsZWN0LmpzOgogICgqISAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKgogIENvcHlyaWdodCAoQykgTWljcm9zb2Z0LiBBbGwgcmlnaHRzIHJlc2VydmVkLgogIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSAiTGljZW5zZSIpOyB5b3UgbWF5IG5vdCB1c2UKICB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4gWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZQogIExpY2Vuc2UgYXQgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCiAgCiAgVEhJUyBDT0RFIElTIFBST1ZJREVEIE9OIEFOICpBUyBJUyogQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWQogIEtJTkQsIEVJVEhFUiBFWFBSRVNTIE9SIElNUExJRUQsIElOQ0xVRElORyBXSVRIT1VUIExJTUlUQVRJT04gQU5ZIElNUExJRUQKICBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgVElUTEUsIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLAogIE1FUkNIQU5UQUJMSVRZIE9SIE5PTi1JTkZSSU5HRU1FTlQuCiAgCiAgU2VlIHRoZSBBcGFjaGUgVmVyc2lvbiAyLjAgTGljZW5zZSBmb3Igc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zCiAgYW5kIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqICopCiovCmxldCBzeXN0ZW07IGxldCBfc3RkbGliOyBsZXQgX3Rlc3RzID0gW107IGxldCBfX3BhdXNlID0gZmFsc2U7IGFzeW5jIGZ1bmN0aW9uIHByb2dyYW0oKSB7IF9zdGRsaWIgPSBuZXcgU3RkTGliKG5ldyBTdHViSW5wdXRPdXRwdXQoKSk7IHN5c3RlbSA9IF9zdGRsaWIuc3lzdGVtOyBzeXN0ZW0uc3RkbGliID0gX3N0ZGxpYiAgCmNvbnN0IGdsb2JhbCA9IG5ldyBjbGFzcyB7DQogIGdyZWVuID0gIiM2YWFhNjQiOw0KDQogIHllbGxvdyA9ICIjYzliNDU4IjsNCg0KICBncmV5ID0gIiM3ODdlN2MiOw0KDQp9Ow0KYXN5bmMgZnVuY3Rpb24gbWFpbigpIHsNCiAgY29uc3QgaHRtbCA9IChhd2FpdCBnbG9iYWwud29yZEh0bWwoIlJBSVNFIiwgIiorX18rIikpOw0KICBjb25zdCBzdHlsZXMgPSBgPHN0eWxlPnNwYW4gJHthd2FpdCBfc3RkbGliLmFzU3RyaW5nKF9zdGRsaWIub3BlbkJyYWNlKX0gZm9udC1zaXplOiAyNHB0OyBwYWRkaW5nLWxlZnQ6IDAuM2VtOyBwYWRkaW5nLXJpZ2h0OiAwLjNlbTsgZm9udC1mYW1pbHk6IG1vbm9zcGFjZTsgZm9udC13ZWlnaHQ6IGJvbGQ7IGNvbG9yOiB3aGl0ZTsgYm9yZGVyLXN0eWxlOiBzb2xpZDsgYm9yZGVyLWNvbG9yOiB3aGl0ZTsgYm9yZGVyLXdpZHRoOiAycHg7ICR7YXdhaXQgX3N0ZGxpYi5hc1N0cmluZyhfc3RkbGliLmNsb3NlQnJhY2UpfTwvc3R5bGUgPiBgOw0KICBhd2FpdCBfc3RkbGliLmRpc3BsYXlIdG1sKHN0eWxlcyArIGh0bWwpOw0KfQ0KDQphc3luYyBmdW5jdGlvbiB3b3JkSHRtbCh3b3JkLCBtYXJrKSB7DQogIGxldCByZXN1bHQgPSAiIjsNCiAgZm9yIChsZXQgaSA9IDA7IGkgPD0gNDsgaSA9IGkgKyAxKSB7DQogICAgcmVzdWx0ID0gcmVzdWx0ICsgKGF3YWl0IGdsb2JhbC5sZXR0ZXJIdG1sKHN5c3RlbS5zYWZlSW5kZXgod29yZCwgaSksIHN5c3RlbS5zYWZlSW5kZXgobWFyaywgaSkpKTsNCiAgfQ0KICByZXR1cm4gcmVzdWx0Ow0NCn0KZ2xvYmFsWyJ3b3JkSHRtbCJdID0gd29yZEh0bWw7Cg0KYXN5bmMgZnVuY3Rpb24gbGV0dGVySHRtbChsZXR0ZXIsIHN0YXR1cykgew0KICBjb25zdCBjb2xvdXIgPSBzdGF0dXMgPT09ICIqIiA/IGdsb2JhbC5ncmVlbiA6IHN0YXR1cyA9PT0gIisiID8gZ2xvYmFsLnllbGxvdyA6IGdsb2JhbC5ncmV5Ow0KICByZXR1cm4gYDxzcGFuIHN0eWxlPSdiYWNrZ3JvdW5kLWNvbG9yOiAke2F3YWl0IF9zdGRsaWIuYXNTdHJpbmcoY29sb3VyKX07Jz4ke2F3YWl0IF9zdGRsaWIuYXNTdHJpbmcobGV0dGVyKX08L3NwYW4+YDsNDQp9Cmdsb2JhbFsibGV0dGVySHRtbCJdID0gbGV0dGVySHRtbDsKcmV0dXJuIFttYWluLCBfdGVzdHNdO30KYWRkRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIsIGFzeW5jIChlKSA9PiB7CiAgaWYgKGUuZGF0YS50eXBlID09PSAic3RhcnQiKSB7CiAgICB0cnkgewogICAgICBjb25zdCBbbWFpbiwgdGVzdHNdID0gYXdhaXQgcHJvZ3JhbSgpOwogICAgICBhd2FpdCBtYWluKCk7CiAgICAgIHBvc3RNZXNzYWdlKHt0eXBlIDogInN0YXR1cyIsIHN0YXR1cyA6ICJmaW5pc2hlZCJ9KTsKICAgIH0KICAgIGNhdGNoIChlKSB7CiAgICAgIHBvc3RNZXNzYWdlKHt0eXBlIDogInN0YXR1cyIsIHN0YXR1cyA6ICJlcnJvciIsIGVycm9yIDogZX0pOwogICAgfQogIH0KICBpZiAoZS5kYXRhLnR5cGUgPT09ICJwYXVzZSIpIHsKICAgIF9fcGF1c2UgPSB0cnVlOwogIH0KICB9KTs=`;
  displayDiv.addEventListener("click", () => {
    displayDiv.getElementsByTagName("input")?.[0]?.focus();
  });
  function runProgram() {
    try {
      runWorker = new Worker(jsCode, { type: "module" });
      runWorker.onmessage = async (e) => {
        const data = e.data;
        switch (data.type) {
          case "write":
            await handleWorkerIO(data);
            break;
          case "status":
            switch (data.status) {
              case "finished":
                handleRunWorkerFinished();
                break;
              case "error":
                await handleRunWorkerError(data);
                break;
            }
        }
      };
      runWorker.onerror = async (ev) => {
        console.warn(ev.message);
      };
      runWorker.postMessage({ type: "start" });
    } catch (e) {
      console.warn(e);
    }
  }
  var isChrome = checkIsChrome();
  var okToContinue = isChrome || confirmContinueOnNonChromeBrowser();
  if (okToContinue) {
    runProgram();
  }
  async function handleWorkerIO(data) {
    switch (data.function) {
      case "readLine":
        const line = await elanInputOutput.readLine();
        runWorker?.postMessage(readMsg(line));
        break;
      case "waitForAnyKey":
        await elanInputOutput.waitForAnyKey();
        runWorker?.postMessage(readMsg(""));
        break;
      case "getKey":
        const key = await elanInputOutput.getKey();
        runWorker?.postMessage(readMsg(key));
        break;
      case "getKeyWithModifier":
        const keyWithMod = await elanInputOutput.getKeyWithModifier();
        runWorker?.postMessage(readMsg(keyWithMod));
        break;
      case "readFile":
        try {
          const file = await elanInputOutput.readFile();
          runWorker?.postMessage(readMsg(file));
        } catch (e) {
          runWorker?.postMessage(errorMsg(e));
        }
        break;
      case "writeFile":
        try {
          await elanInputOutput.writeFile(data.parameters[0], data.parameters[1]);
          runWorker?.postMessage(readMsg(""));
        } catch (e) {
          runWorker?.postMessage(errorMsg(e));
        }
        break;
      default:
        try {
          await elanInputOutput[data.function](...data.parameters);
          runWorker?.postMessage(readMsg(""));
        } catch (e) {
          runWorker?.postMessage(errorMsg(e));
        }
        break;
    }
  }
  function handleRunWorkerFinished() {
    runWorker?.terminate();
    runWorker = void 0;
    console.info("elan program completed OK");
  }
  async function handleRunWorkerError(data) {
    runWorker?.terminate();
    runWorker = void 0;
    console.warn(data.error);
  }
})();
</script>
    </body>
</html>